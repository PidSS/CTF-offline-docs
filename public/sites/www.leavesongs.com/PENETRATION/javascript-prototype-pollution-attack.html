

<html class="no-js">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="keywords" content="" />
    <meta name="description" content="phith0n的小站，长期存在与分享关于网络安全与各种编程的原创文章。" />
    <title>深入理解 JavaScript Prototype 污染攻击 | 离别歌</title>
    <link rel="alternate" type="application/atom+xml" href="../feed/index.rss" title="离别歌" />
    <link href="../static/deep/css/base.css" rel="stylesheet" type="text/css" />
    <link href="../static/deep/css/style.css" rel="stylesheet" type="text/css" />
    <link rel="shortcut icon" href="../static/deep/images/favicon.ico" />
    
<style>div.row .col-xs-4 {
  float: left;
  margin-left: 4px;
}
div.row .col-xs-4 img {
  margin-left: 5px;
}
</style>
<link href="https://cdn.staticfile.org/fancybox/2.1.7/css/jquery.fancybox.min.css" rel="stylesheet">
<link rel="stylesheet" href="../static/deep/css/code.css">

</head>
<body>
<!--[if lt IE 8]>
    <div class="browsehappy" role="dialog">当前网页 <strong>不支持</strong> 你正在使用的浏览器. 为了正常的访问, 请 <a href="http://browsehappy.com/">升级你的浏览器</a>.</div>
<![endif]-->
<div id="header">
    <div class="container">
        <h1 class="h1-title">
            <a href="../index.html">
               <img src="../static/deep/images/logo.png" alt="离别歌" />
            </a>
        </h1>
        <div id="nav">
        <input type="checkbox" id="button">
        <label for="button" onclick>菜单</label>
        
        <ul>
            
            <li class="item ">
                <a href="../index.html" >首页</a>
            </li>
            
            <li class="item ">
                <a href="../list/index.html" >文章</a>
            </li>
            
            <li class="item ">
                <a href="../other/tinger.html" >关于</a>
            </li>
            
            <li class="item ">
                <a href="../other/friends-link.html" >友链</a>
            </li>
            
            <li class="item ">
                <a href="https://github.com/phith0n" target="_blank" >项目</a>
            </li>
            
            <li class="item ">
                <a href="https://www.leavesongs.com/PENETRATION/code-auditor-secret-group.html" target="_blank" >代码审计</a>
            </li>
            
        </ul>
        
        </div>
    </div>
</div>

<div class="banner-bar">
    <div class="container">
        <div class="col-12 columns">
            <div class="place">
                <a href="../index.html">首页</a>
                &raquo;
                
                网络安全 &raquo; <a href="javascript-prototype-pollution-attack.html">深入理解 JavaScript Prototype 污染攻击</a>
                
            </div>
        </div>
    </div>
</div>
<div class="container">
    <div class="col-11 columns" id="mainbody" role="main">
        <div class="post-single type-post">
            <h1 class="article-h1">深入理解 JavaScript Prototype 污染攻击</h1>
            <div class="details-up">
  <span class="author">作者: phithon</span>
  
  <span class="category">分类: <a href="../sort/PENETRATION.html">网络安全</a></span>
  
  <span class="date">时间: 2019-4-3 0:15</span>
  <span class="comments-top" itemprop="interactionCount">评论：<a itemprop="discussionUrl" href="#reply-list">27条评论</a></span>
  <span class="comments-top" itemprop="interactionCount">浏览：<a itemprop="discussionUrl" href="javascript-prototype-pollution-attack.html">60036人看过</a></span>
  
  <span class="date">标签:
    
        <a href="../tag/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93.html">原型链污染</a>
    
        <a href="../tag/javascript.html">javascript</a>
    
  </span>
  
</div>
            <div class="entry">
                <p>本来是想发在<a href="https://zsxq.tricking.io/landpage/">代码审计知识星球</a>里的一篇科普文章，因为最近知识星球似乎在和神秘组织对接，无法发表内容，所以发在博客里。Code-Breaking官方writeup拖了很久，主要是没时间，不过外面已经有很多同学的writeup了，所以问题不大。</p>
<p>JavaScript是一门非常灵活的语言，我感觉在某些方面可能比PHP更加灵活。所以，除了传统的SQL注入、代码执行等注入型漏洞外，也会有一些独有的安全问题，比如今天要说这个prototype污染。</p>
<h2 id="0x01-prototype__proto__"><a class="toclink" href="#0x01-prototype__proto__">0x01 <code>prototype</code>和<code>__proto__</code>分别是什么？</a></h2>
<p>JavaScript中，我们如果要定义一个类，需要以定义“构造函数”的方式来定义：</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="k">new</span> <span class="nx">Foo</span><span class="p">()</span>
</pre></div>


<p><code>Foo</code>函数的内容，就是<code>Foo</code>类的构造函数，而<code>this.bar</code>就是<code>Foo</code>类的一个属性。</p>
<blockquote>
<p>为了简化编写JavaScript代码，ECMAScript 6后增加了<code>class</code>语法，但<code>class</code>其实只是一个语法糖。</p>
</blockquote>
<p>一个类必然有一些方法，类似属性<code>this.bar</code>，我们也可以将方法定义在构造函数内部：</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bar</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="p">(</span><span class="k">new</span> <span class="nx">Foo</span><span class="p">()).</span><span class="nx">show</span><span class="p">()</span>
</pre></div>


<p>但这样写有一个问题，就是每当我们新建一个Foo对象时，<code>this.show = function...</code>就会执行一次，这个<code>show</code>方法实际上是绑定在对象上的，而不是绑定在“类”中。</p>
<p>我希望在创建类的时候只创建一次<code>show</code>方法，这时候就则需要使用原型（prototype）了：</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">Foo</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span>

<span class="nx">Foo</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">show</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">show</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">bar</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Foo</span><span class="p">()</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">show</span><span class="p">()</span>
</pre></div>


<p><a href="../media/attachment/2019/04/03/46109c07-bfa1-4b92-93a2-d86049274035.png"><img alt="image.png" src="../media/attachment/2019/04/03/46109c07-bfa1-4b92-93a2-d86049274035.0dcd4f4c4400.png" /></a></p>
<p>我们可以认为原型<code>prototype</code>是类<code>Foo</code>的一个属性，而所有用<code>Foo</code>类实例化的对象，都将拥有这个属性中的所有内容，包括变量和方法。比如上图中的<code>foo</code>对象，其天生就具有<code>foo.show()</code>方法。</p>
<p>我们可以通过<code>Foo.prototype</code>来访问<code>Foo</code>类的原型，但<code>Foo</code>实例化出来的对象，是不能通过prototype访问原型的。这时候，就该<code>__proto__</code>登场了。</p>
<p>一个Foo类实例化出来的foo对象，可以通过<code>foo.__proto__</code>属性来访问Foo类的原型，也就是说：</p>
<div class="codehilite"><pre><span></span><span class="n">foo</span><span class="p">.</span><span class="n">__proto__</span> <span class="o">==</span> <span class="n">Foo</span><span class="p">.</span><span class="n">prototype</span>
</pre></div>


<p><a href="../media/attachment/2019/04/03/3c4ed224-ae7b-4c8c-b16d-12b56524efee.png"><img alt="image.png" src="../media/attachment/2019/04/03/3c4ed224-ae7b-4c8c-b16d-12b56524efee.e270c75493b0.png" /></a></p>
<p>所以，总结一下：</p>
<ol>
<li><code>prototype</code>是一个类的属性，所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法</li>
<li>一个对象的<code>__proto__</code>属性，指向这个对象所在的类的<code>prototype</code>属性</li>
</ol>
<h2 id="0x02-javascript"><a class="toclink" href="#0x02-javascript">0x02 JavaScript原型链继承</a></h2>
<p>所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法，这个特性被用来实现JavaScript中的继承机制。</p>
<p>比如：</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">Father</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">first_name</span> <span class="o">=</span> <span class="s1">&#39;Donald&#39;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">last_name</span> <span class="o">=</span> <span class="s1">&#39;Trump&#39;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">Son</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">first_name</span> <span class="o">=</span> <span class="s1">&#39;Melania&#39;</span>
<span class="p">}</span>

<span class="nx">Son</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Father</span><span class="p">()</span>

<span class="kd">let</span> <span class="nx">son</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Son</span><span class="p">()</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Name: </span><span class="si">${</span><span class="nx">son</span><span class="p">.</span><span class="nx">first_name</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">son</span><span class="p">.</span><span class="nx">last_name</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</pre></div>


<p>Son类继承了Father类的<code>last_name</code>属性，最后输出的是<code>Name: Melania Trump</code>。</p>
<p>总结一下，对于对象son，在调用<code>son.last_name</code>的时候，实际上JavaScript引擎会进行如下操作：</p>
<ol>
<li>在对象son中寻找last_name</li>
<li>如果找不到，则在<code>son.__proto__</code>中寻找last_name</li>
<li>如果仍然找不到，则继续在<code>son.__proto__.__proto__</code>中寻找last_name</li>
<li>依次寻找，直到找到<code>null</code>结束。比如，<code>Object.prototype</code>的<code>__proto__</code>就是<code>null</code></li>
</ol>
<p><a href="../media/attachment/2019/04/03/08c5d5d0-62da-40f9-9e2c-77831fa7488e.png"><img alt="image.png" src="../media/attachment/2019/04/03/08c5d5d0-62da-40f9-9e2c-77831fa7488e.51324dd04eef.png" /></a></p>
<p>JavaScript的这个查找的机制，被运用在面向对象的继承中，被称作prototype继承链。</p>
<p>以上就是最基础的JavaScript面向对象编程，我们并不深入研究更细节的内容，只要牢记以下几点即可：</p>
<ol>
<li>每个构造函数(constructor)都有一个原型对象(prototype)</li>
<li>对象的<code>__proto__</code>属性，指向类的原型对象<code>prototype</code></li>
<li>JavaScript使用prototype链实现继承机制</li>
</ol>
<h2 id="0x03"><a class="toclink" href="#0x03">0x03 原型链污染是什么</a></h2>
<p>第一章中说到，<code>foo.__proto__</code>指向的是<code>Foo</code>类的<code>prototype</code>。那么，如果我们修改了<code>foo.__proto__</code>中的值，是不是就可以修改Foo类呢？</p>
<p>做个简单的实验：</p>
<div class="codehilite"><pre><span></span><span class="c1">// foo是一个简单的JavaScript对象</span>
<span class="kd">let</span> <span class="nx">foo</span> <span class="o">=</span> <span class="p">{</span><span class="nx">bar</span><span class="o">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1">// foo.bar 此时为1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">)</span>

<span class="c1">// 修改foo的原型（即Object）</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">__proto__</span><span class="p">.</span><span class="nx">bar</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1">// 由于查找顺序的原因，foo.bar仍然是1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">bar</span><span class="p">)</span>

<span class="c1">// 此时再用Object创建一个空的zoo对象</span>
<span class="kd">let</span> <span class="nx">zoo</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1">// 查看zoo.bar</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">zoo</span><span class="p">.</span><span class="nx">bar</span><span class="p">)</span>
</pre></div>


<p>最后，虽然zoo是一个<strong>空</strong>对象<code>{}</code>，但<code>zoo.bar</code>的结果居然是2：</p>
<p><a href="../media/attachment/2019/04/03/4b63f1ef-6ed8-4448-9644-f11620822aaf.png"><img alt="image.png" src="../media/attachment/2019/04/03/4b63f1ef-6ed8-4448-9644-f11620822aaf.2b2425c31fdb.png" /></a></p>
<p>原因也显而易见：因为前面我们修改了foo的原型<code>foo.__proto__.bar = 2</code>，而foo是一个Object类的实例，所以实际上是修改了Object这个类，给这个类增加了一个属性bar，值为2。</p>
<p>后来，我们又用Object类创建了一个zoo对象<code>let zoo = {}</code>，zoo对象自然也有一个bar属性了。</p>
<p>那么，在一个应用中，如果攻击者控制并修改了一个对象的原型，那么将可以影响所有和这个对象来自同一个类、父祖类的对象。这种攻击方式就是<strong>原型链污染</strong>。</p>
<h2 id="0x04"><a class="toclink" href="#0x04">0x04 哪些情况下原型链会被污染？</a></h2>
<p>在实际应用中，哪些情况下可能存在原型链能被攻击者修改的情况呢？</p>
<p>我们思考一下，哪些情况下我们可以设置<code>__proto__</code>的值呢？其实找找能够控制数组（对象）的“键名”的操作即可：</p>
<ul>
<li>对象merge</li>
<li>对象clone（其实内核就是将待操作的对象merge到一个空对象中）</li>
</ul>
<p>以对象merge为例，我们想象一个简单的merge函数：</p>
<div class="codehilite"><pre><span></span><span class="kd">function</span> <span class="nx">merge</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">source</span> <span class="o">&amp;&amp;</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">merge</span><span class="p">(</span><span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">source</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">target</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">source</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>在合并的过程中，存在赋值的操作<code>target[key] = source[key]</code>，那么，这个key如果是<code>__proto__</code>，是不是就可以原型链污染呢？</p>
<p>我们用如下代码实验一下：</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nx">o1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">let</span> <span class="nx">o2</span> <span class="o">=</span> <span class="p">{</span><span class="nx">a</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;__proto__&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">b</span><span class="o">:</span> <span class="mi">2</span><span class="p">}}</span>
<span class="nx">merge</span><span class="p">(</span><span class="nx">o1</span><span class="p">,</span> <span class="nx">o2</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o1</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span> <span class="nx">o1</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>

<span class="nx">o3</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o3</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>
</pre></div>


<p>结果是，合并虽然成功了，但原型链没有被污染：</p>
<p><a href="../media/attachment/2019/04/03/ba16d965-3112-4f69-bf5e-4eddb034e6dc.png"><img alt="image.png" src="../media/attachment/2019/04/03/ba16d965-3112-4f69-bf5e-4eddb034e6dc.c5e82ea6e4f5.png" /></a></p>
<p>这是因为，我们用JavaScript创建o2的过程（<code>let o2 = {a: 1, "__proto__": {b: 2}}</code>）中，<code>__proto__</code>已经代表o2的原型了，此时遍历o2的所有键名，你拿到的是<code>[a, b]</code>，<code>__proto__</code>并不是一个key，自然也不会修改Object的原型。</p>
<p>那么，如何让<code>__proto__</code>被认为是一个键名呢？</p>
<p>我们将代码改成如下：</p>
<div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nx">o1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="kd">let</span> <span class="nx">o2</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">&#39;{&quot;a&quot;: 1, &quot;__proto__&quot;: {&quot;b&quot;: 2}}&#39;</span><span class="p">)</span>
<span class="nx">merge</span><span class="p">(</span><span class="nx">o1</span><span class="p">,</span> <span class="nx">o2</span><span class="p">)</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o1</span><span class="p">.</span><span class="nx">a</span><span class="p">,</span> <span class="nx">o1</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>

<span class="nx">o3</span> <span class="o">=</span> <span class="p">{}</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">o3</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span>
</pre></div>


<p>可见，新建的o3对象，也存在b属性，说明Object已经被污染：</p>
<p><a href="../media/attachment/2019/04/03/5e05a46f-3c7b-4ab4-869c-fe6fd19422b7.png"><img alt="image.png" src="../media/attachment/2019/04/03/5e05a46f-3c7b-4ab4-869c-fe6fd19422b7.64db1b9bbae7.png" /></a></p>
<p>这是因为，JSON解析的情况下，<code>__proto__</code>会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。</p>
<p>merge操作是最常见可能控制键名的操作，也最能被原型链攻击，很多常见的库都存在这个问题。</p>
<h2 id="0x05-code-breaking-2018-thejs"><a class="toclink" href="#0x05-code-breaking-2018-thejs">0x05 Code-Breaking 2018 Thejs 分析</a></h2>
<p>我在Code-Breaking 2018中出了一道原型链污染的CTF题目，为了更加贴合真实环境，我没有刻意加太多自己的代码，后端主要代码如下（完整代码可参考<a href="https://github.com/phith0n/code-breaking/blob/master/2018/thejs/web/server.js">这里</a>）：</p>
<div class="codehilite"><pre><span></span><span class="c1">// ...</span>
<span class="kr">const</span> <span class="nx">lodash</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash&#39;</span><span class="p">)</span>
<span class="c1">// ...</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">engine</span><span class="p">(</span><span class="s1">&#39;ejs&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span> 
<span class="c1">// define the template engine</span>
    <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">err</span><span class="p">))</span>
        <span class="kd">let</span> <span class="nx">compiled</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">.</span><span class="nx">template</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nx">rendered</span> <span class="o">=</span> <span class="nx">compiled</span><span class="p">({...</span><span class="nx">options</span><span class="p">})</span>

        <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">rendered</span><span class="p">)</span>
    <span class="p">})</span>
<span class="p">})</span>
<span class="c1">//...</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">data</span> <span class="o">||</span> <span class="p">{</span><span class="nx">language</span><span class="o">:</span> <span class="p">[],</span> <span class="nx">category</span><span class="o">:</span> <span class="p">[]}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="nx">lodash</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">)</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="nx">data</span>
    <span class="p">}</span>

    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="p">{</span>
        <span class="nx">language</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">language</span><span class="p">,</span> 
        <span class="nx">category</span><span class="o">:</span> <span class="nx">data</span><span class="p">.</span><span class="nx">category</span>
    <span class="p">})</span>
<span class="p">})</span>
</pre></div>


<p>lodash是为了弥补JavaScript原生函数功能不足而提供的一个辅助功能集，其中包含字符串、数组、对象等操作。这个Web应用中，使用了lodash提供的两个工具：</p>
<ol>
<li><code>lodash.template</code> 一个简单的模板引擎</li>
<li><code>lodash.merge</code> 函数或对象的合并</li>
</ol>
<p>其实整个应用逻辑很简单，用户提交的信息，用merge方法合并到session里，多次提交，session里最终保存你提交的所有信息。</p>
<p>而这里的<code>lodash.merge</code>操作实际上就存在原型链污染漏洞。</p>
<p>在污染原型链后，我们相当于可以给Object对象插入任意属性，这个插入的属性反应在最后的<code>lodash.template</code>中。我们看到<code>lodash.template</code>的代码：<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a></p>
<div class="codehilite"><pre><span></span><span class="c1">// Use a sourceURL for easier debugging.</span>
<span class="kd">var</span> <span class="nx">sourceURL</span> <span class="o">=</span> <span class="s1">&#39;sourceURL&#39;</span> <span class="k">in</span> <span class="nx">options</span> <span class="o">?</span> <span class="s1">&#39;//# sourceURL=&#39;</span> <span class="o">+</span> <span class="nx">options</span><span class="p">.</span><span class="nx">sourceURL</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<span class="c1">// ...</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">attempt</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nb">Function</span><span class="p">(</span><span class="nx">importsKeys</span><span class="p">,</span> <span class="nx">sourceURL</span> <span class="o">+</span> <span class="s1">&#39;return &#39;</span> <span class="o">+</span> <span class="nx">source</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">importsValues</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>


<p>options是一个对象，sourceURL取到了其<code>options.sourceURL</code>属性。这个属性原本是没有赋值的，默认取空字符串。</p>
<p>但因为原型链污染，我们可以给所有Object对象中都插入一个<code>sourceURL</code>属性。最后，这个<code>sourceURL</code>被拼接进<code>new Function</code>的第二个参数中，造成任意代码执行漏洞。</p>
<p>我将带有<code>__proto__</code>的Payload以json的形式发送给后端，因为express框架支持根据Content-Type来解析请求Body，这里给我们注入原型提供了很大方便：</p>
<p><a href="../media/attachment/2019/04/03/85fae11e-100b-41aa-9316-de81b93d0036.png"><img alt="image.png" src="../media/attachment/2019/04/03/85fae11e-100b-41aa-9316-de81b93d0036.c6d39683853f.png" /></a></p>
<p>可见，我们代码执行成功，返回了id命令的结果。</p>
<p>整个案例我觉得是一个非常经典的原型链污染漏洞教程，代码不多，逻辑不复杂，没有刻意创造漏洞，真正触发漏洞的代码在库中。</p>
<p>我一直觉得，出题不要刻意创造漏洞，而是找找你的知识点是否能在真实环境下找到应用。</p>
<h2 id="_1"><a class="toclink" href="#_1">相关文章</a></h2>
<ul>
<li><a href="https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf">https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript_prototype_pollution_attack_in_NodeJS.pdf</a></li>
<li><a href="https://xz.aliyun.com/t/2802">https://xz.aliyun.com/t/2802</a></li>
<li><a href="https://xz.aliyun.com/t/2735">https://xz.aliyun.com/t/2735</a></li>
</ul>
            </div>
            <div itemprop="keywords" class="tags-meta">
                标签:
                
                    <a href="../tag/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93.html">原型链污染</a>
                
                    <a href="../tag/javascript.html">javascript</a>
                
            </div>
            <br>
<!--MOB SHARE BEGIN-->
<div class="-mob-share-ui-button -mob-share-open">分享</div>
<div class="-mob-share-ui" style="display: none">
    <ul class="-mob-share-list">
        <li class="-mob-share-weibo"><p>新浪微博</p></li>
        <li class="-mob-share-qzone"><p>QQ空间</p></li>
        <li class="-mob-share-qq"><p>QQ好友</p></li>
        <li class="-mob-share-weixin"><p>微信</p></li>
        <li class="-mob-share-douban"><p>豆瓣</p></li>
        <li class="-mob-share-facebook"><p>Facebook</p></li>
        <li class="-mob-share-twitter"><p>Twitter</p></li>
        <li class="-mob-share-pocket"><p>Pocket</p></li>
        <li class="-mob-share-google"><p>Google+</p></li>
        <li class="-mob-share-youdao"><p>有道云笔记</p></li>
        <li class="-mob-share-mingdao"><p>明道</p></li>
        <li class="-mob-share-tumblr"><p>Tumblr</p></li>
        <li class="-mob-share-instapaper"><p>Instapaper</p></li>
        <li class="-mob-share-linkedin"><p>LinkedIn</p></li>
    </ul>
    <div class="-mob-share-close">取消</div>
</div>
<div class="-mob-share-ui-bg"></div>
<script id="-mob-share" src="https://f1.webshare.mob.com/code/mob-share.js?appkey=af155d9007c8"></script>
<!--MOB SHARE END-->

        <div class="qqlist">
          <h3>订阅本站<small>(RSS)</small></h3>
          <form method="post" target="_blank" action="https://list.qq.com/cgi-bin/qf_compose_send">
          <input type="hidden" value="qf_booked_feedback" name="t" />
          <input type="hidden" value="dace5c2b356504de449e7f3fc2bb59f3f6124d6563786446" name="id" />
          <input type="text" placeholder="E-mail" value="" class="rsstxt" name="to" id="to" />
          <button type="submit" >订阅&rarr;</button>
          </form>
        </div>


        </div>

        
        <div class="post-single type-post text-center">
            <h3 style="margin-top: 0">喜欢这篇文章，扫码和我成为赞友！</h3>
            <img src="../static/wx.jpg" width="280" alt="">
        </div>
        

        <!-- 评论位置 -->
        <div id="comments" class="comments">
          <h3>已有 27 条评论</h3>
            <ol class="comment-list">
            
            
              <li class="comment-body" id="comment-4518">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">sam</a></div>
                    <p>还得是P神，文章一看就懂</p>
                    <span class="comment-time">时间: 2023-06-15 01:48</span>
                    <span class="comment-reply"><a href="#comment-4518" onclick="reply_to('4518','sam')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-4023">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/0cda1b7c4932516d932ec7abaab548c4.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">cr4zyrorz</a></div>
                    <p>这条利用链真是太巧妙了，师傅是怎么发现的呢？</p>
                    <span class="comment-time">时间: 2022-11-16 19:33</span>
                    <span class="comment-reply"><a href="#comment-4023" onclick="reply_to('4023','cr4zyrorz')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3699">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">怎么可以怎么6</a></div>
                    <p>感觉自己学到了</p>
                    <span class="comment-time">时间: 2021-09-24 08:17</span>
                    <span class="comment-reply"><a href="#comment-3699" onclick="reply_to('3699','怎么可以怎么6')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3635">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/814ffe59559cb5b57b6e0e9a7bf626e8.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">Mondayice</a></div>
                    <p>看完一道CTF,前来拜读学习.</p>
                    <span class="comment-time">时间: 2021-03-25 11:17</span>
                    <span class="comment-reply"><a href="#comment-3635" onclick="reply_to('3635','Mondayice')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3571">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/7e9d79aa7195be97f2e9ac770ed776ea.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">就这种成都了吗</a></div>
                    <p>作者的解析很好 在此感谢。另外我补充点：https://esdiscuss.org/topic/proto-and-json，这篇帖子个人感觉很好 可以看看。里面有这么一句话：「V8 ignores keys named proto in JSON.parse」。大家可以结合p神的这篇文章 好好理解下。</p>
                    <span class="comment-time">时间: 2020-11-12 09:03</span>
                    <span class="comment-reply"><a href="#comment-3571" onclick="reply_to('3571','就这种成都了吗')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3530">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">nosaj</a></div>
                    <p>讲的很细  收藏了</p>
                    <span class="comment-time">时间: 2020-07-13 16:51</span>
                    <span class="comment-reply"><a href="#comment-3530" onclick="reply_to('3530','nosaj')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3401">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">Samui</a></div>
                    <p>对于原型链污染的漏洞，加上hasOwnProperty的检查是否可以预防呢</p>
                    <span class="comment-time">时间: 2019-09-07 15:04</span>
                    <span class="comment-reply"><a href="#comment-3401" onclick="reply_to('3401','Samui')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3379">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">wonderkun</a></div>
                    <p>师傅在这个题目中找的这个利用链真是太流畅了，不得不膜啊 。</p>
                    <span class="comment-time">时间: 2019-07-18 21:56</span>
                    <span class="comment-reply"><a href="#comment-3379" onclick="reply_to('3379','wonderkun')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3380">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="../index.html" target="_blank" rel="nofollow noopener">phithon</a></div>
                    <p>@wonderkun 可惜懂欣赏的人并不多。</p>
                    <span class="comment-time">时间: 2019-07-21 02:14</span>
                    <span class="comment-reply"><a href="#comment-3380" onclick="reply_to('3380','phithon')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3349">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/1af4ade46a59b1684c28de1efe1049e1.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="https://solitud.es" target="_blank" rel="nofollow noopener">人迹罕至</a></div>
                    <p>什么时候出个 Go Web framework 的欣赏一下。</p>
                    <span class="comment-time">时间: 2019-05-21 15:53</span>
                    <span class="comment-reply"><a href="#comment-3349" onclick="reply_to('3349','人迹罕至')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3350">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="../index.html" target="_blank" rel="nofollow noopener">phithon</a></div>
                    <p>@人迹罕至 那得等我先学一阵子</p>
                    <span class="comment-time">时间: 2019-05-21 15:56</span>
                    <span class="comment-reply"><a href="#comment-3350" onclick="reply_to('3350','phithon')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3343">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/d219af79b45e5891507fda4c4c2139a0.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="https://repostone.home.blog/" target="_blank" rel="nofollow noopener">repostone</a></div>
                    <p>非技术的路过。</p>
                    <span class="comment-time">时间: 2019-05-07 18:47</span>
                    <span class="comment-reply"><a href="#comment-3343" onclick="reply_to('3343','repostone')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3337">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">饿额额</a></div>
                    <p>膜拜膜拜</p>
                    <span class="comment-time">时间: 2019-05-02 17:22</span>
                    <span class="comment-reply"><a href="#comment-3337" onclick="reply_to('3337','饿额额')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3333">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/30fd15c6be35c39c21b68dc2fdd6a7b8.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">Anemone</a></div>
                    <p>问一下payload里面，直接return e =&gt; { return global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;uname -a&#x27;)}就可以了，为什么还有个for循环呢？</p>
                    <span class="comment-time">时间: 2019-04-24 21:28</span>
                    <span class="comment-reply"><a href="#comment-3333" onclick="reply_to('3333','Anemone')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3334">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="../index.html" target="_blank" rel="nofollow noopener">phithon</a></div>
                    <p>@Anemone <br>这问题太好了，文中没有讲到。<br>原型链污染攻击有个弊端，就是你一旦污染了原型链，除非整个程序重启，否则所有的对象都会被污染与影响。<br>这将导致一些正常的业务出现bug，或者就像这道题里一样，我的payload发出去，response里就有命令的执行结果了。这时候其他用户访问这个页面的时候就能看到这个结果，所以在CTF中就会泄露自己好不容易拿到的flag，所以需要一个for循环把Object对象里污染的原型删掉。</p>
                    <span class="comment-time">时间: 2019-04-24 23:58</span>
                    <span class="comment-reply"><a href="#comment-3334" onclick="reply_to('3334','phithon')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3427">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">nut</a></div>
                    <p>@phithon 请问一下，看了几个原型链污染漏洞，使用的exp都是 global.process.mainModule.constructor._load ，这个是有什么特殊缘由吗，直接 require 有什么不好的地方吗</p>
                    <span class="comment-time">时间: 2019-10-21 10:13</span>
                    <span class="comment-reply"><a href="#comment-3427" onclick="reply_to('3427','nut')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3428">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="../index.html" target="_blank" rel="nofollow noopener">phithon</a></div>
                    <p>@nut 上下文里不一定有require</p>
                    <span class="comment-time">时间: 2019-10-21 20:14</span>
                    <span class="comment-reply"><a href="#comment-3428" onclick="reply_to('3428','phithon')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3433">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">nut</a></div>
                    <p>@phithon 还是没有很明白，node 中 require 不是全局可以访问吗？</p>
                    <span class="comment-time">时间: 2019-11-04 16:07</span>
                    <span class="comment-reply"><a href="#comment-3433" onclick="reply_to('3433','nut')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3434">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="../index.html" target="_blank" rel="nofollow noopener">phithon</a></div>
                    <p>@nut <br>看文档：https://nodejs.org/api/globals.html#globals_require<br>This variable may appear to be global but is not<br>看实例：https://runkit.com/phith0n/5dc0f2cb6866bd0013b764c5<br>ReferenceError: require is not defined</p>
                    <span class="comment-time">时间: 2019-11-05 12:00</span>
                    <span class="comment-reply"><a href="#comment-3434" onclick="reply_to('3434','phithon')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3325">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="../static/placeholder.jpg">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">迷弟</a></div>
                    <p>p神，可以推荐一下适合入门审计的cms吗?</p>
                    <span class="comment-time">时间: 2019-04-11 19:54</span>
                    <span class="comment-reply"><a href="#comment-3325" onclick="reply_to('3325','迷弟')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3321">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/f14545627760b466121491792fc0c9ca.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="http://adoncn.com/" target="_blank" rel="nofollow noopener">跨境电商之家</a></div>
                    <p>不错不错，来看看。。</p>
                    <span class="comment-time">时间: 2019-04-09 22:05</span>
                    <span class="comment-reply"><a href="#comment-3321" onclick="reply_to('3321','跨境电商之家')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3316">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/8f1c3ad9e2d7b02c829f436867370936.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="" target="_blank" rel="nofollow noopener">xxy</a></div>
                    <p>谢谢p神深入浅出的分享。但是在02节貌似有个小小的笔误，寻找show属性该改为寻找last_name属性才对。</p>
                    <span class="comment-time">时间: 2019-04-06 14:17</span>
                    <span class="comment-reply"><a href="#comment-3316" onclick="reply_to('3316','xxy')">回复</a></span>
                    </div>
                </div>
              </li>
            
              <li class="comment-body" id="comment-3318">
                <div class="clearfix">
                    <div class="comment-author">
                        <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g">
                    </div>
                    <div class="comment-meta">
                    <div class="fn"><a href="../index.html" target="_blank" rel="nofollow noopener">phithon</a></div>
                    <p>@xxy 谢谢，已修改</p>
                    <span class="comment-time">时间: 2019-04-08 10:56</span>
                    <span class="comment-reply"><a href="#comment-3318" onclick="reply_to('3318','phithon')">回复</a></span>
                    </div>
                </div>
              </li>
            
            
            </ol>
            
<div class="type-post" id="pagination"><ol class="page-navigator">
    
</ol></div>

        </div>

        <div id="reply"></div>
        <div id="comment-place">
            <div id="comment-post" class="respond none-resize">
             <div id="respond">
                <h3 id="response">添加新评论</h3>
                <form method="post" id="comment-form" role="form" action="#comments">
                    <p>
                        <label for="author" class="required">称呼</label>
                        <input type="text" name="nickname" placeholder="昵称" maxlength="64" required id="id_nickname">
                    </p>
                    <p>
                        <label for="mail">Email</label>
                        <input type="text" name="email" placeholder="邮箱（可留空）" maxlength="254" id="id_email">
                    </p>
                    <p>
                        <label for="url">网站</label>
                        <input type="text" name="url" placeholder="链接（可留空）" maxlength="200" id="id_url">
                    </p>
                    <p>
                        <label for="textarea" class="required">内容</label>
                        <textarea name="content" cols="40" rows="6" required id="id_content">
</textarea>
                    </p>
                    <p>
                        <label style="float:left;">验证码</label>
                        <div class="row gx-2" style="margin-top: 8px"><div class="col-6"><input autocomplete="off" id="id_captcha_1" name="captcha_1" type="text" placeholder="验证码" /> <input id="id_captcha_0" name="captcha_0" type="hidden" value="bfbc462ba98057b3fe113d3f62c25a6d8d5cfee5" />
</div><div class="col-6">
<img src="../captcha/image/bfbc462ba98057b3fe113d3f62c25a6d8d5cfee5/index.png" alt="captcha" class="captcha" /></div></div>
                    </p>
                    <p>
                        <button type="submit" class="submit">提交评论</button>
                        <input type="hidden" name="parent" id="id_parent">
                        <input type="hidden" name="archive" value="441" id="id_archive">
                        <input type="hidden" name="csrfmiddlewaretoken" value="DeAyQMTQrlJ4dA2zKdm0Pw2Ysf9r3ygUpMYpoRuzPHXNL8QXMejLMZ53NCqCCasc">
                    </p>
                </form>
                </div>
            </div>
        </div>

    </div>
    



<div  class="col-5 columns" id="sidebar" role="complementary">

  <div class="widget widget_search">
    <h3>搜索</h3>
    <form action="https://www.leavesongs.com/search/" id="searchform" method="get">
        <input type="text" id="searchkey" name="keyword" value="" class="searchkey" placeholder="Search..."/>
        <button type="submit"  id="searchsubmit">Go</button>
    </form>
  </div>

  
  <div class="widget">
	<h3 class="widget-title">最新评论</h3>
	<ul class="widget-list" id="recent-comment">
    
    
        <li id="comment" class="clearfix">
            <img class="avatar" src="../static/placeholder.jpg" alt="%s" width="40" height="40">
            <div class="comments-link"><cite>木木</cite>：<a href="../THINK/europe-trip-2022.html#comment-4523">虽然物价对比不出什么，但是还是觉得很高昂</a></div>
        </li>
    
        <li id="comment" class="clearfix">
            <img class="avatar" src="../static/placeholder.jpg" alt="%s" width="40" height="40">
            <div class="comments-link"><cite>dongdong4fei</cite>：<a href="../THINK/using-chatgpt-for-antispam.html#comment-4520">肯德基疯狂星期四！ 疯狂星期四！  https://m.kfc.com.cn/wechatco...</a></div>
        </li>
    
        <li id="comment" class="clearfix">
            <img class="avatar" src="../static/placeholder.jpg" alt="%s" width="40" height="40">
            <div class="comments-link"><cite>dongdong4fei</cite>：<a href="../THINK/using-chatgpt-for-antispam.html#comment-4519">小猪咪小猪咪小猪咪</a></div>
        </li>
    
        <li id="comment" class="clearfix">
            <img class="avatar" src="../static/placeholder.jpg" alt="%s" width="40" height="40">
            <div class="comments-link"><cite>sam</cite>：<a href="#comment-4518">还得是P神，文章一看就懂</a></div>
        </li>
    
        <li id="comment" class="clearfix">
            <img class="avatar" src="../static/placeholder.jpg" alt="%s" width="40" height="40">
            <div class="comments-link"><cite>程序</cite>：<a href="discuz72-sql-injection.html#comment-4517">很不错的文章</a></div>
        </li>
    
    </ul>
  </div>

  <div class="widget widget-category">
	<h3>分类</h3>
	<ul id="blogsort" class="widget-list">
    
    
    <li>
        <a href="../sort/PENETRATION.html">网络安全<em>143</em></a>
    </li>
    
    <li>
        <a href="../sort/C.html">C/C++<em>32</em></a>
    </li>
    
    <li>
        <a href="../sort/THINK.html">心得与体会<em>24</em></a>
    </li>
    
    <li>
        <a href="../sort/PYTHON.html">Python<em>19</em></a>
    </li>
    
    <li>
        <a href="../sort/SHARE.html">资源分享<em>16</em></a>
    </li>
    
    </ul>
  </div>

  <div class="widget widget-tag">
	<h3>随机标签</h3>
	<div class="tag-cloud">
        
        
        <a rel="tag" href="../tag/sqlite3_exec.html">sqlite3_exec</a>
        
        <a rel="tag" href="../tag/%E5%AF%92%E5%81%87.html">寒假</a>
        
        <a rel="tag" href="../tag/2019.html">2019</a>
        
        <a rel="tag" href="../tag/xss%E8%A0%95%E8%99%AB.html">xss蠕虫</a>
        
        <a rel="tag" href="../tag/%E5%91%BD%E4%BB%A4%E8%A1%8C.html">命令行</a>
        
        <a rel="tag" href="../tag/php.html">php</a>
        
        <a rel="tag" href="../tag/CRLF.html">CRLF</a>
        
        <a rel="tag" href="../tag/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html">反序列化漏洞</a>
        
        <a rel="tag" href="../tag/VS2010.html">VS2010</a>
        
        <a rel="tag" href="../tag/%E8%B7%A8%E7%9B%AE%E5%BD%95.html">跨目录</a>
        
        <a rel="tag" href="../tag/%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84.html">内存映射</a>
        
        <a rel="tag" href="../tag/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93.html">原型链污染</a>
        
        <a rel="tag" href="../tag/%E8%B6%8A%E6%9D%83%E6%BC%8F%E6%B4%9E.html">越权漏洞</a>
        
        <a rel="tag" href="../tag/%E9%98%BB%E6%AD%A2%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C.html">阻止脚本运行</a>
        
        <a rel="tag" href="../tag/%E7%AD%94%E6%A1%88.html">答案</a>
        
        <a rel="tag" href="../tag/django.html">django</a>
        
        <a rel="tag" href="../tag/%E6%96%AD%E7%82%B9%E7%BB%AD%E4%BC%A0.html">断点续传</a>
        
        <a rel="tag" href="../tag/%E9%93%BE%E8%A1%A8.html">链表</a>
        
        <a rel="tag" href="../tag/%E4%BF%A1%E6%81%AF%E6%B3%84%E9%9C%B2.html">信息泄露</a>
        
        <a rel="tag" href="../tag/getshell.html">getshell</a>
        
        <a rel="tag" href="../tag/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E.html">命令执行漏洞</a>
        
        <a rel="tag" href="../tag/%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86.html">反向代理</a>
        
        <a rel="tag" href="../tag/360webscan.html">360webscan</a>
        
        <a rel="tag" href="../tag/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8.html">前端安全</a>
        
        <a rel="tag" href="../tag/scrapy.html">scrapy</a>
        
        <a rel="tag" href="../tag/API%E5%87%BD%E6%95%B0.html">API函数</a>
        
        <a rel="tag" href="../tag/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89.html">条件竞争</a>
        
        <a rel="tag" href="../tag/webshell.html">webshell</a>
        
        <a rel="tag" href="../tag/%E8%84%B1%E8%A3%A4.html">脱裤</a>
        
        <a rel="tag" href="../tag/SQL.html">SQL</a>
        
    </div>
  </div>

  <div class="widget widget-recent-entries">
	<h3 class="widget-title">热门日志</h3>
	<ul id="hotlog" class="widget-list">
    
    
        <li><a href="../other/tinger.html">About.Me</a></li>
    
        <li><a href="detect-django.html">如何判断目标站点是否为Django开发</a></li>
    
        <li><a href="webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a></li>
    
        <li><a href="webshell-without-alphanum.html">一些不包含数字和字母的webshell</a></li>
    
        <li><a href="php-filter-magic.html">谈一谈php://filter的妙用</a></li>
    
    </ul>
  </div>
  

</div>
</div>

<div id="footer">
	<!-- copyright -->
	<div class="container">
		<div class="row remove-bottom">
			<div class="col-6 columns">
			<h3>Little About</h3>
			<p>Phithon 非强迫症小青年  <br>
现居先 <br>
爱好：种花、买书、收藏明信片 <br>
欢迎各大组织收留 <br>
E-mail：root@leavesongs.com </p>
			</div>

			<div class="col-10 columns">

				<h3 class="mobile-hide">Follow me</h3>
        <div id="social-links">
          <a href="http://weibo.com/101yx" class="sweibo" target="_blank" title="新浪微博">新浪微博</a>
          <a href="javascript:alert(/没有腾讯微博哟/)" class="qweibo" target="_blank" title="腾讯微博">腾讯微博</a>
          <a href="javascript:alert(/墙外有什么/);window.open('http://google.com')" class="google" target="_blank" title="墙外的世界">google+</a>
          <a href="https://github.com/phith0n" class="github" target="_blank" title="Github">github</a>
          <a href="javascript:confirm(/mailto:root#leavesongs.com/)" class="mail" target="_blank" title="私信给我">私信给我</a>
          <a href="../feed/index.rss" target="_blank" class="rss" title="离别歌">RSS订阅</a>
        </div>
        <div class="bot-line"></div>
				<p class="copyright">
	Copyright &copy; Powered by talkbook
				&nbsp;&nbsp;<i>Designed and built with all the love in the world by <a href="../index.html" target="_blank">Phithon</a> && deepsky </i>
                    <a href="../index.html">更换模板</a>
				</p>
			</div>
		</div>
	</div>
	<!-- /copyright -->
</div>
<a href="#" id="go-top">Top ↑</a>
<script src="https://cdn.staticfile.org/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.staticfile.org/jquery.appear/0.4.1/jquery.appear.min.js"></script>
<script src="../static/deep/js/common_tpl.js" type="text/javascript"></script>
<script src="../static/deep/js/config.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FF5KPQ1CZ6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FF5KPQ1CZ6');
</script>

<script src="https://cdn.staticfile.org/fancybox/2.1.7/js/jquery.fancybox.min.js"></script>
<script>
$(document).ready(function () {
    $(".entry a").each(function (i, e) {
        if(e.host != 'www.leavesongs.com') {
            e.target = '_blank';
        }
    });
    $(".entry img").each(function (i, e) {
        if(e.parentNode.tagName.toUpperCase() != 'A') {
            $(e).wrap('<a href="'+escapeHtml(e.src)+'" class="fancybox"></a>');
        } else {
            $(e.parentNode).addClass('fancybox');
        }
    });
    $('.fancybox').fancybox();
})
</script>

</body>

</html>