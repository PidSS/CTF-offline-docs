<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="../assets/built/screen%EF%B9%96v=792c672b3c.css" />

    <meta name="description" content="å¼€å§‹é˜…è¯» AFL çš„æºç ã€‚æœ¬æ–‡åˆ†æäº† AFL é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Œç¡®å®šäº†é˜…è¯»ä»£ç çš„é¡ºåºï¼Œå¹¶è¯¦ç»†è§£é‡Šäº† afl-gcc å’Œ afl-as ä»£ç ã€‚" />
    <link rel="icon" href="../content/images/size/w256h256/2020/02/small-3.png" type="image/png" />
    <link rel="canonical" href="index.html" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="amp/index.html" />
    
    <meta property="og:site_name" content="Pion1eer" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹" />
    <meta property="og:description" content="å¼€å§‹é˜…è¯» AFL çš„æºç ã€‚æœ¬æ–‡åˆ†æäº† AFL é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Œç¡®å®šäº†é˜…è¯»ä»£ç çš„é¡ºåºï¼Œå¹¶è¯¦ç»†è§£é‡Šäº† afl-gcc å’Œ afl-as ä»£ç ã€‚" />
    <meta property="og:url" content="https://www.ruanx.net/afl-source-1/" />
    <meta property="og:image" content="https://www.ruanx.net/content/images/2023/05/output-2.jpg" />
    <meta property="article:published_time" content="2023-05-07T12:45:20.000Z" />
    <meta property="article:modified_time" content="2023-05-08T07:00:12.000Z" />
    <meta property="article:tag" content="Fuzzing" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹" />
    <meta name="twitter:description" content="å¼€å§‹é˜…è¯» AFL çš„æºç ã€‚æœ¬æ–‡åˆ†æäº† AFL é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Œç¡®å®šäº†é˜…è¯»ä»£ç çš„é¡ºåºï¼Œå¹¶è¯¦ç»†è§£é‡Šäº† afl-gcc å’Œ afl-as ä»£ç ã€‚" />
    <meta name="twitter:url" content="https://www.ruanx.net/afl-source-1/" />
    <meta name="twitter:image" content="https://www.ruanx.net/content/images/2023/05/output-2.jpg" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Ruan Xingzhi" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Fuzzing" />
    <meta property="og:image:width" content="640" />
    <meta property="og:image:height" content="480" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Pion1eer",
        "url": "https://www.ruanx.net/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://www.ruanx.net/content/images/size/w256h256/2020/02/small-3.png",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Ruan Xingzhi",
        "image": {
            "@type": "ImageObject",
            "url": "https://www.ruanx.net/content/images/2020/05/blue.jpeg",
            "width": 1024,
            "height": 1024
        },
        "url": "https://www.ruanx.net/author/blue/",
        "sameAs": []
    },
    "headline": "AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹",
    "url": "https://www.ruanx.net/afl-source-1/",
    "datePublished": "2023-05-07T12:45:20.000Z",
    "dateModified": "2023-05-08T07:00:12.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://www.ruanx.net/content/images/2023/05/output-2.jpg",
        "width": 640,
        "height": 480
    },
    "keywords": "Fuzzing",
    "description": "å¼€å§‹é˜…è¯» AFL çš„æºç ã€‚æœ¬æ–‡åˆ†æäº† AFL é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Œç¡®å®šäº†é˜…è¯»ä»£ç çš„é¡ºåºï¼Œå¹¶è¯¦ç»†è§£é‡Šäº† afl-gcc å’Œ afl-as ä»£ç ã€‚",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://www.ruanx.net/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.8" />
    <link rel="alternate" type="application/rss+xml" title="Pion1eer" href="../rss/index.rss" />
    <script defer src="https://cdn.jsdelivr.net/npm/@tryghost/portal@~2.5/umd/portal.min.js" data-ghost="https://www.ruanx.net/" data-key="595acd8f13c14d79a10527399d" data-api="https://www.ruanx.net/ghost/api/content/" crossorigin="anonymous"></script><style id="gh-members-styles">.gh-post-upgrade-cta-content,
.gh-post-upgrade-cta {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    text-align: center;
    width: 100%;
    color: #ffffff;
    font-size: 16px;
}

.gh-post-upgrade-cta-content {
    border-radius: 8px;
    padding: 40px 4vw;
}

.gh-post-upgrade-cta h2 {
    color: #ffffff;
    font-size: 28px;
    letter-spacing: -0.2px;
    margin: 0;
    padding: 0;
}

.gh-post-upgrade-cta p {
    margin: 20px 0 0;
    padding: 0;
}

.gh-post-upgrade-cta small {
    font-size: 16px;
    letter-spacing: -0.2px;
}

.gh-post-upgrade-cta a {
    color: #ffffff;
    cursor: pointer;
    font-weight: 500;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a:hover {
    color: #ffffff;
    opacity: 0.8;
    box-shadow: none;
    text-decoration: underline;
}

.gh-post-upgrade-cta a.gh-btn {
    display: block;
    background: #ffffff;
    text-decoration: none;
    margin: 28px 0 0;
    padding: 8px 18px;
    border-radius: 4px;
    font-size: 16px;
    font-weight: 600;
}

.gh-post-upgrade-cta a.gh-btn:hover {
    opacity: 0.92;
}</style>
    <script defer src="https://cdn.jsdelivr.net/npm/@tryghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="595acd8f13c14d79a10527399d" data-styles="https://cdn.jsdelivr.net/npm/@tryghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://www.ruanx.net/" crossorigin="anonymous"></script>
    <script defer src="../public/cards.min%EF%B9%96v=792c672b3c.js"></script>
    <link rel="stylesheet" type="text/css" href="../public/cards.min%EF%B9%96v=792c672b3c.css">
    <!-- link href="https://fonts.googleapis.com/css?family=Noto+Serif+SC&display=swap" rel="stylesheet" -->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono&amp;family=Noto+Serif+SC&amp;display=swap" rel="stylesheet">

<style>.post-content,.post-card-excerpt{font-family: 'Noto Serif SC', "PingFang SC","Helvetica Neue",Helvetica,"Hiragino Sans GB","Microsoft YaHei","å¾®è½¯é›…é»‘",Arial,sans-serif;}
    .post-full-content{font-size: 100%;}
    .post-full-custom-excerpt {font-size: 1.8rem;}
    .post-full-title {font-size:3.2rem;}
    .post-full-content blockquote{margin:20px;padding: 1em;  background-color: #3eb0ef14; }
    .post-full-content blockquote p {font-style:normal;}
    .post-full-image {display:none;}
    
    /* .post-full-content figcaption {margin: .4em 0 .5em  !important} */
    
    .kg-callout-card {width: 100%; margin-bottom: 1em;}
    
    .post-full-content figure {margin: 0.8em 0 1em;}
    
    p {margin: 0.2em 0 0.5em !important;}
    
    .post-full-content img{border-radius:5px;}
    
    code {font-family: 'Noto Serif SC';}
</style>


<style>:root {--ghost-accent-color: #15171A;}</style>

</head>
<body class="post-template tag-fuzzing">

    <div class="site-wrapper">

        

<header class="site-header">
    <div class="outer site-nav-main">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
                <a class="site-nav-logo" href="../index.html">Pion1eer</a>
            <div class="site-nav-content">
                    <ul class="nav">
    <li class="nav-home"><a href="../index.html">Home</a></li>
    <li class="nav-about"><a href="../about/index.html">About</a></li>
</ul>

                    <span class="nav-post-title dash">AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹</span>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
            <div class="social-links">
            </div>
                <a class="rss-button" href="https://feedly.com/i/subscription/feed/https://www.ruanx.net/rss/" title="RSS" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><circle cx="6.18" cy="17.82" r="2.18"/><path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/></svg>
</a>

    </div>
</nav>
    </div>
</div>

<script>
 MathJax = {
        tex:{
                inlineMath: [['$', '$'], ['\\(', '\\)']]
            },
        svg:{
                fontCache: 'global'
            }
        }; 
    </script>
    <script src="https://cdn.staticfile.org/babel-polyfill/7.12.1/polyfill.min.js?features=es6"></script>
    <script type="text/javascript" id="MathJax-script" async  src="https://cdn.staticfile.org/mathjax/3.2.2/es5/tex-mml-chtml.js"></script>

<style>@media (prefers-color-scheme: light) {
		.post-full-content  
    pre{background:#fafafa;margin:10px 10px 20px 10px;border-style: solid;border-color:#DCDFE6;}
}
</style>

<link rel="stylesheet" href="https://cdn.ruanx.net/css/atom-one-dark.css">
<link rel="stylesheet" media="(prefers-color-scheme: light)" href="https://cdn.ruanx.net/css/atom-one-light.min.css">
<style>.post-full-content  code{font-family: 'Fira Mono', 'Jetbrains mono', 'ubuntu mono', consolas, 'monospace' !important;}
</style>

</header>


<main id="site-main" class="site-main outer">
    <div class="inner">

        <article class="post-full post tag-fuzzing ">

            <header class="post-full-header">

                <section class="post-full-tags">
                    <a href="../tag/fuzzing/index.html">Fuzzing</a>
                </section>

                <h1 class="post-full-title">AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹</h1>

                <p class="post-full-custom-excerpt">å¼€å§‹é˜…è¯» AFL çš„æºç ã€‚æœ¬æ–‡åˆ†æäº† AFL é¡¹ç›®çš„æ–‡ä»¶ç»“æ„ï¼Œç¡®å®šäº†é˜…è¯»ä»£ç çš„é¡ºåºï¼Œå¹¶è¯¦ç»†è§£é‡Šäº† afl-gcc å’Œ afl-as ä»£ç ã€‚</p>

                <div class="post-full-byline">

                    <section class="post-full-byline-content">

                        <ul class="author-list">
                            <li class="author-list-item">

                                <div class="author-card">
                                    <img class="author-profile-image" src="../content/images/size/w100/2020/05/blue.jpeg" alt="Ruan Xingzhi" />
                                    <div class="author-info">
                                        <div class="bio">
                                            <h2>Ruan Xingzhi</h2>
                                            <p>Welcome to my site and hope you have fun.</p>
                                            <p><a href="../author/blue/index.html">More posts</a> by Ruan Xingzhi.</p>
                                        </div>
                                    </div>
                                </div>

                                <a href="../author/blue/index.html" class="author-avatar">
                                    <img class="author-profile-image" src="../content/images/size/w100/2020/05/blue.jpeg" alt="Ruan Xingzhi" />
                                </a>

                            </li>
                        </ul>

                        <section class="post-full-byline-meta">
                            <h4 class="author-name"><a href="../author/blue/index.html">Ruan Xingzhi</a></h4>
                            <div class="byline-meta-content">
                                <time class="byline-meta-date" datetime="2023-05-07">7 May 2023</time>
                                <span class="byline-reading-time"><span class="bull">&bull;</span> 25 min read</span>
                            </div>
                        </section>

                    </section>


                </div>
            </header>

            <figure class="post-full-image">
                <img
                    srcset="../content/images/size/w300/2023/05/output-2.jpg 300w,
                            ../content/images/size/w600/2023/05/output-2.jpg 600w,
                            ../content/images/size/w1000/2023/05/output-2.jpg 1000w,
                            ../content/images/size/w2000/2023/05/output-2.jpg 2000w"
                    sizes="(max-width: 800px) 400px,
                        (max-width: 1170px) 1170px,
                            2000px"
                    src="../content/images/size/w2000/2023/05/output-2.jpg"
                    alt="AFLæºç é˜…è¯»ï¼ˆä¸€ï¼‰ï¼šå¯ç¨‹"
                />
            </figure>

            <section class="post-full-content">
                <div class="post-content">
                    <p>ã€€ã€€ç¬”è€…æ˜å¹´å¹´åº•å°±è¯¥ç ”ç©¶ç”Ÿæ¯•ä¸šäº†ï¼Œç„¶è€Œæ¯•ä¸šè®ºæ–‡çš„é¢˜ç›®è¿˜æ²¡æœ‰ç€è½ã€‚ä¸€ç•ªè€ƒå¯Ÿä¹‹åï¼Œè®¤ä¸º fuzzing æ–¹å‘è¿˜ç®—æ˜¯æœ‰äº‹å¯åšï¼›äºæ˜¯æ‰“ç®—åœ¨ fuzzing é¢†åŸŸç ”ç©¶å¾—æ›´æ·±ä¸€äº›ã€‚</p><p>ã€€ã€€ä¼—æ‰€å‘¨çŸ¥ï¼ŒAFL ç³»çš„ fuzzer æœ‰å‡ ä¸ªç¼ºé™·ï¼š</p><ol><li>å‘ç°çš„ã€Œæœ‰ä»·å€¼çš„æ¼æ´ã€å¤ªå°‘ã€‚fuzzer æŒ‡å‡ºçš„å¤§é‡ bug éƒ½æ˜¯ã€Œæ— å…³ç´§è¦ã€çš„ï¼Œä¾‹å¦‚ç¼ºä¹éªŒè¯è€Œæ‰§è¡Œä¸€ä¸ª division by zeroï¼Œä»¤ç¨‹åºæ”¶åˆ° FPE å´©æºƒã€‚è¿™ç±»æ¼æ´è¦ä¹ˆæœ¬èº«å°±ç¼ºä¹ä»·å€¼ï¼Œè¦ä¹ˆå°±å¾ˆéš¾ä»¥åˆ©ç”¨ï¼Œä»¥è‡³äºéœ€è¦é€šè¿‡è®²æ•…äº‹çš„æ–¹å¼æ„é€ å‡ºä¸€ä¸ªåˆ©ç”¨åœºæ™¯ã€‚è€Œå¦ä¸€æ–¹é¢ï¼ŒAFL å¿½ç•¥äº†é€»è¾‘æ¼æ´ï¼Œå› ä¸ºåªæœ‰ crash æ‰ä¼šè¢«æŠ¥å‘Šã€‚</li><li>fuzzer çš„æœç´¢èƒ½åŠ›å¤ªå·®ã€‚ä¾‹å¦‚ï¼ŒAFL éš¾ä»¥æ„é€ å‡ºèƒ½é€šè¿‡ magic numberã€checksum æ£€æŸ¥çš„è¾“å…¥ï¼Œå®è·µä¸Šå¾€å¾€éœ€è¦ç ”ç©¶å‘˜æ‰‹åŠ¨æ³¨é‡Šæ‰è¿™äº›æ£€æŸ¥ã€‚</li></ol><p>ã€€ã€€å…³äºç¬¬ä¸€ä¸ªå›°éš¾ï¼Œç¬”è€…è®¤ä¸ºæš‚ä¸”æ²¡æœ‰å¾ˆå¥½çš„è§£å†³æ€è·¯ã€‚å½’æ ¹ç»“åº•ï¼Œä¸€ä¸ªæ¼æ´åˆ°åº•æœ‰æ²¡æœ‰ä»·å€¼ï¼Œéœ€è¦å¾ˆå¤šå¤–éƒ¨çŸ¥è¯†â€”â€”ä¾‹å¦‚ï¼Œå‡å¦‚æŸä¸ªè¾“å…¥èƒ½è®©ç¨‹åºé¢å¤–è¿è¡Œä¸€ç§’é’Ÿï¼Œè¿™å¯¹äº nginx æ¥è¯´æ˜¯å·¨å¤§é—®é¢˜ï¼›ä½†å¯¹äº checkpng ä¹‹ç±»çš„å°ç¨‹åºï¼Œä¾¿æ˜¯æ— å…³ç´§è¦çš„ã€‚ä¸€ä¸ªç¼“å†²åŒº over-read æ¼æ´ï¼Œå¯¹äº openssl æ˜¯è‡´å‘½çš„ï¼Œä½†å¯¹äº gimp è¿™ç±»ç¨‹åºè€Œè¨€ï¼Œåªæ˜¯å¤šäº†ä¸ªè®©ç¨‹åºå´©æºƒçš„ bugï¼Œå¤§å®¶å¹¶ä¸ç‰¹åˆ«å…³å¿ƒå…¶å®‰å…¨æ–¹é¢çš„å±é™©ã€‚ç”±äºä¸€ä¸ªæ¼æ´çš„ä»·å€¼éš¾ä»¥è¡¡é‡ï¼Œç¬”è€…å†³å®šä¸é’»ç ”è¿™ä¸ªé—®é¢˜ï¼Œä»ä»¥ crash æ•°é‡ä¸ºè¡¡é‡ fuzzer å¥½åçš„ç¬¬ä¸€æ ‡å‡†ã€‚</p><p>ã€€ã€€è€Œç¬¬äºŒä¸ªå›°éš¾ï¼Œä¾¿æ˜¯å¾ˆæœ‰å¯èƒ½åšå‡ºæ”¹è¿›çš„åœ°æ–¹ã€‚é¦–å…ˆï¼Œfuzzer ä¸å¯èƒ½æœå‡ºæ‰€æœ‰ bugâ€”â€”ä½¿ç”¨åè¯æ³•ï¼Œå‡è®¾å­˜åœ¨è¿™æ ·çš„ fuzzerï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½è·å¾—ä¸€ä¸ªæ±‚è§£ä»»æ„çº¦æŸé—®é¢˜çš„ oracleã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æä¾›ä¸‹é¢çš„ç¨‹åºï¼š</p><pre><code class="language-python">cin &gt;&gt; p;
if(N % p == 0)
    abort();</code></pre><p>ã€€ã€€å¦‚æœçœŸçš„å­˜åœ¨ä¸€ä¸ª fuzzer èƒ½æ‰¾åˆ°ç¨‹åºä¸­çš„æ‰€æœ‰æ¼æ´ï¼Œé‚£å®ƒå°±ä¸€å®šèƒ½æŠ¥å‘Šä¸€ä¸ª $p$ ä½¿å¾— $p \mid n$ï¼Œä»è€Œä»¤ç¨‹åº crashã€‚è¿™åƒæ˜¯å¤©æ–¹å¤œè°­ï¼Œç°é˜¶æ®µæˆ‘ä»¬ä¸å­˜åœ¨è¿™æ ·å¼ºå¤§çš„æ±‚è§£å™¨ã€‚</p><p>ã€€ã€€æ—¢ç„¶ä¸å­˜åœ¨å®Œç¾çš„æ±‚è§£å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½ä¼šè€ƒè™‘è®© fuzzer æ‹¥æœ‰æ›´åŠ ç»†è‡´çš„æ±‚è§£èƒ½åŠ›ã€‚ä½†è¿™æ ·çš„èƒ½åŠ›å¾€å¾€ä¸ fuzz æ•ˆç‡æ˜¯è´Ÿç›¸å…³çš„ï¼šä»¥ç¬¦å·æ‰§è¡Œæ–¹æ³•å¯»æ‰¾ bugï¼Œå®é™…è¡¨ç°å¹¶ä¸æ¯” AFL æ›´å¥½ã€‚<strong>AFL çš„è®¾è®¡å“²å­¦ä¸­æœ‰è¿™æ ·ä¸€ä¸ªè§‚ç‚¹ï¼šå¦‚æœä¸€æ¡è·¯å¾„éœ€è¦å¾ˆè‰°éš¾åœ°è§¦å‘ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è€ƒè™‘åŠ å¿« fuzz é€Ÿåº¦ï¼Œä»¥å°è¯•å¯»æ‰¾æ›´ç®€å•çš„è§¦å‘æ–¹æ³•ã€‚</strong>æ²¿ç€è¿™æ¡è®¾è®¡æ€è·¯ï¼ŒAFL ä¸¥æ ¼åœ°æ§åˆ¶æ¯æ¬¡ç¨‹åºæ‰§è¡Œçš„æ—¶é—´ã€‚</p><p>ã€€ã€€æ˜æ˜¾ï¼Œfuzzer éœ€è¦åœ¨æ‰§è¡Œé€Ÿåº¦ä¸æ±‚è§£èƒ½åŠ›ä¸Šä½œå‡ºæƒè¡¡ã€‚æœ‰ä¸€äº›æ–¹æ³•è¯•å›¾åœ¨ä¸å¤ªå½±å“æ€§èƒ½çš„æƒ…å†µä¸‹ï¼ŒåŠ å¼º AFL çš„æ±‚è§£èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œ<a href="https://nesa.zju.edu.cn/download/lcy_pdf_ems_ndss22.pdf">EMS</a> æ–¹æ³•è®¤ä¸ºï¼Œä» fuzz ä¸€ä¸ªç¨‹åºçš„è¿‡ç¨‹ä¸­å­¦åˆ°çš„ç»éªŒï¼Œèƒ½å¸®åŠ©æˆ‘ä»¬ fuzz å…¶ä»–ç¨‹åºã€‚æ˜¾è€Œæ˜“è§ï¼Œæˆ‘ä»¬å¯¹ libpng è¿›è¡Œ fuzzï¼Œå¯ä»¥å­¦åˆ°å¾ˆå¤š PNG æ ¼å¼ç›¸å…³çš„ magic numberï¼›æ‹¿è¿™äº›çŸ¥è¯†å» fuzz imagemagickï¼Œå¾ˆå¯èƒ½æ˜¯æœ‰æ•ˆæœçš„ã€‚EMS å¹¶æœªå¼•å…¥çº¦æŸæ±‚è§£å™¨ï¼Œè€Œæ˜¯ä»å…¶ä»–ç¨‹åºæ ·æœ¬ä¸­å­¦ä¹ ã€Œ$A\to B$ã€è¿™æ ·çš„å˜å¼‚æ¨¡å¼ï¼Œåœ¨å®è§‚ä¸Šçœ‹ï¼Œç¡®å®æå‡äº† AFL çš„æœç´¢èƒ½åŠ›ã€‚</p><p>ã€€ã€€ç¬”è€…ä¹Ÿæ‰“ç®—ä»ã€Œæ‰§è¡Œé€Ÿåº¦ä¸æ±‚è§£èƒ½åŠ›çš„æƒè¡¡ã€è¿™æ–¹é¢ç€æ‰‹ï¼Œå»ä¼˜åŒ– AFLã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬”è€…å¸Œæœ›å¯»æ‰¾ä¸€äº›ä¸å¤ªå½±å“ fuzz æ‰§è¡Œé€Ÿåº¦çš„æ–¹æ³•ï¼Œå»ä¼˜åŒ– fuzzer çš„æœç´¢èƒ½åŠ›ã€‚è¿™æ ·ï¼ŒåŠ¿å¿…è¦å¯¹ AFL è¿›è¡Œä¸€äº›ä¿®æ”¹ï¼Œå› æ­¤ç¬”è€…å†³å®šé˜…è¯»ä¸€é AFL æºç ã€‚</p><p>ã€€ã€€å¦ç‡åœ°è®²ï¼Œè¿™æ˜¯ç¬”è€…ç¬¬ä¸€æ¬¡å…¨é¢é˜…è¯»ä¸­ç­‰è§„æ¨¡é¡¹ç›®çš„æºç ã€‚å› æ­¤æ“ä½œæµç¨‹ä¸Šä¸€å®šæœ‰ä¸è§„èŒƒçš„åœ°æ–¹ï¼Œæœ›è¯»è€…åœ¨è¯„è®ºåŒºæŒ‡æ­£ã€‚</p><h3 id="0x00-%E9%A1%B9%E7%9B%AE%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90">0x00 é¡¹ç›®æ–‡ä»¶åˆ†æ</h3><p>ã€€ã€€ç¬”è€…é€‰æ‹©é˜…è¯» AFL çš„æºç è€Œé AFL++ï¼Œå› ä¸º AFL++ å¼•å…¥äº†ä¸å°‘æ–°åŠŸèƒ½å’Œä¼˜åŒ–æŠ€æœ¯ï¼Œä»£ç åº”è¯¥æ¯” AFL æ›´åŠ ç¹æ‚ã€‚å¦å¤–ï¼Œç¬”è€…æ‰“ç®—åœ¨ AFL çš„åŸºç¡€ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œå› æ­¤é€‰æ‹©åŸå§‹ AFL æ˜¯æœ€å¥½çš„ã€‚</p><p>ã€€ã€€AFL é¡¹ç›®çš„ä»“åº“æ˜¯ <a href="https://github.com/google/AFL">https://github.com/google/AFL</a>ï¼Œç°å·²åœæ­¢å¼€å‘ã€‚æ®é˜…è¯» Linux æºç çš„äººè¯´ï¼Œè¯»æºç å¯ä»¥å…ˆä»æœ€åˆå‡ ä¸ª commit ç€æ‰‹ï¼Œå› ä¸ºå½“æ—¶æ²¡æœ‰å¤ªå¤šå†—æ‚åŠŸèƒ½ï¼Œcore insight æ¯”è¾ƒçªå‡ºã€‚ä¸è¿‡ Github ä¸Šå¹¶æ²¡æœ‰ 2013 å¹´ç‰ˆæœ¬çš„ AFLï¼Œå› æ­¤ä½œç½¢ï¼Œç›´æ¥é˜…è¯»æœ€æ–°ç‰ˆä»£ç ã€‚</p><p>ã€€ã€€æŠŠé¡¹ç›®å¯¼å…¥ Understand æºç é˜…è¯»å™¨ï¼Œçœ‹ä¸€ä¸‹ Metrics Treemapï¼š</p><figure class="kg-card kg-image-card kg-width-wide"><img src="../content/images/2023/05/image-1.png" class="kg-image" alt loading="lazy" width="2000" height="876" srcset="../content/images/size/w600/2023/05/image-1.png 600w, ../content/images/size/w1000/2023/05/image-1.png 1000w, ../content/images/size/w1600/2023/05/image-1.png 1600w, ../content/images/size/w2400/2023/05/image-1.png 2400w" sizes="(min-width: 1200px) 1200px"></figure><p>ã€€ã€€å¯è§ <code>afl-fuzz.c</code> æœ‰ 8000 ä½™è¡Œï¼Œæ˜¯æœ€å¤§çš„æºç æ–‡ä»¶ã€‚å…¶ä½™çš„ <code>afl-tim.c, afl-analyze.c, afl-showmap.c</code> ç­‰æ–‡ä»¶æœ‰ 1000 è¡Œå·¦å³ã€‚è§‚å¯Ÿä¸€ä¸‹ä»£ç ä¾èµ–å…³ç³»ï¼š</p><figure class="kg-card kg-image-card"><img src="../content/images/2023/05/image-2.png" class="kg-image" alt loading="lazy" width="1075" height="1040" srcset="../content/images/size/w600/2023/05/image-2.png 600w, ../content/images/size/w1000/2023/05/image-2.png 1000w, ../content/images/2023/05/image-2.png 1075w" sizes="(min-width: 720px) 720px"></figure><p>ã€€ã€€æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªé¡¹ç›®çš„ CI é…ç½®ï¼Œå³ <code>.travis.yml</code> æ–‡ä»¶ã€‚</p><pre><code class="language-yaml">language: c

env:
  - AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES=1 AFL_NO_UI=1 AFL_STOP_MANUALLY=1
  - AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES=1 AFL_NO_UI=1 AFL_EXIT_WHEN_DONE=1
 # TODO: test AFL_BENCH_UNTIL_CRASH once we have a target that crashes
  - AFL_I_DONT_CARE_ABOUT_MISSING_CRASHES=1 AFL_NO_UI=1 AFL_BENCH_JUST_ONE=1

before_install:
  - sudo apt update
  - sudo apt install -y libtool libtool-bin automake bison libglib2.0

# TODO: Look into splitting off some builds using a build matrix.
# TODO: Move this all into a bash script so we don't need to write bash in yaml.
script:
  - make
  - ./afl-gcc ./test-instr.c -o test-instr-gcc
  - mkdir seeds
  - echo "" &gt; seeds/nil_seed
  - if [ -z "$AFL_STOP_MANUALLY" ];
    then ./afl-fuzz -i seeds -o out/ -- ./test-instr-gcc;
    else timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-instr-gcc;
    fi
  - .travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 1 -p 3
  - rm -r out/*
  - ./afl-clang ./test-instr.c -o test-instr-clang
  - if [ -z "$AFL_STOP_MANUALLY" ];
    then ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang;
    else timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang;
    fi
  - .travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 1 -p 2
  - make clean
  - CC=clang CXX=clang++ make
  - cd llvm_mode
  # TODO: Build with different versions of clang/LLVM since LLVM passes don't
  # have a stable API.
  - CC=clang CXX=clang++ LLVM_CONFIG=llvm-config make
  - cd ..
  - rm -r out/*
  - ./afl-clang-fast ./test-instr.c -o test-instr-clang-fast
  - if [ -z "$AFL_STOP_MANUALLY" ];
    then ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang-fast;
    else timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang-fast;
    fi
  - .travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 1 -p 3
  # Test fuzzing libFuzzer targets and trace-pc-guard instrumentation.
  - clang -g -fsanitize-coverage=trace-pc-guard ./test-libfuzzer-target.c -c
  - clang -c -w llvm_mode/afl-llvm-rt.o.c
  - wget https://raw.githubusercontent.com/llvm/llvm-project/main/compiler-rt/lib/fuzzer/afl/afl_driver.cpp
  - clang++ afl_driver.cpp afl-llvm-rt.o.o test-libfuzzer-target.o -o test-libfuzzer-target
  - timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-libfuzzer-target
  - cd qemu_mode
  - ./build_qemu_support.sh
  - cd ..
  - gcc ./test-instr.c -o test-no-instr
  - if [ -z "$AFL_STOP_MANUALLY" ];
    then ./afl-fuzz -Q -i seeds -o out/ -- ./test-no-instr;
    else timeout --preserve-status 5s ./afl-fuzz -Q -i seeds -o out/ -- ./test-no-instr;
    fi
  - .travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 12 -p 9</code></pre><p>ã€€ã€€è¿™ä¸ª CI æµç¨‹æ˜¯å…ˆç¼–è¯‘ AFLï¼Œå†æ‰§è¡Œä¸€äº›æµ‹è¯•ã€‚æˆ‘ä»¬é€æ¡è§£é‡Šè¿™äº›è„šæœ¬ï¼š</p><pre><code class="language-bash"># ç¼–è¯‘ AFL
make

# ç”¨ afl-gcc ç¼–è¯‘é¶æ ‡ç¨‹åº
./afl-gcc ./test-instr.c -o test-instr-gcc

# å‡†å¤‡è¯­æ–™é›†
mkdir seeds
echo "" &gt; seeds/nil_seed

# æ‰§è¡Œä¸€æ¬¡æ—¶é•¿ 5s çš„ fuzz
if [ -z "$AFL_STOP_MANUALLY" ];
then ./afl-fuzz -i seeds -o out/ -- ./test-instr-gcc;
else timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-instr-gcc;
fi

# æ£€æŸ¥ fuzzer æ˜¯å¦æ­£ç¡®ç”Ÿæˆäº† fuzzer_stats æ–‡ä»¶ï¼ˆè¿™ä¸ªæ–‡ä»¶ä¿å­˜äº† fuzzer çš„å½“å‰çŠ¶æ€ï¼Œä»¥ä¾¿æ¢å¤ fuzzï¼‰
.travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 1 -p 3

# æ¸…ç†
rm -r out/*

# ç”¨ afl-clang æ‰§è¡Œä¸€é fuzzï¼Œå¤§è‡´ä¸ afl-gcc çš„æµç¨‹ä¸€è‡´
./afl-clang ./test-instr.c -o test-instr-clang
if [ -z "$AFL_STOP_MANUALLY" ];
then ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang;
else timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang;
fi
.travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 1 -p 2
make clean

# ç”¨ llvm_mode æ‰§è¡Œä¸€é fuzz
CC=clang CXX=clang++ make
cd llvm_mode
CC=clang CXX=clang++ LLVM_CONFIG=llvm-config make
cd ..
rm -r out/*
./afl-clang-fast ./test-instr.c -o test-instr-clang-fast
if [ -z "$AFL_STOP_MANUALLY" ];
then ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang-fast;
else timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-instr-clang-fast;
fi
.travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 1 -p 3

# æµ‹è¯•å¯¹ libFuzzer çš„å…¼å®¹æ€§
clang -g -fsanitize-coverage=trace-pc-guard ./test-libfuzzer-target.c -c
clang -c -w llvm_mode/afl-llvm-rt.o.c
wget https://raw.githubusercontent.com/llvm/llvm-project/main/compiler-rt/lib/fuzzer/afl/afl_driver.cpp
clang++ afl_driver.cpp afl-llvm-rt.o.o test-libfuzzer-target.o -o test-libfuzzer-target
timeout --preserve-status 5s ./afl-fuzz -i seeds -o out/ -- ./test-libfuzzer-target

# æµ‹è¯• qemu mode
cd qemu_mode
./build_qemu_support.sh
cd ..
gcc ./test-instr.c -o test-no-instr
if [ -z "$AFL_STOP_MANUALLY" ];
  then ./afl-fuzz -Q -i seeds -o out/ -- ./test-no-instr;
  else timeout --preserve-status 5s ./afl-fuzz -Q -i seeds -o out/ -- ./test-no-instr;
  fi
.travis/check_fuzzer_stats.sh -o out -k peak_rss_mb -v 12 -p 9</code></pre><h3 id="0x01-%E5%86%B3%E5%AE%9A%E9%98%85%E8%AF%BB%E9%A1%BA%E5%BA%8F">0x01 å†³å®šé˜…è¯»é¡ºåº</h3><p>ã€€ã€€AFL ä¸æ˜¯ä¸€ä¸ªç®€å•çš„ CRUD é¡¹ç›®ï¼Œå…¶å†…éƒ¨å……æ–¥ç€å„ç§ç²¾ç»†çš„ä¼˜åŒ–æ‰‹æ®µã€‚æˆ‘ä»¬ç°åœ¨éœ€è¦å¯»æ‰¾ä¸€ä¸ªåˆ‡å…¥ç‚¹ï¼Œå»é˜…è¯»é¡¹ç›®æºç ã€‚ç›´æ¥é˜…è¯» <code>afl-fuzz.c</code> ææ€•ä¼šé™·å…¥ã€Œçœ‹åˆ°ä¸€ä¸ªå‡½æ•° -&gt; å¯»æ‰¾å‡½æ•°å®šä¹‰ -&gt; çœ‹åˆ°é‡Œé¢è°ƒç”¨äº†å¦ä¸€ä¸ªå‡½æ•°â€¦â€¦ã€è¿™æ ·çš„å¾ªç¯ï¼Œå› æ­¤ç¬”è€…å‡†å¤‡å…ˆè¯»é¡¹ç›®çš„å…¶ä»–éƒ¨åˆ†ï¼Œç§¯æ”’ä¸€äº›ç†è§£ï¼Œç„¶åå†è¯» <code>afl-fuzz.c</code>ã€‚è¿™å°±å¦‚åŒåœ¨é˜…è¯»ä¸€ä¸ªå›¾ç‰‡å¤„ç†åº“çš„æ ¸å¿ƒæºç ä¹‹å‰ï¼Œå…ˆè¯»ä¸€ä¸ªè°ƒç”¨äº†è¿™ä¸ªåº“çš„å°ç¨‹åºçš„æºç ï¼Œç†Ÿæ‚‰å„ç§ API çš„ç”¨é€”ï¼Œä»è€Œè¯»æ ¸å¿ƒæºç çš„æ—¶å€™ä¹Ÿæ›´å®¹æ˜“ã€‚</p><p>ã€€ã€€æˆ‘ä»¬é˜…è¯»æºç çš„ä¸»è¦ç›®æ ‡åº”è¯¥æ˜¯ï¼š</p><ol><li>ç†æ¸…é™æ€æ’æ¡©è¿‡ç¨‹ï¼ˆgccã€clangã€llvm modeï¼‰</li><li>ç†æ¸… fuzz è¿‡ç¨‹ï¼šå¦‚ä½•å˜å¼‚ã€å¦‚ä½•å°† input ä¼ é€’ç»™ç¨‹åºã€å¦‚ä½•æ”¶é›†è¦†ç›–åº¦ä¿¡æ¯</li><li>ç†æ¸… qemu mode çš„æ’æ¡©å’Œæ‰§è¡Œè¿‡ç¨‹</li></ol><p>ã€€ã€€å› æ­¤ï¼Œæˆ‘ä»¬å†³å®šé˜…è¯»é¡ºåºï¼š</p><ol><li>é˜…è¯» <code>afl-gcc.c</code> å’Œ <code>afl-as.c</code>ï¼Œå³é™æ€æ’æ¡©ç›¸å…³ä»£ç </li><li>é˜…è¯» <code>afl-tmin.c</code> ï¼Œè¿™ä¸ªå·¥å…·çš„ç”¨é€”æ˜¯ã€Œå°†ä¸€ä¸ª input case ç¼©å°ï¼Œä½†ä¸åŸ input æ‹¥æœ‰ç›¸åŒçš„è¦†ç›–åº¦ã€ã€‚å®ƒä¼šå®Œæ•´åœ°æ¼”ç¤ºå¦‚ä½•æ”¶é›†ç¨‹åºçš„è¦†ç›–åº¦ä¿¡æ¯ï¼Œè€Œä¸æ¶‰åŠ <code>afl-fuzz.c</code> ä¸­çš„å…¶ä»–æµç¨‹ã€‚è¿™å°†ç»™æˆ‘ä»¬æä¾›ä¸€ä¸ªç»ä½³çš„åˆ‡é¢ï¼Œä»¥ç ”ç©¶ AFL æ”¶é›†è¦†ç›–åº¦çš„æ–¹æ³•</li><li>é˜…è¯» <code>afl-fuzz.c</code></li></ol><p>ã€€ã€€é‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨ä» <code>afl-gcc.c</code> å¼€å§‹ã€‚</p><h3 id="0x02-afl-gcc-%E7%BC%96%E8%AF%91%E5%91%BD%E4%BB%A4%E7%94%9F%E6%88%90%E5%99%A8">0x02 afl-gcc ç¼–è¯‘å‘½ä»¤ç”Ÿæˆå™¨</h3><p>ã€€ã€€ç”±äºé˜…è¯»è¿‡ç¨‹ä¸­å°‘ä¸äº†åŠ¨æ€è°ƒè¯•ï¼Œæˆ‘ä»¬ç”¨ VS Code è¿œç¨‹è¿æ¥åˆ° Linux è™šæ‹Ÿæœºä¸Šã€‚å¯¼å…¥æºç ï¼Œå‘ç° clangd æ’ä»¶æ‰¾ä¸åˆ° <code>AFL_PATH</code> å¸¸é‡ã€‚</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="../content/images/2023/05/image-3.png" class="kg-image" alt loading="lazy" width="1827" height="718" srcset="../content/images/size/w600/2023/05/image-3.png 600w, ../content/images/size/w1000/2023/05/image-3.png 1000w, ../content/images/size/w1600/2023/05/image-3.png 1600w, ../content/images/2023/05/image-3.png 1827w" sizes="(min-width: 720px) 720px"><figcaption>â–² clangd æ‰¾ä¸åˆ° <code>AFL_PATH</code></figcaption></figure><p>ã€€ã€€çœ‹ä¸€çœ¼ Makefileï¼š</p><pre><code class="language-makefile">PREFIX     ?= /usr/local
BIN_PATH    = $(PREFIX)/bin
HELPER_PATH = $(PREFIX)/lib/afl
DOC_PATH    = $(PREFIX)/share/doc/afl
MISC_PATH   = $(PREFIX)/share/afl</code></pre><p>ã€€ã€€åŸæ¥è¿™äº›å¸¸é‡éƒ½æ˜¯ make æŒ‡å®šçš„ã€‚æ ¹æ®ä¸€ç¯‡ <a href="https://stackoverflow.com/questions/67887552/make-clangd-aware-of-macros-given-from-the-compiler">Stackoverflow</a> å›ç­”ï¼Œå‘ç° clangd å¯ä»¥ä» <code>compile_commands.json</code> ä¸­è·å–ç¼–è¯‘ flagï¼› æ ¹æ® <a href="https://clangd.llvm.org/installation#project-setup">clangd å®˜ç½‘</a>ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤å°±èƒ½ç”Ÿæˆè¿™ä¸ª jsonï¼š</p><pre><code class="language-bash">make clean
bear -- make</code></pre><p>ã€€ã€€å°è¯•ä¸€ä¸‹ä¹‹åï¼Œé—®é¢˜æœç„¶è§£å†³äº†ã€‚ä¸‹é¢æ¥çœ‹ä»£ç ã€‚</p><p></p><p>ã€€ã€€æ ¹æ®æ³¨é‡Šï¼Œ <code>afl-gcc</code> æ˜¯ <code>gcc, g++, clang, clang++</code> çš„åŒ…è£…å™¨ã€‚å®ƒçš„ä½œç”¨æ˜¯è®¾ç½®ä¸€äº›ç¼–è¯‘å‚æ•°ï¼Œç„¶åè°ƒç”¨è¿™äº›ç¼–è¯‘å™¨ã€‚äº‹å®ä¸Šï¼Œ<strong>ç¼–è¯‘å‡ºæ¥çš„ <code>afl-clang, afl-g++</code> ç­‰æ–‡ä»¶éƒ½æ˜¯æŒ‡å‘ <code>afl-gcc</code> çš„è½¯é“¾æ¥ã€‚</strong></p><p>ã€€ã€€<code>afl-gcc</code> éœ€è¦çŸ¥é“ <code>afl-as</code> çš„è·¯å¾„ã€‚<code>afl-as</code> æ˜¯æ’æ¡©å™¨ï¼Œæˆ‘ä»¬å°†ä¼šåœ¨åæ–‡åˆ†æå®ƒçš„é€»è¾‘ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>afl-as</code> ä½äº <code>/usr/local/lib/afl/</code> ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥é€è¿‡ <code>AFL_PATH</code> æŒ‡å®šã€‚</p><div class="kg-card kg-callout-card kg-callout-card-grey"><div class="kg-callout-emoji">ğŸ““</div><div class="kg-callout-text"><strong>ä¸€äº›ç»†èŠ‚ï¼š</strong> <br>å¦‚æœ <code>AFL_HARDEN</code> æ‰“å¼€ï¼Œ <code>afl-gcc</code> ä¼šç»™ä¸‹æ¸¸ç¼–è¯‘å™¨ä¼ é€’ä¸€äº›å¼€å…³ï¼ˆ <code>-D_FORTIFY_SOURCE=2, -fstack-protector-all</code>ï¼‰ï¼Œä½¿å¾—å†…å­˜ bug æ›´å®¹æ˜“æš´éœ²å’Œå¤ç°ã€‚å¦‚æœ <code>AFL_USE_ASAN</code> æ‰“å¼€ï¼Œå°†ä¼šä½¿ç”¨ ASanã€‚<br><br>å¦å¤–ï¼Œ <code>afl-gcc</code> å…è®¸ç”¨æˆ·ä½¿ç”¨éæ ‡å‡†çš„ä¸‹æ¸¸ç¼–è¯‘å™¨ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå¹¶é gcc æˆ– clangï¼‰ã€‚è®¾ç½® <code>AFL_CC</code> å’Œ <code>AFL_CXX</code> å³å¯ã€‚</div></div><p>ã€€ã€€ã€€å…ˆçœ‹ <code>main</code> å‡½æ•°ï¼š</p><pre><code class="language-c">/* Main entry point */

int main(int argc, char** argv) {

  // å¦‚æœä¸æ˜¯ QUIET æ¨¡å¼ï¼Œåˆ™è¾“å‡ºä½œè€…ä¿¡æ¯
  if (isatty(2) &amp;&amp; !getenv("AFL_QUIET")) {
    SAYF(cCYA "afl-cc " cBRI VERSION cRST " by &lt;lcamtuf@google.com&gt;\n");
  } else be_quiet = 1;

  // å¦‚æœä¸å¸¦å‚æ•°è°ƒç”¨ï¼Œåˆ™è¾“å‡ºå¸®åŠ©æ–‡æ¡£åé€€å‡º
  if (argc &lt; 2) {
    SAYF("\n"
         "This is a helper application for afl-fuzz. It serves as a drop-in replacement\n"
         "for gcc or clang, letting you recompile third-party code with the required\n"
         "runtime instrumentation. A common use pattern would be one of the following:\n\n"

         "  CC=%s/afl-gcc ./configure\n"
         "  CXX=%s/afl-g++ ./configure\n\n"

         "You can specify custom next-stage toolchain via AFL_CC, AFL_CXX, and AFL_AS.\n"
         "Setting AFL_HARDEN enables hardening optimizations in the compiled code.\n\n",
         BIN_PATH, BIN_PATH);

    exit(1);
  }

  // å¯»æ‰¾ afl-as
  find_as(argv[0]);

  // ä¿®æ”¹ç¼–è¯‘å‚æ•°
  edit_params(argc, argv);

  // æ‰§è¡Œä¸‹æ¸¸ç¼–è¯‘å™¨
  execvp(cc_params[0], (char**)cc_params);

  FATAL("Oops, failed to execute '%s' - check your PATH", cc_params[0]);

  return 0;

}</code></pre><p>ã€€ã€€é€»è¾‘å¾ˆæ¸…æ™°ï¼š<strong>å…ˆè°ƒç”¨ <code>find_as(argv[0])</code> å¯»æ‰¾ <code>afl-as</code> ï¼›ç„¶åä¿®æ”¹ç¼–è¯‘å™¨å‚æ•°ï¼Œå¹¶æ‰§è¡Œä¸‹æ¸¸ç¼–è¯‘å™¨ã€‚</strong>æˆ‘ä»¬æŒ‰é¡ºåºçœ‹ï¼Œå…ˆè§‚å¯Ÿè´Ÿè´£å¯»æ‰¾ <code>afl-as</code> çš„ <code>find_as</code> å‡½æ•°ï¼š</p><pre><code class="language-c">/* Try to find our "fake" GNU assembler in AFL_PATH or at the location derived
   from argv[0]. If that fails, abort. */

static void find_as(u8* argv0) {
  // ä»ç¯å¢ƒå˜é‡ä¸­è¯»å– $AFL_PATH
  u8 *afl_path = getenv("AFL_PATH");
  u8 *slash, *tmp;

  // å¦‚æœå­˜åœ¨ç¯å¢ƒå˜é‡ $AFL_PATHï¼Œä¸” $AFL_PATH/as å­˜åœ¨ï¼Œåˆ™æˆåŠŸæ‰¾åˆ°
  if (afl_path) {

    tmp = alloc_printf("%s/as", afl_path);

    if (!access(tmp, X_OK)) {
      as_path = afl_path;
      ck_free(tmp);
      return;
    }

    ck_free(tmp);

  }

  // äº argv[0] æ‰€åœ¨çš„ç›®å½•ä¸‹å¯»æ‰¾ afl-as
  slash = strrchr(argv0, '/');

  if (slash) {

    u8 *dir;

    *slash = 0;
    dir = ck_strdup(argv0);
    *slash = '/';

    tmp = alloc_printf("%s/afl-as", dir);

    if (!access(tmp, X_OK)) {
      as_path = dir;
      ck_free(tmp);
      return;
    }

    ck_free(tmp);
    ck_free(dir);

  }

  // fallbackï¼Œå¦‚æœå‰ä¸¤ä¸ªä½ç½®éƒ½æ‰¾ä¸åˆ°ï¼Œåˆ™å»ç¼–è¯‘ afl-gcc æ—¶å®šä¹‰çš„ AFL_PATH å»æ‰¾
  // é»˜è®¤æƒ…å†µä¸‹ï¼ŒAFL_PATH ç”± Makefile å®šä¹‰æˆ "/usr/local/lib/afl"
  if (!access(AFL_PATH "/as", X_OK)) {
    as_path = AFL_PATH;
    return;
  }

  FATAL("Unable to find AFL wrapper binary for 'as'. Please set AFL_PATH");
 
}</code></pre><p>ã€€ã€€æˆ‘ä»¬å¹³æ—¶ä¸€èˆ¬ä½¿ç”¨ <code>/work/afl/afl-gcc</code> æ¥è°ƒç”¨ <code>afl-gcc</code>ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¼šæ‰¾åˆ° <code>/work/afl/afl-as</code> è¿™ä¸ªæ–‡ä»¶ã€‚</p><hr><p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œé˜…è¯» <code>edit_params</code> å‡½æ•°ï¼Œçœ‹çœ‹ä¸‹æ¸¸ç¼–è¯‘å™¨çš„å‚æ•°æ˜¯å¦‚ä½•ç”Ÿæˆçš„ã€‚</p><p>ã€€ã€€é¦–å…ˆï¼Œåˆ†æè‡ªå·±çš„ <code>argv[0]</code> ï¼Œç¡®å®šè‡ªå·±éœ€è¦è°ƒç”¨å“ªä¸ªä¸‹æ¸¸ç¼–è¯‘å™¨â€”â€”ä¾‹å¦‚ï¼Œå¦‚æœ <code>argv[0]</code> æ˜¯ <code>/work/afl/afl-clang++</code> ï¼Œåˆ™ä¸‹æ¸¸ç¼–è¯‘å™¨æ˜¯ <code>clang++</code> ã€‚å¦å¤–ï¼Œä¸Šæ–‡æåˆ°è¿‡ï¼ŒAFL å…è®¸ç”¨æˆ·è‡ªå·±æŒ‡å®šä¸‹æ¸¸ç¼–è¯‘å™¨ï¼Œå¦‚æœ <code>AFL_CC</code> å’Œ <code>AFL_CXX</code> å­˜åœ¨ï¼Œåˆ™ä¼šè¦†ç›–æ‰é»˜è®¤ç¼–è¯‘å™¨ã€‚</p><p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œ<strong>å°†è‡ªå·±çš„ <code>argv[]</code> å¤åˆ¶ä¸€ä»½ï¼Œç¨åå°†ä¼šåŸæ ·ä¼ é€’ç»™ä¸‹æ¸¸ç¼–è¯‘å™¨ã€‚</strong>ç”±äºè¿™ä¸€æ­¥éª¤çš„å­˜åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>afl-gcc</code> ä»£æ›¿åŸæœ‰çš„ <code>gcc</code> æŒ‡ä»¤ã€‚</p><ul><li><code>-integrated-as</code> å’Œ <code>-pipe</code> å¼€å…³ä¼šè¢«å¿½ç•¥ã€‚</li><li><code>-B</code> å‚æ•°ä¼šè¢«è¦†ç›–ä¸º <code>as_path</code> ã€‚æ ¹æ® gcc æ–‡æ¡£ï¼šThis option specifies where to find the executables, libraries, include files, and data files <strong>of the compiler itself</strong>.</li><li>å¦‚æœæ˜¯ clang æ¨¡å¼ï¼Œåˆ™æ‰“å¼€ <code>-no-integrated-as</code> å¼€å…³ã€‚</li><li>å¦‚æœ <code>AFL_HARDEN</code> æ‰“å¼€ï¼Œåˆ™è®¾ç½® <code>-fstack-protector-all</code> å’Œ <code>-D_FORTIFY_SOURCE=2</code> ã€‚</li><li>è‹¥ä¼ å…¥çš„ç¼–è¯‘å‚æ•°ä¸­æœ¬æ¥å°±æœ‰ <code>-fsanitize=address</code> æˆ– <code>-fsanitize=memory</code>ï¼Œåˆ™è®¾ç½®ç¯å¢ƒå˜é‡ <code>AFL_USE_ASAN</code> ä¸º 1ï¼›<br>å¦åˆ™æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š <br>- å¦‚æœ <code>AFL_USE_ASAN</code> æ‰“å¼€ï¼Œåˆ™è®¾ç½® <code>-U_FORTIFY_SOURCE</code> å’Œ <code>-fsanitize=address</code><br>- å¦‚æœ <code>AFL_USE_MSAN</code> æ‰“å¼€ï¼Œåˆ™è®¾ç½® <code>-U_FORTIFY_SOURCE</code> å’Œ <code>-fsanitize=memory</code></li></ul><p>ã€€ã€€é»˜è®¤æƒ…å†µä¸‹ï¼ˆæœªè®¾ç½® <code>AFL_DONT_OPTIMIZE</code> ç¯å¢ƒå˜é‡ï¼‰ï¼Œä¼šåŠ å…¥ä»¥ä¸‹ä¼˜åŒ–å¼€å…³ï¼š</p><pre><code class="language-plaintext">-g -O3 -funroll-loops -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1</code></pre><p>ã€€ã€€å¦‚æœ <code>AFL_NO_BUILTIN</code> ç¯å¢ƒå˜é‡è¢«æ‰“å¼€ï¼Œåˆ™åŠ å…¥ä»¥ä¸‹å¼€å…³ï¼š</p><figure class="kg-card kg-code-card"><pre><code class="language-plaintext">-fno-builtin-strcmp
-fno-builtin-strncmp
-fno-builtin-strcasecmp
-fno-builtin-strncasecmp
-fno-builtin-memcmp
-fno-builtin-strstr
-fno-builtin-strcasestr</code></pre><figcaption>â–² å…³äºè¿™äº› no-builtin å¼€å…³çš„ç”¨é€”ï¼Œè¯¦è§ <a href="https://stackoverflow.com/questions/54281780/what-exactly-is-fno-builtin-doing-here">Stackoverflow è®¨è®º</a>&nbsp;</figcaption></figure><p>ã€€ã€€ä»¥ä¸Šå°±æ˜¯ <code>edit_params</code> çš„å…¨æµç¨‹ã€‚æ³¨æ„åˆ°ï¼Œ<strong>æœ€å…³é”®çš„ä¸€æ­¥æ˜¯åŠ å…¥äº† <code>-B as_path</code> è¿™ä¸ª flagï¼Œä½¿å¾—ä¸‹æ¸¸ç¼–è¯‘å™¨åœ¨æ±‡ç¼–è¿‡ç¨‹ä¸­ï¼Œä»¥ <code>afl-as</code> æ›¿æ¢äº†åŸç”Ÿçš„æ±‡ç¼–å™¨ã€‚</strong>è€Œå…·ä½“çš„æ’æ¡©è¿‡ç¨‹ï¼Œåˆ™æ˜¯ <code>afl-as</code> è´Ÿè´£å®ç°ã€‚æˆ‘ä»¬åœ¨ä¸‹ä¸€ç« èŠ‚å»é˜…è¯» <code>afl-as</code> çš„æºç ã€‚</p><p>ã€€ã€€æœ¬èŠ‚é˜…è¯»çš„ <code>edit_params</code> å‡½æ•°æºç å¦‚ä¸‹ï¼š</p><pre><code class="language-c">/* Copy argv to cc_params, making the necessary edits. */

static void edit_params(u32 argc, char** argv) {
  u8 fortify_set = 0, asan_set = 0;
  u8 *name;

#if defined(__FreeBSD__) &amp;&amp; defined(__x86_64__)
  u8 m32_set = 0;
#endif

  // ç¡®å®šä½¿ç”¨å“ªä¸ªä¸‹æ¸¸ç¼–è¯‘å™¨
  cc_params = ck_alloc((argc + 128) * sizeof(u8*));

  name = strrchr(argv[0], '/');
  if (!name) name = argv[0]; else name++;

  if (!strncmp(name, "afl-clang", 9)) {

    clang_mode = 1;

    setenv(CLANG_ENV_VAR, "1", 1);

    if (!strcmp(name, "afl-clang++")) {
      u8* alt_cxx = getenv("AFL_CXX");
      cc_params[0] = alt_cxx ? alt_cxx : (u8*)"clang++";
    } else {
      u8* alt_cc = getenv("AFL_CC");
      cc_params[0] = alt_cc ? alt_cc : (u8*)"clang";
    }

  } else {

    /* With GCJ and Eclipse installed, you can actually compile Java! The
       instrumentation will work (amazingly). Alas, unhandled exceptions do
       not call abort(), so afl-fuzz would need to be modified to equate
       non-zero exit codes with crash conditions when working with Java
       binaries. Meh. */

#ifdef __APPLE__

    if (!strcmp(name, "afl-g++")) cc_params[0] = getenv("AFL_CXX");
    else if (!strcmp(name, "afl-gcj")) cc_params[0] = getenv("AFL_GCJ");
    else cc_params[0] = getenv("AFL_CC");

    if (!cc_params[0]) {

      SAYF("\n" cLRD "[-] " cRST
           "On Apple systems, 'gcc' is usually just a wrapper for clang. Please use the\n"
           "    'afl-clang' utility instead of 'afl-gcc'. If you really have GCC installed,\n"
           "    set AFL_CC or AFL_CXX to specify the correct path to that compiler.\n");

      FATAL("AFL_CC or AFL_CXX required on MacOS X");

    }

#else

    if (!strcmp(name, "afl-g++")) {
      u8* alt_cxx = getenv("AFL_CXX");
      cc_params[0] = alt_cxx ? alt_cxx : (u8*)"g++";
    } else if (!strcmp(name, "afl-gcj")) {
      u8* alt_cc = getenv("AFL_GCJ");
      cc_params[0] = alt_cc ? alt_cc : (u8*)"gcj";
    } else {
      u8* alt_cc = getenv("AFL_CC");
      cc_params[0] = alt_cc ? alt_cc : (u8*)"gcc";
    }

#endif /* __APPLE__ */

  }


  // å¤åˆ¶è‡ªå·±çš„ argv
  while (--argc) {
    u8* cur = *(++argv);

    if (!strncmp(cur, "-B", 2)) {

      if (!be_quiet) WARNF("-B is already set, overriding");

      if (!cur[2] &amp;&amp; argc &gt; 1) { argc--; argv++; }
      continue;

    }

    if (!strcmp(cur, "-integrated-as")) continue;

    if (!strcmp(cur, "-pipe")) continue;

#if defined(__FreeBSD__) &amp;&amp; defined(__x86_64__)
    if (!strcmp(cur, "-m32")) m32_set = 1;
#endif

    if (!strcmp(cur, "-fsanitize=address") ||
        !strcmp(cur, "-fsanitize=memory")) asan_set = 1;

    if (strstr(cur, "FORTIFY_SOURCE")) fortify_set = 1;

    cc_params[cc_par_cnt++] = cur;

  }

  cc_params[cc_par_cnt++] = "-B";
  cc_params[cc_par_cnt++] = as_path;

  if (clang_mode)
    cc_params[cc_par_cnt++] = "-no-integrated-as";

  if (getenv("AFL_HARDEN")) {

    cc_params[cc_par_cnt++] = "-fstack-protector-all";

    if (!fortify_set)
      cc_params[cc_par_cnt++] = "-D_FORTIFY_SOURCE=2";

  }

  // è‹¥ä¼ å…¥çš„ç¼–è¯‘å‚æ•°ä¸­æœ¬æ¥å°±æ‰“å¼€äº† ASan æˆ– MSanï¼Œåˆ™è¿™é‡ŒæŠŠ $AFL_USE_ASAN ä¹Ÿæ‰“å¼€
  if (asan_set) {

    /* Pass this on to afl-as to adjust map density. */

    setenv("AFL_USE_ASAN", "1", 1);

  } else if (getenv("AFL_USE_ASAN")) {

    if (getenv("AFL_USE_MSAN"))
      FATAL("ASAN and MSAN are mutually exclusive");

    if (getenv("AFL_HARDEN"))
      FATAL("ASAN and AFL_HARDEN are mutually exclusive");

    cc_params[cc_par_cnt++] = "-U_FORTIFY_SOURCE";
    cc_params[cc_par_cnt++] = "-fsanitize=address";

  } else if (getenv("AFL_USE_MSAN")) {

    if (getenv("AFL_USE_ASAN"))
      FATAL("ASAN and MSAN are mutually exclusive");

    if (getenv("AFL_HARDEN"))
      FATAL("MSAN and AFL_HARDEN are mutually exclusive");

    cc_params[cc_par_cnt++] = "-U_FORTIFY_SOURCE";
    cc_params[cc_par_cnt++] = "-fsanitize=memory";


  }

  if (!getenv("AFL_DONT_OPTIMIZE")) {

#if defined(__FreeBSD__) &amp;&amp; defined(__x86_64__)

    /* On 64-bit FreeBSD systems, clang -g -m32 is broken, but -m32 itself
       works OK. This has nothing to do with us, but let's avoid triggering
       that bug. */

    if (!clang_mode || !m32_set)
      cc_params[cc_par_cnt++] = "-g";

#else

      cc_params[cc_par_cnt++] = "-g";

#endif

    cc_params[cc_par_cnt++] = "-O3";
    cc_params[cc_par_cnt++] = "-funroll-loops";

    /* Two indicators that you're building for fuzzing; one of them is
       AFL-specific, the other is shared with libfuzzer. */

    cc_params[cc_par_cnt++] = "-D__AFL_COMPILER=1";
    cc_params[cc_par_cnt++] = "-DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1";

  }

  if (getenv("AFL_NO_BUILTIN")) {

    cc_params[cc_par_cnt++] = "-fno-builtin-strcmp";
    cc_params[cc_par_cnt++] = "-fno-builtin-strncmp";
    cc_params[cc_par_cnt++] = "-fno-builtin-strcasecmp";
    cc_params[cc_par_cnt++] = "-fno-builtin-strncasecmp";
    cc_params[cc_par_cnt++] = "-fno-builtin-memcmp";
    cc_params[cc_par_cnt++] = "-fno-builtin-strstr";
    cc_params[cc_par_cnt++] = "-fno-builtin-strcasestr";

  }

  cc_params[cc_par_cnt] = NULL;

}</code></pre><h3 id="0x03-afl-as-%E9%9D%99%E6%80%81%E6%8F%92%E6%A1%A9%E5%99%A8">0x03 afl-as é™æ€æ’æ¡©å™¨</h3><p>ã€€ã€€<code>afl-as</code> æ˜¯åŸç”Ÿ GNU as çš„ wrapperã€‚æˆ‘ä»¬å…ˆé˜…è¯» <code>main</code> å‡½æ•°ï¼š</p><pre><code class="language-c">/* Main entry point */

int main(int argc, char** argv) {

  s32 pid;
  u32 rand_seed;
  int status;
  u8* inst_ratio_str = getenv("AFL_INST_RATIO");

  struct timeval tv;
  struct timezone tz;

  clang_mode = !!getenv(CLANG_ENV_VAR);

  if (isatty(2) &amp;&amp; !getenv("AFL_QUIET")) {

    SAYF(cCYA "afl-as " cBRI VERSION cRST " by &lt;lcamtuf@google.com&gt;\n");
 
  } else be_quiet = 1;

  if (argc &lt; 2) {

    SAYF("\n"
         "This is a helper application for afl-fuzz. It is a wrapper around GNU 'as',\n"
         "executed by the toolchain whenever using afl-gcc or afl-clang. You probably\n"
         "don't want to run this program directly.\n\n"

         "Rarely, when dealing with extremely complex projects, it may be advisable to\n"
         "set AFL_INST_RATIO to a value less than 100 in order to reduce the odds of\n"
         "instrumenting every discovered branch.\n\n");

    exit(1);

  }

  gettimeofday(&amp;tv, &amp;tz);

  rand_seed = tv.tv_sec ^ tv.tv_usec ^ getpid();

  srandom(rand_seed);

  edit_params(argc, argv);

  if (inst_ratio_str) {

    if (sscanf(inst_ratio_str, "%u", &amp;inst_ratio) != 1 || inst_ratio &gt; 100) 
      FATAL("Bad value of AFL_INST_RATIO (must be between 0 and 100)");

  }

  if (getenv(AS_LOOP_ENV_VAR))
    FATAL("Endless loop when calling 'as' (remove '.' from your PATH)");

  setenv(AS_LOOP_ENV_VAR, "1", 1);

  /* When compiling with ASAN, we don't have a particularly elegant way to skip
     ASAN-specific branches. But we can probabilistically compensate for
     that... */

  if (getenv("AFL_USE_ASAN") || getenv("AFL_USE_MSAN")) {
    sanitizer = 1;
    inst_ratio /= 3;
  }

  if (!just_version) add_instrumentation();

  if (!(pid = fork())) {

    execvp(as_params[0], (char**)as_params);
    FATAL("Oops, failed to execute '%s' - check your PATH", as_params[0]);

  }

  if (pid &lt; 0) PFATAL("fork() failed");

  if (waitpid(pid, &amp;status, 0) &lt;= 0) PFATAL("waitpid() failed");

  if (!getenv("AFL_KEEP_ASSEMBLY")) unlink(modified_file);

  exit(WEXITSTATUS(status));

}</code></pre><p>ã€€ã€€å¯è§å·¥ä½œæµç¨‹æ˜¯ï¼š</p><ol><li>åˆå§‹åŒ–éšæœºæ•°ç§å­</li><li>åœ¨æ±‡ç¼–æŒ‡ä»¤åºåˆ—ä¸Šæ’æ¡© Â </li><li>ä¿®æ”¹ as å‚æ•°</li><li>è°ƒç”¨ as ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æ¸…ç†ç°åœº</li></ol><p>ã€€ã€€å…ˆæ¥çœ‹ <code>afl-as</code> æ˜¯å¦‚ä½•è¯»å–å¹¶ä¿®æ”¹ as å‚æ•°çš„ã€‚æºç ä¸­æœ‰å¾ˆå¤šå¯¹åº” MacOS çš„å†…å®¹ï¼Œæˆ‘ä»¬åªå…³æ³¨ Linux x86ï¼Œæ•…åˆ å»è¿™äº›æ®µè½ã€‚ç²¾ç®€åçš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-c">/* Examine and modify parameters to pass to 'as'. Note that the file name
   is always the last parameter passed by GCC, so we exploit this property
   to keep the code simple. */

static void edit_params(int argc, char** argv) {

  u8 *tmp_dir = getenv("TMPDIR"), *afl_as = getenv("AFL_AS");
  u32 i;

  /* Although this is not documented, GCC also uses TEMP and TMP when TMPDIR
     is not set. We need to check these non-standard variables to properly
     handle the pass_thru logic later on. */

  if (!tmp_dir) tmp_dir = getenv("TEMP");
  if (!tmp_dir) tmp_dir = getenv("TMP");
  if (!tmp_dir) tmp_dir = "/tmp";

  as_params = ck_alloc((argc + 32) * sizeof(u8*));

  as_params[0] = afl_as ? afl_as : (u8*)"as";

  as_params[argc] = 0;

  for (i = 1; i &lt; argc - 1; i++) {

    if (!strcmp(argv[i], "--64")) use_64bit = 1;
    else if (!strcmp(argv[i], "--32")) use_64bit = 0;

    as_params[as_par_cnt++] = argv[i];

  }

  input_file = argv[argc - 1];

  if (input_file[0] == '-') {

    if (!strcmp(input_file + 1, "-version")) {
      just_version = 1;
      modified_file = input_file;
      goto wrap_things_up;
    }

    if (input_file[1]) FATAL("Incorrect use (not called through afl-gcc?)");
    else input_file = NULL;

  } else {

    /* Check if this looks like a standard invocation as a part of an attempt
       to compile a program, rather than using gcc on an ad-hoc .s file in
       a format we may not understand. This works around an issue compiling
       NSS. */

    if (strncmp(input_file, tmp_dir, strlen(tmp_dir)) &amp;&amp;
        strncmp(input_file, "/var/tmp/", 9) &amp;&amp;
        strncmp(input_file, "/tmp/", 5)) pass_thru = 1;

  }

  modified_file = alloc_printf("%s/.afl-%u-%u.s", tmp_dir, getpid(),
                               (u32)time(NULL));

wrap_things_up:

  as_params[as_par_cnt++] = modified_file;
  as_params[as_par_cnt]   = NULL;

}</code></pre><p>ã€€ã€€å¯è§ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆç±»ä¼¼äº <code>afl-gcc</code> ä¿®æ”¹å‚æ•°çš„é€»è¾‘ï¼š</p><ol><li>é¦–å…ˆç¡®å®š as ç¨‹åºçš„åå­—ï¼Œé»˜è®¤å°±æ˜¯ GNU asï¼Œä½†ç”¨æˆ·ä¹Ÿå¯ä»¥æä¾› <code>AFL_AS</code> æ¥è¦†ç›–</li><li>è®¾ç½®ä¸´æ—¶æ–‡ä»¶ <code>modified_file</code> è·¯å¾„ä¸º <code>/tmp/.afl-pid-timestamp.s</code></li><li>å°†è‡ªå·±ç¨‹åºçš„ <code>argv</code> åŸæ ·å¤åˆ¶ç»™ <code>as</code> </li></ol><p>ã€€ã€€é‚£ä¹ˆï¼Œæ•´ä¸ª <code>afl-as</code> ç¨‹åºçš„é€»è¾‘å°±æ˜¯ï¼šè¯»å…¥åŸæ¥çš„æ±‡ç¼–ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ªæ’äº†æ¡©çš„æ–°æ±‡ç¼–ä»£ç ï¼ˆå­˜æ”¾åœ¨ä¸´æ—¶ç›®å½•ï¼‰ï¼Œè°ƒç”¨ GNU as æ¥å°†æ–°æ±‡ç¼–ä»£ç è½¬åŒ–æˆæœºå™¨ç ã€‚</p><p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é˜…è¯»æ’æ¡©è¿‡ç¨‹çš„æ ¸å¿ƒéƒ¨åˆ†ã€‚</p><hr><p>ã€€ã€€<code>add_instrumentation</code> æ˜¯ä¸€ä¸ª 200 å¤šè¡Œçš„å‡½æ•°ï¼Œå…¶ä¸­é€»è¾‘æ¯”è¾ƒå¤æ‚ã€‚æˆ‘ä»¬ä¸å¦¨å…ˆå®é™…æ‰§è¡Œä¸€é as è¿‡ç¨‹ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•æ’æ¡©çš„ã€‚</p><p>ã€€ã€€ç¼–å†™ä¸€æ®µç®€å•çš„ä»£ç ï¼š</p><pre><code class="language-c">#include &lt;stdio.h&gt;

void work() {
    for(int i=1; i&lt;=10; i++) {
        printf("Hello, world %d\n", i);
    }
}

int main(void) {
    work();
    return 0;
}</code></pre><p>ã€€ã€€ç¼–è¯‘ã€æ’æ¡©ï¼š</p><figure class="kg-card kg-code-card"><pre><code class="language-bash">AFL_DONT_OPTIMIZE=1 ../afl-gcc target.c -o target -O0 -fno-asynchronous-unwind-tables</code></pre><figcaption>â–² ä½¿ç”¨ <code>-fno-asynchronous-unwind-tables</code> ä»¥å»é™¤ .cfi æŒ‡ä»¤ã€‚è§ <a href="https://stackoverflow.com/questions/2529185/what-are-cfi-directives-in-gnu-assembler-gas-used-for">Stackoverflow</a>&nbsp;</figcaption></figure><p>ã€€ã€€æˆ‘ä»¬ä¿®æ”¹äº† <code>afl-as</code> çš„æºç ï¼Œè®©å®ƒå°†æ’æ¡©å‰ã€æ’æ¡©åçš„æ±‡ç¼–ä»£ç éƒ½ä¿ç•™åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚æ’æ¡©å‰çš„æ±‡ç¼–ä»£ç ä¸ºï¼š </p><pre><code class="language-c">	.file	"target.c"
	.text
	.section	.rodata
.LC0:
	.string	"Hello, world %d\n"
	.text
	.globl	work
	.type	work, @function
work:
	pushq	%rbp
	movq	%rsp, %rbp
	subq	$16, %rsp
	movl	$1, -4(%rbp)
	jmp	.L2
.L3:
	movl	-4(%rbp), %eax
	movl	%eax, %esi
	leaq	.LC0(%rip), %rax
	movq	%rax, %rdi
	movl	$0, %eax
	call	printf@PLT
	addl	$1, -4(%rbp)
.L2:
	cmpl	$10, -4(%rbp)
	jle	.L3
	nop
	nop
	leave
	ret
	.size	work, .-work
	.globl	main
	.type	main, @function
main:
	pushq	%rbp
	movq	%rsp, %rbp
	movl	$0, %eax
	call	work
	movl	$0, %eax
	popq	%rbp
	ret
	.size	main, .-main
	.ident	"GCC: (Debian 12.2.0-14) 12.2.0"
	.section	.note.GNU-stack,"",@progbits
</code></pre><p>ã€€ã€€æ’æ¡©åçš„ä»£ç ä¸ºï¼š</p><pre><code class="language-c">	.file	"target.c"
	.text
	.section	.rodata
.LC0:
	.string	"Hello, world %d\n"
	.text
	.globl	work
	.type	work, @function
work:

/* --- AFL TRAMPOLINE (64-BIT) --- */

.align 4

leaq -(128+24)(%rsp), %rsp
movq %rdx,  0(%rsp)
movq %rcx,  8(%rsp)
movq %rax, 16(%rsp)
movq $0x00000af3, %rcx
call __afl_maybe_log
movq 16(%rsp), %rax
movq  8(%rsp), %rcx
movq  0(%rsp), %rdx
leaq (128+24)(%rsp), %rsp

/* --- END --- */

	pushq	%rbp
	movq	%rsp, %rbp
	subq	$16, %rsp
	movl	$1, -4(%rbp)
	jmp	.L2
.L3:

/* --- AFL TRAMPOLINE (64-BIT) --- */

.align 4

leaq -(128+24)(%rsp), %rsp
movq %rdx,  0(%rsp)
movq %rcx,  8(%rsp)
movq %rax, 16(%rsp)
movq $0x00003d9b, %rcx
call __afl_maybe_log
movq 16(%rsp), %rax
movq  8(%rsp), %rcx
movq  0(%rsp), %rdx
leaq (128+24)(%rsp), %rsp

/* --- END --- */

	movl	-4(%rbp), %eax
	movl	%eax, %esi
	leaq	.LC0(%rip), %rax
	movq	%rax, %rdi
	movl	$0, %eax
	call	printf@PLT
	addl	$1, -4(%rbp)
.L2:

/* --- AFL TRAMPOLINE (64-BIT) --- */

.align 4

leaq -(128+24)(%rsp), %rsp
movq %rdx,  0(%rsp)
movq %rcx,  8(%rsp)
movq %rax, 16(%rsp)
movq $0x0000d5a5, %rcx
call __afl_maybe_log
movq 16(%rsp), %rax
movq  8(%rsp), %rcx
movq  0(%rsp), %rdx
leaq (128+24)(%rsp), %rsp

/* --- END --- */

	cmpl	$10, -4(%rbp)
	jle	.L3

/* --- AFL TRAMPOLINE (64-BIT) --- */

.align 4

leaq -(128+24)(%rsp), %rsp
movq %rdx,  0(%rsp)
movq %rcx,  8(%rsp)
movq %rax, 16(%rsp)
movq $0x000078e0, %rcx
call __afl_maybe_log
movq 16(%rsp), %rax
movq  8(%rsp), %rcx
movq  0(%rsp), %rdx
leaq (128+24)(%rsp), %rsp

/* --- END --- */

	nop
	nop
	leave
	ret
	.size	work, .-work
	.globl	main
	.type	main, @function
main:

/* --- AFL TRAMPOLINE (64-BIT) --- */

.align 4

leaq -(128+24)(%rsp), %rsp
movq %rdx,  0(%rsp)
movq %rcx,  8(%rsp)
movq %rax, 16(%rsp)
movq $0x0000c35b, %rcx
call __afl_maybe_log
movq 16(%rsp), %rax
movq  8(%rsp), %rcx
movq  0(%rsp), %rdx
leaq (128+24)(%rsp), %rsp

/* --- END --- */

	pushq	%rbp
	movq	%rsp, %rbp
	movl	$0, %eax
	call	work
	movl	$0, %eax
	popq	%rbp
	ret
	.size	main, .-main
	.ident	"GCC: (Debian 12.2.0-14) 12.2.0"
	.section	.note.GNU-stack,"",@progbits

/* --- AFL MAIN PAYLOAD (64-BIT) --- */
/* æ­¤å¤„çœç•¥ 300 ä½™è¡Œ */</code></pre><p>ã€€ã€€å¯è§ï¼Œåœ¨æ¯ä¸€ä¸ªåŸºæœ¬å—å…¥å£å¤„ï¼Œafl-as æ’å…¥äº†ä¸€æ®µä»£ç ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨æ•´ä¸ªç¨‹åºçš„æœ«å°¾ï¼Œæ’å…¥äº†ä¸€æ®µ 300 å¤šè¡Œçš„ AFL main payloadã€‚æš‚ä¸”å…ˆä¸ç®¡ AFL main payloadï¼Œæˆ‘ä»¬å…ˆåˆ†æåœ¨æ¯ä¸ª branch å¼€å§‹çš„ä½ç½®æ’å…¥çš„ä»£ç ï¼Œè¿™ç±»ä»£ç å½¢å¦‚ï¼š</p><pre><code class="language-c">/* --- AFL TRAMPOLINE (64-BIT) --- */
.align 4

leaq -(128+24)(%rsp), %rsp
movq %rdx,  0(%rsp)
movq %rcx,  8(%rsp)
movq %rax, 16(%rsp)
movq $0x000078e0, %rcx
call __afl_maybe_log
movq 16(%rsp), %rax
movq  8(%rsp), %rcx
movq  0(%rsp), %rdx
leaq (128+24)(%rsp), %rsp
/* --- END --- */</code></pre><p>ã€€ã€€<a href="https://github.com/google/AFL/blob/master/docs/technical_details.txt">AFL ç™½çš®ä¹¦</a>ä¸­è¯´ï¼Œä¸Šè¿°ä»£ç æœ¬è´¨ä¸Šå®ç°äº†å¦‚ä¸‹é€»è¾‘ï¼š</p><pre><code class="language-c">cur_location = &lt;COMPILE_TIME_RANDOM&gt;;
shared_mem[cur_location ^ prev_location]++; 
prev_location = cur_location &gt;&gt; 1;</code></pre><p>ã€€ã€€è¿™é‡Œæœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼šä¸ºä»€ä¹ˆéœ€è¦æŠŠ <code>cur_location</code> å³ç§»ä¸€ä½å†èµ‹å€¼ç»™ <code>prev_location</code> ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ã€‚è®¾ä¸¤ä¸ªå…¥å£ç‚¹çš„éšæœºå€¼åˆ†åˆ«ä¸º $A, B$ï¼Œå‡è®¾ä¸å­˜åœ¨è¿™ä¸ªå³ç§»ï¼Œé‚£ä¹ˆç”±äºå¼‚æˆ–è¿ç®—çš„äº¤æ¢å¾‹ï¼Œ$A\to B$ å’Œ $B \to A$ éƒ½ä¼šä½¿å¾— <code>mem[A ^ B]++</code>ï¼Œè¿™æ ·å°±ä¸¢å¤±äº†æ–¹å‘ä¿¡æ¯ã€‚è€Œ AFL ä¸­å­˜åœ¨è¿™ä¸ªå³ç§»ï¼Œä½¿å¾— $A\to B$ å®é™…ä¸Šå¼•å‘çš„æ˜¯ <code>mem[(A&gt;&gt;1)^B]++</code> ï¼Œè€Œ $B\to A$ å¼•å‘ <code>mem[(B&gt;&gt;1)^A]++</code> ï¼Œå·§å¦™åœ°åŒºåˆ†å¼€äº†è¿™ä¸¤ç§ä¸åŒæ–¹å‘ã€‚</p><p>ã€€ã€€ç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è¿™æ®µæ±‡ç¼–ï¼Œçœ‹å®ƒæ˜¯å¦‚ä½•å®ç°ä¸Šè¿°ä¼ªä»£ç é€»è¾‘çš„ã€‚</p><ol><li>å°† <code>rsp</code> ä¸‹é™ä¸€æ®µè·ç¦»</li><li>å°† <code>rdx, rcx, rax</code> çš„å€¼å­˜æ”¾åˆ°æ ˆä¸Š</li><li>å°† <code>rcx</code> è®¾ä¸ºä¸€ä¸ªç«‹å³æ•°ï¼ˆç”± afl-as éšæœºç”Ÿæˆï¼‰</li><li>è°ƒç”¨ <code>__afl_maybe_log</code></li><li>æ¢å¤ <code>rdx, rcx, rax</code> å’Œ <code>rsp</code> </li></ol><p>ã€€ã€€è¿™å·²ç»è§£é‡Šäº† <code>cur_location</code> çš„æ¥å†ã€‚å®ƒæ˜¯éšæœºç”Ÿæˆçš„ï¼Œç°åœ¨å­˜æ”¾åœ¨ <code>rcx</code> å¯„å­˜å™¨ä¸­ã€‚æ¥ä¸‹æ¥è°ƒç”¨ <code>__afl_maybe_log</code> ï¼Œå¯ä»¥çŒœæµ‹ï¼Œå®ƒè¦å®ç°ã€Œ<code>mem</code> è‡ªå¢ã€å’Œã€Œä¿å­˜ <code>prev_location</code>ã€ä¸¤é¡¹ä»»åŠ¡ã€‚</p><p>ã€€ã€€è·Ÿè¿› <code>__afl_maybe_log</code> çœ‹çœ‹ï¼š</p><pre><code class="language-c">__afl_maybe_log:

  lahf
  seto  %al

  /* Check if SHM region is already mapped. */

  movq  __afl_area_ptr(%rip), %rdx
  testq %rdx, %rdx
  je    __afl_setup

__afl_store:

  /* Calculate and store hit for the code location specified in rcx. */

  xorq __afl_prev_loc(%rip), %rcx
  xorq %rcx, __afl_prev_loc(%rip)
  shrq $1, __afl_prev_loc(%rip)

  incb (%rdx, %rcx, 1)

__afl_return:

  addb $127, %al
  sahf
  ret</code></pre><p>ã€€ã€€é¦–å…ˆè§£é‡Šä¸€ä¸‹ <code>lahf</code> å’Œ <code>seto Â %al</code> è¿™ä¸¤è¡Œä»£ç çš„æ„æ€ã€‚å®ƒä»¬æ˜¯è´Ÿè´£å­˜å‚¨ eflags å¯„å­˜å™¨çš„å€¼â€”â€”å°†ä½ 8 ä½ä¿å­˜åœ¨ <code>ah</code>ï¼Œå°† OF ä½ä¿å­˜åœ¨ <code>al</code>ï¼Œå¹¶åœ¨æ¡©ä»£ç é€€å‡ºæ—¶æ‰§è¡Œ <code>addb $127, %al</code> å’Œ <code>sahf</code> æ¢å¤ç°åœºï¼Œ<strong>ä½¿å¾—æ•´ä¸ªæ¡©ä»£ç å¯¹åŸç¨‹åºé€æ˜</strong>ã€‚</p><p>ã€€ã€€<code>__afl_maybe_log</code> å…ˆæ£€æŸ¥å…±äº«å†…å­˜åŒºåŸŸæ˜¯å¦å·²ç»æ˜ å°„ã€‚å¦‚æœè¿˜æœªæ˜ å°„ï¼Œåˆ™è·³è½¬åˆ° <code>__afl_setup</code> è¿›è¡Œåˆå§‹åŒ–ï¼›å¦åˆ™ç»§ç»­æ‰§è¡Œ <code>__afl_store</code> é€»è¾‘ï¼Œ<code>rdx</code> å¯„å­˜å™¨æŒ‡å‘å…±äº«å†…å­˜åŒºå—ã€‚</p><p>ã€€ã€€<code>__afl_store</code> æ‰§è¡Œè¿‡ç¨‹ä¸ºï¼š</p><ol><li>å°†ç›®å‰å­˜å‚¨ç€ <code>cur_loc</code> çš„ <code>rcx</code> å¯„å­˜å™¨å¼‚æˆ–ä¸Š <code>prev_loc</code> </li><li>å°† <code>prev_loc</code> è®¾ä¸º <code>cur_loc</code> ï¼ˆè¿™é‡Œåˆ©ç”¨äº†å¼‚æˆ–è¿ç®—çš„è‡ªåæ€§ï¼‰</li><li>å°† <code>prev_loc</code> å³ç§»ä¸€ä½</li><li>å¢åŠ  hit count</li></ol><p>ã€€ã€€è¿™äº›è¿‡ç¨‹æ‰§è¡Œå®Œåï¼Œæ¢å¤ eflags å¹¶è¿”å›ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¼„æ¸…äº†æ’å…¥åˆ°åŸºæœ¬å—èµ·å§‹å¤„çš„æ¡©ä»£ç çš„é€»è¾‘ã€‚è‡³äº <code>AFL MAIN PAYLOAD</code> é‚£ä¸€æ®µå‡ ç™¾è¡Œçš„æ±‡ç¼–ï¼Œä¸ fork server æœ‰å…³ï¼Œæˆ‘ä»¬ä¸‹ä¸€ç¯‡æ–‡ç« å†ç ”ç©¶ã€‚</p><p>ã€€ã€€åœ¨ç ”ç©¶æ˜ç™½ <code>afl-as</code> çš„è¡Œä¸ºä¹‹åï¼Œå›å¤´å†çœ‹ <code>add_instrumentation</code> å‡½æ•°ã€‚å¯ä»¥å‘ç°å®ƒæ˜¯ä¸€ä¸ª parserï¼Œæ¯æ¬¡æ‰«æå¹¶åŸæ ·è¾“å‡ºä¸€è¡Œæ±‡ç¼–ç ï¼Œå¦‚æœå‘ç°è¿™ä¸ªåœ°æ–¹è¦æ’æ¡©ï¼Œåˆ™æŠŠæ¡©ä»£ç æ’è¿›å»ã€‚è‡³äºå…·ä½“çš„æ¡©ä»£ç ï¼Œå®ƒä»¬å®šä¹‰åœ¨ <code>afl-as.h</code> ä¸­ï¼Œæœ‰ 32 ä½ã€64 ä½ä¸¤ä¸ªç‰ˆæœ¬ã€‚æˆ‘ä»¬ä¸Šæ–‡å·²ç»è¯¦ç»†è§£é‡Šäº† 64 ä½ç‰ˆæœ¬ã€‚</p><p>ã€€ã€€åœ¨æ‰«æå®Œæˆä¹‹åï¼Œäºæ–‡ä»¶æœ«å°¾å†™å…¥ main payloadã€‚å®ƒä¹Ÿæ˜¯æœ‰ 32 ä½å’Œ 64 ä½ç‰ˆæœ¬ã€‚</p><p>ã€€ã€€ä»¥ä¸Šï¼Œæˆ‘ä»¬ç†è§£äº†æ’æ¡©è¿‡ç¨‹æ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚è€Œ <code>add_instrumentation</code> å‡½æ•°ä¹‹å®ç°ç»†èŠ‚ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€ç†Ÿæ‚‰çš„å„ç§è¯æ³•åˆ†æå™¨ä¸€æ ·ï¼Œå†™å¾—å¾ˆçç¢ï¼šå¤§éƒ¨åˆ†ä»£ç æ˜¯åœ¨åˆ†ç±»è®¨è®ºå„ç§ tokenï¼ˆLinux çš„ã€MacOS çš„ã€OpenBSD çš„ï¼‰ï¼Œæ²¡æœ‰ä»”ç»†ç ”è¯»çš„å¿…è¦ã€‚</p><hr><p>ã€€ã€€åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é˜…è¯»äº† <code>afl-gcc</code> å’Œ <code>afl-as</code> çš„æºç ï¼Œåˆæ­¥äº†è§£äº† AFL ç¼–è¯‘å’Œæ’æ¡©è¿‡ç¨‹ã€‚æœ¬æ–‡åªåˆ†æäº†æ’å…¥åˆ°åŸºæœ¬å—å…¥å£çš„æ¡©ä»£ç ï¼Œå¹¶æœªè¯¦ç»†è§£é‡Šæ’å…¥åˆ°æ•´ä¸ªæ±‡ç¼–ä»£ç æ–‡ä»¶æœ«å°¾çš„ main payloadã€‚è¿™éƒ¨åˆ†å†…å®¹ç•™åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« ã€‚</p><p></p>
                </div>
            </section>


            <div id="gitalk-container"></div>

            <link rel="stylesheet" href="https://cdn.staticfile.org/gitalk/1.6.2/gitalk.css">
            <script src="https://cdn.staticfile.org/gitalk/1.6.2/gitalk.min.js"></script>

            <script>
                const gitalk = new Gitalk({

                    proxy: 'https://cors.pion1eer.workers.dev/?https://github.com/login/oauth/access_token',

                    clientID: '9f7e67174f5ab8b1a2b9',
                    clientSecret: 'ddee425a0b50ed02a05fdedb1a4ea039e01b3170',
                    repo: 'blogComment',
                    owner: 'Ruanxingzhi',
                    admin: ['Ruanxingzhi'],
                    id: location.pathname,      // Ensure uniqueness and length less than 50
                    distractionFreeMode: false  // Facebook-like distraction free mode

                    });

                gitalk.render('gitalk-container');
            </script>

        </article>

    </div>
</main>

<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
                <article class="read-next-card">
                    <header class="read-next-card-header">
                        <h3><span>More in</span> <a href="../tag/fuzzing/index.html">Fuzzing</a></h3>
                    </header>
                    <div class="read-next-card-content">
                        <ul>
                            <li>
                                <h4><a href="../afl-source-2/index.html">AFLæºç é˜…è¯»ï¼ˆäºŒï¼‰ï¼šMain Payload æ±‡ç¼–</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2023-05-16">16 May 2023</time> â€“
                                        12 min read</p>
                                </div>
                            </li>
                            <li>
                                <h4><a href="../fuzzing101-wp-5/index.html">Fuzzing101-5ï¼šLibXML2</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2022-11-02">2 Nov 2022</time> â€“
                                        5 min read</p>
                                </div>
                            </li>
                            <li>
                                <h4><a href="../fuzzing101-wp-4/index.html">Fuzzing101-4ï¼šLibTIFF</a></h4>
                                <div class="read-next-card-meta">
                                    <p><time datetime="2022-10-30">30 Oct 2022</time> â€“
                                        5 min read</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <footer class="read-next-card-footer">
                        <a href="../tag/fuzzing/index.html">See all 8 posts
                            â†’</a>
                    </footer>
                </article>

                <article class="post-card post tag-fuzzing ">

    <a class="post-card-image-link" href="../afl-source-2/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2023/05/output-3.jpg 300w,
                    ../content/images/size/w600/2023/05/output-3.jpg 600w,
                    ../content/images/size/w1000/2023/05/output-3.jpg 1000w,
                    ../content/images/size/w2000/2023/05/output-3.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="../content/images/size/w600/2023/05/output-3.jpg"
            alt="AFLæºç é˜…è¯»ï¼ˆäºŒï¼‰ï¼šMain Payload æ±‡ç¼–"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../afl-source-2/index.html">

            <header class="post-card-header">
                    <div class="post-card-primary-tag">Fuzzing</div>
                <h2 class="post-card-title">AFLæºç é˜…è¯»ï¼ˆäºŒï¼‰ï¼šMain Payload æ±‡ç¼–</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>AFL æºç é˜…è¯»çš„ç¬¬äºŒç¯‡ã€‚æœ¬æ–‡è¯¦ç»†è§£è¯»äº† AFL main payload æ±‡ç¼–ä»£ç ï¼Œåˆ†æäº†å…±äº«å†…å­˜åŒºåŸŸçš„å»ºç«‹æ–¹å¼å’Œ fork server é€»è¾‘ã€‚</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Ruan Xingzhi
                    </div>
            
                    <a href="../author/blue/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2020/05/blue.jpeg" alt="Ruan Xingzhi" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/blue/index.html">Ruan Xingzhi</a></span>
                <span class="post-card-byline-date"><time datetime="2023-05-16">16 May 2023</time> <span class="bull">&bull;</span> 12 min read</span>
            </div>
        </footer>

    </div>

</article>

                <article class="post-card post tag-reverse ">

    <a class="post-card-image-link" href="../js-deobfuscate/index.html">
        <img class="post-card-image"
            srcset="../content/images/size/w300/2023/03/output-1.jpg 300w,
                    ../content/images/size/w600/2023/03/output-1.jpg 600w,
                    ../content/images/size/w1000/2023/03/output-1.jpg 1000w,
                    ../content/images/size/w2000/2023/03/output-1.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 700px"
            src="../content/images/size/w600/2023/03/output-1.jpg"
            alt="ä¸€åœºæœ‰è¶£çš„ js åæ··æ·†"
        />
    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="../js-deobfuscate/index.html">

            <header class="post-card-header">
                    <div class="post-card-primary-tag">reverse</div>
                <h2 class="post-card-title">ä¸€åœºæœ‰è¶£çš„ js åæ··æ·†</h2>
            </header>

            <section class="post-card-excerpt">
                    <p>å¯¹å“ˆå·¥å¤§è¿åŠ¨åœºé¦†é¢„çº¦ç³»ç»Ÿ js çš„åˆ†æè¿‡ç¨‹ã€‚æˆ‘ä»¬é€šè¿‡è‡ªåŠ¨å’Œäººå·¥åˆ†æï¼Œæå–å‡ºäº†ç½‘ç»œè¯·æ±‚çš„ç›¸å…³é€»è¾‘ï¼Œä¸ºç¼–å†™çˆ¬è™«æä¾›åŸºç¡€ã€‚</p>
            </section>

        </a>

        <footer class="post-card-meta">
            <ul class="author-list">
                <li class="author-list-item">
            
                    <div class="author-name-tooltip">
                        Ruan Xingzhi
                    </div>
            
                    <a href="../author/blue/index.html" class="static-avatar">
                        <img class="author-profile-image" src="../content/images/size/w100/2020/05/blue.jpeg" alt="Ruan Xingzhi" />
                    </a>
                </li>
            </ul>
            <div class="post-card-byline-content">
                <span><a href="../author/blue/index.html">Ruan Xingzhi</a></span>
                <span class="post-card-byline-date"><time datetime="2023-03-30">30 Mar 2023</time> <span class="bull">&bull;</span> 13 min read</span>
            </div>
        </footer>

    </div>

</article>
        </div>
    </div>
</aside>




        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright"><a href="../index.html">Pion1eer</a> &copy; 2023</section>
                <nav class="site-footer-nav">
                    <a href="http://beian.miit.gov.cn/" target="_blank">æ¹˜ICPå¤‡20008720å·-1</a>
                    <a href="../index.html">Latest Posts</a>
                    
                    
                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>
                </nav>
            </div>
        </footer>

    </div>

<!--

    <div class="subscribe-success-message">
        <a class="subscribe-close" href="javascript:;"></a>
        You've successfully subscribed to Pion1eer!
    </div>

    <div id="subscribe" class="subscribe-overlay">
        <a class="subscribe-close" href="#"></a>
        <div class="subscribe-overlay-content">
            <div class="subscribe-form">
                <h1 class="subscribe-overlay-title">Subscribe to Pion1eer</h1>
                <p class="subscribe-overlay-description">Stay up to date! Get all the latest & greatest posts delivered straight to your inbox</p>
                <form data-members-form="subscribe">
                    <div class="form-group">
                        <input class="subscribe-email" data-members-email placeholder="youremail@example.com"
                            autocomplete="false" />
                        <button class="button primary" type="submit">
                            <span class="button-content">Subscribe</span>
                            <span class="button-loader"><svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
    y="0px" width="40px" height="40px" viewBox="0 0 40 40" enable-background="new 0 0 40 40" xml:space="preserve">
    <path opacity="0.2" fill="#000" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946
s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634
c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z" />
    <path fill="#000" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0
C22.32,8.481,24.301,9.057,26.013,10.047z">
        <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20"
            dur="0.5s" repeatCount="indefinite" />
    </path>
</svg></span>
                        </button>
                    </div>
                    <div class="message-success">
                        <strong>Great!</strong> Check your inbox and click the link to confirm your subscription.
                    </div>
                    <div class="message-error">
                        Please enter a valid email address!
                    </div>
                </form>
            </div>
        </div>
    </div>

-->

    <script
        src="https://cdn.ruanx.net/js/jquery.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
        crossorigin="anonymous">
    </script>
    <script src="../assets/built/casper%EF%B9%96v=792c672b3c.js"></script>

    <script>
        // Parse the URL parameter
        function getParameterByName(name, url) {
            if (!url) url = window.location.href;
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        // Give the parameter a variable name
        var action = getParameterByName('action');

        $(document).ready(function () {
            if (action == 'subscribe') {
                $('body').addClass("subscribe-success");
            }

            $('.subscribe-success-message .subscribe-close').click(function () {
                $('.subscribe-success-message').addClass('close');
            });

            // Reset form on opening subscrion overlay
            $('.subscribe-button').click(function() {
                $('.subscribe-overlay form').removeClass();
                $('.subscribe-email').val('');
            });
        });
    </script>

    <script>
    $(document).ready(function () {
        // FitVids - start
        var $postContent = $(".post-full-content");
        $postContent.fitVids();
        // FitVids - end

        // Replace nav with title on scroll - start
        Casper.stickyNavTitle({
            navSelector: '.site-nav-main',
            titleSelector: '.post-full-title',
            activeClass: 'nav-post-title-active'
        });
        // Replace nav with title on scroll - end

        // Hover on avatar
        var hoverTimeout;
        $('.author-list-item').hover(function () {
            var $this = $(this);

            clearTimeout(hoverTimeout);

            $('.author-card').removeClass('hovered');
            $(this).children('.author-card').addClass('hovered');

        }, function () {
            var $this = $(this);

            hoverTimeout = setTimeout(function () {
                $this.children('.author-card').removeClass('hovered');
            }, 800);
        });
    });
</script>

<script src="https://cdn.staticfile.org/highlight.js/10.1.1/highlight.min.js"></script>
<script >hljs.initHighlightingOnLoad();</script>



    <style>.kg-bookmark-metadata > .kg-bookmark-publisher:before {
    content: "" !important; 
    margin: 0 !important;
}
</style>

</body>
</html>
