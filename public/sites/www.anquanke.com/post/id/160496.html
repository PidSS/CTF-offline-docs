<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="renderer" content="webkit"/>
<meta name="force-rendering" content="webkit"/>
<meta name="referrer" content="always" />
<meta name="description" content="安全客 - 安全资讯平台" />
<link rel="icon" href="https://s3.ssl.qhres2.com/static/02b5158bbb6adeac.ico" type="image/x-icon" />
<link rel="shortcut icon" href="https://s3.ssl.qhres2.com/static/02b5158bbb6adeac.ico" type="image/x-icon" />
<meta name="keywords"
    content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议" />

  <title>恶意挖矿监测运营实践和典型样本预警-安全客 - 安全资讯平台</title>
  <meta name="description" content="安全客 - 安全资讯平台" />
  <meta name="keywords"
    content="安全媒体,安全资讯,安全知识, 安全热点,安全招聘,安全趋势,移动安全,网站安全,终端安全,无线安全,工控安全,物联网安全,WEB安全,系统安全,网络安全,区块链安全,安全活动,信息安全,安全预警,安全会议" />
  <script>(function(window){
        

function empty() {}

empty();
      })(this);</script>

<link rel="stylesheet" href="https://s1.ssl.qhimg.com/static/d4cec9cd8efbfd10.css">
<link rel="stylesheet" href="https://s1.ssl.qhimg.com/static/a51843d6b82241be,d94674bd62441768,56ce5cef8079a575,8514be0a921ca6e8,4802c0c382205144,8e4464e423fe6849,13c0bf3b0c2e4882,2b3936345af879da,f568b72da28701d3,da046392ff3eccb9,aa4b116b0af3b8cd,e0bfaead3067bbc1,fea7be2aa27ff2f2,d9201f9584eef2b6,fd21c2ec74567dad,b7a96d5b0251b853,5dcd3ae257726a93,1c6ca2a1950ce544,0faa71bef217b8bc,a36a201f0d041a4e,7344734df279a41a,edd5eea8fdbfac69,5f39838e3d3adabf,639096234333f66b,7315fe23da834588,e8c1651c2e73e657,05bbb034f84fe2cd,4c4133809419f2be,14794e88015634b7,a165d020d16c358a,315ee55058416496.css">
<script>window._dynamic_deps_={}</script>
</head>

<body>
  <div id='app'><!--[--><div class="_9" style="height:60px;"><div class="g-w"><a class="logo1" href="https://www.anquanke.com/"></a><div class="_10"><!--[--><div class="item"><div style="cursor:pointer;"><span>首页</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style=""><span>阅读</span><ul><!--[--><li class="sub-item"><a href="https://www.anquanke.com/news">安全资讯</a></li><li class="sub-item"><a href="https://www.anquanke.com/knowledge">安全知识</a></li><li class="sub-item"><a href="https://www.anquanke.com/tool">安全工具</a></li><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>活动</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>招聘</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>安全导航</span><ul><!--[--><!--]--></ul></div></div><div class="item"><div style="cursor:pointer;"><span>内容精选</span><ul><!--[--><li class="sub-item"><a href="https://www.anquanke.com/column/index.html">专栏</a></li><li class="sub-item"><a href="https://www.anquanke.com/subject-list">精选专题</a></li><li class="sub-item"><a href="https://www.anquanke.com/discovery">安全客季刊</a></li><li class="sub-item"><a href="https://www.anquanke.com/week-list">360网络安全周报</a></li><!--]--></ul></div></div><!--]--></div><!----></div></div><div class="index"><div class="index-main"><div class="_55"><h1>恶意挖矿监测运营实践和典型样本预警</h1><div class="read"><p><span class="read-text">阅读量</span><b class="read-num">367544</b></p><p><span class="read-sep">|</span><span class="read-text">评论</span><b class="read-num">2</b></p><!----></div><p class="publish">发布时间 : 2018-09-21 15:30:16</p><div class="_54" style="display:none;"><b class="close">x</b><h5>译文声明</h5><p> 本文是翻译文章<!----><!----></p><!----><p>译文仅供参考，具体内容表达以及含义原文为准。</p></div><div class="content" id="js-article"><html>
<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"></head>
<body>
<p id="h1-u6076u610Fu6316u77FFu76D1u6D4Bu8FD0u8425u5B9Eu8DF5u548Cu5178u578Bu6837u672Cu9884u8B66"><img class="alignnone size-large wp-image-160499 aligncenter" alt="" width="1024" height="672" data-original="https://p5.ssl.qhimg.com/dm/1024_672_/t01d54f46e240bc9226.jpg"></p>
<p> </p>
<h2 name="h2-0" id="h2-0">0x00 背景概述</h2>
<p>2018年以来，加密货币市场出现震荡，很多币种币值较年初都有一定程度的缩水，但是由于“免费电”挖矿这种零投入模式的存在，币市降温似乎并没有给各类挖矿木马的传播者造成太大的影响，挖矿木马仍然是黑产团伙重要的盈利点。对于企业内部安全来说，无论是办公环境还是生产环境，挖矿木马都可以被定义为高危威胁，360 MeshFire Team聚焦于威胁检测的落地运营，在日常运营中提炼了挖矿的主要威胁场景，对恶意挖矿事件的持续进行监测和处置，总结归纳出对此类威胁类型的主要检测指标和处置流程，同时给出部分工具，方法和样本案例，供相关从业者参考。</p>
<p>本文的后半部分我们以一个捕获到的高危MAC挖矿样本为例，展开此类安全事件的监测和处置过程。该样本借助 “MAC使用word文档”等关键词SEO搜索结果，诱导用户下载执行挖矿程序，导致MAC电脑用户在网络中寻求帮助时会不甚感染挖矿木马。由于MAC系统少有人安装杀软，且目前没有杀软程序报毒相关样本，为了避免出现更多的受感染者，我们决定提前公开部分分析结果，向更多用户发出预警。特感谢专注于IOS安全研究的360 涅槃团队在分析过程中给予的支持和帮助。</p>
<p> </p>
<h2 name="h2-1" id="h2-1">0x01恶意挖矿行为来源</h2>
<h3 name="h3-2" id="h3-2">
<a name="1.%E4%BC%81%E4%B8%9A%E5%91%98%E5%B7%A5%E8%87%AA%E4%B8%BB%E6%8C%96%E7%9F%BF"></a>1.企业员工自主挖矿</h3>
<p>在一些论坛或者社交网络中，不难找到“免费”挖矿的践行者分享经历的信息。他们或利用手头的办公资源，或利用自身管理的服务器和其他网络设备，通过部署矿机的方式进行挖矿行为。这种行为最直接的后果是：员工获取不正当利益的同时，致使企业遭受损失。而一旦被发现，员工也可能会因此承担相应的责任。</p>
<h3 name="h3-3" id="h3-3">
<a name="2.PC%E6%84%9F%E6%9F%93%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC"></a>2.PC感染挖矿木马</h3>
<p>在github等代码托管平台中，有大量的开源挖矿程序。这就给挖矿木马的二次开发提供了基础组件。在我们发现的挖矿木马传播事件中，攻击者多次利用xmrig、xmr-stak等开源项目，或是自己编写恶意挖矿代码进行挖矿。而矿机程序的传播，也不外乎几个方面：垃圾邮件传播、挂马网页、僵尸网络、挖矿蠕虫、捆绑安装工具和破解软件的安装等。</p>
<h3 name="h3-4" id="h3-4">
<a name="3.%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%84%9F%E6%9F%93%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC"></a>3.服务器感染挖矿木马</h3>
<p>如果企业服务器秘钥管理不善或软件补丁更新不及时，则可能因为弱口令、应用程序漏洞等原因，被攻击者成功入侵，植入恶意挖矿代码。一个比较突出的实例是：今年上半年由于Redis提权漏洞的出现，大量攻击者利用该漏洞入侵Linux服务器进行扫描和挖矿，而被挖矿恶意代码感染的服务器，从而导致性能降低甚至死机的状况出现。</p>
<h3 name="h3-5" id="h3-5">
<a name="4.%E7%BD%91%E7%AB%99%E6%8C%96%E7%9F%BF%E8%84%9A%E6%9C%AC"></a>4.网站挖矿脚本</h3>
<p>几年前，随着加密货币价格持续走高，“浏览即挖矿”这一黑产模式出现在我们的视野当中。网页中植入一段JS代码，用户浏览时即可在主机挖矿，在加密货币具备价值的前提下，这种变现模式比流量和广告变现要容易得多。利益驱动下，多个网站，甚至广告平台被曝光网页植入挖矿脚本的情形出现也就不足为奇了。对于企业和相关机构来说，员工浏览植入挖矿脚本的网页，会对计算机性能、电力造成损耗，而企业网站如果因为安全问题被植入挖矿代码，则是对企业信誉，乃至形象的损害。</p>
<p> </p>
<h2 name="h2-6" id="h2-6">0x02 内网挖矿威胁监控和处置流程</h2>
<h3 name="h3-7" id="h3-7">1.内网资产挖矿监控体系</h3>
<p>我们日常安全运营依赖自研的宙合大数据威胁检测平台，整合终端、流量、网络边界、邮件等安全防护设备产生的告警信息和安全日志，基于特征检测、威胁情报和大数据关联聚合等技术手段，构建了一套基于大数据技术的内网威胁检测体系。通过数据关联和聚合分析，为网络扫描、漏洞利用、病毒传输、风险行为、邮件钓鱼等多种威胁场景的日常运营分析工作提供数据平台支撑。系统基本架构如下所示：</p>
<p><img class="aligncenter" alt="" data-original="https://p2.ssl.qhimg.com/t014d5f16b85cdc954c.png"></p>
<p>宙合平台同样适用于内网挖矿威胁场景的监测，基于挖矿行为的入侵检测的规则，从邮件附件、流量还原样本检测、服务器安全Agent和终端EDR日志等多种数据维度挖掘和关联，我们可以从主机运行环境，网络通信过程等多个采集点完成此类威胁的发现。</p>
<h3 name="h3-8" id="h3-8">2.恶意挖矿监控和取证模式</h3>
<h4 id="h4--strong-em-2-1-em-strong-">2.1.资产定位</h4>
<p>威胁检测落地首先需要完善安全基础工作，资产数据清晰准确的管理至关重要，将精细化的资产信息关联到告警日志中，将极大的提升安全运营的效率。一旦监测到威胁，快速响定位相应资产取证，而资产归属得以确认则是取证工作顺利进行的先决条件。在日常工作中完善运维和IT资产管理，梳理清晰的网络拓扑和网络安全策略等前置基础工作必不可少。</p>
<h4 id="h4--strong-em-2-2-em-strong-">2.2.挖矿特征监测思路和规则</h4>
<p>挖矿恶意软件主要目的是为了感染目标机器，运行挖矿软件，为追求利益最大化，防止追踪，一般恶意挖矿软件挖掘的加密货币符合下面4个条件：</p>
<pre>（1）    匿名性
（2）    CPU挖矿
（3）    价值靠前
（4）    抗AISC
</pre>
<p>目前市面上存在2000多种加密货币，而符合上面4个条件，升级算法后的门罗币（XMR）几乎是唯一选择，这也是恶意挖矿软件大多挖掘门罗币的原因。</p>
<p>门罗币采用Cryptonight算法，目前较为常用CPU挖矿软件有：xmr-stak，xmrig，claymore，对软件网络特征进行分析，发现各软件特征如下：</p>
<p>xmr-stak</p>
<p><img class="aligncenter" alt="" data-original="https://p0.ssl.qhimg.com/t0178170068e3e43f04.png"></p>
<p>xmrig</p>
<p><img class="aligncenter" alt="" data-original="https://p1.ssl.qhimg.com/t018af2971bca265d1e.png"></p>
<p>Claymore</p>
<p><img class="aligncenter" alt="" data-original="https://p0.ssl.qhimg.com/t012a68ac0f8acdacf2.png"></p>
<p>从上面特征中，我们可以明显看到，挖矿客户端首先会与矿池互联，产生登陆操作，登陆操作分为两种，一种是直接登录，一种是通过jsonrpc方式，这两种方式依赖于TCP的Stratum。开源的ET open规则里都进行了监控。规则细节如下：</p>
<pre class="pure-highlightjs"><code class="">alert tcp-pkt $HOME_NET any -&gt; $EXTERNAL_NET any (msg:"ET POLICY Cryptocurrency Miner Checkin"; flow:established,to_server; content:"|7b 22|id|22 3a|"; nocase; depth:6; content:"|22|jsonrpc|22 3a|"; nocase; distance:0; content:"|22 2c 22|method|22 3a 22|login|22 2c 22|params|22 3a|"; fast_pattern; content:"|22|pass|22 3a 22|"; nocase; content:"|22|agent|22 3a 22|"; nocase; content:!"&lt;title"; nocase; content:!"&lt;script"; nocase; content:!"&lt;html"; nocase; metadata: former_category POLICY; classtype:policy-violation; sid:2024792; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Minor, created_at 2017_10_02, updated_at 2018_06_15;)

alert tcp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:"ET POLICY Crypto Coin Miner Login"; flow: to_server,established; content:"|7b 22|method|22 3a 20 22|login|22 2c 20 22|params|22 3a 20 7b 22|login"; nocase; depth:37; fast_pattern:17,20; content:"agent|22 3a 20 22|"; nocase; distance:0; reference:md5,d1082e445f932938366a449631b82946; reference:md5,33d7a82fe13c9737a103bcc4a21f9425; reference:md5,ebe1aeb5dd692b222f8cf964e7785a55; classtype:trojan-activity; sid:2022886; rev:2;)</code></pre>
<p>除开源规则外，还可使用如下规则，监控挖矿软件与矿池之间的网络通信过程。</p>
<pre class="pure-highlightjs"><code class="">alert tcp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:"Cryptocurrency Miner Request Pools"; content:"|22|method|223a|"; content:"|22|params|223a|"; content:"|22|job_id|223a|"; content:"|22|nonce|223a|"; content:"|22|result|223a|"; classtype:bad-unknown;rev:1;sid:7000179;)</code></pre>
<h4 id="h4--strong-em-2-3-em-strong-">2.3挖矿行为的终端取证</h4>
<p>取证是事件分析和追溯的重要步骤，取证结果直接关系能否成功定位威胁，及后续工作的进行。下面简单介绍些我们在日常不同操作系统下的取证对象、方法及工具，应用场景不限于各类安全事件响应工作中的取证环节，供参考。</p>
<h5>2.3.1 Windows主机取证</h5>
<p>Windows取证工具有很多，下面列举部分工具，并简单描述使用场景。</p>
<pre>    Sysinternals：一个用于监控Windows系统的工具套件，有PsTools、Process Monitor、ProcessExplorer、Autoruns、sysmon、Whois、ProcDump等，几乎涵盖Windows取证各个方面。https://docs.microsoft.com/en-us/sysinternals/
    AVZ：一款信息获取工具，可以获得进程、服务、内核空间、端口等信息。
    GMER：可以用来检测和删除rootkit的工具http://www.gmer.net/
    Forensic Toolkit：可以用于数字取证的实用工具http://accessdata.com/solutions/digital-forensics/forensic-toolkit-ftk?/solutions/digital-forensics/ftk
    Rekall：一个内存分析框架，可以检测系统的inline_hook,创建内存转储http://www.rekall-forensic.com
    火绒剑、PcHunter、PETools等分析和取证辅助工具
    ……
</pre>
<h5>2.3.2 Linux取证</h5>
<p>Linux取证工作的主要对象有：</p>
<pre>    用户：Linux不同用户往往有不同的操作权限，如果有非正常新增用户或用户权限异常变动，往往是有问题的。
    进程：一般被入侵的Linux系统（服务器）都会有恶意程序运行，通过查看进程信息则可以发现一些威胁痕迹。
    网络：可以通过对进程网络通信和端口占用情况，与网络告警信息比对，以此找到威胁源。
    命令历史：如不加删除，linux用户历史命令都会存在用户目录下.bash_history当中。
    登录历史：可以通过查看登录历史判断威胁落地的时间，以及入侵的可能责任对象。
    开机启动和定时任务：一旦系统被入侵，则可能通过开机启动项配置，crontab和守护进程设置的方式达到持久化的效果，所以linux取证环节中，对相应项的检测是很重要的。
    系统日志和各类应用日志：重要性不必多说。
</pre>
<p>除上述方面和对象外，还有许多要注意的其他内容，这里不做赘述。</p>
<h5 id="h4-2-3-3-macos-">
<a name="2.3.3%20MacOS%E5%8F%96%E8%AF%81"></a>2.3.3 MacOS取证</h5>
<p>MacOS取证对象与Linux类似，除部分内置软件外这里列举部分取证工具仅供参考：</p>
<pre>    fsmon:跨平台文件监控工具 https://github.com/nowsecure/fsmon
    dtrace：动态行为检测神器  http://dtrace.org/blogs/
    objective-see部分MacOS防护软件：https://www.objective-see.com/products.html
    instruments：MacOS原生动态行为监控工具，需要xcode环境
</pre>
<h3 name="h3-9" id="h3-9">
<a name="3.%20%E5%90%8E%E7%BB%AD%E5%A4%84%E7%BD%AE%E5%B7%A5%E4%BD%9C"></a>3. 后续处置工作</h3>
<h4 id="h4-1-">
<a name="1.%20%E7%9F%BF%E6%B1%A0%E5%9F%9F%E5%90%8D%E5%B0%81%E5%A0%B5"></a>1. 矿池域名封堵</h4>
<p>随着时间推移，节点直连区块中心挖矿的模式，已经很难挖到加密货币了，现在更多的人选择将节点连接到矿池的方式获取加密货币。所以，对于企业而言，阻断内网资产对常见挖矿威胁矿池的访问，是一种较为有效的网络侧处置手段。</p>
<h4 id="h4-2-">
<a name="2.%20%E6%94%BB%E5%87%BB%E9%93%BE%E8%BF%98%E5%8E%9F"></a>2. 攻击链还原</h4>
<p>为了确认恶意挖矿事件的攻击链，需要对取证结果、样本分析结果、网络日志等信息进行关联整合，形成攻击事件的流程。还原攻击链的目的主要有三个：一是确认挖矿行为的源头是来自于入侵还是内部员工的违规行为；二是找到内部资产脆弱点，从而对内部资产进行安全升级；三是提取攻击载荷特征，部署入侵监测系统、防火墙过滤规则，便于威胁源头阻断和后续的追溯工作。</p>
<h4 id="h4-3-payload-">
<a name="3.%20Payload%E6%9F%A5%E6%9D%80"></a>3. Payload查杀</h4>
<p>对于一些企业和机构来说，如果内网部署企业级终端安全防护产品，则可通过后台策略进行内网查杀，如果不能则需要根据payload行为编写专杀工具或手动清理感染痕迹。</p>
<p> </p>
<h2 name="h2-10" id="h2-10">0x04 挖矿木马事件典型示例</h2>
<h3 name="h3-11" id="h3-11">
<a name="%E7%A0%B4%E8%A7%A3%E7%89%88%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AF%B1%E5%AF%BC%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E6%8C%96%E7%9F%BF%E7%A8%8B%E5%BA%8F%E6%81%B6%E6%84%8F%E4%BA%8B%E4%BB%B6"></a>破解版应用程序诱导下载安装挖矿程序恶意事件</h3>
<p>安全分析人员在8月发现内网部分MacOS主机产生挖矿网络告警，通过Review告警信息，资产确认后，锁定若干Mac办公机。进一步取证，分析，发现这些Mac主机确实感染挖矿木马，攻击样本来自百度搜索“MAC使用word文档”等关键字反馈结果的置顶广告推荐。</p>
<h4 id="h4-1-">
<a name="1.%20%E4%BA%8B%E4%BB%B6%E5%91%8A%E8%AD%A6"></a>1. 事件告警</h4>
<p>8月10日前后，内网发现大量挖矿告警，告警地址显示为45.195.146.32，该IP地址对应域名funningx.com，告警端口为3333，产生告警截图如下</p>
<p><img class="aligncenter" alt="" data-original="https://p0.ssl.qhimg.com/t015d7f8e7880034ac4.png"></p>
<h4 id="h4-2-">
<a name="2.%20%E8%B5%84%E4%BA%A7%E5%AE%9A%E4%BD%8D%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%8F%96%E8%AF%81"></a>2. 资产定位和主机取证</h4>
<p>发现告警后，第一时间从网络资产管理系统中查询告警IP所属主机，确定主机为部分iMac和Macbook。拿到取证机后，接入网络，查看3333端口占用进程信息，定位到一个名为ssl.plist的进程。IDA静态分析样本行为，确认这是一个xmr-stak的矿机程序。</p>
<p><img class="aligncenter" alt="" data-original="https://p5.ssl.qhimg.com/t014e4f4e12684bdab3.png"></p>
<p>在~/Library/LaunchAgents，/Library/LaunchDeamos，/Library/LaunchAgents，/System/Library/LaunchDaemons开机启动项中查找ssl.plist路径信息，均无所获，其他开机启动方式检查也未有结果。杀掉进程，删除ssl.plist, cpu.txt, config.txt, pools.txt等配置文件后，重启系统，挖矿程序会重新启动。</p>
<p>在~/Library/LaunchAgents目录下发现两个plist文件：com.apple.Yahoo.plist和com.apple.Google.plist。其中com.apple.Google.plist是一个plist文件，内容如下：</p>
<p><img class="aligncenter" alt="" data-original="https://p4.ssl.qhimg.com/t01f2feff997421169f.png"></p>
<p>该plist配置文件表明系统开机时会启动osascript，并且运行com.apple.Yahoo.plist这个applescript脚本。</p>
<p><img class="aligncenter" alt="" data-original="https://p4.ssl.qhimg.com/t01d3fee8324065e8b0.png"></p>
<p>由文件16进制内容可知，这是一个run-only applescript脚本文件。手动启动com.apple.Yahoo.plist，并进行主机行为和网络监测，发现该脚本文件的部分行为是：根据主机类型释放挖矿配置文件，下载<a href="http://101.55.20.149/gogoto.png">http://101.55.20.149/gogoto.png</a> 保存为11.png并运行。</p>
<p><img class="aligncenter" alt="" data-original="https://p5.ssl.qhimg.com/t01a9ab9774b37d2d9e.png"></p>
<p>同样用osascript启动脚本，并监控osascript行为和网络行为。行为显示该脚本的部分功能为：下载<a href="http://101.55.20.149/ssl.zip">http://101.55.20.149/ssl.zip</a> 并解压到~/Library/Safari目录下，得到ssl.plist和openssl文件夹，并运行ssl.plist进程。</p>
<p>根据脚本行为锁定101.55.20.149这个IP，Review被感染主机历史流量日志，发现攻击载荷最初的入口均来自vip1.czscrj.com，由百度搜索“excel mac版下载” “mac 使用word”等关键字查询获取：</p>
<p><img class="aligncenter" alt="" data-original="https://p0.ssl.qhimg.com/t0122ab21578b658c86.png"></p>
<p><img class="aligncenter" alt="" data-original="https://p2.ssl.qhimg.com/t01afe91b66553195a4.png"></p>
<p>下载office4mac.zip，解压运行，mac主机启动挖矿程序，开始挖矿，主机和网络行为与告警一致。至此取证工作完毕。</p>
<h4 id="h4-3-">
<a name="3.%20%E6%A0%B7%E6%9C%AC%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90"></a>3. 样本行为分析</h4>
<p>office4mac.app 目录结构如下：</p>
<p>~ /Desktop/office4mac/office4mac.app<br>
└── Contents<br>
├── Info.plist<br>
├── MacOS<br>
│ └── applet<br>
├── PkgInfo<br>
└── Resources<br>
├── 001.plist ———————-即为com.apple.Yahoo.plist applescript脚本文件<br>
├── 1.png<br>
├── 10.png<br>
├── 2.png<br>
├── 3.png<br>
├── 4.png<br>
├── 5.png<br>
├── 6.png<br>
├── 7.png<br>
├── 8.png<br>
├── 9.png<br>
├── Scripts<br>
│ └── main.scpt ——-程序编译的applescript代码，run-only，不可读<br>
├── applet.icns<br>
├── applet.plist<br>
├── applet.rsrc<br>
└── description.rtfd<br>
└── TXT.rtf</p>
<p>尤其可以认定该样本是一个applescript导出为run-only模式的Mac平台应用程序。由于目前还没有找到run-only applescript 的有效分析方法，逆向osascript的工作还在进行中，但是通过行为监测，可以大致梳理出office4mac.app运行后挖矿工具的安装流程，流程如下：</p>
<p>(1) 运行office4mac.app 启动office4mac.appContentsMacOSapplet进程，进程行为是加载office4mac.appContentsResourcesScriptsmain.scpt，执行脚本文件。从文件行为检测上看，该脚本的部分功能是：读取主机硬件信息，向~/Library/LaunchAgents/目录下释放com.apple.Google.plist 和com.apple.Yahoo.plist两个文件并com.apple.Google.plist由脚本创建并写入内容，com.apple.Yahoo.plist为样本的资源文件office4mac.appContentsResources01.plist复制到相应目录下。经过测试，com.apple.Yahoo.plist的主要行为是：<a href="http://101.55.20.149/gogoto.png">http://101.55.20.149/gogoto.png</a> 保存为11.png并运行。</p>
<p><img class="aligncenter" alt="" data-original="https://p2.ssl.qhimg.com/t011bbf063b4af38cc9.png"></p>
<p><img class="aligncenter" alt="" data-original="https://p3.ssl.qhimg.com/t0153e9fc0eaef46417.jpg"></p>
<p>(2) 11.png运行后的脚本检测结果是：自删除，释放挖矿配置文件，cpu.txt，config.txt，pools.txt等。然后调用curl下载<a href="http://101.55.20.149/ssl.zip">http://101.55.20.149/ssl.zip</a> 并解压到~/Library/Safari目录下，得到ssl.plist和openssl文件夹，并运行ssl.plist进程。ssl.plist即为xmr-stak矿机程序。</p>
<p><img class="aligncenter" alt="" data-original="https://p3.ssl.qhimg.com/t01c1a62b735dc8ccde.jpg"></p>
<p>另外，在虚拟机中测试office4mac应用程序，不会触发挖矿行为，猜测脚本代码中有虚拟机检测的行为，因代码暂时没能准确解读，所以仅作猜想。</p>
<h4 id="h4-4-">
<a name="4.%20%E7%94%A8%E6%88%B7%E8%87%AA%E6%9F%A5%E5%92%8C%E7%97%85%E6%AF%92%E6%9F%A5%E6%9D%80%E6%96%B9%E6%A1%88"></a>4. 用户自查和病毒查杀方案</h4>
<p>MacOS用户可参考如下方案完成挖矿病毒自查和病毒查杀：</p>
<pre>1.    终端输入命令netstat –an |grep 3333查看是否有ssl.plist进程绑定3333端口。
2.    查看主机是否运行挖矿进程：ps -ef |grep ssl.plist，如果有进程，则需要用kill pid命令杀掉进程。
3.    通过ls ~/Library/LaunchAgents/ 看目录下是否有com.apple.Google.plist 和com.apple.Yahoo.plist，如果有，则删除文件。
4.    删除~/Library/Safari/目录下的ssl.plist ，cpu.txt ，config.txt，pools.txt 和openssl文件夹，进入相应目录使用rm命令即可。
5.    实测此office4mac应用程序并不会安装mac平台office应用软件，如有需求请寻找其他资源，建议购买正版。
</pre>
<h4 id="h4-5-">
<a name="5.%20%E5%B0%8F%E7%BB%93"></a>5. 小结</h4>
<p>office4mac应用程序的开发者采用导出为run-only applescript的方式生成payload文件，但现阶段对applescript脚本的分析方法还比较匮乏，所以分析人员采用fsmon和dtrace等系统行为检测工具分析样本的行为。关于applescript的逆向，需要后续跟进和分析。</p>
<p> </p>
<h2 name="h2-12" id="h2-12">0x05 总结</h2>
<p>文中给出的基于大数据技术进行挖矿威胁场景的监测方法，从实践的检验来看有非常好的效果，挖矿相关行为会持续产生规律性告警，客户端及网络流量一侧也能准确捕捉到挖矿行为的产生，是一种比较成熟的挖矿行为检测模型。</p>
<p>关于MacOS平台盗版Office挖矿的事件，由于macos系统对applescript原生支持混淆和编译，这是保护软件著作的一种途径，但也给applescript恶意代码对抗分析，逃避杀软检测带来了捷径。目前applescript的恶意代码比较少见，但如果对此种类型恶意代码的前景做一个大胆预测， applescript恶意代码日后有可能成为MacOS平台中VBS恶意宏脚本的角色。所以，现阶段安全从业者不应对此有所忽视。</p>
<p>此外，网络攻击形式是有趋利性的，从银行木马，到勒索软件，再到现在各类挖矿木马，本质上都是一个在尽可能短的时间内攫取更多利益的过程。现在很多面向个人和企业的杀软也逐渐推出防挖矿功能，但是对企业来说，仅仅依靠杀软在终端提供支持还远远不够，对MAC系统安全的也不应该有绝对的自信，需要的是完善的威胁监测机制和安全运营流程，不断提升应急响应的效率，减少不必要的损失。</p>
<p> </p>
<h2 name="h2-13" id="h2-13">0x06 附录：部分IOC</h2>
<p>Office4mac.zip：</p>
<pre>MD5        7e077211cb23838ba48073dde67a80a4
SHA-1        d6118f4ec47ee0c4606b9a1594648ffbafefc3a0
File Type    ZIP
TRiD        Zip archive data, at least v1.0 to extract
File Size        3.8 MB
</pre>
<p>Yahoo.plist：</p>
<pre>MD5        f3247a8b7a25d35dc88dbd676d7f2476
SHA-1        f3d83291008736e1f8a2d52e064e2decb2c893ba
File Type    run-only applescript
TRiD        Compiled AppleScript script (100%)
File Size        4.23 KB
</pre>
<p>11.png：</p>
<pre>MD5        1b477f3f2b2af9e22dff5c316fe3d5a9
SHA-1        c6759838dd64c370cc6e728828cc71e738339702
File Type    run-only applescript
TRiD        Compiled AppleScript script (100%)
File Size        6.28 KB
</pre>
<p>ssl.zip：</p>
<pre>MD5        af08ffb2ddd5c207f0d8b8ded070282c
SHA-1        8bcdc85aec55821791032cb9d6c9f7ab161def3e
File Type    ZIP
TRiD        ZIP compressed archive (80%)
File Size        1.12 MB
</pre>
<p>ssl.plist：</p>
<pre>MD5        b74ff65d7af518316f5d0230f62f9433
SHA-1        b8f6734ceede14e071320820b9de448ccfa1466f
File Type    Mach-O
Magic        Mach-O 64-bit executable
TRiD        Mac OS X Mach-O 64bit Intel executable (100%)
File Size        769.74 KB
</pre>
</body>
</html></div><div class="_53" style="display:none;"> 本文翻译自 <a href="" target="_blank">原文链接</a>。如若转载请注明出处。 </div><div class="_206" style="display:none;"> 商务合作，文章发布请联系 anquanke@360.cn </div><div class="_59" style=""><p> 本文由<b>360 MeshFire Team</b>原创发布 </p><p> 转载，请参考<a href="https://www.anquanke.com/note/repost" target="_blank">转载声明</a>，注明出处： <a href="160496.html" target="_blank">https://www.anquanke.com/post/id/160496</a></p><p>安全客 - 有思想的安全新媒体</p></div><div class="_62" style="display:none;"><p> 本文转载自: <a href=""></a></p><p> 如若转载,请注明出处： <a href="" target="_blank"></a></p><p>安全客 - 有思想的安全新媒体</p></div><div class="_63 share1"><div class="main-w"><div class="bg"></div><div class="main"><span>分享到：</span><img class="icon" data-cmd="weixin" alt="微信" src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png"></div></div><div class="qrcode" style="display:none;"></div></div><ul class="_65"><!--[--><li><a target="_blank" href="https://www.anquanke.com/tag/%E6%8C%96%E7%9F%BF">挖矿</a></li><li><a target="_blank" href="https://www.anquanke.com/tag/%E5%8A%A0%E5%AF%86%E8%B4%A7%E5%B8%81">加密货币</a></li><!--]--></ul><div class="_56"><div class="line line1"><div class="_18 item1"><b style="display:none;">+1</b><i class="iconfont icon-rate"></i><span class="rate-text">14赞</span></div><div class="_12 item1"><i class=""></i><span>收藏</span></div></div><div class="line line2"><div class="user"><img class="avatar" src="https://p5.ssl.qhimg.com/t01b22d45fef232c21b.png"><span class="name">360 MeshFire Team</span><span class="label-verify label"></span></div><div class="_63 share2"><div class="main-w"><div class="bg"></div><div class="main"><span>分享到：</span><img class="icon" data-cmd="weixin" alt="微信" src="https://p0.ssl.qhimg.com/sdm/28_28_100/t01e29062a5dcd13c10.png"></div></div><div class="qrcode" style="display:none;"></div></div></div></div></div><div class="_60"><!----><!----></div><div class="_7 index-comment"><h2 class="g-title">发表评论</h2><div class="login"><p class="login-text">您还未登录，请先登录。</p><p class="login-bar"><a href="https://www.anquanke.com/login/index.html">登录</a></p></div><!----><!----><!----></div></div><div class="index-side"><div class="index-side-top"><div class="_66"><img class="banner" src="https://p3.ssl.qhimg.com/t014757b72460d855bf.png"><div class="w"><a class="avatar" href="https://www.anquanke.com/member.html?memberId=121034"><img src="https://p5.ssl.qhimg.com/t01b22d45fef232c21b.png"></a><p class="info"><a href="https://www.anquanke.com/member.html?memberId=121034" class="name">360 MeshFire Team</a><a href="https://www.anquanke.com/member.html?memberId=121034" class="user-label-verify user-label"></a></p><p class="hint">360MeshFireTeam隶属于360信息安全部，负责360集团基础网络安全防护和运营，专注于基础网络层面的威胁检测和安全研究</p><div class="bottom"><ul class="bottom-1"><li>文章</li><li><strong>10</strong></li></ul><ul class="bottom-2"><li>粉丝</li><li><strong>14</strong></li></ul><div class="spacer"></div><!----></div></div></div><div class="_64"><h3 class="title"> TA的文章</h3><ul><!--[--><li><h5><a href="https://www.anquanke.com/post/id/222801">一次QuasarRAT的利用活动发现分析</a></h5><p>2020-11-18 12:00:29</p></li><li><h5><a href="160496.html">恶意挖矿监测运营实践和典型样本预警</a></h5><p>2018-09-21 15:30:16</p></li><li><h5><a href="https://www.anquanke.com/post/id/149059">利用网游加速器隧道传播挖矿蠕虫事件分析报告</a></h5><p>2018-06-26 11:03:25</p></li><li><h5><a href="https://www.anquanke.com/post/id/105473">CVE-2018-0171 Cisco Smart Install远程代码执行漏洞分析</a></h5><p>2018-04-19 15:00:27</p></li><li><h5><a href="https://www.anquanke.com/post/id/101446">CVE-2018-0101 Cisco ASA 拒绝服务&amp;远程代码执行漏洞分析</a></h5><p>2018-03-19 16:03:51</p></li><!--]--></ul></div><div class="_61"><h3 class="title"> 相关文章</h3><ul><!--[--><li><h5><a href="https://www.anquanke.com/post/id/286968">Trezor警告大规模加密钱包网络钓鱼活动</a></h5><p>2023-03-03 10:30:48</p></li><li><h5><a href="https://www.anquanke.com/post/id/286937">Parallax RAT利用注入技术瞄准加密货币公司</a></h5><p>2023-03-02 11:30:33</p></li><li><h5><a href="https://www.anquanke.com/post/id/286629">加密货币交易所Coinbase遭遇网络诈骗攻击</a></h5><p>2023-02-22 11:30:49</p></li><li><h5><a href="https://www.anquanke.com/post/id/286624">挪威当局查获Lazarus黑客584万美元加密货币</a></h5><p>2023-02-22 11:00:17</p></li><li><h5><a href="https://www.anquanke.com/post/id/286411">YouTube加密骗局抢走Tether投资者百万+美元</a></h5><p>2023-02-15 14:00:56</p></li><li><h5><a href="https://www.anquanke.com/post/id/286401">Enigma信息窃取恶意软件针对加密货币行业</a></h5><p>2023-02-15 11:30:02</p></li><li><h5><a href="https://www.anquanke.com/post/id/285735">亚马逊AWS、微软和 Google 都是FTX的债权人</a></h5><p>2023-01-29 12:00:58</p></li><!--]--></ul></div><div class="_52"><h3 class="title">热门推荐</h3><ul><!--[--><!--]--></ul></div></div><div class="_57"><div class="wrap" style=""><div class="title">文章目录</div><ul class="list"><!--[--><li class="item"><a target="_self" href="#h2-0" class="g-line1">0x00 背景概述</a><ul><!--[--><!--]--></ul></li><li class="item"><a target="_self" href="#h2-1" class="g-line1">0x01恶意挖矿行为来源</a><ul><!--[--><li class="subitem"><a class="g-line1" href="#h3-2">1.企业员工自主挖矿</a></li><li class="subitem"><a class="g-line1" href="#h3-3">2.PC感染挖矿木马</a></li><li class="subitem"><a class="g-line1" href="#h3-4">3.服务器感染挖矿木马</a></li><li class="subitem"><a class="g-line1" href="#h3-5">4.网站挖矿脚本</a></li><!--]--></ul></li><li class="item"><a target="_self" href="#h2-6" class="g-line1">0x02 内网挖矿威胁监控和处置流程</a><ul><!--[--><li class="subitem"><a class="g-line1" href="#h3-7">1.内网资产挖矿监控体系</a></li><li class="subitem"><a class="g-line1" href="#h3-8">2.恶意挖矿监控和取证模式</a></li><li class="subitem"><a class="g-line1" href="#h3-9">3. 后续处置工作</a></li><!--]--></ul></li><li class="item"><a target="_self" href="#h2-10" class="g-line1">0x04 挖矿木马事件典型示例</a><ul><!--[--><li class="subitem"><a class="g-line1" href="#h3-11">破解版应用程序诱导下载安装挖矿程序恶意事件</a></li><!--]--></ul></li><li class="item"><a target="_self" href="#h2-12" class="g-line1">0x05 总结</a><ul><!--[--><!--]--></ul></li><li class="item"><a target="_self" href="#h2-13" class="g-line1">0x06 附录：部分IOC</a><ul><!--[--><!--]--></ul></li><!--]--></ul></div></div></div></div><div class="_8"><div class="g-w main"><div class="col1"><p class="col1-logo"><img src="https://p2.ssl.qhimg.com/t018717b31ed82fff86.png"></p><div class="col1-link"><b class="col1-weixin"></b><a href="https://weibo.com/360adlab" class="col1-sina"></a><a href="https://zhuanlan.zhihu.com/c_118578260" class="col1-zhi"></a></div></div><div class="col2"><div class="title">安全客</div><ul class="col2-list"><li><a href="https://www.anquanke.com/about" rel="noopener noreferrer" target="_blank">关于我们</a></li><li><a href="https://www.anquanke.com/note/contact" target="_blank" rel="noopener noreferrer">联系我们</a></li><li><a href="https://www.anquanke.com/note/protocol" target="_blank" rel="noopener noreferrer">用户协议</a></li></ul></div><div class="col3"><div class="title">商务合作</div><ul class="col3-list"><li><a href="https://www.anquanke.com/note/business" target="_blank" rel="noopener noreferrer">合作内容</a></li><li><a href="https://www.anquanke.com/note/contact" target="_blank" rel="noopener noreferrer">联系方式</a></li><li><a href="https://www.anquanke.com/link" target="_blank" rel="noopener noreferrer">友情链接</a></li></ul></div><div class="col4"><div class="title">内容需知</div><ul><li><a href="https://www.anquanke.com/contribute/tips" target="_blank" rel="noopener noreferrer">投稿须知</a></li><li><a href="https://www.anquanke.com/note/repost" target="_blank" rel="noopener noreferrer">转载须知</a></li><li>官网QQ群8：819797106</li><li>官网QQ群3：830462644(已满)</li><li>官网QQ群2：814450983(已满)</li><li>官网QQ群1：702511263(已满)</li></ul></div><div class="col5"><div class="title">合作单位</div><ul><li><a href="http://www.cert.org.cn/" target="_blank" rel="noopener noreferrer"><img alt="安全客" src="https://p0.ssl.qhimg.com/t01592a959354157bc0.png" style="max-height:40px;"></a></li><li style="margin-top:-20px;"><a href="http://www.cnnvd.org.cn/" target="_blank" rel="noopener noreferrer"><img alt="安全客" src="https://p0.ssl.qhimg.com/t014f76fcea94035e47.png" style="max-height:50px;margin-top:10px;"></a></li></ul></div></div><div class="right g-w"><span>Copyright © 北京奇虎科技有限公司 360网络攻防实验室 安全客 All Rights Reserved </span><a href="https://beian.miit.gov.cn/">京ICP备08010314号-66</a><span id="cnzz_stat_icon_1271278035"><a href="https://www.cnzz.com/stat/website.php?web_id=1271278035" target="_blank" title="站长统计"><img border="0" hspace="0" vspace="0" src="https://icon.cnzz.com/img/pic.gif"></a></span></div><div class="layer" style="display:none;"><div class="layer-main"><div class="layer-title">微信二维码</div><b class="layer-close">X</b><img src="https://p0.ssl.qhimg.com/t0151209205b47f2270.jpg" alt="安全客"></div></div></div><!--]--></div><script>window.__state__={"artical":{"post":{"id":160496,"title":"恶意挖矿监测运营实践和典型样本预警","category_name":"安全知识","category_slug":"knowledge","desc":"360 MeshFire Team总结归纳出挖矿恶意软件主要检测指标和处置流程，同时给出部分工具，方法和样本案例，供相关从业者参考。本文的后半部分我们以一个捕获到的高危MAC挖矿样本为例，展开此类安全事件的监测和处置过程。","date":"2018-09-21 15:30:16","time_interval":"2018-09-21","status":"publish","comment":2,"cover":"https://p5.ssl.qhimg.com/t01d54f46e240bc9226.jpg","subject":false,"red":true,"type":"origin","url":"","source":"","fee":"","origin_author":"","pv":367544,"like_count":14,"liked":0,"tags":["挖矿","加密货币"],"is_favorite":false,"favorite_count":9,"content":"<html>\n<head><meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"></head>\n<body>\n<p id=\"h1-u6076u610Fu6316u77FFu76D1u6D4Bu8FD0u8425u5B9Eu8DF5u548Cu5178u578Bu6837u672Cu9884u8B66\"><img class=\"alignnone size-large wp-image-160499 aligncenter\" alt=\"\" width=\"1024\" height=\"672\" data-original=\"https://p5.ssl.qhimg.com/dm/1024_672_/t01d54f46e240bc9226.jpg\"></p>\n<p> </p>\n<h2 name=\"h2-0\" id=\"h2-0\">0x00 背景概述</h2>\n<p>2018年以来，加密货币市场出现震荡，很多币种币值较年初都有一定程度的缩水，但是由于“免费电”挖矿这种零投入模式的存在，币市降温似乎并没有给各类挖矿木马的传播者造成太大的影响，挖矿木马仍然是黑产团伙重要的盈利点。对于企业内部安全来说，无论是办公环境还是生产环境，挖矿木马都可以被定义为高危威胁，360 MeshFire Team聚焦于威胁检测的落地运营，在日常运营中提炼了挖矿的主要威胁场景，对恶意挖矿事件的持续进行监测和处置，总结归纳出对此类威胁类型的主要检测指标和处置流程，同时给出部分工具，方法和样本案例，供相关从业者参考。</p>\n<p>本文的后半部分我们以一个捕获到的高危MAC挖矿样本为例，展开此类安全事件的监测和处置过程。该样本借助 “MAC使用word文档”等关键词SEO搜索结果，诱导用户下载执行挖矿程序，导致MAC电脑用户在网络中寻求帮助时会不甚感染挖矿木马。由于MAC系统少有人安装杀软，且目前没有杀软程序报毒相关样本，为了避免出现更多的受感染者，我们决定提前公开部分分析结果，向更多用户发出预警。特感谢专注于IOS安全研究的360 涅槃团队在分析过程中给予的支持和帮助。</p>\n<p> </p>\n<h2 name=\"h2-1\" id=\"h2-1\">0x01恶意挖矿行为来源</h2>\n<h3 name=\"h3-2\" id=\"h3-2\">\n<a name=\"1.%E4%BC%81%E4%B8%9A%E5%91%98%E5%B7%A5%E8%87%AA%E4%B8%BB%E6%8C%96%E7%9F%BF\"></a>1.企业员工自主挖矿</h3>\n<p>在一些论坛或者社交网络中，不难找到“免费”挖矿的践行者分享经历的信息。他们或利用手头的办公资源，或利用自身管理的服务器和其他网络设备，通过部署矿机的方式进行挖矿行为。这种行为最直接的后果是：员工获取不正当利益的同时，致使企业遭受损失。而一旦被发现，员工也可能会因此承担相应的责任。</p>\n<h3 name=\"h3-3\" id=\"h3-3\">\n<a name=\"2.PC%E6%84%9F%E6%9F%93%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC\"></a>2.PC感染挖矿木马</h3>\n<p>在github等代码托管平台中，有大量的开源挖矿程序。这就给挖矿木马的二次开发提供了基础组件。在我们发现的挖矿木马传播事件中，攻击者多次利用xmrig、xmr-stak等开源项目，或是自己编写恶意挖矿代码进行挖矿。而矿机程序的传播，也不外乎几个方面：垃圾邮件传播、挂马网页、僵尸网络、挖矿蠕虫、捆绑安装工具和破解软件的安装等。</p>\n<h3 name=\"h3-4\" id=\"h3-4\">\n<a name=\"3.%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%84%9F%E6%9F%93%E6%8C%96%E7%9F%BF%E6%9C%A8%E9%A9%AC\"></a>3.服务器感染挖矿木马</h3>\n<p>如果企业服务器秘钥管理不善或软件补丁更新不及时，则可能因为弱口令、应用程序漏洞等原因，被攻击者成功入侵，植入恶意挖矿代码。一个比较突出的实例是：今年上半年由于Redis提权漏洞的出现，大量攻击者利用该漏洞入侵Linux服务器进行扫描和挖矿，而被挖矿恶意代码感染的服务器，从而导致性能降低甚至死机的状况出现。</p>\n<h3 name=\"h3-5\" id=\"h3-5\">\n<a name=\"4.%E7%BD%91%E7%AB%99%E6%8C%96%E7%9F%BF%E8%84%9A%E6%9C%AC\"></a>4.网站挖矿脚本</h3>\n<p>几年前，随着加密货币价格持续走高，“浏览即挖矿”这一黑产模式出现在我们的视野当中。网页中植入一段JS代码，用户浏览时即可在主机挖矿，在加密货币具备价值的前提下，这种变现模式比流量和广告变现要容易得多。利益驱动下，多个网站，甚至广告平台被曝光网页植入挖矿脚本的情形出现也就不足为奇了。对于企业和相关机构来说，员工浏览植入挖矿脚本的网页，会对计算机性能、电力造成损耗，而企业网站如果因为安全问题被植入挖矿代码，则是对企业信誉，乃至形象的损害。</p>\n<p> </p>\n<h2 name=\"h2-6\" id=\"h2-6\">0x02 内网挖矿威胁监控和处置流程</h2>\n<h3 name=\"h3-7\" id=\"h3-7\">1.内网资产挖矿监控体系</h3>\n<p>我们日常安全运营依赖自研的宙合大数据威胁检测平台，整合终端、流量、网络边界、邮件等安全防护设备产生的告警信息和安全日志，基于特征检测、威胁情报和大数据关联聚合等技术手段，构建了一套基于大数据技术的内网威胁检测体系。通过数据关联和聚合分析，为网络扫描、漏洞利用、病毒传输、风险行为、邮件钓鱼等多种威胁场景的日常运营分析工作提供数据平台支撑。系统基本架构如下所示：</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p2.ssl.qhimg.com/t014d5f16b85cdc954c.png\"></p>\n<p>宙合平台同样适用于内网挖矿威胁场景的监测，基于挖矿行为的入侵检测的规则，从邮件附件、流量还原样本检测、服务器安全Agent和终端EDR日志等多种数据维度挖掘和关联，我们可以从主机运行环境，网络通信过程等多个采集点完成此类威胁的发现。</p>\n<h3 name=\"h3-8\" id=\"h3-8\">2.恶意挖矿监控和取证模式</h3>\n<h4 id=\"h4--strong-em-2-1-em-strong-\">2.1.资产定位</h4>\n<p>威胁检测落地首先需要完善安全基础工作，资产数据清晰准确的管理至关重要，将精细化的资产信息关联到告警日志中，将极大的提升安全运营的效率。一旦监测到威胁，快速响定位相应资产取证，而资产归属得以确认则是取证工作顺利进行的先决条件。在日常工作中完善运维和IT资产管理，梳理清晰的网络拓扑和网络安全策略等前置基础工作必不可少。</p>\n<h4 id=\"h4--strong-em-2-2-em-strong-\">2.2.挖矿特征监测思路和规则</h4>\n<p>挖矿恶意软件主要目的是为了感染目标机器，运行挖矿软件，为追求利益最大化，防止追踪，一般恶意挖矿软件挖掘的加密货币符合下面4个条件：</p>\n<pre>（1）    匿名性\r\n（2）    CPU挖矿\r\n（3）    价值靠前\r\n（4）    抗AISC\r\n</pre>\n<p>目前市面上存在2000多种加密货币，而符合上面4个条件，升级算法后的门罗币（XMR）几乎是唯一选择，这也是恶意挖矿软件大多挖掘门罗币的原因。</p>\n<p>门罗币采用Cryptonight算法，目前较为常用CPU挖矿软件有：xmr-stak，xmrig，claymore，对软件网络特征进行分析，发现各软件特征如下：</p>\n<p>xmr-stak</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p0.ssl.qhimg.com/t0178170068e3e43f04.png\"></p>\n<p>xmrig</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p1.ssl.qhimg.com/t018af2971bca265d1e.png\"></p>\n<p>Claymore</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p0.ssl.qhimg.com/t012a68ac0f8acdacf2.png\"></p>\n<p>从上面特征中，我们可以明显看到，挖矿客户端首先会与矿池互联，产生登陆操作，登陆操作分为两种，一种是直接登录，一种是通过jsonrpc方式，这两种方式依赖于TCP的Stratum。开源的ET open规则里都进行了监控。规则细节如下：</p>\n<pre class=\"pure-highlightjs\"><code class=\"\">alert tcp-pkt $HOME_NET any -&gt; $EXTERNAL_NET any (msg:\"ET POLICY Cryptocurrency Miner Checkin\"; flow:established,to_server; content:\"|7b 22|id|22 3a|\"; nocase; depth:6; content:\"|22|jsonrpc|22 3a|\"; nocase; distance:0; content:\"|22 2c 22|method|22 3a 22|login|22 2c 22|params|22 3a|\"; fast_pattern; content:\"|22|pass|22 3a 22|\"; nocase; content:\"|22|agent|22 3a 22|\"; nocase; content:!\"&lt;title\"; nocase; content:!\"&lt;script\"; nocase; content:!\"&lt;html\"; nocase; metadata: former_category POLICY; classtype:policy-violation; sid:2024792; rev:4; metadata:affected_product Windows_XP_Vista_7_8_10_Server_32_64_Bit, attack_target Client_Endpoint, deployment Perimeter, signature_severity Minor, created_at 2017_10_02, updated_at 2018_06_15;)\r\n\r\nalert tcp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:\"ET POLICY Crypto Coin Miner Login\"; flow: to_server,established; content:\"|7b 22|method|22 3a 20 22|login|22 2c 20 22|params|22 3a 20 7b 22|login\"; nocase; depth:37; fast_pattern:17,20; content:\"agent|22 3a 20 22|\"; nocase; distance:0; reference:md5,d1082e445f932938366a449631b82946; reference:md5,33d7a82fe13c9737a103bcc4a21f9425; reference:md5,ebe1aeb5dd692b222f8cf964e7785a55; classtype:trojan-activity; sid:2022886; rev:2;)</code></pre>\n<p>除开源规则外，还可使用如下规则，监控挖矿软件与矿池之间的网络通信过程。</p>\n<pre class=\"pure-highlightjs\"><code class=\"\">alert tcp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:\"Cryptocurrency Miner Request Pools\"; content:\"|22|method|223a|\"; content:\"|22|params|223a|\"; content:\"|22|job_id|223a|\"; content:\"|22|nonce|223a|\"; content:\"|22|result|223a|\"; classtype:bad-unknown;rev:1;sid:7000179;)</code></pre>\n<h4 id=\"h4--strong-em-2-3-em-strong-\">2.3挖矿行为的终端取证</h4>\n<p>取证是事件分析和追溯的重要步骤，取证结果直接关系能否成功定位威胁，及后续工作的进行。下面简单介绍些我们在日常不同操作系统下的取证对象、方法及工具，应用场景不限于各类安全事件响应工作中的取证环节，供参考。</p>\n<h5>2.3.1 Windows主机取证</h5>\n<p>Windows取证工具有很多，下面列举部分工具，并简单描述使用场景。</p>\n<pre>    Sysinternals：一个用于监控Windows系统的工具套件，有PsTools、Process Monitor、ProcessExplorer、Autoruns、sysmon、Whois、ProcDump等，几乎涵盖Windows取证各个方面。https://docs.microsoft.com/en-us/sysinternals/\r\n    AVZ：一款信息获取工具，可以获得进程、服务、内核空间、端口等信息。\r\n    GMER：可以用来检测和删除rootkit的工具http://www.gmer.net/\r\n    Forensic Toolkit：可以用于数字取证的实用工具http://accessdata.com/solutions/digital-forensics/forensic-toolkit-ftk?/solutions/digital-forensics/ftk\r\n    Rekall：一个内存分析框架，可以检测系统的inline_hook,创建内存转储http://www.rekall-forensic.com\r\n    火绒剑、PcHunter、PETools等分析和取证辅助工具\r\n    ……\r\n</pre>\n<h5>2.3.2 Linux取证</h5>\n<p>Linux取证工作的主要对象有：</p>\n<pre>    用户：Linux不同用户往往有不同的操作权限，如果有非正常新增用户或用户权限异常变动，往往是有问题的。\r\n    进程：一般被入侵的Linux系统（服务器）都会有恶意程序运行，通过查看进程信息则可以发现一些威胁痕迹。\r\n    网络：可以通过对进程网络通信和端口占用情况，与网络告警信息比对，以此找到威胁源。\r\n    命令历史：如不加删除，linux用户历史命令都会存在用户目录下.bash_history当中。\r\n    登录历史：可以通过查看登录历史判断威胁落地的时间，以及入侵的可能责任对象。\r\n    开机启动和定时任务：一旦系统被入侵，则可能通过开机启动项配置，crontab和守护进程设置的方式达到持久化的效果，所以linux取证环节中，对相应项的检测是很重要的。\r\n    系统日志和各类应用日志：重要性不必多说。\r\n</pre>\n<p>除上述方面和对象外，还有许多要注意的其他内容，这里不做赘述。</p>\n<h5 id=\"h4-2-3-3-macos-\">\n<a name=\"2.3.3%20MacOS%E5%8F%96%E8%AF%81\"></a>2.3.3 MacOS取证</h5>\n<p>MacOS取证对象与Linux类似，除部分内置软件外这里列举部分取证工具仅供参考：</p>\n<pre>    fsmon:跨平台文件监控工具 https://github.com/nowsecure/fsmon\r\n    dtrace：动态行为检测神器  http://dtrace.org/blogs/\r\n    objective-see部分MacOS防护软件：https://www.objective-see.com/products.html\r\n    instruments：MacOS原生动态行为监控工具，需要xcode环境\r\n</pre>\n<h3 name=\"h3-9\" id=\"h3-9\">\n<a name=\"3.%20%E5%90%8E%E7%BB%AD%E5%A4%84%E7%BD%AE%E5%B7%A5%E4%BD%9C\"></a>3. 后续处置工作</h3>\n<h4 id=\"h4-1-\">\n<a name=\"1.%20%E7%9F%BF%E6%B1%A0%E5%9F%9F%E5%90%8D%E5%B0%81%E5%A0%B5\"></a>1. 矿池域名封堵</h4>\n<p>随着时间推移，节点直连区块中心挖矿的模式，已经很难挖到加密货币了，现在更多的人选择将节点连接到矿池的方式获取加密货币。所以，对于企业而言，阻断内网资产对常见挖矿威胁矿池的访问，是一种较为有效的网络侧处置手段。</p>\n<h4 id=\"h4-2-\">\n<a name=\"2.%20%E6%94%BB%E5%87%BB%E9%93%BE%E8%BF%98%E5%8E%9F\"></a>2. 攻击链还原</h4>\n<p>为了确认恶意挖矿事件的攻击链，需要对取证结果、样本分析结果、网络日志等信息进行关联整合，形成攻击事件的流程。还原攻击链的目的主要有三个：一是确认挖矿行为的源头是来自于入侵还是内部员工的违规行为；二是找到内部资产脆弱点，从而对内部资产进行安全升级；三是提取攻击载荷特征，部署入侵监测系统、防火墙过滤规则，便于威胁源头阻断和后续的追溯工作。</p>\n<h4 id=\"h4-3-payload-\">\n<a name=\"3.%20Payload%E6%9F%A5%E6%9D%80\"></a>3. Payload查杀</h4>\n<p>对于一些企业和机构来说，如果内网部署企业级终端安全防护产品，则可通过后台策略进行内网查杀，如果不能则需要根据payload行为编写专杀工具或手动清理感染痕迹。</p>\n<p> </p>\n<h2 name=\"h2-10\" id=\"h2-10\">0x04 挖矿木马事件典型示例</h2>\n<h3 name=\"h3-11\" id=\"h3-11\">\n<a name=\"%E7%A0%B4%E8%A7%A3%E7%89%88%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E8%AF%B1%E5%AF%BC%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85%E6%8C%96%E7%9F%BF%E7%A8%8B%E5%BA%8F%E6%81%B6%E6%84%8F%E4%BA%8B%E4%BB%B6\"></a>破解版应用程序诱导下载安装挖矿程序恶意事件</h3>\n<p>安全分析人员在8月发现内网部分MacOS主机产生挖矿网络告警，通过Review告警信息，资产确认后，锁定若干Mac办公机。进一步取证，分析，发现这些Mac主机确实感染挖矿木马，攻击样本来自百度搜索“MAC使用word文档”等关键字反馈结果的置顶广告推荐。</p>\n<h4 id=\"h4-1-\">\n<a name=\"1.%20%E4%BA%8B%E4%BB%B6%E5%91%8A%E8%AD%A6\"></a>1. 事件告警</h4>\n<p>8月10日前后，内网发现大量挖矿告警，告警地址显示为45.195.146.32，该IP地址对应域名funningx.com，告警端口为3333，产生告警截图如下</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p0.ssl.qhimg.com/t015d7f8e7880034ac4.png\"></p>\n<h4 id=\"h4-2-\">\n<a name=\"2.%20%E8%B5%84%E4%BA%A7%E5%AE%9A%E4%BD%8D%E5%92%8C%E4%B8%BB%E6%9C%BA%E5%8F%96%E8%AF%81\"></a>2. 资产定位和主机取证</h4>\n<p>发现告警后，第一时间从网络资产管理系统中查询告警IP所属主机，确定主机为部分iMac和Macbook。拿到取证机后，接入网络，查看3333端口占用进程信息，定位到一个名为ssl.plist的进程。IDA静态分析样本行为，确认这是一个xmr-stak的矿机程序。</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p5.ssl.qhimg.com/t014e4f4e12684bdab3.png\"></p>\n<p>在~/Library/LaunchAgents，/Library/LaunchDeamos，/Library/LaunchAgents，/System/Library/LaunchDaemons开机启动项中查找ssl.plist路径信息，均无所获，其他开机启动方式检查也未有结果。杀掉进程，删除ssl.plist, cpu.txt, config.txt, pools.txt等配置文件后，重启系统，挖矿程序会重新启动。</p>\n<p>在~/Library/LaunchAgents目录下发现两个plist文件：com.apple.Yahoo.plist和com.apple.Google.plist。其中com.apple.Google.plist是一个plist文件，内容如下：</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p4.ssl.qhimg.com/t01f2feff997421169f.png\"></p>\n<p>该plist配置文件表明系统开机时会启动osascript，并且运行com.apple.Yahoo.plist这个applescript脚本。</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p4.ssl.qhimg.com/t01d3fee8324065e8b0.png\"></p>\n<p>由文件16进制内容可知，这是一个run-only applescript脚本文件。手动启动com.apple.Yahoo.plist，并进行主机行为和网络监测，发现该脚本文件的部分行为是：根据主机类型释放挖矿配置文件，下载<a href=\"http://101.55.20.149/gogoto.png\">http://101.55.20.149/gogoto.png</a> 保存为11.png并运行。</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p5.ssl.qhimg.com/t01a9ab9774b37d2d9e.png\"></p>\n<p>同样用osascript启动脚本，并监控osascript行为和网络行为。行为显示该脚本的部分功能为：下载<a href=\"http://101.55.20.149/ssl.zip\">http://101.55.20.149/ssl.zip</a> 并解压到~/Library/Safari目录下，得到ssl.plist和openssl文件夹，并运行ssl.plist进程。</p>\n<p>根据脚本行为锁定101.55.20.149这个IP，Review被感染主机历史流量日志，发现攻击载荷最初的入口均来自vip1.czscrj.com，由百度搜索“excel mac版下载” “mac 使用word”等关键字查询获取：</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p0.ssl.qhimg.com/t0122ab21578b658c86.png\"></p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p2.ssl.qhimg.com/t01afe91b66553195a4.png\"></p>\n<p>下载office4mac.zip，解压运行，mac主机启动挖矿程序，开始挖矿，主机和网络行为与告警一致。至此取证工作完毕。</p>\n<h4 id=\"h4-3-\">\n<a name=\"3.%20%E6%A0%B7%E6%9C%AC%E8%A1%8C%E4%B8%BA%E5%88%86%E6%9E%90\"></a>3. 样本行为分析</h4>\n<p>office4mac.app 目录结构如下：</p>\n<p>~ /Desktop/office4mac/office4mac.app<br>\n└── Contents<br>\n├── Info.plist<br>\n├── MacOS<br>\n│ └── applet<br>\n├── PkgInfo<br>\n└── Resources<br>\n├── 001.plist ———————-即为com.apple.Yahoo.plist applescript脚本文件<br>\n├── 1.png<br>\n├── 10.png<br>\n├── 2.png<br>\n├── 3.png<br>\n├── 4.png<br>\n├── 5.png<br>\n├── 6.png<br>\n├── 7.png<br>\n├── 8.png<br>\n├── 9.png<br>\n├── Scripts<br>\n│ └── main.scpt ——-程序编译的applescript代码，run-only，不可读<br>\n├── applet.icns<br>\n├── applet.plist<br>\n├── applet.rsrc<br>\n└── description.rtfd<br>\n└── TXT.rtf</p>\n<p>尤其可以认定该样本是一个applescript导出为run-only模式的Mac平台应用程序。由于目前还没有找到run-only applescript 的有效分析方法，逆向osascript的工作还在进行中，但是通过行为监测，可以大致梳理出office4mac.app运行后挖矿工具的安装流程，流程如下：</p>\n<p>(1) 运行office4mac.app 启动office4mac.appContentsMacOSapplet进程，进程行为是加载office4mac.appContentsResourcesScriptsmain.scpt，执行脚本文件。从文件行为检测上看，该脚本的部分功能是：读取主机硬件信息，向~/Library/LaunchAgents/目录下释放com.apple.Google.plist 和com.apple.Yahoo.plist两个文件并com.apple.Google.plist由脚本创建并写入内容，com.apple.Yahoo.plist为样本的资源文件office4mac.appContentsResources01.plist复制到相应目录下。经过测试，com.apple.Yahoo.plist的主要行为是：<a href=\"http://101.55.20.149/gogoto.png\">http://101.55.20.149/gogoto.png</a> 保存为11.png并运行。</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p2.ssl.qhimg.com/t011bbf063b4af38cc9.png\"></p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p3.ssl.qhimg.com/t0153e9fc0eaef46417.jpg\"></p>\n<p>(2) 11.png运行后的脚本检测结果是：自删除，释放挖矿配置文件，cpu.txt，config.txt，pools.txt等。然后调用curl下载<a href=\"http://101.55.20.149/ssl.zip\">http://101.55.20.149/ssl.zip</a> 并解压到~/Library/Safari目录下，得到ssl.plist和openssl文件夹，并运行ssl.plist进程。ssl.plist即为xmr-stak矿机程序。</p>\n<p><img class=\"aligncenter\" alt=\"\" data-original=\"https://p3.ssl.qhimg.com/t01c1a62b735dc8ccde.jpg\"></p>\n<p>另外，在虚拟机中测试office4mac应用程序，不会触发挖矿行为，猜测脚本代码中有虚拟机检测的行为，因代码暂时没能准确解读，所以仅作猜想。</p>\n<h4 id=\"h4-4-\">\n<a name=\"4.%20%E7%94%A8%E6%88%B7%E8%87%AA%E6%9F%A5%E5%92%8C%E7%97%85%E6%AF%92%E6%9F%A5%E6%9D%80%E6%96%B9%E6%A1%88\"></a>4. 用户自查和病毒查杀方案</h4>\n<p>MacOS用户可参考如下方案完成挖矿病毒自查和病毒查杀：</p>\n<pre>1.    终端输入命令netstat –an |grep 3333查看是否有ssl.plist进程绑定3333端口。\r\n2.    查看主机是否运行挖矿进程：ps -ef |grep ssl.plist，如果有进程，则需要用kill pid命令杀掉进程。\r\n3.    通过ls ~/Library/LaunchAgents/ 看目录下是否有com.apple.Google.plist 和com.apple.Yahoo.plist，如果有，则删除文件。\r\n4.    删除~/Library/Safari/目录下的ssl.plist ，cpu.txt ，config.txt，pools.txt 和openssl文件夹，进入相应目录使用rm命令即可。\r\n5.    实测此office4mac应用程序并不会安装mac平台office应用软件，如有需求请寻找其他资源，建议购买正版。\r\n</pre>\n<h4 id=\"h4-5-\">\n<a name=\"5.%20%E5%B0%8F%E7%BB%93\"></a>5. 小结</h4>\n<p>office4mac应用程序的开发者采用导出为run-only applescript的方式生成payload文件，但现阶段对applescript脚本的分析方法还比较匮乏，所以分析人员采用fsmon和dtrace等系统行为检测工具分析样本的行为。关于applescript的逆向，需要后续跟进和分析。</p>\n<p> </p>\n<h2 name=\"h2-12\" id=\"h2-12\">0x05 总结</h2>\n<p>文中给出的基于大数据技术进行挖矿威胁场景的监测方法，从实践的检验来看有非常好的效果，挖矿相关行为会持续产生规律性告警，客户端及网络流量一侧也能准确捕捉到挖矿行为的产生，是一种比较成熟的挖矿行为检测模型。</p>\n<p>关于MacOS平台盗版Office挖矿的事件，由于macos系统对applescript原生支持混淆和编译，这是保护软件著作的一种途径，但也给applescript恶意代码对抗分析，逃避杀软检测带来了捷径。目前applescript的恶意代码比较少见，但如果对此种类型恶意代码的前景做一个大胆预测， applescript恶意代码日后有可能成为MacOS平台中VBS恶意宏脚本的角色。所以，现阶段安全从业者不应对此有所忽视。</p>\n<p>此外，网络攻击形式是有趋利性的，从银行木马，到勒索软件，再到现在各类挖矿木马，本质上都是一个在尽可能短的时间内攫取更多利益的过程。现在很多面向个人和企业的杀软也逐渐推出防挖矿功能，但是对企业来说，仅仅依靠杀软在终端提供支持还远远不够，对MAC系统安全的也不应该有绝对的自信，需要的是完善的威胁监测机制和安全运营流程，不断提升应急响应的效率，减少不必要的损失。</p>\n<p> </p>\n<h2 name=\"h2-13\" id=\"h2-13\">0x06 附录：部分IOC</h2>\n<p>Office4mac.zip：</p>\n<pre>MD5        7e077211cb23838ba48073dde67a80a4\r\nSHA-1        d6118f4ec47ee0c4606b9a1594648ffbafefc3a0\r\nFile Type    ZIP\r\nTRiD        Zip archive data, at least v1.0 to extract\r\nFile Size        3.8 MB\r\n</pre>\n<p>Yahoo.plist：</p>\n<pre>MD5        f3247a8b7a25d35dc88dbd676d7f2476\r\nSHA-1        f3d83291008736e1f8a2d52e064e2decb2c893ba\r\nFile Type    run-only applescript\r\nTRiD        Compiled AppleScript script (100%)\r\nFile Size        4.23 KB\r\n</pre>\n<p>11.png：</p>\n<pre>MD5        1b477f3f2b2af9e22dff5c316fe3d5a9\r\nSHA-1        c6759838dd64c370cc6e728828cc71e738339702\r\nFile Type    run-only applescript\r\nTRiD        Compiled AppleScript script (100%)\r\nFile Size        6.28 KB\r\n</pre>\n<p>ssl.zip：</p>\n<pre>MD5        af08ffb2ddd5c207f0d8b8ded070282c\r\nSHA-1        8bcdc85aec55821791032cb9d6c9f7ab161def3e\r\nFile Type    ZIP\r\nTRiD        ZIP compressed archive (80%)\r\nFile Size        1.12 MB\r\n</pre>\n<p>ssl.plist：</p>\n<pre>MD5        b74ff65d7af518316f5d0230f62f9433\r\nSHA-1        b8f6734ceede14e071320820b9de448ccfa1466f\r\nFile Type    Mach-O\r\nMagic        Mach-O 64-bit executable\r\nTRiD        Mac OS X Mach-O 64bit Intel executable (100%)\r\nFile Size        769.74 KB\r\n</pre>\n</body>\n</html>","index":[{"title":"0x00 背景概述","id":"#h2-0","sub":[]},{"title":"0x01恶意挖矿行为来源","id":"#h2-1","sub":[{"title":"1.企业员工自主挖矿","id":"#h3-2"},{"title":"2.PC感染挖矿木马","id":"#h3-3"},{"title":"3.服务器感染挖矿木马","id":"#h3-4"},{"title":"4.网站挖矿脚本","id":"#h3-5"}]},{"title":"0x02 内网挖矿威胁监控和处置流程","id":"#h2-6","sub":[{"title":"1.内网资产挖矿监控体系","id":"#h3-7"},{"title":"2.恶意挖矿监控和取证模式","id":"#h3-8"},{"title":"3. 后续处置工作","id":"#h3-9"}]},{"title":"0x04 挖矿木马事件典型示例","id":"#h2-10","sub":[{"title":"破解版应用程序诱导下载安装挖矿程序恶意事件","id":"#h3-11"}]},{"title":"0x05 总结","id":"#h2-12","sub":[]},{"title":"0x06 附录：部分IOC","id":"#h2-13","sub":[]}],"success":true},"share":{"title":"恶意挖矿监测运营实践和典型样本预警","desc":"360 MeshFire Team总结归纳出挖矿恶意软件主要检测指标和处置流程，同时给出部分工具，方法和样本案例，供相关从业者参考。本文的后半部分我们以一个捕获到的高危MAC挖矿样本为例，展开此类安全事件的监测和处置过程。","imgUrl":"https://p5.ssl.qhimg.com/sdm/160_160_100/t01d54f46e240bc9226.jpg"},"author":{"nickname":"360 MeshFire Team","user_url":"","id":121034,"avatar":"https://p5.ssl.qhimg.com/t01b22d45fef232c21b.png","banner":"https://p3.ssl.qhimg.com/t014757b72460d855bf.png","location":"北京","user_label":"verify","description":"360MeshFireTeam隶属于360信息安全部，负责360集团基础网络安全防护和运营，专注于基础网络层面的威胁检测和安全研究","register_date":"2017-11-29 02:26:31","self":false,"follow":false,"post_count":10,"follower_count":14,"follow_count":1,"comment_count":0},"relevant":[{"id":286968,"title":"Trezor警告大规模加密钱包网络钓鱼活动","date":"2023-03-03 10:30:48"},{"id":286937,"title":"Parallax RAT利用注入技术瞄准加密货币公司","date":"2023-03-02 11:30:33"},{"id":286629,"title":"加密货币交易所Coinbase遭遇网络诈骗攻击","date":"2023-02-22 11:30:49"},{"id":286624,"title":"挪威当局查获Lazarus黑客584万美元加密货币","date":"2023-02-22 11:00:17"},{"id":286411,"title":"YouTube加密骗局抢走Tether投资者百万+美元","date":"2023-02-15 14:00:56"},{"id":286401,"title":"Enigma信息窃取恶意软件针对加密货币行业","date":"2023-02-15 11:30:02"},{"id":285735,"title":"亚马逊AWS、微软和 Google 都是FTX的债权人","date":"2023-01-29 12:00:58"}],"authorPostList":[{"post_id":222801,"title":"一次QuasarRAT的利用活动发现分析","cover":"https://p5.ssl.qhimg.com/sdm/229_160_100/t013e4c47597f94ade8.jpg","date":"2020-11-18 12:00:29"},{"post_id":160496,"title":"恶意挖矿监测运营实践和典型样本预警","cover":"https://p5.ssl.qhimg.com/sdm/229_160_100/t01d54f46e240bc9226.jpg","date":"2018-09-21 15:30:16"},{"post_id":149059,"title":"利用网游加速器隧道传播挖矿蠕虫事件分析报告","cover":"https://p4.ssl.qhimg.com/sdm/229_160_100/t01df05928b24581ac9.jpg","date":"2018-06-26 11:03:25"},{"post_id":105473,"title":"CVE-2018-0171 Cisco Smart Install远程代码执行漏洞分析","cover":"https://p0.ssl.qhimg.com/sdm/229_160_100/t01c332a1f4ec475bc4.jpg","date":"2018-04-19 15:00:27"},{"post_id":101446,"title":"CVE-2018-0101 Cisco ASA 拒绝服务&远程代码执行漏洞分析","cover":"https://p3.ssl.qhimg.com/sdm/229_160_100/t0151f208f9a86f1f6d.jpg","date":"2018-03-19 16:03:51"}],"cookie":[]}};
//published at: 6/30/2023, 6:04:10 AM</script>

<script src="https://s0.ssl.qhimg.com/static/a89b1e55fab19834,969b9d2ab6d58ff9.js"></script>
<script src="https://s0.ssl.qhimg.com/static/e855bc476c0070c4,d70645fabcfd28e5,b00f894d26352cfe,374cd4f654903275,1fbf0cc911f15a9c.js"></script>
<script src="https://s0.ssl.qhimg.com/static/43c736269a19e5f8,d7c4492c306d9e12.js"></script>
<script src="https://s0.ssl.qhimg.com/static/c3f64e723fc684b2,d29a864a4b5dd4b6,5c4b8b1bbe75533d,f59329488ebbc180,569b6657398e046f,50a9d6f78d7b9c2b,ffa01aa1dfa9875c,1e0c54ddfbe618cb,cc52ec6e18fb5e0f,7e2ef3c63800d75a,163f062eddf12afb,12d46f82993a5686,a0f3df7d061398da,d13f12550890a37e,a1038fbbcca5451e,b4f09346293512df,c4dd2a401c8d680a,2cf22cf2afd2abeb,097579769ff1a9e5,cdf1af3ce7fb15c0,52624e35e0a71a1d,2a6f530aa0ff4ab1,a1dbcc9d979007e3,21c0bbbac4162adc,b48c87c047227d8d,a4c086374473de3d,8986a347a9b1bf47,0df21b2fbcae7ee2,5ed46454edb70992,48968bfda2315809,5df7f89714480d5b,2ac5433e81c47d4c,3458ad5e1fb21426,c0f2dbc584b90d28,9b256882cc6d1129,f45edb50c819dfb9,22dc6a03fc216c80,7603fdbafaed5beb,8f3880f75e82b893,7e4ef35e980d3675,1fbafd3380b80586.js"></script>
</body>

</html>